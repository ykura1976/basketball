<!DOCTYPE html>

<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ€ ãƒã‚¹ã‚±è¨˜éŒ²</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

```
body {
font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
min-height: 100vh;
padding: 20px;
padding-bottom: 80px;
}

.container {
max-width: 600px;
margin: 0 auto;
}

.header {
text-align: center;
color: white;
margin-bottom: 20px;
}

.header h1 {
font-size: 2em;
margin-bottom: 10px;
}

.mode-switch {
display: flex;
gap: 10px;
margin-bottom: 20px;
}

.mode-btn {
flex: 1;
padding: 15px;
border: 2px solid white;
border-radius: 12px;
background: rgba(255,255,255,0.2);
color: white;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}

.mode-btn.active {
background: white;
color: #667eea;
}

.tab-bar {
display: flex;
gap: 10px;
margin-bottom: 20px;
overflow-x: auto;
}

.tab {
flex: 1;
min-width: 80px;
padding: 15px;
background: rgba(255,255,255,0.2);
border: none;
border-radius: 12px;
color: white;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
font-size: 0.85em;
}

.tab.active {
background: white;
color: #667eea;
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.card {
background: white;
border-radius: 20px;
padding: 25px;
margin-bottom: 20px;
box-shadow: 0 10px 30px rgba(0,0,0,0.2);
}

.input-group {
margin-bottom: 15px;
}

.input-group label {
display: block;
font-weight: 600;
margin-bottom: 8px;
color: #333;
font-size: 0.95em;
}

.stepper {
display: flex;
align-items: center;
gap: 12px;
}

.stepper button {
width: 45px;
height: 45px;
border: none;
border-radius: 10px;
background: #667eea;
color: white;
font-size: 22px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}

.stepper button:active {
transform: scale(0.95);
}

.stepper .value {
flex: 1;
text-align: center;
font-size: 26px;
font-weight: bold;
color: #667eea;
}

.stats-grid {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 12px;
margin: 20px 0;
}

.stats-display {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
border-radius: 12px;
padding: 12px;
color: white;
text-align: center;
}

.stats-display h3 {
font-size: 0.85em;
margin-bottom: 5px;
}

.stats-display .percentage {
font-size: 1.8em;
font-weight: bold;
}

.save-btn, .primary-btn {
width: 100%;
padding: 18px;
border: none;
border-radius: 12px;
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
color: white;
font-size: 18px;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}

.save-btn:active, .primary-btn:active {
transform: scale(0.98);
}

.game-item {
background: white;
border-radius: 15px;
padding: 20px;
margin-bottom: 15px;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
position: relative;
transition: all 0.3s;
}

.game-item:hover {
transform: translateY(-2px);
box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.game-checkbox {
position: absolute;
top: 20px;
right: 20px;
width: 24px;
height: 24px;
cursor: pointer;
}

.game-date {
font-weight: bold;
color: #667eea;
margin-bottom: 12px;
font-size: 1.1em;
padding-right: 40px;
}

.game-stats {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 8px;
}

.stat-box {
text-align: center;
padding: 8px;
background: #f7f7f7;
border-radius: 8px;
}

.stat-box .label {
font-size: 0.7em;
color: #666;
margin-bottom: 4px;
}

.stat-box .value {
font-size: 1.1em;
font-weight: bold;
color: #667eea;
}

.delete-selected-btn {
position: fixed;
bottom: 20px;
left: 50%;
transform: translateX(-50%);
padding: 15px 30px;
border: none;
border-radius: 25px;
background: #ff4757;
color: white;
font-size: 16px;
font-weight: bold;
cursor: pointer;
box-shadow: 0 4px 15px rgba(0,0,0,0.3);
z-index: 1000;
display: none;
}

.delete-selected-btn.show {
display: block;
}

.empty-state {
text-align: center;
padding: 40px;
color: #999;
}

.empty-state .icon {
font-size: 4em;
margin-bottom: 15px;
}

input[type="date"], input[type="number"], input[type="text"] {
width: 100%;
padding: 12px;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 16px;
}

.saved-indicator {
position: fixed;
bottom: 20px;
right: 20px;
background: #2ecc71;
color: white;
padding: 12px 20px;
border-radius: 25px;
box-shadow: 0 4px 15px rgba(0,0,0,0.2);
opacity: 0;
transition: opacity 0.3s;
font-weight: bold;
z-index: 1000;
}

.saved-indicator.show {
opacity: 1;
}

.chart-container {
position: relative;
height: 300px;
margin-bottom: 20px;
}

.section-title {
font-size: 1.1em;
font-weight: bold;
margin: 25px 0 15px 0;
color: #333;
border-left: 4px solid #667eea;
padding-left: 10px;
}

.section-title:first-of-type {
margin-top: 0;
}

.player-grid {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 10px;
margin-bottom: 20px;
}

.player-btn {
padding: 15px;
border: 2px solid #e0e0e0;
border-radius: 10px;
background: white;
cursor: pointer;
transition: all 0.3s;
text-align: center;
}

.player-btn.selected {
background: #667eea;
color: white;
border-color: #667eea;
}

.player-btn .number {
font-size: 1.5em;
font-weight: bold;
margin-bottom: 5px;
}

.player-btn .name {
font-size: 0.85em;
}

.player-item {
background: white;
border-radius: 15px;
padding: 20px;
margin-bottom: 15px;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.player-item.editing {
background: #f0f8ff;
border: 2px solid #667eea;
}

.player-info {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
}

.player-info .number {
font-size: 1.5em;
font-weight: bold;
color: #667eea;
}

.my-data-badge {
background: #2ecc71;
color: white;
padding: 4px 10px;
border-radius: 12px;
font-size: 0.8em;
font-weight: bold;
}

.edit-form {
display: none;
margin-top: 15px;
padding-top: 15px;
border-top: 2px solid #e0e0e0;
}

.edit-form.active {
display: block;
}

.action-buttons {
display: grid;
grid-template-columns: repeat(2, 1fr);
gap: 10px;
margin-bottom: 20px;
}

.action-btn {
padding: 20px;
border: none;
border-radius: 12px;
font-size: 1em;
font-weight: bold;
cursor: pointer;
transition: all 0.3s;
}

.action-btn.success {
background: #2ecc71;
color: white;
}

.action-btn.miss {
background: #e0e0e0;
color: #666;
}

.action-btn.other {
background: #667eea;
color: white;
}

.action-btn:active {
transform: scale(0.95);
}

select {
width: 100%;
padding: 12px;
border: 2px solid #e0e0e0;
border-radius: 10px;
font-size: 16px;
background: white;
}

.ranking-table {
width: 100%;
border-collapse: collapse;
margin-top: 15px;
}

.ranking-table th {
background: #f7f7f7;
padding: 12px 8px;
text-align: left;
font-weight: bold;
color: #333;
border-bottom: 2px solid #e0e0e0;
font-size: 0.9em;
}

.ranking-table td {
padding: 12px 8px;
border-bottom: 1px solid #f0f0f0;
font-size: 0.9em;
}

.ranking-table tr:hover {
background: #f9f9f9;
}

.ranking-table .value-cell {
font-weight: bold;
color: #667eea;
font-size: 1.1em;
}

.top-record {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
border-radius: 15px;
padding: 25px;
margin-bottom: 20px;
color: white;
text-align: center;
box-shadow: 0 8px 20px rgba(0,0,0,0.2);
}

.top-record .trophy {
font-size: 3em;
margin-bottom: 10px;
}

.top-record .value {
font-size: 3em;
font-weight: bold;
margin: 10px 0;
}

.top-record .details {
font-size: 1.1em;
opacity: 0.95;
}

.play-history {
margin-top: 15px;
max-height: 200px;
overflow-y: auto;
background: #f7f7f7;
border-radius: 10px;
padding: 10px;
}

.play-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 8px;
background: white;
border-radius: 8px;
margin-bottom: 8px;
}

.play-item:last-child {
margin-bottom: 0;
}

.undo-btn {
padding: 6px 12px;
border: none;
border-radius: 6px;
background: #ff4757;
color: white;
font-size: 0.85em;
cursor: pointer;
}

.team-stat-card {
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
border-radius: 15px;
padding: 20px;
color: white;
margin-bottom: 20px;
text-align: center;
}

.team-stat-card .big-number {
font-size: 3em;
font-weight: bold;
margin: 10px 0;
}

.team-stat-card .label {
font-size: 1.1em;
opacity: 0.9;
}

.rank-badge {
display: inline-block;
min-width: 35px;
padding: 5px 10px;
border-radius: 20px;
font-weight: bold;
text-align: center;
margin-right: 10px;
}

.rank-1 { background: #FFD700; color: #333; }
.rank-2 { background: #C0C0C0; color: #333; }
.rank-3 { background: #CD7F32; color: white; }

.member-card {
background: white;
border-radius: 12px;
padding: 15px;
margin-bottom: 12px;
box-shadow: 0 2px 8px rgba(0,0,0,0.1);
cursor: pointer;
transition: all 0.3s;
}

.member-card:hover {
transform: translateY(-2px);
box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.member-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 10px;
}

.member-name {
font-size: 1.2em;
font-weight: bold;
color: #667eea;
}

.member-stats {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 8px;
font-size: 0.9em;
}

.team-code-display {
background: #f0f0f0;
padding: 15px;
border-radius: 10px;
text-align: center;
margin: 20px 0;
}

.team-code-display .code {
font-size: 2em;
font-weight: bold;
color: #667eea;
letter-spacing: 2px;
margin: 10px 0;
}

.team-game-item {
background: white;
border-radius: 15px;
padding: 20px;
margin-bottom: 15px;
box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.team-game-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 15px;
padding-bottom: 15px;
border-bottom: 2px solid #f0f0f0;
}

.team-game-date {
font-size: 1.2em;
font-weight: bold;
color: #667eea;
}

.team-game-opponent {
font-size: 1em;
color: #666;
}

.team-game-stats {
display: grid;
gap: 10px;
}

.player-stat-row {
display: grid;
grid-template-columns: 2fr 1fr 1fr 1fr;
gap: 10px;
padding: 8px;
background: #f7f7f7;
border-radius: 8px;
align-items: center;
}

.player-stat-name {
font-weight: bold;
color: #333;
}

.player-stat-value {
text-align: center;
font-weight: bold;
color: #667eea;
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0,0,0,0.5);
z-index: 2000;
align-items: center;
justify-content: center;
}

.modal.active {
display: flex;
}

.modal-content {
background: white;
border-radius: 20px;
padding: 30px;
max-width: 400px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
}

.modal-title {
font-size: 1.5em;
font-weight: bold;
margin-bottom: 20px;
color: #333;
}

.close-modal {
background: #95a5a6;
color: white;
border: none;
padding: 12px;
border-radius: 10px;
width: 100%;
margin-top: 15px;
font-size: 16px;
cursor: pointer;
}

.backup-reminder {
background: #fff3cd;
border-left: 4px solid #ffc107;
padding: 15px;
border-radius: 8px;
margin-bottom: 20px;
display: none;
}

.backup-reminder.show {
display: block;
}

.backup-reminder h3 {
color: #856404;
margin-bottom: 8px;
}

.backup-reminder p {
color: #856404;
font-size: 0.9em;
margin-bottom: 10px;
}
</style>
```

</head>
<body>
<div class="container">
<div class="header">
<h1>ğŸ€ ãƒã‚¹ã‚±è¨˜éŒ²</h1>
<p>æˆé•·ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>
</div>

```
<div id="backupReminder" class="backup-reminder">
<h3>âš ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ãŠå¿˜ã‚Œãªãï¼</h3>
<p>10è©¦åˆä»¥ä¸Šè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚å¤§åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’å®ˆã‚‹ãŸã‚ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚</p>
<button class="primary-btn" style="background: #ffc107; color: #856404;" onclick="exportData()">ä»Šã™ããƒãƒƒã‚¯ã‚¢ãƒƒãƒ—</button>
</div>

<div class="mode-switch">
<button class="mode-btn active" onclick="switchMode('personal')">ğŸ‘¤ å€‹äºº</button>
<button class="mode-btn" onclick="switchMode('team')">ğŸ‘¥ ãƒãƒ¼ãƒ </button>
</div>

<!-- å€‹äººãƒ¢ãƒ¼ãƒ‰ -->
<div id="personalMode">
<div class="tab-bar">
<button class="tab active" onclick="switchTab('input')">ğŸ“ è¨˜éŒ²</button>
<button class="tab" onclick="switchTab('list')">ğŸ“Š å±¥æ­´</button>
<button class="tab" onclick="switchTab('ranking')">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
<button class="tab" onclick="switchTab('graph')">ğŸ“ˆ ã‚°ãƒ©ãƒ•</button>
<button class="tab" onclick="switchTab('settings')">âš™ï¸ è¨­å®š</button>
</div>

<!-- å…¥åŠ›ã‚¿ãƒ– -->
<div id="inputTab" class="tab-content active">
<div class="card">
<h2 style="margin-bottom: 20px;">æ–°ã—ã„è©¦åˆã‚’è¨˜éŒ²</h2>

<div class="input-group">
<label>è©¦åˆæ—¥</label>
<input type="date" id="gameDate">
</div>

<div class="input-group">
<label>å¯¾æˆ¦ç›¸æ‰‹</label>
<input type="text" id="opponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
</div>

<div class="input-group">
<label>ãƒ—ãƒ¬ã‚¤æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
<input type="number" id="playTime" value="0" min="0" max="200">
</div>

<div class="section-title">ğŸ€ ã‚·ãƒ¥ãƒ¼ãƒˆ</div>

<div class="input-group">
<label>2ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ</label>
<div class="stepper">
<button onclick="changeValue('twoPointsMade', -1)">âˆ’</button>
<div class="value" id="twoPointsMade">0</div>
<button onclick="changeValue('twoPointsMade', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>2ãƒã‚¤ãƒ³ãƒˆè©¦æŠ•</label>
<div class="stepper">
<button onclick="changeValue('twoPointsAttempted', -1)">âˆ’</button>
<div class="value" id="twoPointsAttempted">0</div>
<button onclick="changeValue('twoPointsAttempted', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>3ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ</label>
<div class="stepper">
<button onclick="changeValue('threePointsMade', -1)">âˆ’</button>
<div class="value" id="threePointsMade">0</div>
<button onclick="changeValue('threePointsMade', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>3ãƒã‚¤ãƒ³ãƒˆè©¦æŠ•</label>
<div class="stepper">
<button onclick="changeValue('threePointsAttempted', -1)">âˆ’</button>
<div class="value" id="threePointsAttempted">0</div>
<button onclick="changeValue('threePointsAttempted', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼æˆåŠŸ</label>
<div class="stepper">
<button onclick="changeValue('freeThrowsMade', -1)">âˆ’</button>
<div class="value" id="freeThrowsMade">0</div>
<button onclick="changeValue('freeThrowsMade', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼è©¦æŠ•</label>
<div class="stepper">
<button onclick="changeValue('freeThrowsAttempted', -1)">âˆ’</button>
<div class="value" id="freeThrowsAttempted">0</div>
<button onclick="changeValue('freeThrowsAttempted', 1)">ï¼‹</button>
</div>
</div>

<div class="stats-grid">
<div class="stats-display">
<h3>2PæˆåŠŸç‡</h3>
<div class="percentage" id="twoPointPercentage">0%</div>
</div>
<div class="stats-display">
<h3>3PæˆåŠŸç‡</h3>
<div class="percentage" id="threePointPercentage">0%</div>
</div>
<div class="stats-display">
<h3>FTæˆåŠŸç‡</h3>
<div class="percentage" id="freeThrowPercentage">0%</div>
</div>
<div class="stats-display">
<h3>ç·å¾—ç‚¹</h3>
<div class="percentage" id="totalPoints">0</div>
</div>
</div>

<div class="section-title">ğŸ¯ ãƒªãƒã‚¦ãƒ³ãƒ‰</div>

<div class="input-group">
<label>ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</label>
<div class="stepper">
<button onclick="changeValue('offensiveRebounds', -1)">âˆ’</button>
<div class="value" id="offensiveRebounds">0</div>
<button onclick="changeValue('offensiveRebounds', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</label>
<div class="stepper">
<button onclick="changeValue('defensiveRebounds', -1)">âˆ’</button>
<div class="value" id="defensiveRebounds">0</div>
<button onclick="changeValue('defensiveRebounds', 1)">ï¼‹</button>
</div>
</div>

<div class="section-title">ğŸ“Š ãã®ä»–ã®çµ±è¨ˆ</div>

<div class="input-group">
<label>ã‚¢ã‚·ã‚¹ãƒˆ</label>
<div class="stepper">
<button onclick="changeValue('assists', -1)">âˆ’</button>
<div class="value" id="assists">0</div>
<button onclick="changeValue('assists', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</label>
<div class="stepper">
<button onclick="changeValue('steals', -1)">âˆ’</button>
<div class="value" id="steals">0</div>
<button onclick="changeValue('steals', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ãƒ–ãƒ­ãƒƒã‚¯</label>
<div class="stepper">
<button onclick="changeValue('blocks', -1)">âˆ’</button>
<div class="value" id="blocks">0</div>
<button onclick="changeValue('blocks', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</label>
<div class="stepper">
<button onclick="changeValue('turnovers', -1)">âˆ’</button>
<div class="value" id="turnovers">0</div>
<button onclick="changeValue('turnovers', 1)">ï¼‹</button>
</div>
</div>

<div class="input-group">
<label>ãƒ•ã‚¡ã‚¦ãƒ«</label>
<div class="stepper">
<button onclick="changeValue('fouls', -1)">âˆ’</button>
<div class="value" id="fouls">0</div>
<button onclick="changeValue('fouls', 1)">ï¼‹</button>
</div>
</div>

<button class="save-btn" onclick="savePersonalGame()">è¨˜éŒ²ã‚’ä¿å­˜</button>
</div>
</div>

<!-- å±¥æ­´ã‚¿ãƒ– -->
<div id="listTab" class="tab-content">
<div id="gameList"></div>
</div>

<!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¿ãƒ– -->
<div id="rankingTab" class="tab-content">
<div class="card">
<h2 style="margin-bottom: 20px;">ğŸ† ãƒ™ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>

<h3 style="margin: 30px 0 15px 0; color: #667eea; font-size: 1.3em;">æœ€é«˜å¾—ç‚¹</h3>
<div id="topPoints"></div>

<h3 style="margin: 40px 0 15px 0; color: #667eea; font-size: 1.3em;">æœ€é«˜2PæˆåŠŸç‡</h3>
<div id="top2P"></div>

<h3 style="margin: 40px 0 15px 0; color: #667eea; font-size: 1.3em;">æœ€é«˜3PæˆåŠŸç‡</h3>
<div id="top3P"></div>

<h3 style="margin: 40px 0 15px 0; color: #667eea; font-size: 1.3em;">æœ€é«˜FTæˆåŠŸç‡</h3>
<div id="topFT"></div>

<h3 style="margin: 40px 0 15px 0; color: #667eea; font-size: 1.3em;">æœ€å¤šãƒªãƒã‚¦ãƒ³ãƒ‰</h3>
<div id="topRebounds"></div>

<h3 style="margin: 40px 0 15px 0; color: #667eea; font-size: 1.3em;">æœ€å¤šã‚¢ã‚·ã‚¹ãƒˆ</h3>
<div id="topAssists"></div>
</div>
</div>

<!-- ã‚°ãƒ©ãƒ•ã‚¿ãƒ– -->
<div id="graphTab" class="tab-content">
<div class="card">
<h2 style="margin-bottom: 20px;">ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ã®æ¨ç§»</h2>
<div class="chart-container">
<canvas id="shootingChart"></canvas>
</div>
</div>
<div class="card">
<h2 style="margin-bottom: 20px;">ç·å¾—ç‚¹ã®æ¨ç§»</h2>
<div class="chart-container">
<canvas id="pointsChart"></canvas>
</div>
</div>
<div class="card">
<h2 style="margin-bottom: 20px;">ãƒªãƒã‚¦ãƒ³ãƒ‰ã®æ¨ç§»</h2>
<div class="chart-container">
<canvas id="reboundsChart"></canvas>
</div>
</div>
<div class="card">
<h2 style="margin-bottom: 20px;">ãã®ä»–ã®çµ±è¨ˆ</h2>
<div class="chart-container">
<canvas id="otherStatsChart"></canvas>
</div>
</div>
<div class="card">
<h2 style="margin-bottom: 20px;">ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹çµ±è¨ˆ</h2>
<div class="chart-container">
<canvas id="defenseChart"></canvas>
</div>
</div>
</div>

<!-- è¨­å®šã‚¿ãƒ– -->
<div id="settingsTab" class="tab-content">
<div class="card">
<h2 style="margin-bottom: 20px;">ğŸ‘¤ å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºè¨­å®š</h2>
<div class="input-group">
<label>å€‹äººãƒ¢ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹é¸æ‰‹</label>
<select id="myPlayerSelect" onchange="changeMyPlayer()">
<option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
</select>
</div>
<p style="color: #666; font-size: 0.9em; margin-top: 10px;">
é¸æŠã—ãŸé¸æ‰‹ã®å€‹äººæˆç¸¾ãŒå€‹äººãƒ¢ãƒ¼ãƒ‰ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚<br>
ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã§ã“ã®é¸æ‰‹ãŒè¨˜éŒ²ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚‚è‡ªå‹•çš„ã«å€‹äººãƒ¢ãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã¾ã™ã€‚
</p>
</div>

<div class="card">
<h2 style="margin-bottom: 20px;">ğŸ‘¥ é¸æ‰‹ç™»éŒ²</h2>
<div class="input-group">
<label>èƒŒç•ªå·</label>
<input type="number" id="playerNumber" placeholder="ä¾‹: 7" min="0" max="99">
</div>
<div class="input-group">
<label>åå‰</label>
<input type="text" id="playerName" placeholder="ä¾‹: å±±ç”° èŠ±å­">
</div>
<button class="primary-btn" style="margin-top: 15px;" onclick="addPlayer()">é¸æ‰‹ã‚’è¿½åŠ </button>
</div>

<div class="card">
<h2 style="margin-bottom: 20px;">ç™»éŒ²æ¸ˆã¿é¸æ‰‹</h2>
<div id="playerList"></div>
</div>

<div class="card">
<h2 style="margin-bottom: 20px;">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
<p style="color: #666; margin-bottom: 15px;">å¤§åˆ‡ãªãƒ‡ãƒ¼ã‚¿ã‚’å®ˆã‚‹ãŸã‚ã€å®šæœŸçš„ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ã‚‡ã†</p>

<button class="primary-btn" style="background: #2ecc71; margin-bottom: 10px;" onclick="exportData()">
ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
</button>

<button class="primary-btn" style="background: #3498db;" onclick="document.getElementById('importFile').click()">
ğŸ“‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
</button>
<input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">

<div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
<strong>âš ï¸ é‡è¦ï¼š</strong>
<ul style="margin: 10px 0 0 20px; line-height: 1.8;">
<li>ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆå»ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚‚æ¶ˆãˆã¾ã™</li>
<li>ã‚¢ãƒ—ãƒªã‚’æ›´æ–°ã™ã‚‹å‰ã«å¿…ãšãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãã ã•ã„</li>
<li>ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„</li>
</ul>
</div>
</div>
</div>
</div>

<!-- ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ -->
<div id="teamMode" style="display: none;">
<div class="tab-bar">
<button class="tab active" onclick="switchTeamTab('record')">ğŸ“ è¨˜éŒ²</button>
<button class="tab" onclick="switchTeamTab('history')">ğŸ“Š å±¥æ­´</button>
</div>

<!-- ãƒãƒ¼ãƒ è¨˜éŒ²ã‚¿ãƒ– -->
<div id="teamRecordTab" class="tab-content active">
<div class="card">
<h2 style="margin-bottom: 20px;">è©¦åˆè¨˜éŒ²</h2>

<div class="input-group">
<label>è©¦åˆæ—¥</label>
<input type="date" id="teamGameDate">
</div>

<div class="input-group">
<label>å¯¾æˆ¦ç›¸æ‰‹</label>
<input type="text" id="teamOpponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
</div>

<button class="primary-btn" onclick="startTeamGame()">è©¦åˆé–‹å§‹</button>
</div>

<div id="teamRecording" style="display: none;">
<div class="card">
<h2 style="margin-bottom: 15px;">é¸æ‰‹ã‚’é¸æŠ</h2>
<div id="playerSelector" class="player-grid"></div>
</div>

<div class="card">
<h2 style="margin-bottom: 15px;">ãƒ—ãƒ¬ã‚¤ã‚’è¨˜éŒ²</h2>
<div class="action-buttons">
<button class="action-btn success" onclick="recordPlay('2p-made')">2PæˆåŠŸ</button>
<button class="action-btn miss" onclick="recordPlay('2p-miss')">2På¤±æ•—</button>
<button class="action-btn success" onclick="recordPlay('3p-made')">3PæˆåŠŸ</button>
<button class="action-btn miss" onclick="recordPlay('3p-miss')">3På¤±æ•—</button>
<button class="action-btn success" onclick="recordPlay('ft-made')">FTæˆåŠŸ</button>
<button class="action-btn miss" onclick="recordPlay('ft-miss')">FTå¤±æ•—</button>
<button class="action-btn other" onclick="recordPlay('oreb')">ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</button>
<button class="action-btn other" onclick="recordPlay('dreb')">ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</button>
<button class="action-btn other" onclick="recordPlay('ast')">ã‚¢ã‚·ã‚¹ãƒˆ</button>
<button class="action-btn other" onclick="recordPlay('stl')">ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</button>
<button class="action-btn other" onclick="recordPlay('blk')">ãƒ–ãƒ­ãƒƒã‚¯</button>
<button class="action-btn other" onclick="recordPlay('to')">ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</button>
<button class="action-btn other" onclick="recordPlay('foul')">ãƒ•ã‚¡ã‚¦ãƒ«</button>
</div>

<div class="play-history" id="playHistory">
<div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
</div>
</div>

<div class="card">
<h2 style="margin-bottom: 15px;">è©¦åˆçµ±è¨ˆ</h2>
<div id="teamStats"></div>
<button class="save-btn" style="margin-top: 20px;" onclick="saveTeamGame()">è©¦åˆçµ‚äº†ãƒ»ä¿å­˜</button>
</div>
</div>
</div>

<!-- ãƒãƒ¼ãƒ å±¥æ­´ã‚¿ãƒ– -->
<div id="teamHistoryTab" class="tab-content">
<div id="teamGameList"></div>
</div>
</div>
</div>

<button class="delete-selected-btn" id="deleteSelectedBtn" onclick="deleteSelectedGames()">é¸æŠã—ãŸè¨˜éŒ²ã‚’å‰Šé™¤</button>
<div class="saved-indicator" id="savedIndicator">âœ“ ä¿å­˜ã—ã¾ã—ãŸ</div>

<script>
let currentMode = 'personal';
let currentTeamTab = 'record';
let personalGames = [];
let teamGames = [];
let players = [];
let myPlayerId = null;
let selectedGameIds = new Set();
let editingPlayerId = null;
let lastBackupCheck = null;

let stats = {
twoPointsMade: 0, twoPointsAttempted: 0,
threePointsMade: 0, threePointsAttempted: 0,
freeThrowsMade: 0, freeThrowsAttempted: 0,
offensiveRebounds: 0, defensiveRebounds: 0,
assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
};

let currentTeamGame = null;
let selectedPlayer = null;
let charts = {};

function loadData() {
try {
const saved = localStorage.getItem('basketballData');
if (saved) {
const data = JSON.parse(saved);
personalGames = data.personalGames || [];
teamGames = data.teamGames || [];
players = data.players || [];
myPlayerId = data.myPlayerId || null;
lastBackupCheck = data.lastBackupCheck || null;
}
checkBackupReminder();
} catch (e) {
console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
}
}

function saveData() {
const data = {
personalGames,
teamGames,
players,
myPlayerId,
lastBackupCheck: lastBackupCheck || new Date().toISOString()
};
localStorage.setItem('basketballData', JSON.stringify(data));
showSavedIndicator();
checkBackupReminder();
}

function checkBackupReminder() {
const totalGames = personalGames.length + teamGames.length;
const reminder = document.getElementById('backupReminder');

if (totalGames >= 10) {
if (!lastBackupCheck || daysSinceDate(lastBackupCheck) >= 7) {
reminder.classList.add('show');
}
} else {
reminder.classList.remove('show');
}
}

function daysSinceDate(dateStr) {
const date = new Date(dateStr);
const now = new Date();
const diff = now - date;
return Math.floor(diff / (1000 * 60 * 60 * 24));
}

function exportData() {
const data = {
version: '1.1',
exportDate: new Date().toISOString(),
personalGames,
teamGames,
players,
myPlayerId
};

const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `ãƒã‚¹ã‚±è¨˜éŒ²_${new Date().toISOString().split('T')[0]}.json`;
a.click();
URL.revokeObjectURL(url);

lastBackupCheck = new Date().toISOString();
saveData();
document.getElementById('backupReminder').classList.remove('show');

alert('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤§åˆ‡ã«ä¿ç®¡ã—ã¦ãã ã•ã„ã€‚');
}

function importData(e) {
const file = e.target.files[0];
if (!file) return;

const reader = new FileReader();
reader.onload = function(ev) {
try {
const data = JSON.parse(ev.target.result);
if (confirm('âš ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™\n\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
personalGames = data.personalGames || [];
teamGames = data.teamGames || [];
players = data.players || [];
myPlayerId = data.myPlayerId || null;
saveData();
displayGames();
displayPlayers();
displayTeamGames();
alert('âœ… ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸï¼');
location.reload(); // å®Œå…¨ã«ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
}
} catch (err) {
alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ\n\næ­£ã—ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', err);
}
};
reader.readAsText(file);
e.target.value = '';
}

function showSavedIndicator() {
const indicator = document.getElementById('savedIndicator');
indicator.classList.add('show');
setTimeout(() => indicator.classList.remove('show'), 2000);
}

document.getElementById('gameDate').valueAsDate = new Date();
document.getElementById('teamGameDate').valueAsDate = new Date();

function switchMode(mode) {
currentMode = mode;
document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));

if (mode === 'personal') {
document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
document.getElementById('personalMode').style.display = 'block';
document.getElementById('teamMode').style.display = 'none';
displayGames();
} else if (mode === 'team') {
document.querySelector('.mode-btn:nth-child(2)').classList.add('active');
document.getElementById('personalMode').style.display = 'none';
document.getElementById('teamMode').style.display = 'block';
displayTeamGames();
}
}

function switchTab(tab) {
document.querySelectorAll('#personalMode .tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('#personalMode .tab-content').forEach(c => c.classList.remove('active'));

const tabs = ['input', 'list', 'ranking', 'graph', 'settings'];
const index = tabs.indexOf(tab);
document.querySelector(`#personalMode .tab:nth-child(${index + 1})`).classList.add('active');
document.getElementById(tab + 'Tab').classList.add('active');

if (tab === 'graph') updateCharts();
if (tab === 'settings') { displayPlayers(); updateMyPlayerSelect(); }
if (tab === 'ranking') displayRankings();
if (tab === 'list') displayGames();
}

function switchTeamTab(tab) {
currentTeamTab = tab;
document.querySelectorAll('#teamMode .tab').forEach(t => t.classList.remove('active'));
document.querySelectorAll('#teamMode .tab-content').forEach(c => c.classList.remove('active'));

if (tab === 'record') {
document.querySelector('#teamMode .tab:nth-child(1)').classList.add('active');
document.getElementById('teamRecordTab').classList.add('active');
} else {
document.querySelector('#teamMode .tab:nth-child(2)').classList.add('active');
document.getElementById('teamHistoryTab').classList.add('active');
displayTeamGames();
}
}

function changeValue(key, delta) {
stats[key] = Math.max(0, stats[key] + delta);

// æˆåŠŸæ•°ãŒè©¦æŠ•æ•°ã‚’è¶…ãˆãªã„ã‚ˆã†ã«èª¿æ•´
if (key === 'twoPointsMade' && stats.twoPointsMade > stats.twoPointsAttempted) {
stats.twoPointsAttempted = stats.twoPointsMade;
}
if (key === 'twoPointsAttempted' && stats.twoPointsMade > stats.twoPointsAttempted) {
stats.twoPointsMade = stats.twoPointsAttempted;
}
if (key === 'threePointsMade' && stats.threePointsMade > stats.threePointsAttempted) {
stats.threePointsAttempted = stats.threePointsMade;
}
if (key === 'threePointsAttempted' && stats.threePointsMade > stats.threePointsAttempted) {
stats.threePointsMade = stats.threePointsAttempted;
}
if (key === 'freeThrowsMade' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
stats.freeThrowsAttempted = stats.freeThrowsMade;
}
if (key === 'freeThrowsAttempted' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
stats.freeThrowsMade = stats.freeThrowsAttempted;
}

updateDisplay();
}

function updateDisplay() {
Object.keys(stats).forEach(key => {
const el = document.getElementById(key);
if (el) el.textContent = stats[key];
});

const twoP = stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0';
const threeP = stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0';
const ft = stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0';
const totalPoints = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;

document.getElementById('twoPointPercentage').textContent = twoP + '%';
document.getElementById('threePointPercentage').textContent = threeP + '%';
document.getElementById('freeThrowPercentage').textContent = ft + '%';
document.getElementById('totalPoints').textContent = totalPoints;
}

function savePersonalGame() {
const date = document.getElementById('gameDate').value;
if (!date) {
alert('è©¦åˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
return;
}

const game = {
id: Date.now(),
date: date,
opponent: document.getElementById('opponent').value.trim(),
playTime: parseInt(document.getElementById('playTime').value) || 0,
playerId: myPlayerId,
...stats,
totalRebounds: stats.offensiveRebounds + stats.defensiveRebounds,
twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
totalPoints: (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade,
source: 'personal'
};

personalGames.unshift(game);
saveData();
displayGames();
resetForm();

alert('âœ… è©¦åˆè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
}

function resetForm() {
Object.keys(stats).forEach(key => stats[key] = 0);
document.getElementById('gameDate').valueAsDate = new Date();
document.getElementById('opponent').value = '';
document.getElementById('playTime').value = 0;
updateDisplay();
}

function toggleGameSelection(id) {
if (selectedGameIds.has(id)) {
selectedGameIds.delete(id);
} else {
selectedGameIds.add(id);
}

const deleteBtn = document.getElementById('deleteSelectedBtn');
if (selectedGameIds.size > 0) {
deleteBtn.classList.add('show');
deleteBtn.textContent = `é¸æŠã—ãŸ${selectedGameIds.size}ä»¶ã®è¨˜éŒ²ã‚’å‰Šé™¤`;
} else {
deleteBtn.classList.remove('show');
}
}

function deleteSelectedGames() {
if (selectedGameIds.size === 0) return;
if (confirm(`é¸æŠã—ãŸ${selectedGameIds.size}ä»¶ã®è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
personalGames = personalGames.filter(g => !selectedGameIds.has(g.id));
selectedGameIds.clear();
saveData();
displayGames();
document.getElementById('deleteSelectedBtn').classList.remove('show');
}
}

function displayGames() {
const list = document.getElementById('gameList');

const myGames = personalGames.filter(g => !g.playerId || g.playerId === myPlayerId);

if (myGames.length === 0) {
list.innerHTML = '<div class="empty-state"><div class="icon">ğŸ€</div><h3>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>æœ€åˆã®è©¦åˆã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p></div>';
return;
}

list.innerHTML = myGames.map(g => {
const player = g.playerId ? players.find(p => p.id === g.playerId) : null;
return `
<div class="game-item">
<input type="checkbox" class="game-checkbox" ${selectedGameIds.has(g.id) ? 'checked' : ''} onchange="toggleGameSelection(${g.id})">
<div class="game-date">
${new Date(g.date).toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'})}
${g.opponent ? ` vs ${g.opponent}` : ''}
${g.playTime ? ` (${g.playTime}åˆ†)` : ''}
${g.source === 'team' ? ' <span style="background: #2ecc71; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">ãƒãƒ¼ãƒ è¨˜éŒ²</span>' : ''}
</div>
<div class="game-stats">
<div class="stat-box"><div class="label">ç·å¾—ç‚¹</div><div class="value">${g.totalPoints}ç‚¹</div></div>
<div class="stat-box"><div class="label">2Pç‡</div><div class="value">${g.twoPointPercentage}%</div></div>
<div class="stat-box"><div class="label">3Pç‡</div><div class="value">${g.threePointPercentage}%</div></div>
<div class="stat-box"><div class="label">FTç‡</div><div class="value">${g.freeThrowPercentage}%</div></div>
<div class="stat-box"><div class="label">ãƒªãƒã‚¦ãƒ³ãƒ‰</div><div class="value">${g.totalRebounds}</div></div>
<div class="stat-box"><div class="label">ã‚¢ã‚·ã‚¹ãƒˆ</div><div class="value">${g.assists}</div></div>
</div>
</div>
`;
}).join('');
}

function displayTeamGames() {
const list = document.getElementById('teamGameList');

if (teamGames.length === 0) {
list.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘¥</div><h3>ãƒãƒ¼ãƒ è©¦åˆã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>ãƒãƒ¼ãƒ ã§è©¦åˆã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p></div>';
return;
}

list.innerHTML = teamGames.map(g => {
let html = `
<div class="team-game-item">
<div class="team-game-header">
<div>
<div class="team-game-date">
${new Date(g.date).toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'})}
</div>
<div class="team-game-opponent">vs ${g.opponent || 'ç›¸æ‰‹ãƒãƒ¼ãƒ '}</div>
</div>
</div>
<div class="team-game-stats">
`;

// å„é¸æ‰‹ã®çµ±è¨ˆã‚’è¡¨ç¤º
Object.keys(g.playerStats).forEach(playerId => {
const player = players.find(p => p.id === playerId);
if (player) {
const stats = g.playerStats[playerId];
const points = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
const rebounds = stats.offensiveRebounds + stats.defensiveRebounds;

html += `
<div class="player-stat-row">
<div class="player-stat-name">#${player.number} ${player.name}</div>
<div class="player-stat-value">${points}ç‚¹</div>
<div class="player-stat-value">${rebounds}R</div>
<div class="player-stat-value">${stats.assists}A</div>
</div>
`;
}
});

html += `
</div>
</div>
`;
return html;
}).join('');
```
}

// displayRankingsé–¢æ•°
function displayRankings() {
    const myGames = personalGames.filter(g => !g.playerId || g.playerId === myPlayerId);
    
    if (myGames.length === 0) {
        ['topPoints', 'top2P', 'top3P', 'topFT', 'topRebounds', 'topAssists'].forEach(id => {
            document.getElementById(id).innerHTML = '<p style="text-align: center; color: #999;">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        });
        return;
    }

    const topPoints = [...myGames].sort((a, b) => b.totalPoints - a.totalPoints).slice(0, 10);
    const top2P = [...myGames].filter(g => g.twoPointsAttempted >= 3).sort((a, b) => parseFloat(b.twoPointPercentage) - parseFloat(a.twoPointPercentage)).slice(0, 10);
    const top3P = [...myGames].filter(g => g.threePointsAttempted >= 3).sort((a, b) => parseFloat(b.threePointPercentage) - parseFloat(a.threePointPercentage)).slice(0, 10);
    const topFT = [...myGames].filter(g => g.freeThrowsAttempted >= 3).sort((a, b) => parseFloat(b.freeThrowPercentage) - parseFloat(a.freeThrowPercentage)).slice(0, 10);
    const topRebounds = [...myGames].sort((a, b) => b.totalRebounds - a.totalRebounds).slice(0, 10);
    const topAssists = [...myGames].sort((a, b) => b.assists - a.assists).slice(0, 10);

    function renderRanking(games, key, unit = '', title = '') {
        if (games.length === 0) return '<p style="text-align: center; color: #999;">è©¦æŠ•3æœ¬ä»¥ä¸Šã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';

        const top = games[0];
        const val = typeof top[key] === 'number' ? top[key] : parseFloat(top[key]);
        
        let html = `
            <div class="top-record">
                <div class="trophy">ğŸ†</div>
                <div style="font-size: 1.2em; margin-bottom: 10px;">${title}</div>
                <div class="value">${val}${unit}</div>
                <div class="details">
                    ${new Date(top.date).toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'})}
                    ${top.opponent ? '<br>vs ' + top.opponent : ''}
                </div>
            </div>
            <table class="ranking-table">
                <thead><tr><th>é †ä½</th><th>è¨˜éŒ²</th><th>æ—¥ä»˜</th><th>å¯¾æˆ¦ç›¸æ‰‹</th></tr></thead>
                <tbody>
        `;

        games.forEach((g, i) => {
            const v = typeof g[key] === 'number' ? g[key] : parseFloat(g[key]);
            const badge = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1);
            html += `
                <tr>
                    <td style="text-align: center; font-weight: bold;">${badge}</td>
                    <td class="value-cell">${v}${unit}</td>
                    <td>${new Date(g.date).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'})}</td>
                    <td>${g.opponent || '-'}</td>
                </tr>
            `;
        });

        return html + '</tbody></table>';
    }

    document.getElementById('topPoints').innerHTML = renderRanking(topPoints, 'totalPoints', 'ç‚¹', 'æœ€é«˜å¾—ç‚¹');
    document.getElementById('top2P').innerHTML = renderRanking(top2P, 'twoPointPercentage', '%', 'æœ€é«˜2PæˆåŠŸç‡');
    document.getElementById('top3P').innerHTML = renderRanking(top3P, 'threePointPercentage', '%', 'æœ€é«˜3PæˆåŠŸç‡');
    document.getElementById('topFT').innerHTML = renderRanking(topFT, 'freeThrowPercentage', '%', 'æœ€é«˜FTæˆåŠŸç‡');
    document.getElementById('topRebounds').innerHTML = renderRanking(topRebounds, 'totalRebounds', 'æœ¬', 'æœ€å¤šãƒªãƒã‚¦ãƒ³ãƒ‰');
    document.getElementById('topAssists').innerHTML = renderRanking(topAssists, 'assists', 'æœ¬', 'æœ€å¤šã‚¢ã‚·ã‚¹ãƒˆ');
}

// updateChartsé–¢æ•°
function updateCharts() {
    const myGames = personalGames.filter(g => !g.playerId || g.playerId === myPlayerId);
    
    if (myGames.length === 0) return;

    const sorted = [...myGames].reverse();
    const labels = sorted.map(g => {
        const d = new Date(g.date).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'});
        return g.opponent ? `${d} vs ${g.opponent}` : d;
    });

    // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ã‚°ãƒ©ãƒ•
    if (charts.shooting) charts.shooting.destroy();
    charts.shooting = new Chart(document.getElementById('shootingChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: '2PæˆåŠŸç‡',
                data: sorted.map(g => parseFloat(g.twoPointPercentage)),
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                tension: 0.4
            }, {
                label: '3PæˆåŠŸç‡',
                data: sorted.map(g => parseFloat(g.threePointPercentage)),
                borderColor: '#f093fb',
                backgroundColor: 'rgba(240, 147, 251, 0.1)',
                tension: 0.4
            }, {
                label: 'FTæˆåŠŸç‡',
                data: sorted.map(g => parseFloat(g.freeThrowPercentage)),
                borderColor: '#4facfe',
                backgroundColor: 'rgba(79, 172, 254, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    ticks: { callback: v => v + '%' }
                }
            }
        }
    });

    // ç·å¾—ç‚¹ã‚°ãƒ©ãƒ•
    if (charts.points) charts.points.destroy();
    charts.points = new Chart(document.getElementById('pointsChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'ç·å¾—ç‚¹',
                data: sorted.map(g => g.totalPoints),
                backgroundColor: 'rgba(102, 126, 234, 0.8)',
                borderColor: '#667eea',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });

    // ãƒªãƒã‚¦ãƒ³ãƒ‰ã‚°ãƒ©ãƒ•
    if (charts.rebounds) charts.rebounds.destroy();
    charts.rebounds = new Chart(document.getElementById('reboundsChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰',
                data: sorted.map(g => g.offensiveRebounds),
                backgroundColor: 'rgba(255, 107, 107, 0.8)',
                borderColor: '#ff6b6b',
                borderWidth: 2
            }, {
                label: 'ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰',
                data: sorted.map(g => g.defensiveRebounds),
                backgroundColor: 'rgba(78, 205, 196, 0.8)',
                borderColor: '#4ecdc4',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } },
            scales: {
                y: { beginAtZero: true, stacked: true },
                x: { stacked: true }
            }
        }
    });

    // ãã®ä»–çµ±è¨ˆã‚°ãƒ©ãƒ•
    if (charts.other) charts.other.destroy();
    charts.other = new Chart(document.getElementById('otherStatsChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ã‚¢ã‚·ã‚¹ãƒˆ',
                data: sorted.map(g => g.assists),
                borderColor: '#4ecdc4',
                backgroundColor: 'rgba(78, 205, 196, 0.1)',
                tension: 0.4
            }, {
                label: 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼',
                data: sorted.map(g => g.turnovers),
                borderColor: '#ff6b6b',
                backgroundColor: 'rgba(255, 107, 107, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } },
            scales: { y: { beginAtZero: true } }
        }
    });

    // ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹çµ±è¨ˆã‚°ãƒ©ãƒ•
    if (charts.defense) charts.defense.destroy();
    charts.defense = new Chart(document.getElementById('defenseChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«',
                data: sorted.map(g => g.steals),
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                tension: 0.4
            }, {
                label: 'ãƒ–ãƒ­ãƒƒã‚¯',
                data: sorted.map(g => g.blocks),
                borderColor: '#f093fb',
                backgroundColor: 'rgba(240, 147, 251, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'bottom' } },
            scales: { y: { beginAtZero: true } }
        }
    });
}

// é¸æ‰‹ç®¡ç†é–¢æ•°
function addPlayer() {
    const num = document.getElementById('playerNumber').value;
    const name = document.getElementById('playerName').value.trim();

    if (!num || !name) { 
        alert('èƒŒç•ªå·ã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); 
        return; 
    }
    if (players.some(p => p.number === num)) { 
        alert('ã“ã®èƒŒç•ªå·ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™'); 
        return; 
    }

    const player = { id: Date.now().toString(), number: num, name: name };
    players.push(player);
    
    if (!myPlayerId) myPlayerId = player.id;
    
    saveData();
    displayPlayers();
    updateMyPlayerSelect();

    document.getElementById('playerNumber').value = '';
    document.getElementById('playerName').value = '';
    
    alert(`âœ… ${name} #${num} ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼`);
}

function changeMyPlayer() {
    myPlayerId = document.getElementById('myPlayerSelect').value || null;
    saveData();
    displayGames();
    
    if (myPlayerId) {
        const p = players.find(pl => pl.id === myPlayerId);
        alert(`âœ… å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’ã€Œ${p.name} #${p.number}ã€ã«è¨­å®šã—ã¾ã—ãŸ`);
    }
}

function updateMyPlayerSelect() {
    const sel = document.getElementById('myPlayerSelect');
    sel.innerHTML = '<option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
    players.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.id;
        opt.textContent = `${p.name} #${p.number}`;
        if (p.id === myPlayerId) opt.selected = true;
        sel.appendChild(opt);
    });
}

function displayPlayers() {
    const list = document.getElementById('playerList');
    
    if (players.length === 0) {
        list.innerHTML = '<p style="text-align: center; color: #999;">ã¾ã é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
        return;
    }

    list.innerHTML = players.map(p => `
        <div class="player-item ${editingPlayerId === p.id ? 'editing' : ''}">
            <div class="player-info">
                <div>
                    <span class="number">#${p.number}</span>
                    <span style="font-weight: bold; margin-left: 10px;">${p.name}</span>
                </div>
                ${p.id === myPlayerId ? '<span class="my-data-badge">å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºä¸­</span>' : ''}
            </div>
            
            <div class="edit-form ${editingPlayerId === p.id ? 'active' : ''}" id="editForm_${p.id}">
                <div class="input-group">
                    <label>èƒŒç•ªå·</label>
                    <input type="number" id="editNumber_${p.id}" value="${p.number}" min="0" max="99">
                </div>
                <div class="input-group">
                    <label>åå‰</label>
                    <input type="text" id="editName_${p.id}" value="${p.name}">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: #2ecc71; color: white; font-weight: bold; cursor: pointer;" onclick="saveEditPlayer('${p.id}')">ä¿å­˜</button>
                    <button style="flex: 1; padding: 10px; border: none; border-radius: 8px; background: #95a5a6; color: white; font-weight: bold; cursor: pointer;" onclick="cancelEditPlayer()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
            
            <div style="display: ${editingPlayerId === p.id ? 'none' : 'flex'}; gap: 10px; margin-top: 10px;">
                <button style="flex: 1; padding: 8px; border: none; border-radius: 8px; background: #667eea; color: white; cursor: pointer;" onclick="startEditPlayer('${p.id}')">ç·¨é›†</button>
                <button style="flex: 1; padding: 8px; border: none; border-radius: 8px; background: #ff4757; color: white; cursor: pointer;" onclick="deletePlayer('${p.id}')">å‰Šé™¤</button>
            </div>
        </div>
    `).join('');
}

function startEditPlayer(id) {
    editingPlayerId = id;
    displayPlayers();
}

function cancelEditPlayer() {
    editingPlayerId = null;
    displayPlayers();
}

function saveEditPlayer(id) {
    const p = players.find(pl => pl.id === id);
    if (!p) return;
    
    const newNum = document.getElementById('editNumber_' + id).value;
    const newName = document.getElementById('editName_' + id).value.trim();
    
    if (!newNum || !newName) {
        alert('èƒŒç•ªå·ã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    if (players.some(pl => pl.id !== id && pl.number === newNum)) {
        alert('ã“ã®èƒŒç•ªå·ã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™');
        return;
    }
    
    p.number = newNum;
    p.name = newName;
    editingPlayerId = null;
    saveData();
    displayPlayers();
    updateMyPlayerSelect();
    
    if (currentMode === 'personal') displayGames();
    
    showSavedIndicator();
}

function deletePlayer(id) {
    const p = players.find(pl => pl.id === id);
    if (!p) return;
    
    if (confirm(`${p.name} #${p.number} ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚`)) {
        players = players.filter(pl => pl.id !== id);
        if (myPlayerId === id) myPlayerId = null;
        editingPlayerId = null;
        saveData();
        displayPlayers();
        updateMyPlayerSelect();
    }
}

// ãƒãƒ¼ãƒ é–¢é€£é–¢æ•°
function startTeamGame() {
    if (players.length === 0) { 
        alert('å…ˆã«é¸æ‰‹ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ï¼ˆè¨­å®šã‚¿ãƒ–ï¼‰'); 
        return; 
    }

    const date = document.getElementById('teamGameDate').value;
    if (!date) { 
        alert('è©¦åˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„'); 
        return; 
    }

    currentTeamGame = {
        id: Date.now(),
        date: date,
        opponent: document.getElementById('teamOpponent').value.trim(),
        plays: [],
        playerStats: {}
    };

    players.forEach(p => {
        currentTeamGame.playerStats[p.id] = {
            twoPointsMade: 0, twoPointsAttempted: 0,
            threePointsMade: 0, threePointsAttempted: 0,
            freeThrowsMade: 0, freeThrowsAttempted: 0,
            offensiveRebounds: 0, defensiveRebounds: 0,
            assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
        };
    });

    document.getElementById('teamRecording').style.display = 'block';
    displayPlayerSelector();
    updateTeamStats();
    displayPlayHistory();
}

function displayPlayerSelector() {
    const sel = document.getElementById('playerSelector');
    sel.innerHTML = players.map(p => `
        <div class="player-btn ${selectedPlayer === p.id ? 'selected' : ''}" onclick="selectPlayer('${p.id}')">
            <div class="number">#${p.number}</div>
            <div class="name">${p.name}</div>
        </div>
    `).join('');
}

function selectPlayer(id) {
    selectedPlayer = id;
    displayPlayerSelector();
}

function getPlayLabel(type) {
    const labels = {
        '2p-made': '2PæˆåŠŸ', '2p-miss': '2På¤±æ•—',
        '3p-made': '3PæˆåŠŸ', '3p-miss': '3På¤±æ•—',
        'ft-made': 'FTæˆåŠŸ', 'ft-miss': 'FTå¤±æ•—',
        'oreb': 'ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰', 'dreb': 'ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰',
        'ast': 'ã‚¢ã‚·ã‚¹ãƒˆ', 'stl': 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«', 'blk': 'ãƒ–ãƒ­ãƒƒã‚¯',
        'to': 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼', 'foul': 'ãƒ•ã‚¡ã‚¦ãƒ«'
    };
    return labels[type] || type;
}

function recordPlay(type) {
    if (!selectedPlayer) { 
        alert('å…ˆã«é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„'); 
        return; 
    }

    const st = currentTeamGame.playerStats[selectedPlayer];
    
    switch(type) {
        case '2p-made': st.twoPointsMade++; st.twoPointsAttempted++; break;
        case '2p-miss': st.twoPointsAttempted++; break;
        case '3p-made': st.threePointsMade++; st.threePointsAttempted++; break;
        case '3p-miss': st.threePointsAttempted++; break;
        case 'ft-made': st.freeThrowsMade++; st.freeThrowsAttempted++; break;
        case 'ft-miss': st.freeThrowsAttempted++; break;
        case 'oreb': st.offensiveRebounds++; break;
        case 'dreb': st.defensiveRebounds++; break;
        case 'ast': st.assists++; break;
        case 'stl': st.steals++; break;
        case 'blk': st.blocks++; break;
        case 'to': st.turnovers++; break;
        case 'foul': st.fouls++; break;
    }

    currentTeamGame.plays.push({
        playerId: selectedPlayer,
        playType: type,
        timestamp: Date.now()
    });

    updateTeamStats();
    displayPlayHistory();
}

function deletePlay(timestamp) {
    const playIndex = currentTeamGame.plays.findIndex(p => p.timestamp === timestamp);
    if (playIndex === -1) return;
    
    const play = currentTeamGame.plays[playIndex];
    const st = currentTeamGame.playerStats[play.playerId];
    
    switch(play.playType) {
        case '2p-made': st.twoPointsMade--; st.twoPointsAttempted--; break;
        case '2p-miss': st.twoPointsAttempted--; break;
        case '3p-made': st.threePointsMade--; st.threePointsAttempted--; break;
        case '3p-miss': st.threePointsAttempted--; break;
        case 'ft-made': st.freeThrowsMade--; st.freeThrowsAttempted--; break;
        case 'ft-miss': st.freeThrowsAttempted--; break;
        case 'oreb': st.offensiveRebounds--; break;
        case 'dreb': st.defensiveRebounds--; break;
        case 'ast': st.assists--; break;
        case 'stl': st.steals--; break;
        case 'blk': st.blocks--; break;
        case 'to': st.turnovers--; break;
        case 'foul': st.fouls--; break;
    }
    
    currentTeamGame.plays.splice(playIndex, 1);
    
    updateTeamStats();
    displayPlayHistory();
}

function displayPlayHistory() {
    const histEl = document.getElementById('playHistory');
    
    if (currentTeamGame.plays.length === 0) {
        histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>';
        return;
    }
    
    const recentPlays = [...currentTeamGame.plays].reverse().slice(0, 10);
    histEl.innerHTML = `
        <div style="margin-bottom: 10px; font-size: 0.9em; color: #666; font-weight: bold;">
            æœ€æ–°ã®ãƒ—ãƒ¬ã‚¤ï¼ˆæœ€å¤§10ä»¶ï¼‰ - ã‚¿ãƒƒãƒ—ã§å‰Šé™¤
        </div>
    ` + recentPlays.map(play => {
        const p = players.find(pl => pl.id === play.playerId);
        return `
            <div class="play-item">
                <div>
                    <strong>#${p.number} ${p.name}</strong>
                    <div style="font-size: 0.85em; color: #666; margin-top: 2px;">${getPlayLabel(play.playType)}</div>
                </div>
                <button class="undo-btn" onclick="deletePlay(${play.timestamp})">å‰Šé™¤</button>
            </div>
        `;
    }).join('');
}

function updateTeamStats() {
    const el = document.getElementById('teamStats');
    let html = '';

    players.forEach(p => {
        const st = currentTeamGame.playerStats[p.id];
        const pts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;
        const reb = st.offensiveRebounds + st.defensiveRebounds;

        html += `
            <div style="padding: 10px; background: #f7f7f7; border-radius: 8px; margin-bottom: 10px;">
                <div style="font-weight: bold; margin-bottom: 5px;">#${p.number} ${p.name}</div>
                <div style="font-size: 0.9em; color: #666;">
                    ${pts}ç‚¹ | ${reb}ãƒªãƒã‚¦ãƒ³ãƒ‰ | ${st.assists}ã‚¢ã‚·ã‚¹ãƒˆ | ${st.steals}ã‚¹ãƒ†ã‚£ãƒ¼ãƒ« | ${st.blocks}ãƒ–ãƒ­ãƒƒã‚¯
                </div>
            </div>
        `;
    });

    el.innerHTML = html;
}

function saveTeamGame() {
    if (!currentTeamGame) return;

    teamGames.unshift(currentTeamGame);

    // å€‹äººãƒ¢ãƒ¼ãƒ‰ã«è‡ªå‹•åæ˜ 
    if (myPlayerId && currentTeamGame.playerStats[myPlayerId]) {
        const st = currentTeamGame.playerStats[myPlayerId];
        const totalReb = st.offensiveRebounds + st.defensiveRebounds;
        const totalPts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;

        const personalGame = {
            id: Date.now() + 1, // é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚+1
            date: currentTeamGame.date,
            opponent: currentTeamGame.opponent,
            playTime: 0,
            playerId: myPlayerId,
            ...st,
            totalRebounds: totalReb,
            twoPointPercentage: st.twoPointsAttempted > 0 ? ((st.twoPointsMade / st.twoPointsAttempted) * 100).toFixed(1) : '0',
            threePointPercentage: st.threePointsAttempted > 0 ? ((st.threePointsMade / st.threePointsAttempted) * 100).toFixed(1) : '0',
            freeThrowPercentage: st.freeThrowsAttempted > 0 ? ((st.freeThrowsMade / st.freeThrowsAttempted) * 100).toFixed(1) : '0',
            totalPoints: totalPts,
            source: 'team'
        };

        personalGames.unshift(personalGame);
    }

    saveData();
    displayTeamGames();
    
    currentTeamGame = null;
    selectedPlayer = null;
    document.getElementById('teamRecording').style.display = 'none';
    document.getElementById('teamGameDate').valueAsDate = new Date();
    document.getElementById('teamOpponent').value = '';
    
    alert('âœ… è©¦åˆè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
}

// åˆæœŸåŒ–å‡¦ç†
loadData();
updateDisplay();
displayGames();
displayPlayers();
updateMyPlayerSelect();

        // åˆæœŸåŒ–å‡¦ç†
        loadData();
        updateDisplay();
        displayGames();
        displayPlayers();
        updateMyPlayerSelect();
    </script>
</body>
</html>