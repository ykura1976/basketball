<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÄ „Éê„Çπ„Ç±Ë®òÈå≤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .sync-indicator.syncing {
            display: block;
            color: #667eea;
        }

        .sync-indicator.success {
            display: block;
            color: #2ecc71;
        }

        .sync-indicator.error {
            display: block;
            color: #ff4757;
        }

        .mode-switch {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid white;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
        }

        .mode-btn.active.team-mode {
            color: #f39c12;
        }

        .mode-btn.active.team-mode {
            color: #f39c12;
        }

        /* ÂÄã‰∫∫„É¢„Éº„Éâ„ÅÆÊôÇ„ÅÆÂÖ®‰ΩìËÉåÊôØ */
        body.personal-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* „ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅÆÊôÇ„ÅÆÂÖ®‰ΩìËÉåÊôØ */
        body.team-mode {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .tab-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .stepper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stepper button {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stepper button:active {
            transform: scale(0.95);
        }

        .stepper .value {
            flex: 1;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stats-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 12px;
            color: white;
            text-align: center;
        }

        .stats-display h3 {
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stats-display .percentage {
            font-size: 1.8em;
            font-weight: bold;
        }

        .stats-display .fraction {
            font-size: 0.9em;
            opacity: 0.85;
            margin-top: 5px;
            font-weight: normal;
        }

        .save-btn, .primary-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn:active, .primary-btn:active {
            transform: scale(0.98);
        }

        .save-btn:disabled, .primary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .game-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .stat-box {
            text-align: center;
            padding: 8px;
            background: #f7f7f7;
            border-radius: 8px;
        }

        .stat-box .label {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-box .value {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .fraction {
            font-size: 0.75em;
            color: #999;
            margin-top: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        input[type="date"], input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .saved-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: bold;
            z-index: 1000;
        }

        .saved-indicator.show {
            opacity: 1;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: bold;
            margin: 25px 0 15px 0;
            color: #333;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .player-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .player-btn .number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-btn .name {
            font-size: 0.85em;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.success {
            background: #2ecc71;
            color: white;
        }

        .action-btn.miss {
            background: #e0e0e0;
            color: #666;
        }

        .action-btn.other {
            background: #667eea;
            color: white;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .play-history {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: #f7f7f7;
            border-radius: 10px;
            padding: 10px;
        }

        .play-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .play-item:last-child {
            margin-bottom: 0;
        }

        .undo-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #ff4757;
            color: white;
            font-size: 0.85em;
            cursor: pointer;
        }

        .period-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            color: #666;
        }

        .period-btn.selected {
            background: #ffc107;
            color: white;
            border-color: #ffc107;
        }

        .team-code-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .team-code-display .code {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        .player-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-info .number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .my-data-badge {
            background: #2ecc71;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }

        .top-record {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .top-record .trophy {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .top-record .value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .close-modal {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            width: 100%;
            margin-top: 15px;
            font-size: 16px;
            cursor: pointer;
        }
        .ranking-medal {
            font-size: 2em;
            display: inline-block;
            width: 50px;
            text-align: center;
        }

        .ranking-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-info .rank {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }

        .ranking-info .player-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .ranking-info .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-left: 10px;
        }

        .game-history-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .game-history-item:hover {
            transform: translateY(-2px);
        }

        .game-history-item .game-date {
            font-size: 1em;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .game-history-item .game-opponent {
            font-size: 1.3em;
            font-weight: bold;
        }

        .game-detail {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .game-detail.active {
            display: block;
        }

        .ranking-section {
            margin-bottom: 30px;
        }

        .ranking-section h3 {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }

        .top3-container {
            margin-bottom: 15px;
        }

        .all-rankings {
            display: none;
            margin-top: 10px;
        }

        .all-rankings.active {
            display: block;
        }

        .toggle-rankings {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            color: #667eea;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .toggle-rankings:hover {
            background: #667eea;
            color: white;
        }

        .toggle-rankings.active {
            background: #667eea;
            color: white;
        }

        /* „Çπ„Ç≥„Ç¢ÂÖ•ÂäõÊ¨Ñ */
        .score-input-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-input-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-input-box label {
            font-size: 0.9em;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        .score-input-box input {
            width: 80px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            color: #667eea;
        }

        .score-vs {
            font-size: 1.5em;
            font-weight: bold;
            color: #999;
        }

        /* Ë©¶ÂêàÁµêÊûúË°®Á§∫ */
        .game-result {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .game-result.loss {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .game-result .result-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .game-result .result-score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .game-result .result-outcome {
            font-size: 1.3em;
            font-weight: bold;
        }

        .quarter-scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .quarter-score-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .quarter-score-item .quarter-label {
            font-size: 0.85em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .quarter-score-item .quarter-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .quarter-score-item .quarter-diff {
            font-size: 0.9em;
            margin-top: 3px;
        }

        .quarter-diff.positive {
            color: #2ecc71;
        }

        .quarter-diff.negative {
            color: #e74c3c;
        }

        /* Ë©¶ÂêàÁ∑®ÈõÜÊ©üËÉΩ */
        .edit-game-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            width: 100%;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-game-btn:hover {
            background: #e67e22;
        }

        .edit-modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .edit-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .edit-section:last-child {
            border-bottom: none;
        }

        .edit-section h3 {
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .player-stat-edit {
            background: #f7f7f7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .player-stat-edit .player-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .stat-edit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-edit-item {
            display: flex;
            flex-direction: column;
        }

        .stat-edit-item label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .stat-edit-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .save-edit-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            margin-top: 15px;
        }

        .save-edit-btn:hover {
            background: #27ae60;
        }

        .delete-game-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 0.95em;
            margin-top: 10px;
        }

        .delete-game-btn:hover {
            background: #c0392b;
        }

        /* „Éú„Çø„É≥„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes button-press {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
            100% { transform: scale(1); }
        }

        .action-btn.pressed {
            animation: button-press 0.3s ease;
        }

        /* „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü• */
        .feedback-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 10000;
            animation: fade-in-out 1s ease;
            pointer-events: none;
        }

        @keyframes fade-in-out {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .feedback-notification.success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .feedback-notification.miss {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .feedback-notification.other {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        /* ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏ÊâãË°®Á§∫ */
        .current-player-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .current-player-banner .player-icon {
            font-size: 1.5em;
        }

        .current-player-banner .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .current-player-banner .player-label {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .current-player-banner .player-name {
            font-size: 1.2em;
        }
         /* ========== ÈÅ∏ÊâãÈÅ∏Êäû„É¢„Éº„ÉÄ„É´„ÅÆ„Çπ„Çø„Ç§„É´ ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .modal-header h2 {
            font-size: 1.3em;
            color: #333;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .player-select-dropdown {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .player-select-dropdown:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .player-select-dropdown option {
            padding: 10px;
            font-size: 1em;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            padding: 20px 25px;
            border-top: 2px solid #f0f0f0;
        }
        
        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .cancel-btn {
            background: #f0f0f0;
            color: #666;
        }
        
        .cancel-btn:hover {
            background: #e0e0e0;
        }
        
        .confirm-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .confirm-btn:active {
            transform: translateY(0);
        }
        /* ========== „ÉÅ„Éº„É†ÂêçË°®Á§∫„ÅÆ„Çπ„Çø„Ç§„É´ ========== */
        .team-names {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .our-team-name {
            color: white;
            font-weight: 600;
            margin-right: 20px;
        }
        
        .vs-label {
            color: white;
            font-size: 0.75em;
            font-weight: normal;
            opacity: 0.8;
            min-width: 30px;
            text-align: center;
            padding: 0 15px;
        }
        
        .opp-team-name {
            color: white;
            font-weight: 600;
            margin-left: 20px;
        }
        /* „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„ÉàÁî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        .shot-chart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .shot-chart-modal.active {
            display: flex;
        }
        
        .shot-chart-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }
        
        .court-container {
            position: relative;
            width: 300px;
            height: 400px;
            margin: 20px auto;
            background: #f5f5f5;
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: crosshair;
        }
        
        .court-canvas {
            width: 100%;
            height: 100%;
        }
        
        .shot-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .shot-marker.made {
            background: #2ecc71;
            border: 2px solid #27ae60;
        }
        
        .shot-marker.missed {
            background: #e74c3c;
            border: 2px solid #c0392b;
        }
        
        .zone-stats {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .zone-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
        }
        
        .zone-name {
            font-weight: bold;
            color: #667eea;
        }
        
        .zone-percentage {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .shot-chart-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        .shot-chart-button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="sync-indicator" id="syncIndicator">ÂêåÊúü‰∏≠...</div>
    
    <div class="container">
        <div class="header">
            <h1>üèÄ „Éê„Çπ„Ç±Ë®òÈå≤</h1>
            <p>ÊàêÈï∑„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ</p>
        </div>

        <div class="mode-switch">
           <button class="mode-btn active" onclick="switchMode('personal')">üë§ ÂÄã‰∫∫</button>
           <button class="mode-btn" onclick="switchMode('team')">‚ö° „ÉÅ„Éº„É†</button>
           <button class="mode-btn" onclick="switchMode('settings')">‚öôÔ∏è Ë®≠ÂÆö</button>
        </div>

        <div id="personalMode">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTab('input')">üìù Ë®òÈå≤</button>
                <button class="tab" onclick="switchTab('list')">üìä Â±•Ê≠¥</button>
                <button class="tab" onclick="switchTab('ranking')">üèÜ „É©„É≥„Ç≠„É≥„Ç∞</button>
                <button class="tab" onclick="switchTab('graph')">üìà „Ç∞„É©„Éï</button>
            </div>

            <div id="inputTab" class="tab-content active">
                <div id="inputPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="inputPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">Êñ∞„Åó„ÅÑË©¶Âêà„ÇíË®òÈå≤</h2>
                    
                    <div class="input-group">
                        <label>Ë©¶ÂêàÊó•</label>
                        <input type="date" id="gameDate">
                    </div>

                    <div class="input-group">
                        <label>ÂØæÊà¶Áõ∏Êâã</label>
                        <input type="text" id="opponent" placeholder="Áõ∏Êâã„ÉÅ„Éº„É†Âêç„ÇíÂÖ•Âäõ">
                    </div>

                    <div class="input-group">
                        <label>„Éó„É¨„Ç§ÊôÇÈñì(ÂàÜ)</label>
                        <input type="number" id="playTime" value="0" min="0" max="200">
                    </div>

                    <div class="section-title">üèÄ „Ç∑„É•„Éº„Éà</div>
                    
                    <div class="input-group">
                        <label>2„Éù„Ç§„É≥„ÉàÊàêÂäü</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsMade', -1)">‚àí</button>
                            <div class="value" id="twoPointsMade">0</div>
                            <button onclick="changeValue('twoPointsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>2„Éù„Ç§„É≥„ÉàË©¶Êäï</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsAttempted', -1)">‚àí</button>
                            <div class="value" id="twoPointsAttempted">0</div>
                            <button onclick="changeValue('twoPointsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3„Éù„Ç§„É≥„ÉàÊàêÂäü</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsMade', -1)">‚àí</button>
                            <div class="value" id="threePointsMade">0</div>
                            <button onclick="changeValue('threePointsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3„Éù„Ç§„É≥„ÉàË©¶Êäï</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsAttempted', -1)">‚àí</button>
                            <div class="value" id="threePointsAttempted">0</div>
                            <button onclick="changeValue('threePointsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éï„É™„Éº„Çπ„É≠„ÉºÊàêÂäü</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsMade', -1)">‚àí</button>
                            <div class="value" id="freeThrowsMade">0</div>
                            <button onclick="changeValue('freeThrowsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éï„É™„Éº„Çπ„É≠„ÉºË©¶Êäï</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsAttempted', -1)">‚àí</button>
                            <div class="value" id="freeThrowsAttempted">0</div>
                            <button onclick="changeValue('freeThrowsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stats-display">
                            <h3>2PÊàêÂäüÁéá</h3>
                            <div class="percentage" id="twoPointPercentage">0%</div>
                            <div class="fraction" id="twoPointFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>3PÊàêÂäüÁéá</h3>
                            <div class="percentage" id="threePointPercentage">0%</div>
                            <div class="fraction" id="threePointFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>FTÊàêÂäüÁéá</h3>
                            <div class="percentage" id="freeThrowPercentage">0%</div>
                            <div class="fraction" id="freeThrowFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>Á∑èÂæóÁÇπ</h3>
                            <div class="percentage" id="totalPoints">0</div>
                        </div>
                    </div>

                    <div class="section-title">üéØ „É™„Éê„Ç¶„É≥„Éâ</div>

                    <div class="input-group">
                        <label>„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</label>
                        <div class="stepper">
                            <button onclick="changeValue('offensiveRebounds', -1)">‚àí</button>
                            <div class="value" id="offensiveRebounds">0</div>
                            <button onclick="changeValue('offensiveRebounds', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</label>
                        <div class="stepper">
                            <button onclick="changeValue('defensiveRebounds', -1)">‚àí</button>
                            <div class="value" id="defensiveRebounds">0</div>
                            <button onclick="changeValue('defensiveRebounds', 1)">+</button>
                        </div>
                    </div>

                    <div class="section-title">üìä „Åù„ÅÆ‰ªñ„ÅÆÁµ±Ë®à</div>

                    <div class="input-group">
                        <label>„Ç¢„Ç∑„Çπ„Éà</label>
                        <div class="stepper">
                            <button onclick="changeValue('assists', -1)">‚àí</button>
                            <div class="value" id="assists">0</div>
                            <button onclick="changeValue('assists', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Çπ„ÉÜ„Ç£„Éº„É´</label>
                        <div class="stepper">
                            <button onclick="changeValue('steals', -1)">‚àí</button>
                            <div class="value" id="steals">0</div>
                            <button onclick="changeValue('steals', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éñ„É≠„ÉÉ„ÇØ</label>
                        <div class="stepper">
                            <button onclick="changeValue('blocks', -1)">‚àí</button>
                            <div class="value" id="blocks">0</div>
                            <button onclick="changeValue('blocks', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Çø„Éº„É≥„Ç™„Éº„Éê„Éº</label>
                        <div class="stepper">
                            <button onclick="changeValue('turnovers', -1)">‚àí</button>
                            <div class="value" id="turnovers">0</div>
                            <button onclick="changeValue('turnovers', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éï„Ç°„Ç¶„É´</label>
                        <div class="stepper">
                            <button onclick="changeValue('fouls', -1)">‚àí</button>
                            <div class="value" id="fouls">0</div>
                            <button onclick="changeValue('fouls', 1)">+</button>
                        </div>
                    </div>

                    <button class="save-btn" id="saveGameBtn" onclick="savePersonalGame()">Ë®òÈå≤„Çí‰øùÂ≠ò</button>
                </div>
            </div>

            <div id="listTab" class="tab-content">
                <div id="listPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="listPlayerName"></span>
                    </div>
                </div>
                <div id="gameList"></div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div id="rankingPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="rankingPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">üèÜ „Éô„Çπ„Éà„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</h2>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                        ÈÅ∏Êäû„Åó„ÅüÈÅ∏Êâã„ÅÆËá™Â∑±„Éô„Çπ„ÉàË®òÈå≤„Åß„Åô
                    </p>
                    <div id="topPoints"></div>
                </div>
            </div>

            <div id="graphTab" class="tab-content">
                <div id="graphPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="graphPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">„Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„ÅÆÊé®Áßª</h2>
                    <div class="chart-container">
                        <canvas id="shootingChart"></canvas>
                    </div>
                </div>
            </div>

            
        </div>
        <div id="settingsMode" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">üîó „ÉÅ„Éº„É†ÈÄ£Êê∫</h2>
                    <div id="teamStatus"></div>
                    
                    <button class="primary-btn" style="margin-bottom: 10px;" onclick="showCreateTeamModal()">
                        üÜï Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†„Çí‰ΩúÊàê
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="showJoinTeamModal()">
                        üëã „ÉÅ„Éº„É†„Å´ÂèÇÂä†
                    </button>
                    
                    <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 0.9em; color: #1976d2;">
                        üí° <strong>„ÉÅ„Éº„É†Ê©üËÉΩ:</strong> Ë®òÈå≤‰øÇ1‰∫∫„ÅåÂÖ®ÈÅ∏Êâã„ÇíË®òÈå≤‚ÜíÂÖ®Âì°„ÅÆ„Çπ„Éû„Éõ„Å´Ëá™ÂãïÂêåÊúü
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">üë§ ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫Ë®≠ÂÆö</h2>
                    <div class="input-group">
                        <label>ÂÄã‰∫∫„É¢„Éº„Éâ„ÅßË°®Á§∫„Åô„ÇãÈÅ∏Êâã</label>
                        <select id="myPlayerSelect" onchange="changeMyPlayer()">
                            <option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        </select>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        ÈÅ∏Êäû„Åó„ÅüÈÅ∏Êâã„ÅÆÂÄã‰∫∫ÊàêÁ∏æ„ÅåÂ±•Ê≠¥„Éª„É©„É≥„Ç≠„É≥„Ç∞„Éª„Ç∞„É©„Éï„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô
                    </p>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">üë• ÈÅ∏ÊâãÁôªÈå≤</h2>
                    <div class="input-group">
                        <label>ËÉåÁï™Âè∑</label>
                        <input type="number" id="playerNumber" placeholder="‰æã: 7" min="0" max="99">
                    </div>
                    <div class="input-group">
                        <label>ÂêçÂâç</label>
                        <input type="text" id="playerName" placeholder="‰æã: Â±±Áî∞ Ëä±Â≠ê">
                    </div>
                    <button class="primary-btn" style="margin-top: 15px;" onclick="addPlayer()">ÈÅ∏Êâã„ÇíËøΩÂä†</button>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ÁôªÈå≤Ê∏à„ÅøÈÅ∏Êâã</h2>
                    <div id="playerList"></div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">üì• „Éá„Éº„ÇøÁÆ°ÁêÜ</h2>
                    <button class="primary-btn" style="background: #2ecc71; margin-bottom: 10px;" onclick="exportData()">
                        üíæ „Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="document.getElementById('importFile').click()">
                        üìÇ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„ÇâÂæ©ÂÖÉ
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
             <button class="primary-btn" style="background: #3498db; margin-top: 10px;" onclick="confirmClearLocalData()">
    üóëÔ∏è „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
</button>

<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="confirmResetTeamData()">
    ‚ö†Ô∏è „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà
</button>
                    
                </div>
            </div>
        <div id="teamMode" style="display: none;">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTeamTab('record')">‚ö° Ë®òÈå≤</button>
                <button class="tab" onclick="switchTeamTab('history')">üìä Â±•Ê≠¥</button>
                <button class="tab" onclick="switchTeamTab('ranking')">üìà „É©„É≥„Ç≠„É≥„Ç∞</button>
            </div>

            <div id="teamRecordTab">
            <div class="card">
                <h2 style="margin-bottom: 20px;">‚ö° Ë©¶ÂêàË®òÈå≤</h2>
                
                <div class="input-group">
                    <label>Ë©¶ÂêàÊó•</label>
                    <input type="date" id="teamGameDate">
                </div>

                <div class="input-group">
                    <label>ÂØæÊà¶Áõ∏Êâã</label>
                    <input type="text" id="teamOpponent" placeholder="Áõ∏Êâã„ÉÅ„Éº„É†Âêç„ÇíÂÖ•Âäõ">
                </div>

                <button class="primary-btn" onclick="startTeamGame()">Ë©¶ÂêàÈñãÂßã</button>
            </div>

            <div id="teamRecording" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 15px;">„Éî„É™„Ç™„Éâ„ÇíÈÅ∏Êäû</h2>
                    <div class="period-selector">
                        <div class="period-btn selected" onclick="selectPeriod(1)" id="period1">1Q</div>
                        <div class="period-btn" onclick="selectPeriod(2)" id="period2">2Q</div>
                        <div class="period-btn" onclick="selectPeriod(3)" id="period3">3Q</div>
                        <div class="period-btn" onclick="selectPeriod(4)" id="period4">4Q</div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="font-size: 1em; color: #666; margin-bottom: 10px;">„Åì„ÅÆ„ÇØ„Ç©„Éº„Çø„Éº„ÅÆÂæóÁÇπ</h3>
                        <div class="score-input-container">
                            <div class="score-input-box">
                                <label>Ëá™„ÉÅ„Éº„É†</label>
                                <input type="number" id="ourScoreInput" min="0" max="99" value="0" onchange="updateQuarterScore(currentPeriod, 'our')">
                            </div>
                            <div class="score-vs">-</div>
                            <div class="score-input-box">
                                <label>Áõ∏Êâã</label>
                                <input type="number" id="oppScoreInput" min="0" max="99" value="0" onchange="updateQuarterScore(currentPeriod, 'opp')">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">ÈÅ∏Êâã„ÇíÈÅ∏Êäû</h2>
                    <div id="playerSelector" class="player-grid"></div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">„Éó„É¨„Ç§„ÇíË®òÈå≤</h2>
                        <button class="primary-btn" style="background: #3498db; padding: 8px 16px; font-size: 0.9em;" onclick="openGlossary()">
                            ‚ùì Áî®Ë™ûËß£Ë™¨
                        </button>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn success" onclick="recordPlay('2p-made')">2PÊàêÂäü</button>
                        <button class="action-btn miss" onclick="recordPlay('2p-miss')">2PÂ§±Êïó</button>
                        <button class="action-btn success" onclick="recordPlay('3p-made')">3PÊàêÂäü</button>
                        <button class="action-btn miss" onclick="recordPlay('3p-miss')">3PÂ§±Êïó</button>
                        <button class="action-btn success" onclick="recordPlay('ft-made')">FTÊàêÂäü</button>
                        <button class="action-btn miss" onclick="recordPlay('ft-miss')">FTÂ§±Êïó</button>
                        <button class="action-btn other" onclick="recordPlay('oreb')">„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</button>
                        <button class="action-btn other" onclick="recordPlay('dreb')">„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</button>
                        <button class="action-btn other" onclick="recordPlay('ast')">„Ç¢„Ç∑„Çπ„Éà</button>
                        <button class="action-btn other" onclick="recordPlay('stl')">„Çπ„ÉÜ„Ç£„Éº„É´</button>
                        <button class="action-btn other" onclick="recordPlay('blk')">„Éñ„É≠„ÉÉ„ÇØ</button>
                        <button class="action-btn other" onclick="recordPlay('to')">„Çø„Éº„É≥„Ç™„Éº„Éê„Éº</button>
                        <button class="action-btn other" onclick="recordPlay('foul')">„Éï„Ç°„Ç¶„É´</button>
                    </div>

                    <div class="play-history" id="playHistory">
                        <div style="text-align: center; color: #999; font-size: 0.9em;">„Éó„É¨„Ç§Â±•Ê≠¥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">Ë©¶ÂêàÁµ±Ë®à</h2>
                    <div id="teamStats"></div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                        <button class="primary-btn" style="background: #3498db;" onclick="saveDraftTeamGame()">
                            üíæ ÈÄî‰∏≠‰øùÂ≠ò
                        </button>
                        <button class="save-btn" onclick="saveTeamGame()">
                            ‚úÖ Ë©¶ÂêàÁµÇ‰∫Ü„Éª‰øùÂ≠ò
                        </button>
                    </div>
                </div>
            </div>
     </div>
     <div id="teamHistoryTab" style="display: none;">
         <div id="teamGamesList"></div>
     </div>
     <div id="teamRankingTab" style="display: none;">
         <div id="teamRankingsDisplay"></div>
     </div>
        </div>
    </div>

    <div id="createTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">üÜï „ÉÅ„Éº„É†„Çí‰ΩúÊàê</h2>
            <div class="input-group">
                <label>„ÉÅ„Éº„É†Âêç</label>
                <input type="text" id="newTeamName" placeholder="‰æã: „Åï„Åè„Çâ„Éê„Çπ„Ç±ÈÉ®">
            </div>
            <button class="primary-btn" onclick="createTeam()">‰ΩúÊàê</button>
            <button class="close-modal" onclick="closeModal('createTeamModal')">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>

    <div id="joinTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">üëã „ÉÅ„Éº„É†„Å´ÂèÇÂä†</h2>
            <div class="input-group">
                <label>„ÉÅ„Éº„É†„Ç≥„Éº„Éâ</label>
                <input type="text" id="joinTeamCode" placeholder="6Ê°Å„ÅÆ„Ç≥„Éº„Éâ" maxlength="6">
            </div>
            <button class="primary-btn" onclick="joinTeam()">ÂèÇÂä†</button>
            <button class="close-modal" onclick="closeModal('joinTeamModal')">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>
  <div id="glossaryModal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 class="modal-title">üìö „Éê„Çπ„Ç±Áî®Ë™ûËß£Ë™¨</h2>
            
            <div style="text-align: left;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #2ecc71; margin-top: 0;">‚úÖ ÊàêÂäü„Éó„É¨„Ç§</h3>
                    
                    <p style="margin: 10px 0;"><strong>2PÊàêÂäü(„ÉÑ„Éº„Éù„Ç§„É≥„ÉàÊàêÂäü)</strong><br>
                    2ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂÖ•„Å£„Åü„Å®„Åç„ÄÇ„Ç¥„Éº„É´„Å´Ëøë„ÅÑÂ†¥ÊâÄ„Åã„Çâ„ÅÆ„Ç∑„É•„Éº„Éà„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>3PÊàêÂäü(„Çπ„É™„Éº„Éù„Ç§„É≥„ÉàÊàêÂäü)</strong><br>
                    3ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂÖ•„Å£„Åü„Å®„Åç„ÄÇ3ÁÇπ„É©„Ç§„É≥„ÅÆÂ§ñÂÅ¥„Åã„Çâ„ÅÆ„Ç∑„É•„Éº„Éà„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>FTÊàêÂäü(„Éï„É™„Éº„Çπ„É≠„ÉºÊàêÂäü)</strong><br>
                    „Éï„É™„Éº„Çπ„É≠„Éº(1ÁÇπ)„ÅåÂÖ•„Å£„Åü„Å®„Åç„ÄÇ„Éï„Ç°„Ç¶„É´„Åï„Çå„ÅüÂæå„ÅÆÁÑ°Â¶®ÂÆ≥„Ç∑„É•„Éº„Éà„ÄÇ</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #95a5a6; margin-top: 0;">‚ùå Â§±Êïó„Éó„É¨„Ç§</h3>
                    
                    <p style="margin: 10px 0;"><strong>2PÂ§±Êïó</strong><br>
                    2ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>3PÂ§±Êïó</strong><br>
                    3ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>FTÂ§±Êïó</strong><br>
                    „Éï„É™„Éº„Çπ„É≠„Éº„ÅåÂ§ñ„Çå„Åü„Å®„Åç„ÄÇ</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #3498db; margin-top: 0;">üìä „Åù„ÅÆ‰ªñ„ÅÆË®òÈå≤</h3>
                    
                    <p style="margin: 10px 0;"><strong>„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ(ÊîªÊíÉ„É™„Éê„Ç¶„É≥„Éâ)</strong><br>
                    Âë≥Êñπ„ÅÆ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„ÅüÂæå„ÄÅËá™ÂàÜ„ÅÆ„ÉÅ„Éº„É†„ÅåÂÜç„Å≥„Éú„Éº„É´„ÇíÂèñ„Å£„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ(ÂÆàÂÇô„É™„Éê„Ç¶„É≥„Éâ)</strong><br>
                    Áõ∏Êâã„ÅÆ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„ÅüÂæå„ÄÅ„Éú„Éº„É´„ÇíÂèñ„Å£„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Ç¢„Ç∑„Çπ„Éà</strong><br>
                    „Éë„Çπ„ÇíÂá∫„Åó„Å¶„ÄÅ„Åù„ÅÆ„Éë„Çπ„ÇíÂèó„Åë„ÅüÂë≥Êñπ„Åå„Ç∑„É•„Éº„Éà„ÇíÊ±∫„ÇÅ„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Çπ„ÉÜ„Ç£„Éº„É´</strong><br>
                    Áõ∏Êâã„Åã„Çâ„Éú„Éº„É´„ÇíÂ•™„Å£„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Éñ„É≠„ÉÉ„ÇØ</strong><br>
                    Áõ∏Êâã„ÅÆ„Ç∑„É•„Éº„Éà„ÇíÊâã„ÅßÈò≤„ÅÑ„Å†„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Çø„Éº„É≥„Ç™„Éº„Éê„Éº</strong><br>
                    „Éú„Éº„É´„ÇíÂ§±„Å£„Åü„Å®„Åç„ÄÇ„Éë„Çπ„Éü„Çπ„ÄÅ„Éâ„É™„Éñ„É´„Éü„Çπ„ÄÅÁõ∏Êâã„Å´Â•™„Çè„Çå„Åü„Å®„Åç„Å™„Å©„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Éï„Ç°„Ç¶„É´</strong><br>
                    ÂèçÂâá„Çí„Åó„Åü„Å®„Åç„ÄÇÁõ∏Êâã„ÇíÊäº„Åô„ÄÅÂè©„Åè„ÄÅ‰∏çÊ≠£„Å™„Éñ„É≠„ÉÉ„ÇØ„Å™„Å©„ÄÇ</p>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #f39c12; margin-top: 0;">üí° Ë®òÈå≤„ÅÆ„Ç≥„ÉÑ</h3>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Ëø∑„Å£„Åü„ÇâË®òÈå≤„Åó„Å™„ÅÑ„Çà„Çä„ÄÅË®òÈå≤„Åó„ÅüÊñπ„Åå„ÅÑ„ÅÑ</li>
                        <li>ÈñìÈÅï„Åà„Åü„Çâ„Äå„Éó„É¨„Ç§Â±•Ê≠¥„Äç„Åã„ÇâÂâäÈô§„Åß„Åç„Çã</li>
                        <li>„Ç∑„É•„Éº„Éà„ÅØ„ÄåÊàêÂäü„Äç„Åæ„Åü„ÅØ„ÄåÂ§±Êïó„Äç„ÅÆ‰∏°Êñπ„ÇíÂøÖ„ÅöË®òÈå≤</li>
                        <li>„É™„Éê„Ç¶„É≥„Éâ„ÅØË™∞„ÅåÂèñ„Å£„Åü„Åã„ÅåÈáçË¶Å</li>
                    </ul>
                </div>
            </div>
            
            <button class="primary-btn" onclick="closeModal('glossaryModal')">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <!-- Ë©¶ÂêàÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="editGameModal" class="modal">
        <div class="modal-content edit-modal-content">
            <h2 class="modal-title">üîí Ë©¶ÂêàË®òÈå≤„ÇíÁ∑®ÈõÜ</h2>
            
            <div class="edit-section">
                <h3>üìÖ Ë©¶ÂêàÊÉÖÂ†±</h3>
                <div class="input-group">
                    <label>Ë©¶ÂêàÊó•</label>
                    <input type="date" id="editGameDate">
                </div>
                <div class="input-group">
                    <label>ÂØæÊà¶Áõ∏Êâã</label>
                    <input type="text" id="editOpponent" placeholder="Áõ∏Êâã„ÉÅ„Éº„É†Âêç">
                </div>
            </div>

            <div class="edit-section">
                <h3>üèÄ Ë©¶Âêà„Çπ„Ç≥„Ç¢</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div class="input-group">
                        <label>Q1 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ1" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q1 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ1" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q2 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ2" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q2 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ2" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q3 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ3" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q3 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ3" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q4 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ4" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q4 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ4" min="0" max="99" value="0">
                    </div>
                </div>
            </div>

            <div class="edit-section" id="editPlayersSection">
                <h3>üë• ÈÅ∏ÊâãÁµ±Ë®à</h3>
                <div id="editPlayersList"></div>
            </div>

            <button class="save-edit-btn" onclick="saveGameEdit()">‚úÖ Â§âÊõ¥„Çí‰øùÂ≠ò</button>
            <button class="delete-game-btn" onclick="deleteGame()">üóëÔ∏è „Åì„ÅÆË©¶Âêà„ÇíÂâäÈô§</button>
            <button class="close-modal" onclick="closeModal('editGameModal')">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>
    
    <div class="saved-indicator" id="savedIndicator">‚úì ‰øùÂ≠ò„Åó„Åæ„Åó„Åü</div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwbPUgd-QAVhwBmhyBwiCtS1GDvZks0imrC78ZsJu5dV-d-Zt6reEW0oi1Lkc_MbW_agQ/exec';
        
        let currentMode = 'personal';
        // „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„ÉàÈñ¢ÈÄ£„ÅÆÂ§âÊï∞
        let currentShotPosition = null;
        let shotChartCallback = null;
        
        // „Ç≥„Éº„ÉàÂõ≥„ÇíÊèèÁîª„Åô„ÇãÈñ¢Êï∞
        function drawCourt(canvas) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ËÉåÊôØ„ÇíÁôΩ„Å´
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // „Ç≥„Éº„Éà„ÅÆÁ∑öÔºàÈªíÔºâ
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // Â§ñÊû†
            ctx.strokeRect(10, 10, width - 20, height - 20);
            
            // „Éï„É™„Éº„Çπ„É≠„Éº„É©„Ç§„É≥ÔºàÂè∞ÂΩ¢Ôºâ
            ctx.beginPath();
            ctx.moveTo(width * 0.2, 10);
            ctx.lineTo(width * 0.3, height * 0.25);
            ctx.lineTo(width * 0.7, height * 0.25);
            ctx.lineTo(width * 0.8, 10);
            ctx.closePath();
            ctx.stroke();
            
            // 3„Éù„Ç§„É≥„Éà„É©„Ç§„É≥ÔºàÂçäÂÜÜÔºâ
            ctx.beginPath();
            ctx.arc(width / 2, 10, width * 0.45, 0, Math.PI);
            ctx.stroke();
            
            // „Ç¥„Éº„É´ÔºàÂçäÂÜÜÔºâ
            ctx.beginPath();
            ctx.arc(width / 2, 10, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#e74c3c';
            ctx.fill();
            
            // „Çª„É≥„Çø„Éº„É©„Ç§„É≥ÔºàÁÇπÁ∑öÔºâ
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(10, height / 2);
            ctx.lineTo(width - 10, height / 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // „Ç®„É™„Ç¢Âêç„ÇíË°®Á§∫
            ctx.fillStyle = '#999';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('„Ç¥„Éº„É´‰∏ã', width / 2, 80);
            ctx.fillText('Â∑¶„Ç¶„Ç£„É≥„Ç∞', width * 0.25, height * 0.35);
            ctx.fillText('Âè≥„Ç¶„Ç£„É≥„Ç∞', width * 0.75, height * 0.35);
            ctx.fillText('„Éà„ÉÉ„Éó', width / 2, height * 0.6);
        }
        
        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„Åå„Å©„ÅÆ„Ç®„É™„Ç¢„Å´Â±û„Åô„Çã„ÅãÂà§ÂÆö„Åô„ÇãÈñ¢Êï∞
        function getZoneFromPosition(x, y, width, height) {
            const centerX = width / 2;
            const distanceFromCenter = Math.abs(x - centerX);
            
            // YÂ∫ßÊ®ô„ÅßÂà§ÂÆö
            if (y < height * 0.2) {
                return 'paint'; // „Ç¥„Éº„É´‰∏ã
            } else if (y < height * 0.4) {
                if (distanceFromCenter < width * 0.2) {
                    return 'mid_range'; // „Éü„Éâ„É´„É¨„É≥„Ç∏
                } else {
                    return x < centerX ? 'left_wing' : 'right_wing'; // Â∑¶Âè≥„Ç¶„Ç£„É≥„Ç∞
                }
            } else if (y < height * 0.65) {
                return 'top'; // „Éà„ÉÉ„Éó
            } else {
                return 'backcourt'; // „Éê„ÉÉ„ÇØ„Ç≥„Éº„Éà
            }
        }
        
        // „Ç®„É™„Ç¢Âêç„ÇíÊó•Êú¨Ë™û„Å´Â§âÊèõ
        function getZoneNameJP(zone) {
            const names = {
                'paint': '„Ç¥„Éº„É´‰∏ã',
                'left_wing': 'Â∑¶„Ç¶„Ç£„É≥„Ç∞',
                'right_wing': 'Âè≥„Ç¶„Ç£„É≥„Ç∞',
                'mid_range': '„Éü„Éâ„É´„É¨„É≥„Ç∏',
                'top': '„Éà„ÉÉ„Éó',
                'backcourt': '„Éê„ÉÉ„ÇØ„Ç≥„Éº„Éà'
            };
            return names[zone] || zone;
        }
        let personalGames = [];
        let teamGames = [];
        let players = [];
        let myPlayerId = null;
        let teamData = null;
        let charts = {};
        
        let stats = {
            twoPointsMade: 0, twoPointsAttempted: 0,
            threePointsMade: 0, threePointsAttempted: 0,
            freeThrowsMade: 0, freeThrowsAttempted: 0,
            offensiveRebounds: 0, defensiveRebounds: 0,
            assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
        };

        let currentTeamGame = null;
        let draftTeamGame = null;
        let selectedPlayer = null;
        let currentPeriod = 1;

        function showSyncIndicator(status, message) {
            const indicator = document.getElementById('syncIndicator');
            indicator.className = 'sync-indicator ' + status;
            indicator.textContent = message;
            
            if (status === 'success' || status === 'error') {
                setTimeout(function() {
                    indicator.className = 'sync-indicator';
                }, 3000);
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('basketballData');
                if (saved) {
                    const data = JSON.parse(saved);
                    personalGames = data.personalGames || [];
                    teamGames = data.teamGames || [];
                    players = data.players || [];
                    myPlayerId = data.myPlayerId || null;
                    teamData = data.teamData || null;
                    draftTeamGame = data.draftTeamGame || null;
                    // ‚ñº‚ñº‚ñº „Åì„Åì„Åã„ÇâËøΩÂä† ‚ñº‚ñº‚ñº
                    // myPlayerId„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÈÅ∏Êâã„ÇíÊåá„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÄÅ‰øÆÊ≠£„Åô„Çã
                    if (myPlayerId && players.length > 0) {
                        const playerExists = players.find(function(p) {
                            return p.id === myPlayerId;
                        });
                
                        if (!playerExists) {
                            console.warn('ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÊúÄÂàù„ÅÆÈÅ∏Êâã„ÇíËá™ÂãïÈÅ∏Êäû„Åó„Åæ„Åô„ÄÇ');
                            myPlayerId = players[0].id;
                            saveData();
                        }
                    }
                    // ‚ñ≤‚ñ≤‚ñ≤ „Åì„Åì„Åæ„ÅßËøΩÂä† ‚ñ≤‚ñ≤‚ñ≤
                }
            } catch (e) {
                console.error('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', e);
            }
        }

        function saveData() {
            const data = {
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData,
                draftTeamGame: draftTeamGame
            };
            localStorage.setItem('basketballData', JSON.stringify(data));
            showSavedIndicator();
        }

        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.classList.add('show');
            setTimeout(function() {
                indicator.classList.remove('show');
            }, 2000);
        }

        
        function startTeamGame() {
            // ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØË≠¶Âëä
            if (draftTeamGame) {
                if (!confirm('‚ö†Ô∏è Êú™ÂÆå‰∫Ü„ÅÆË©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô\n\nÊñ∞„Åó„ÅÑË©¶Âêà„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ\nÁ∂ö„Åë„Åæ„Åô„Åã?')) {
                    return;
                }
            }
            
            if (players.length === 0) { 
                alert('ÂÖà„Å´ÈÅ∏Êâã„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ(Ë®≠ÂÆö„Çø„Éñ)'); 
                return; 
            }

            const date = document.getElementById('teamGameDate').value;
            if (!date) { 
                alert('Ë©¶ÂêàÊó•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); 
                return; 
            }

            currentTeamGame = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('teamOpponent').value.trim(),
                plays: [],
                playerStats: {},
                scores: {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                }
            };

            players.forEach(function(p) {
                currentTeamGame.playerStats[p.id] = {
                    twoPointsMade: 0, twoPointsAttempted: 0,
                    threePointsMade: 0, threePointsAttempted: 0,
                    freeThrowsMade: 0, freeThrowsAttempted: 0,
                    offensiveRebounds: 0, defensiveRebounds: 0,
                    assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
                };
            });

            currentPeriod = 1;
            selectPeriod(1);
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
        }

        function displayPlayerSelector() {
            const sel = document.getElementById('playerSelector');
            sel.innerHTML = players.map(function(p) {
                const isSelected = selectedPlayer === p.id;
                return '<div class="player-btn' + (isSelected ? ' selected' : '') + '" onclick="selectPlayer(\'' + p.id + '\')">' +
                    '<div class="number">#' + p.number + '</div>' +
                    '<div class="name">' + p.name + '</div>' +
                    '</div>';
            }).join('');
        }

        function selectPlayer(id) {
            selectedPlayer = id;
            displayPlayerSelector();
        }

        function selectPeriod(period) {
            currentPeriod = period;
            
            // „Éî„É™„Ç™„Éâ„Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„ÇíÊõ¥Êñ∞
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById('period' + i);
                if (i === period) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            }
            
            // „Çπ„Ç≥„Ç¢ÂÖ•ÂäõÊ¨Ñ„ÅÆÂÄ§„ÇíÊõ¥Êñ∞(ID„ÅØÂõ∫ÂÆö)
            const ourScoreInput = document.querySelector('.score-input-container input[id^="ourScore"]');
            const oppScoreInput = document.querySelector('.score-input-container input[id^="oppScore"]');
            
            if (ourScoreInput && oppScoreInput) {
                // onchange„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö„ÅóÁõ¥„Åó
                ourScoreInput.onchange = function() { updateQuarterScore(period, 'our'); };
                oppScoreInput.onchange = function() { updateQuarterScore(period, 'opp'); };
                
                // ÁèæÂú®„ÅÆ„ÇØ„Ç©„Éº„Çø„Éº„ÅÆ„Çπ„Ç≥„Ç¢„ÇíË°®Á§∫
                if (currentTeamGame && currentTeamGame.scores) {
                    ourScoreInput.value = currentTeamGame.scores.our['q' + period] || 0;
                    oppScoreInput.value = currentTeamGame.scores.opp['q' + period] || 0;
                }
            }
        }

        function updateQuarterScore(quarter, team) {
            if (!currentTeamGame) return;
            
            const inputId = team === 'our' ? 'ourScoreInput' : 'oppScoreInput';
            const value = parseInt(document.getElementById(inputId).value) || 0;
            
            currentTeamGame.scores[team]['q' + quarter] = value;
        }

        function getPlayLabel(type) {
            const labels = {
                '2p-made': '2PÊàêÂäü', '2p-miss': '2PÂ§±Êïó',
                '3p-made': '3PÊàêÂäü', '3p-miss': '3PÂ§±Êïó',
                'ft-made': 'FTÊàêÂäü', 'ft-miss': 'FTÂ§±Êïó',
                'oreb': '„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ', 'dreb': '„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ',
                'ast': '„Ç¢„Ç∑„Çπ„Éà', 'stl': '„Çπ„ÉÜ„Ç£„Éº„É´', 'blk': '„Éñ„É≠„ÉÉ„ÇØ',
                'to': '„Çø„Éº„É≥„Ç™„Éº„Éê„Éº', 'foul': '„Éï„Ç°„Ç¶„É´'
            };
            return labels[type] || type;
        }

        function recordPlay(type) {
            if (!selectedPlayer || !currentPeriod) {
                alert('ÈÅ∏Êâã„Å®„ÇØ„Ç©„Éº„Çø„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!currentTeamGame) {
                alert('Ë©¶Âêà„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // „Ç∑„É•„Éº„ÉàÁ≥ª„ÅÆ„Éó„É¨„Ç§„ÅÆÂ†¥Âêà„ÅØ‰ΩçÁΩÆ„ÇíË®òÈå≤
            const shotTypes = ['2p-made', '2p-miss', '3p-made', '3p-miss'];
            
            if (shotTypes.includes(type)) {
                // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
                openShotPositionModal(function(position) {
                    // ‰ΩçÁΩÆÊÉÖÂ†±„Å®ÂÖ±„Å´„Éó„É¨„Ç§„ÇíË®òÈå≤
                    recordPlayWithPosition(type, position);
                });
            } else {
                // „Ç∑„É•„Éº„Éà‰ª•Â§ñ„ÅØ„Åù„ÅÆ„Åæ„ÅæË®òÈå≤
                recordPlayWithPosition(type, null);
            }
        }
        
        // ‰ΩçÁΩÆÊÉÖÂ†±‰ªò„Åç„Åß„Éó„É¨„Ç§„ÇíË®òÈå≤„Åô„ÇãÊñ∞„Åó„ÅÑÈñ¢Êï∞
        function recordPlayWithPosition(type, position) {
            if (!currentTeamGame) {
                alert('Ë©¶Âêà„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const play = {
                playType: type,
                playerId: selectedPlayer,
                period: currentPeriod,  // ‚Üê currentQuarter„Åß„ÅØ„Å™„ÅècurrentPeriod
                timestamp: Date.now()
            };
            
            // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆÊÉÖÂ†±„ÇíËøΩÂä†
            if (position) {
                play.position = position;
            }
            
            currentTeamGame.plays.push(play);  // ‚Üê currentPlays„Åß„ÅØ„Å™„ÅècurrentTeamGame.plays„Å´Â§âÊõ¥
            updatePlayerStats(selectedPlayer, type);
            displayPlayHistory();
            updateTeamStats();  // ‚Üê displayCurrentStats„Åß„ÅØ„Å™„ÅèupdateTeamStats„ÇíÂëº„Å∂
            
            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫„ÇíËøΩÂä†
            const player = players.find(p => p.id === selectedPlayer);
            const playerName = player ? '#' + player.number + ' ' + player.name : '';
            showPlayFeedback(playerName + ' ' + getPlayLabel(type), type);
            
            saveData();
        }

        // „Éó„É¨„Ç§„Çø„Ç§„Éó„Å´Âøú„Åò„Å¶ÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
        function updatePlayerStats(playerId, playType) {
            if (!currentTeamGame || !currentTeamGame.playerStats[playerId]) {
                return;
            }
            
            const stats = currentTeamGame.playerStats[playerId];
            
            switch(playType) {
                case '2p-made':
                    stats.twoPointsMade++;
                    stats.twoPointsAttempted++;
                    break;
                case '2p-miss':
                    stats.twoPointsAttempted++;
                    break;
                case '3p-made':
                    stats.threePointsMade++;
                    stats.threePointsAttempted++;
                    break;
                case '3p-miss':
                    stats.threePointsAttempted++;
                    break;
                case 'ft-made':
                    stats.freeThrowsMade++;
                    stats.freeThrowsAttempted++;
                    break;
                case 'ft-miss':
                    stats.freeThrowsAttempted++;
                    break;
                case 'oreb':
                    stats.offensiveRebounds++;
                    break;
                case 'dreb':
                    stats.defensiveRebounds++;
                    break;
                case 'ast':
                    stats.assists++;
                    break;
                case 'stl':
                    stats.steals++;
                    break;
                case 'blk':
                    stats.blocks++;
                    break;
                case 'to':
                    stats.turnovers++;
                    break;
                case 'foul':
                    stats.fouls++;
                    break;
            }
        }

        function showPlayFeedback(message, type) {
            // Êó¢Â≠ò„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
            const existing = document.querySelector('.feedback-notification');
            if (existing) {
                existing.remove();
            }

            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü•„Çí‰ΩúÊàê
            const feedback = document.createElement('div');
            feedback.className = 'feedback-notification';
            
            // „Çø„Ç§„Éó„Å´Âøú„Åò„Å¶„ÇØ„É©„Çπ„ÇíËøΩÂä†
            if (type.includes('made')) {
                feedback.classList.add('success');
            } else if (type.includes('miss')) {
                feedback.classList.add('miss');
            } else {
                feedback.classList.add('other');
            }
            
            feedback.textContent = message;
            document.body.appendChild(feedback);

            // 1ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(function() {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 1000);

            // „Éú„Çø„É≥„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíËøΩÂä†
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(function(btn) {
                if (btn.textContent.toLowerCase().includes(type.split('-')[0])) {
                    btn.classList.add('pressed');
                    setTimeout(function() {
                        btn.classList.remove('pressed');
                    }, 300);
                }
            });
        }

        function deletePlay(timestamp) {
            const playIndex = currentTeamGame.plays.findIndex(function(p) {
                return p.timestamp === timestamp;
            });
            if (playIndex === -1) return;
            
            const play = currentTeamGame.plays[playIndex];
            const st = currentTeamGame.playerStats[play.playerId];
            
            if (play.playType === '2p-made') { st.twoPointsMade--; st.twoPointsAttempted--; }
            else if (play.playType === '2p-miss') { st.twoPointsAttempted--; }
            else if (play.playType === '3p-made') { st.threePointsMade--; st.threePointsAttempted--; }
            else if (play.playType === '3p-miss') { st.threePointsAttempted--; }
            else if (play.playType === 'ft-made') { st.freeThrowsMade--; st.freeThrowsAttempted--; }
            else if (play.playType === 'ft-miss') { st.freeThrowsAttempted--; }
            else if (play.playType === 'oreb') { st.offensiveRebounds--; }
            else if (play.playType === 'dreb') { st.defensiveRebounds--; }
            else if (play.playType === 'ast') { st.assists--; }
            else if (play.playType === 'stl') { st.steals--; }
            else if (play.playType === 'blk') { st.blocks--; }
            else if (play.playType === 'to') { st.turnovers--; }
            else if (play.playType === 'foul') { st.fouls--; }
            
            currentTeamGame.plays.splice(playIndex, 1);
            
            updateTeamStats();
            displayPlayHistory();
        }

        function displayPlayHistory() {
    const histEl = document.getElementById('playHistory');
    
    // ========== ËøΩÂä†:Â≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ ==========
    if (!currentTeamGame || !currentTeamGame.plays) {
        histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">„Éó„É¨„Ç§Â±•Ê≠¥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>';
        return;
    }
    // ========================================
    
    if (currentTeamGame.plays.length === 0) {
        histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">„Éó„É¨„Ç§Â±•Ê≠¥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>';
        return;
    }
    
    const recentPlays = currentTeamGame.plays.slice().reverse().slice(0, 10);
    histEl.innerHTML = '<div style="margin-bottom: 10px; font-size: 0.9em; color: #666; font-weight: bold;">ÊúÄÊñ∞„ÅÆ„Éó„É¨„Ç§(ÊúÄÂ§ß10‰ª∂) - „Çø„ÉÉ„Éó„ÅßÂâäÈô§</div>' +
        recentPlays.map(function(play) {
            const p = players.find(function(pl) {
                return pl.id === play.playerId;
            });
            return '<div class="play-item">' +
                '<div>' +
                '<strong>' + play.period + 'Q | #' + p.number + ' ' + p.name + '</strong>' +
                '<div style="font-size: 0.85em; color: #666; margin-top: 2px;">' + getPlayLabel(play.playType) + '</div>' +
                '</div>' +
                '<button class="undo-btn" onclick="deletePlay(' + play.timestamp + ')">ÂâäÈô§</button>' +
                '</div>';
        }).join('');
}

        function updateTeamStats() {
            const el = document.getElementById('teamStats');
            let html = '';

            players.forEach(function(p) {
                const st = currentTeamGame.playerStats[p.id];
                const pts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;
                const reb = st.offensiveRebounds + st.defensiveRebounds;

                html += '<div style="padding: 10px; background: #f7f7f7; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="font-weight: bold; margin-bottom: 5px;">#' + p.number + ' ' + p.name + '</div>' +
                    '<div style="font-size: 0.9em; color: #666;">' +
                    pts + 'ÁÇπ | ' + reb + '„É™„Éê„Ç¶„É≥„Éâ | ' + st.assists + '„Ç¢„Ç∑„Çπ„Éà | ' + st.steals + '„Çπ„ÉÜ„Ç£„Éº„É´ | ' + st.blocks + '„Éñ„É≠„ÉÉ„ÇØ' +
                    '</div>' +
                    '</div>';
            });

            el.innerHTML = html;
        }

        function saveTeamGame() {
            if (!currentTeamGame) return;

            teamGames.unshift(currentTeamGame);

            players.forEach(function(player) {
                if (currentTeamGame.playerStats[player.id]) {
                    const st = currentTeamGame.playerStats[player.id];
                    const totalReb = st.offensiveRebounds + st.defensiveRebounds;
                    const totalPts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;

                    const personalGame = {
                        id: Date.now() + Math.random(),
                        date: currentTeamGame.date,
                        opponent: currentTeamGame.opponent,
                        playTime: 0,
                        playerId: player.id,
                        twoPointsMade: st.twoPointsMade,
                        twoPointsAttempted: st.twoPointsAttempted,
                        threePointsMade: st.threePointsMade,
                        threePointsAttempted: st.threePointsAttempted,
                        freeThrowsMade: st.freeThrowsMade,
                        freeThrowsAttempted: st.freeThrowsAttempted,
                        offensiveRebounds: st.offensiveRebounds,
                        defensiveRebounds: st.defensiveRebounds,
                        assists: st.assists,
                        steals: st.steals,
                        blocks: st.blocks,
                        turnovers: st.turnovers,
                        fouls: st.fouls,
                        totalRebounds: totalReb,
                        twoPointPercentage: st.twoPointsAttempted > 0 ? ((st.twoPointsMade / st.twoPointsAttempted) * 100).toFixed(1) : '0',
                        threePointPercentage: st.threePointsAttempted > 0 ? ((st.threePointsMade / st.threePointsAttempted) * 100).toFixed(1) : '0',
                        freeThrowPercentage: st.freeThrowsAttempted > 0 ? ((st.freeThrowsMade / st.freeThrowsAttempted) * 100).toFixed(1) : '0',
                        totalPoints: totalPts,
                        source: 'team',
                        teamGameId: currentTeamGame.id
                    };

                    personalGames.unshift(personalGame);
                }
            });

            saveData();
            
            if (teamData) {
                syncGamesOnly();
            }

            // ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§(Ë©¶ÂêàÂÆå‰∫Ü„Åó„Åü„ÅÆ„Åß‰∏çË¶Å)
            clearDraftTeamGame();
            
            // Ë≠¶Âëä„Éú„ÉÉ„ÇØ„Çπ„ÇÇÂâäÈô§
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            currentTeamGame = null;
            selectedPlayer = null;
            currentPeriod = 1;
            document.getElementById('teamRecording').style.display = 'none';
            document.getElementById('teamGameDate').valueAsDate = new Date();
            document.getElementById('teamOpponent').value = '';
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!\n\nÂÖ®ÈÅ∏Êâã„ÅÆ„Éá„Éº„Çø„ÅåÂÄã‰∫∫„É¢„Éº„Éâ„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô„ÄÇ');
        }

        // ========== ÈÄî‰∏≠‰øùÂ≠òÊ©üËÉΩ ==========
        function saveDraftTeamGame() {
            if (!currentTeamGame) {
                alert('‚ùå Ë®òÈå≤‰∏≠„ÅÆË©¶Âêà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // ÁèæÂú®„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇíÈÄî‰∏≠‰øùÂ≠òÁî®„Å´‰øùÂ≠ò
            draftTeamGame = {
                id: currentTeamGame.id,
                date: currentTeamGame.date,
                opponent: currentTeamGame.opponent,
                plays: currentTeamGame.plays.slice(), // „Ç≥„Éî„Éº„Çí‰ΩúÊàê
                playerStats: JSON.parse(JSON.stringify(currentTeamGame.playerStats)), // Ê∑±„ÅÑ„Ç≥„Éî„Éº
                scores: JSON.parse(JSON.stringify(currentTeamGame.scores)), // „Çπ„Ç≥„Ç¢„Éá„Éº„Çø„ÇÇ‰øùÂ≠ò
                currentPeriod: currentPeriod, // ÁèæÂú®„ÅÆ„Éî„É™„Ç™„Éâ„ÇÇ‰øùÂ≠ò
                savedAt: new Date().toISOString() // ‰øùÂ≠òÊó•ÊôÇ
            };
            
            // „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
            
            alert('‚úÖ ÈÄî‰∏≠‰øùÂ≠ò„Åó„Åæ„Åó„Åü!\n\nË®òÈå≤„ÇíÁ∂ö„Åë„Çã„Åã„ÄÅÂæå„Åã„Çâ„ÄåÁ∂ö„Åç„Åã„ÇâË®òÈå≤„Äç„ÅßÂÜçÈñã„Åß„Åç„Åæ„Åô„ÄÇ');
        }

        // ========== Á∂ö„Åç„Åã„ÇâË®òÈå≤(ÂÜçÈñã)Ê©üËÉΩ ==========
        function resumeDraftGame() {
            if (!draftTeamGame) {
                alert('‚ùå ÈÄî‰∏≠‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // Á¢∫Ë™ç„É°„ÉÉ„Çª„Éº„Ç∏
            const dateStr = new Date(draftTeamGame.date).toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            if (!confirm('üìã Êú™ÂÆå‰∫Ü„ÅÆË©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô\n\n' +
                        'Êó•‰ªò: ' + dateStr + '\n' +
                        'ÂØæÊà¶Áõ∏Êâã: ' + (draftTeamGame.opponent || 'Êú™Ë®≠ÂÆö') + '\n' +
                        '‰øùÂ≠òÊó•ÊôÇ: ' + new Date(draftTeamGame.savedAt).toLocaleString('ja-JP') + '\n\n' +
                        'Á∂ö„Åç„Åã„ÇâË®òÈå≤„Åó„Åæ„Åô„Åã?')) {
                return;
            }
            
            // ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åü„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
            currentTeamGame = {
                id: draftTeamGame.id,
                date: draftTeamGame.date,
                opponent: draftTeamGame.opponent,
                plays: draftTeamGame.plays.slice(),
                playerStats: JSON.parse(JSON.stringify(draftTeamGame.playerStats)),
                scores: draftTeamGame.scores ? JSON.parse(JSON.stringify(draftTeamGame.scores)) : {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                }
            };
            
            // „Éî„É™„Ç™„Éâ„ÇÇÂæ©ÂÖÉ
            currentPeriod = draftTeamGame.currentPeriod || 1;
            selectPeriod(currentPeriod);
            
            // Êó•‰ªò„Å®ÂØæÊà¶Áõ∏Êâã„ÇíÁîªÈù¢„Å´Ë°®Á§∫
            document.getElementById('teamGameDate').value = draftTeamGame.date;
            document.getElementById('teamOpponent').value = draftTeamGame.opponent || '';
            
            // Ë®òÈå≤ÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„ÇíÂÜçÈñã„Åó„Åæ„Åó„Åü!\n\nÂâçÂõû„ÅÆÁ∂ö„Åç„Åã„ÇâË®òÈå≤„Åß„Åç„Åæ„Åô„ÄÇ');
        }

        // ========== ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÅÆÂâäÈô§(Ë©¶ÂêàÂÆå‰∫ÜÊôÇ)==========
        function clearDraftTeamGame() {
            draftTeamGame = null;
            saveData();
        }

        // ========== Ëµ∑ÂãïÊôÇ„Å´ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ ==========
        function checkAndShowDraftGame() {
            // ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„Åå„Å™„Åë„Çå„Å∞‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (!draftTeamGame) {
                return;
            }
            
            // „ÉÅ„Éº„É†Ë®òÈå≤„Çø„Éñ„ÅÆ‰∏ÄÁï™‰∏ä„Å´„ÄåÁ∂ö„Åç„Åã„ÇâË®òÈå≤„Äç„Éú„Çø„É≥„ÇíË°®Á§∫
            const teamRecordTab = document.getElementById('teamRecordTab');
            
            // Êó¢„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (document.getElementById('draftGameAlert')) {
                return;
            }
            
            // Êó•‰ªò„ÇíË¶ã„ÇÑ„Åô„ÅèÊï¥ÂΩ¢
            const dateStr = new Date(draftTeamGame.date).toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // „Ç¢„É©„Éº„Éà„Éú„ÉÉ„ÇØ„Çπ„Çí‰ΩúÊàê
            const alertBox = document.createElement('div');
            alertBox.id = 'draftGameAlert';
            alertBox.className = 'card';
            alertBox.style.background = 'linear-gradient(135deg, #ffd93d 0%, #ffb03a 100%)';
            alertBox.style.color = '#333';
            alertBox.style.marginBottom = '20px';
            alertBox.innerHTML = 
                '<div style="display: flex; align-items: center; margin-bottom: 15px;">' +
                '<span style="font-size: 2em; margin-right: 10px;">‚ö†Ô∏è</span>' +
                '<h2 style="margin: 0;">Êú™ÂÆå‰∫Ü„ÅÆË©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô</h2>' +
                '</div>' +
                '<div style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px; margin-bottom: 15px;">' +
                '<div style="margin-bottom: 8px;"><strong>üìÖ Ë©¶ÂêàÊó•:</strong> ' + dateStr + '</div>' +
                '<div style="margin-bottom: 8px;"><strong>üèÄ ÂØæÊà¶Áõ∏Êâã:</strong> ' + (draftTeamGame.opponent || 'Êú™Ë®≠ÂÆö') + '</div>' +
                '<div><strong>üíæ ‰øùÂ≠òÊó•ÊôÇ:</strong> ' + new Date(draftTeamGame.savedAt).toLocaleString('ja-JP') + '</div>' +
                '</div>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">' +
                '<button class="primary-btn" style="background: #2ecc71;" onclick="resumeDraftGame()">‚ñ∂Ô∏è Á∂ö„Åç„Åã„ÇâË®òÈå≤</button>' +
                '<button class="primary-btn" style="background: #e74c3c;" onclick="deleteDraftGame()">üóëÔ∏è ÂâäÈô§„Åó„Å¶Êñ∞Ë¶è‰ΩúÊàê</button>' +
                '</div>';
            
            // „Çø„Éñ„ÅÆÊúÄÂàù„Å´ÊåøÂÖ•
            teamRecordTab.insertBefore(alertBox, teamRecordTab.firstChild);
        }

        // ========== ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶Êñ∞Ë¶è‰ΩúÊàê ==========
        function deleteDraftGame() {
            if (!confirm('‚ö†Ô∏è ÈÄî‰∏≠‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô\n\nÂâäÈô§„Åô„Çã„Å®Âæ©ÂÖÉ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\nÊú¨ÂΩì„Å´„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã?')) {
                return;
            }
            
            clearDraftTeamGame();
            
            // Ë≠¶Âëä„Éú„ÉÉ„ÇØ„Çπ„ÇíÂâäÈô§
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            alert('‚úÖ ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü\n\nÊñ∞„Åó„ÅÑË©¶Âêà„ÇíË®òÈå≤„Åß„Åç„Åæ„Åô„ÄÇ');
        }

        

        function switchTeamTab(tab) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÂàá„ÇäÊõø„Åà
            const tabs = document.querySelectorAll('#teamMode .tab');
            tabs.forEach(function(t) {
                t.classList.remove('active');
            });
            
            if (tab === 'record') {
                tabs[0].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'block';
                document.getElementById('teamHistoryTab').style.display = 'none';
                document.getElementById('teamRankingTab').style.display = 'none';
                checkAndShowDraftGame();
            } else if (tab === 'history') {
                tabs[1].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'none';
                document.getElementById('teamHistoryTab').style.display = 'block';
                document.getElementById('teamRankingTab').style.display = 'none';
                displayTeamGamesHistory();
            } else if (tab === 'ranking') {
                tabs[2].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'none';
                document.getElementById('teamHistoryTab').style.display = 'none';
                document.getElementById('teamRankingTab').style.display = 'block';
                displayTeamRankings();
            }
        }

        function displayTeamGamesHistory() {
            const listEl = document.getElementById('teamGamesList');
            
            if (teamGames.length === 0) {
                listEl.innerHTML = '<div class="empty-state"><div class="icon">üèÄ</div><h3>„Åæ„Å†Ë©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3><p>Ë©¶ÂêàË®òÈå≤„Çø„Éñ„ÅßË®òÈå≤„ÇíÈñãÂßã„Åó„Åæ„Åó„Çá„ÅÜ!</p></div>';
                return;
            }
            
            let html = '<div class="card"><h2 style="margin-bottom: 20px;">üìä Ë©¶ÂêàÂ±•Ê≠¥</h2></div>';
            
            // ========== ÊúÄÊñ∞„ÅÆË©¶Âêà„Åå‰∏ä„Å´Êù•„Çã„Çà„ÅÜ„Å´„ÇΩ„Éº„Éà ==========
            const sortedGames = teamGames.slice().sort(function(a, b) {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return dateB - dateA; // Êñ∞„Åó„ÅÑÈ†Ü(ÈôçÈ†Ü)
            });
            // ====================================================
            
            sortedGames.forEach(function(game, index) {
                // ÂÖÉ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíÂèñÂæó(Á∑®ÈõÜ„ÉªÂâäÈô§Áî®)
                const originalIndex = teamGames.indexOf(game);
                const dateObj = new Date(game.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                // „Çπ„Ç≥„Ç¢ÊÉÖÂ†±„ÇíË®àÁÆó
                let scoreHtml = '';
                if (game.scores) {
                    const ourTotal = (game.scores.our.q1 || 0) + (game.scores.our.q2 || 0) + (game.scores.our.q3 || 0) + (game.scores.our.q4 || 0);
                    const oppTotal = (game.scores.opp.q1 || 0) + (game.scores.opp.q2 || 0) + (game.scores.opp.q3 || 0) + (game.scores.opp.q4 || 0);
                    const isWin = ourTotal > oppTotal;
                    const outcome = ourTotal === oppTotal ? 'Âºï„ÅçÂàÜ„Åë' : (isWin ? 'ÂãùÂà©' : 'ÊïóÂåó');
                    
                    scoreHtml = '<div style="font-size: 1.5em; font-weight: bold; margin-top: 5px;">' +
                        ourTotal + ' - ' + oppTotal + ' (' + outcome + ')' +
                        '</div>';
                }
                
                html += '<div class="game-history-item" onclick="toggleGameDetail(' + originalIndex + ')">' +
                    '<div class="game-date">' + dateStr + '</div>' +
                    '<div class="game-opponent">vs ' + (game.opponent || 'ÂØæÊà¶Áõ∏Êâã„Å™„Åó') + '</div>' +
                    scoreHtml +
                    '</div>' +
                    '<div class="game-detail" id="gameDetail' + originalIndex + '">' +
                    generateScoreDetail(game) +
                    '<button class="edit-game-btn" onclick="event.stopPropagation(); openEditGameModal(' + originalIndex + ')">üìù Ë©¶ÂêàË®òÈå≤„ÇíÁ∑®ÈõÜ(ÁÆ°ÁêÜËÄÖ„ÅÆ„Åø)</button>' +
                    generateGameRankings(game) +
                    '</div>';
            });
            
            listEl.innerHTML = html;
        }

        function toggleGameDetail(index) {
            const detail = document.getElementById('gameDetail' + index);
            detail.classList.toggle('active');
        }

        function generateScoreDetail(game) {
            if (!game.scores) return '';
            
            const ourTotal = (game.scores.our.q1 || 0) + (game.scores.our.q2 || 0) + (game.scores.our.q3 || 0) + (game.scores.our.q4 || 0);
            const oppTotal = (game.scores.opp.q1 || 0) + (game.scores.opp.q2 || 0) + (game.scores.opp.q3 || 0) + (game.scores.opp.q4 || 0);
            const isWin = ourTotal > oppTotal;
            const outcome = ourTotal === oppTotal ? 'Âºï„ÅçÂàÜ„Åë' : (isWin ? 'ÂãùÂà©' : 'ÊïóÂåó');
            
            // „ÉÅ„Éº„É†Âêç„ÇíÂèñÂæó
            const ourTeamName = teamData ? teamData.name : 'Ëá™„ÉÅ„Éº„É†';
            const oppTeamName = game.opponent || 'ÂØæÊà¶Áõ∏Êâã';
            
            let html = '<div class="game-result' + (isWin ? '' : ' loss') + '">';
            html += '<div class="result-label">Ë©¶ÂêàÁµêÊûú</div>';
            html += '<div class="result-score">' + ourTotal + ' - ' + oppTotal + '</div>';
            
            // ========== „ÉÅ„Éº„É†Âêç„ÇíËøΩÂä† ==========
            html += '<div class="team-names">';
            html += '<span class="our-team-name">' + ourTeamName + '</span>';
            html += '<span class="vs-label">VS</span>';
            html += '<span class="opp-team-name">' + oppTeamName + '</span>';
            html += '</div>';
            // ===================================
            
            html += '<div class="result-outcome">' + outcome + '</div>';
            html += '</div>';
            
            html += '<div class="quarter-scores">';
            for (let i = 1; i <= 4; i++) {
                const ourScore = game.scores.our['q' + i] || 0;
                const oppScore = game.scores.opp['q' + i] || 0;
                const diff = ourScore - oppScore;
                const diffClass = diff > 0 ? 'positive' : (diff < 0 ? 'negative' : '');
                const diffText = diff > 0 ? '+' + diff : diff;
                
                html += '<div class="quarter-score-item">';
                html += '<div class="quarter-label">Q' + i + '</div>';
                html += '<div class="quarter-value">' + ourScore + ' - ' + oppScore + '</div>';
                html += '<div class="quarter-diff ' + diffClass + '">(' + diffText + ')</div>';
                html += '</div>';
            }
            html += '</div>';
            
            return html;
        }

        function generateGameRankings(game) {
            let html = '';
            
            // ÂæóÁÇπ„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'points', 'üèÜ ÂæóÁÇπÁéã', function(stats) {
                return (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            }, 'ÁÇπ');
            
            // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'fieldGoalPct', 'üéØ „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá', function(stats) {
                const made = stats.twoPointsMade + stats.threePointsMade;
                const attempted = stats.twoPointsAttempted + stats.threePointsAttempted;
                return attempted > 0 ? ((made / attempted) * 100).toFixed(1) : 0;
            }, '%', true);
            
            // „É™„Éê„Ç¶„É≥„Éâ„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'rebounds', 'üì¶ „É™„Éê„Ç¶„É≥„ÉâÁéã', function(stats) {
                return stats.offensiveRebounds + stats.defensiveRebounds;
            }, 'Êú¨');
            
            // „Ç¢„Ç∑„Çπ„Éà„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'assists', 'ü§ù „Ç¢„Ç∑„Çπ„ÉàÁéã', function(stats) {
                return stats.assists;
            }, 'Âõû');
            
            // „Çπ„ÉÜ„Ç£„Éº„É´„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'steals', 'üõ°Ô∏è „Çπ„ÉÜ„Ç£„Éº„É´Áéã', function(stats) {
                return stats.steals;
            }, 'Âõû');
            
            return html;
        }
        

        function generateRankingSection(game, key, title, calcFunc, unit, isPercentage) {
            // ÈÅ∏Êâã„Éá„Éº„Çø„ÇíÈÖçÂàó„Å´Â§âÊèõ„Åó„Å¶ÂÄ§„ÇíË®àÁÆó
            const playerData = [];
            Object.keys(game.playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (player) {
                    const stats = game.playerStats[playerId];
                    const value = calcFunc(stats);
                    
                    // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„ÅÆÂ†¥Âêà„ÄÅË©¶ÊäïÊï∞„Åå0„ÅÆÈÅ∏Êâã„ÅØÈô§Â§ñ
                    if (isPercentage) {
                        const attempted = stats.twoPointsAttempted + stats.threePointsAttempted;
                        if (attempted > 0) {
                            playerData.push({
                                player: player,
                                value: parseFloat(value),
                                displayValue: value
                            });
                        }
                    } else {
                        playerData.push({
                            player: player,
                            value: parseFloat(value),
                            displayValue: value
                        });
                    }
                }
            });
            
            // ÂÄ§„Åß„ÇΩ„Éº„Éà(ÈôçÈ†Ü)
            playerData.sort(function(a, b) { return b.value - a.value; });
            
            if (playerData.length === 0) {
                return '';
            }
            
            let html = '<div class="ranking-section">';
            html += '<h3>' + title + '</h3>';
            
            // TOP3„ÇíË°®Á§∫
            html += '<div class="top3-container">';
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            for (let i = 0; i < Math.min(3, playerData.length); i++) {
                const data = playerData[i];
                html += '<div class="ranking-card">' +
                    '<span class="ranking-medal">' + medals[i] + '</span>' +
                    '<div class="ranking-info">' +
                    '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                    '<span class="stat-value">' + data.displayValue + unit + '</span>' +
                    '</div>' +
                    '</div>';
            }
            html += '</div>';
            
            // ÂÖ®ÈÅ∏Êâã„É©„É≥„Ç≠„É≥„Ç∞(Êäò„Çä„Åü„Åü„Åø)
            if (playerData.length > 3) {
                html += '<button class="toggle-rankings" onclick="toggleAllRankings(\'' + key + game.id + '\')">' +
                    '‚ñº ÂÖ®' + playerData.length + 'Âêç„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË°®Á§∫' +
                    '</button>';
                
                html += '<div class="all-rankings" id="allRankings' + key + game.id + '">';
                playerData.forEach(function(data, index) {
                    html += '<div class="ranking-card">' +
                        '<div class="ranking-info">' +
                        '<span class="rank">' + (index + 1) + '‰Ωç</span>' +
                        '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                        '<span class="stat-value">' + data.displayValue + unit + '</span>' +
                        '</div>' +
                        '</div>';
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }

        function toggleAllRankings(id) {
            const el = document.getElementById('allRankings' + id);
            const btn = event.target;
            
            if (el.classList.contains('active')) {
                el.classList.remove('active');
                btn.classList.remove('active');
                btn.textContent = btn.textContent.replace('‚ñ≤ Èñâ„Åò„Çã', '‚ñº ÂÖ®' + btn.textContent.match(/\d+/)[0] + 'Âêç„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË°®Á§∫');
            } else {
                el.classList.add('active');
                btn.classList.add('active');
                btn.textContent = '‚ñ≤ Èñâ„Åò„Çã';
            }
        }
        

        // ========== „ÉÅ„Éº„É†„É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫Èñ¢Êï∞ ==========
        function displayTeamRankings() {
            const container = document.getElementById('teamRankingsDisplay');
            
            if (teamGames.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üèÜ</div><h3>„Åæ„Å†Ë©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3><p>Ë©¶ÂêàË®òÈå≤„Çø„Éñ„ÅßË®òÈå≤„ÇíÈñãÂßã„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p></div>';
                return;
            }
            
            let html = '';
            
            // Áõ¥Ëøë3Ë©¶Âêà„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞
            html += '<div class="card">';
            html += '<h2 style="margin-bottom: 20px;">üìä Áõ¥Ëøë3Ë©¶Âêà„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞</h2>';
            html += '<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">ÊúÄÊñ∞3Ë©¶Âêà„ÅÆÂêàË®àÂÄ§„ÉªÂπ≥ÂùáÂÄ§„ÅßÁÆóÂá∫</p>';
            html += calculateRecentGamesRankings();
            html += '</div>';
            
            // ÂÖ®Ë©¶Âêà„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞
            html += '<div class="card">';
            html += '<h2 style="margin-bottom: 20px;">üèÜ ÂÖ®Ë©¶ÂêàÈÄöÁÆó„É©„É≥„Ç≠„É≥„Ç∞</h2>';
            html += '<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">ÂÖ®' + teamGames.length + 'Ë©¶Âêà„ÅÆÂπ≥ÂùáÂÄ§„ÉªÂêàË®àÂÄ§„ÅßÁÆóÂá∫</p>';
            html += calculateAllGamesRankings();
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        function calculateRecentGamesRankings() {
            // ÊúÄÊñ∞3Ë©¶Âêà„ÇíÂèñÂæó
            const recentGames = teamGames.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            }).slice(0, 3);
            
            if (recentGames.length === 0) return '';
            
            // ÂêÑÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÈõÜË®à
            const playerStats = {};
            
            recentGames.forEach(function(game) {
                Object.keys(game.playerStats).forEach(function(playerId) {
                    const stats = game.playerStats[playerId];
                    
                    if (!playerStats[playerId]) {
                        playerStats[playerId] = {
                            gamesPlayed: 0,
                            totalPoints: 0,
                            totalRebounds: 0,
                            totalAssists: 0,
                            totalFGMade: 0,
                            totalFGAttempted: 0
                        };
                    }
                    
                    playerStats[playerId].gamesPlayed++;
                    playerStats[playerId].totalPoints += (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                    playerStats[playerId].totalRebounds += stats.offensiveRebounds + stats.defensiveRebounds;
                    playerStats[playerId].totalAssists += stats.assists;
                    playerStats[playerId].totalFGMade += stats.twoPointsMade + stats.threePointsMade;
                    playerStats[playerId].totalFGAttempted += stats.twoPointsAttempted + stats.threePointsAttempted;
                });
            });
            
            let html = '';
            
            // ÂæóÁÇπÁéãÔºàÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üèÜ ÂæóÁÇπÁéãÔºàÂêàË®àÔºâ',
                function(stats) { return stats.totalPoints; },
                'ÁÇπ',
                false,
                'recentPoints'
            );
            
            // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéáÔºàÂπ≥ÂùáÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üéØ „Ç∑„É•„Éº„ÉàÊàêÂäüÁéáÔºàÂπ≥ÂùáÔºâ',
                function(stats) { 
                    return stats.totalFGAttempted > 0 ? (stats.totalFGMade / stats.totalFGAttempted * 100).toFixed(1) : 0;
                },
                '%',
                true,
                'recentFG'
            );
            
            // „É™„Éê„Ç¶„É≥„ÉâÁéãÔºàÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üì¶ „É™„Éê„Ç¶„É≥„ÉâÁéãÔºàÂêàË®àÔºâ',
                function(stats) { return stats.totalRebounds; },
                'Êú¨',
                false,
                'recentReb'
            );
            
            // „Ç¢„Ç∑„Çπ„ÉàÁéãÔºàÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'ü§ù „Ç¢„Ç∑„Çπ„ÉàÁéãÔºàÂêàË®àÔºâ',
                function(stats) { return stats.totalAssists; },
                'Âõû',
                false,
                'recentAst'
            );
            
            return html;
        }
        
        function calculateAllGamesRankings() {
            if (teamGames.length === 0) return '';
            
            // ÂêÑÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÈõÜË®à
            const playerStats = {};
            
            teamGames.forEach(function(game) {
                Object.keys(game.playerStats).forEach(function(playerId) {
                    const stats = game.playerStats[playerId];
                    
                    if (!playerStats[playerId]) {
                        playerStats[playerId] = {
                            gamesPlayed: 0,
                            totalPoints: 0,
                            totalRebounds: 0,
                            totalAssists: 0,
                            totalFGMade: 0,
                            totalFGAttempted: 0
                        };
                    }
                    
                    playerStats[playerId].gamesPlayed++;
                    playerStats[playerId].totalPoints += (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                    playerStats[playerId].totalRebounds += stats.offensiveRebounds + stats.defensiveRebounds;
                    playerStats[playerId].totalAssists += stats.assists;
                    playerStats[playerId].totalFGMade += stats.twoPointsMade + stats.threePointsMade;
                    playerStats[playerId].totalFGAttempted += stats.twoPointsAttempted + stats.threePointsAttempted;
                });
            });
            
            let html = '';
            
            // ÂæóÁÇπÁéãÔºàÂπ≥Âùá + ÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üèÜ ÂæóÁÇπÁéã',
                function(stats) { 
                    const avg = (stats.totalPoints / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'ÁÇπÔºàÂêàË®à' + stats.totalPoints + 'ÁÇπÔºâ' };
                },
                '',
                false,
                'allPoints',
                true
            );
            
            // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéáÔºàÂπ≥ÂùáÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üéØ „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá',
                function(stats) { 
                    return stats.totalFGAttempted > 0 ? (stats.totalFGMade / stats.totalFGAttempted * 100).toFixed(1) : 0;
                },
                '%',
                true,
                'allFG'
            );
            
            // „É™„Éê„Ç¶„É≥„ÉâÁéãÔºàÂπ≥Âùá + ÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üì¶ „É™„Éê„Ç¶„É≥„ÉâÁéã',
                function(stats) { 
                    const avg = (stats.totalRebounds / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'Êú¨ÔºàÂêàË®à' + stats.totalRebounds + 'Êú¨Ôºâ' };
                },
                '',
                false,
                'allReb',
                true
            );
            
            // „Ç¢„Ç∑„Çπ„ÉàÁéãÔºàÂπ≥Âùá + ÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'ü§ù „Ç¢„Ç∑„Çπ„ÉàÁéã',
                function(stats) { 
                    const avg = (stats.totalAssists / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'ÂõûÔºàÂêàË®à' + stats.totalAssists + 'ÂõûÔºâ' };
                },
                '',
                false,
                'allAst',
                true
            );
            
            return html;
        }
        
        function generateTeamRankingSection(playerStats, title, calcFunc, unit, isPercentage, key, useCustomDisplay) {
            const playerData = [];
            
            Object.keys(playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (!player) return;
                
                const stats = playerStats[playerId];
                const result = calcFunc(stats);
                
                let value, displayValue;
                if (useCustomDisplay && typeof result === 'object') {
                    value = result.value;
                    displayValue = result.display;
                } else {
                    value = parseFloat(result);
                    displayValue = result + unit;
                }
                
                // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„ÅÆÂ†¥Âêà„ÄÅË©¶ÊäïÊï∞„Åå0„ÅÆÈÅ∏Êâã„ÅØÈô§Â§ñ
                if (isPercentage && stats.totalFGAttempted === 0) {
                    return;
                }
                
                // ÂÄ§„Åå0‰ª•‰∏ä„ÅÆÂ†¥Âêà„ÅÆ„ÅøËøΩÂä†
                if (value > 0 || !isPercentage) {
                    playerData.push({
                        player: player,
                        value: value,
                        displayValue: displayValue
                    });
                }
            });
            
            // ÂÄ§„Åß„ÇΩ„Éº„ÉàÔºàÈôçÈ†ÜÔºâ
            playerData.sort(function(a, b) { return b.value - a.value; });
            
            if (playerData.length === 0) {
                return '';
            }
            
            let html = '<div class="ranking-section">';
            html += '<h3>' + title + '</h3>';
            
            // TOP3„ÇíË°®Á§∫
            html += '<div class="top3-container">';
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            for (let i = 0; i < Math.min(3, playerData.length); i++) {
                const data = playerData[i];
                html += '<div class="ranking-card">' +
                    '<span class="ranking-medal">' + medals[i] + '</span>' +
                    '<div class="ranking-info">' +
                    '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                    '<span class="stat-value">' + data.displayValue + '</span>' +
                    '</div>' +
                    '</div>';
            }
            html += '</div>';
            
            // ÂÖ®ÈÅ∏Êâã„É©„É≥„Ç≠„É≥„Ç∞ÔºàÊäò„Çä„Åü„Åü„ÅøÔºâ
            if (playerData.length > 3) {
                html += '<button class="toggle-rankings" onclick="toggleAllRankings(\'' + key + '\')">' +
                    '‚ñº ÂÖ®' + playerData.length + 'Âêç„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË°®Á§∫' +
                    '</button>';
                
                html += '<div class="all-rankings" id="allRankings' + key + '">';
                playerData.forEach(function(data, index) {
                    html += '<div class="ranking-card">' +
                        '<div class="ranking-info">' +
                        '<span class="rank">' + (index + 1) + '‰Ωç</span>' +
                        '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                        '<span class="stat-value">' + data.displayValue + '</span>' +
                        '</div>' +
                        '</div>';
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }
        
        function showCreateTeamModal() {
            document.getElementById('createTeamModal').classList.add('active');
        }

        let currentEditingGameIndex = null;

        function openEditGameModal(gameIndex) {
            // „ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
            if (!teamData) {
                alert('‚ùå „ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            // „Éá„Éê„ÉÉ„Ç∞:ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂèñÂæó„Åß„Åç„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
            console.log('teamData:', teamData);
            console.log('ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ:', teamData.adminPassword);
            
            // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
            if (!teamData.adminPassword) {
                alert('‚ö†Ô∏è ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì\n\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Äå„ÉÅ„Éº„É†ÊÉÖÂ†±„Äç„Ç∑„Éº„ÉàB4„Çª„É´„Å´„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n„Åù„ÅÆÂæå„ÄÅ„Äå‰ªä„Åô„ÅêÂêåÊúü„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÁ¢∫Ë™ç
            const password = prompt('üîí ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n\n‚Äª„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Äå„ÉÅ„Éº„É†ÊÉÖÂ†±„Äç„Ç∑„Éº„ÉàB4„Çª„É´„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô');
            
            if (!password) {
                return;
            }
            
            // Á©∫ÁôΩ„ÉÅ„Çß„ÉÉ„ÇØ
            if (password.trim() === '') {
                alert('‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÊ§úË®º
            const correctPassword = teamData.adminPassword || '';
            
            if (password !== correctPassword) {
                alert('‚ùå ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì\n\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Äå„ÉÅ„Éº„É†ÊÉÖÂ†±„Äç„Ç∑„Éº„ÉàB4„Çª„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // „Éë„Çπ„ÉØ„Éº„ÉâË™çË®ºÊàêÂäü
            currentEditingGameIndex = gameIndex;
            const game = teamGames[gameIndex];
            
            // Ë©¶ÂêàÊÉÖÂ†±„ÇíÂÖ•ÂäõÊ¨Ñ„Å´Ë®≠ÂÆö
            document.getElementById('editGameDate').value = game.date;
            document.getElementById('editOpponent').value = game.opponent || '';
            
            // „Çπ„Ç≥„Ç¢„ÇíÂÖ•ÂäõÊ¨Ñ„Å´Ë®≠ÂÆö
            if (game.scores) {
                document.getElementById('editOurQ1').value = game.scores.our.q1 || 0;
                document.getElementById('editOppQ1').value = game.scores.opp.q1 || 0;
                document.getElementById('editOurQ2').value = game.scores.our.q2 || 0;
                document.getElementById('editOppQ2').value = game.scores.opp.q2 || 0;
                document.getElementById('editOurQ3').value = game.scores.our.q3 || 0;
                document.getElementById('editOppQ3').value = game.scores.opp.q3 || 0;
                document.getElementById('editOurQ4').value = game.scores.our.q4 || 0;
                document.getElementById('editOppQ4').value = game.scores.opp.q4 || 0;
            }
            
            // ÈÅ∏ÊâãÁµ±Ë®à„ÇíË°®Á§∫
            displayEditPlayerStats(game);
            
            // „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            document.getElementById('editGameModal').classList.add('active');
        }

        function displayEditPlayerStats(game) {
            const container = document.getElementById('editPlayersList');
            let html = '';
            
            Object.keys(game.playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (!player) return;
                
                const stats = game.playerStats[playerId];
                
                html += '<div class="player-stat-edit">';
                html += '<div class="player-header">#' + player.number + ' ' + player.name + '</div>';
                html += '<div class="stat-edit-grid">';
                
                html += '<div class="stat-edit-item"><label>2PÊàêÂäü</label><input type="number" min="0" id="edit_' + playerId + '_2pm" value="' + stats.twoPointsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>2PË©¶Êäï</label><input type="number" min="0" id="edit_' + playerId + '_2pa" value="' + stats.twoPointsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>3PÊàêÂäü</label><input type="number" min="0" id="edit_' + playerId + '_3pm" value="' + stats.threePointsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>3PË©¶Êäï</label><input type="number" min="0" id="edit_' + playerId + '_3pa" value="' + stats.threePointsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>FTÊàêÂäü</label><input type="number" min="0" id="edit_' + playerId + '_ftm" value="' + stats.freeThrowsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>FTË©¶Êäï</label><input type="number" min="0" id="edit_' + playerId + '_fta" value="' + stats.freeThrowsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>„Ç™„Éï„Çß„É≥„ÇπRB</label><input type="number" min="0" id="edit_' + playerId + '_oreb" value="' + stats.offensiveRebounds + '"></div>';
                html += '<div class="stat-edit-item"><label>„Éá„Ç£„Éï„Çß„É≥„ÇπRB</label><input type="number" min="0" id="edit_' + playerId + '_dreb" value="' + stats.defensiveRebounds + '"></div>';
                html += '<div class="stat-edit-item"><label>„Ç¢„Ç∑„Çπ„Éà</label><input type="number" min="0" id="edit_' + playerId + '_ast" value="' + stats.assists + '"></div>';
                html += '<div class="stat-edit-item"><label>„Çπ„ÉÜ„Ç£„Éº„É´</label><input type="number" min="0" id="edit_' + playerId + '_stl" value="' + stats.steals + '"></div>';
                html += '<div class="stat-edit-item"><label>„Éñ„É≠„ÉÉ„ÇØ</label><input type="number" min="0" id="edit_' + playerId + '_blk" value="' + stats.blocks + '"></div>';
                html += '<div class="stat-edit-item"><label>TO</label><input type="number" min="0" id="edit_' + playerId + '_to" value="' + stats.turnovers + '"></div>';
                html += '<div class="stat-edit-item"><label>„Éï„Ç°„Ç¶„É´</label><input type="number" min="0" id="edit_' + playerId + '_foul" value="' + stats.fouls + '"></div>';
                
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        function saveGameEdit() {
            if (currentEditingGameIndex === null) return;
            
            const game = teamGames[currentEditingGameIndex];
            
            // Ë©¶ÂêàÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            game.date = document.getElementById('editGameDate').value;
            game.opponent = document.getElementById('editOpponent').value;
            
            // „Çπ„Ç≥„Ç¢„ÇíÊõ¥Êñ∞
            if (!game.scores) {
                game.scores = {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                };
            }
            
            game.scores.our.q1 = parseInt(document.getElementById('editOurQ1').value) || 0;
            game.scores.opp.q1 = parseInt(document.getElementById('editOppQ1').value) || 0;
            game.scores.our.q2 = parseInt(document.getElementById('editOurQ2').value) || 0;
            game.scores.opp.q2 = parseInt(document.getElementById('editOppQ2').value) || 0;
            game.scores.our.q3 = parseInt(document.getElementById('editOurQ3').value) || 0;
            game.scores.opp.q3 = parseInt(document.getElementById('editOppQ3').value) || 0;
            game.scores.our.q4 = parseInt(document.getElementById('editOurQ4').value) || 0;
            game.scores.opp.q4 = parseInt(document.getElementById('editOppQ4').value) || 0;
            
            // ÂêÑÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
            Object.keys(game.playerStats).forEach(function(playerId) {
                const stats = game.playerStats[playerId];
                
                stats.twoPointsMade = parseInt(document.getElementById('edit_' + playerId + '_2pm').value) || 0;
                stats.twoPointsAttempted = parseInt(document.getElementById('edit_' + playerId + '_2pa').value) || 0;
                stats.threePointsMade = parseInt(document.getElementById('edit_' + playerId + '_3pm').value) || 0;
                stats.threePointsAttempted = parseInt(document.getElementById('edit_' + playerId + '_3pa').value) || 0;
                stats.freeThrowsMade = parseInt(document.getElementById('edit_' + playerId + '_ftm').value) || 0;
                stats.freeThrowsAttempted = parseInt(document.getElementById('edit_' + playerId + '_fta').value) || 0;
                stats.offensiveRebounds = parseInt(document.getElementById('edit_' + playerId + '_oreb').value) || 0;
                stats.defensiveRebounds = parseInt(document.getElementById('edit_' + playerId + '_dreb').value) || 0;
                stats.assists = parseInt(document.getElementById('edit_' + playerId + '_ast').value) || 0;
                stats.steals = parseInt(document.getElementById('edit_' + playerId + '_stl').value) || 0;
                stats.blocks = parseInt(document.getElementById('edit_' + playerId + '_blk').value) || 0;
                stats.turnovers = parseInt(document.getElementById('edit_' + playerId + '_to').value) || 0;
                stats.fouls = parseInt(document.getElementById('edit_' + playerId + '_foul').value) || 0;
            });
            
            // ÂÄã‰∫∫„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
            updatePersonalGamesFromTeamGame(game);
            
            // „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
            
            // ÂêåÊúü
            if (teamData) {
                syncGamesOnly();
            }
            
            // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            displayTeamGamesHistory();
            
            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            closeModal('editGameModal');
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü!');
        }

        function updatePersonalGamesFromTeamGame(teamGame) {
    // „Åì„ÅÆË©¶Âêà„Å´Èñ¢ÈÄ£„Åô„ÇãÂÄã‰∫∫„Éá„Éº„Çø„ÇíÂÖ®„Å¶ÂâäÈô§(Ë©¶ÂêàID„ÅßÁ¢∫ÂÆü„Å´ÂâäÈô§)
    personalGames = personalGames.filter(function(g) {
        return !(g.source === 'team' && g.teamGameId === teamGame.id);
    });
    
    // Êñ∞„Åó„ÅÑÂÄã‰∫∫„Éá„Éº„Çø„Çí‰ΩúÊàê
    Object.keys(teamGame.playerStats).forEach(function(playerId) {
        const stats = teamGame.playerStats[playerId];
        const totalReb = stats.offensiveRebounds + stats.defensiveRebounds;
        const totalPts = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
        
        const personalGame = {
            id: Date.now() + Math.random(),
            date: teamGame.date,
            opponent: teamGame.opponent,
            playTime: 0,
            playerId: playerId,
            twoPointsMade: stats.twoPointsMade,
            twoPointsAttempted: stats.twoPointsAttempted,
            threePointsMade: stats.threePointsMade,
            threePointsAttempted: stats.threePointsAttempted,
            freeThrowsMade: stats.freeThrowsMade,
            freeThrowsAttempted: stats.freeThrowsAttempted,
            offensiveRebounds: stats.offensiveRebounds,
            defensiveRebounds: stats.defensiveRebounds,
            assists: stats.assists,
            steals: stats.steals,
            blocks: stats.blocks,
            turnovers: stats.turnovers,
            fouls: stats.fouls,
            totalRebounds: totalReb,
            twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
            threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
            freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
            totalPoints: totalPts,
            source: 'team',
            fromTeam: true,
            teamGameId: teamGame.id  // ‚Üê ‚òÖ„Åì„Åì„ÅåÈáçË¶Å!„ÉÅ„Éº„É†„Ç≤„Éº„É†ID„Çí‰øùÂ≠ò
        };
        
        personalGames.unshift(personalGame);
    });
    
    // Â±•Ê≠¥„ÇÑ„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
    displayGames();
    displayRankings();
    updateCharts();
}
        async function deleteGame() {
    if (currentEditingGameIndex === null) return;
    
    const game = teamGames[currentEditingGameIndex];
    const dateStr = new Date(game.date).toLocaleDateString('ja-JP');
    
    if (!confirm('‚ö†Ô∏è Êú¨ÂΩì„Å´„Åì„ÅÆË©¶Âêà„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?\n\n' + dateStr + ' vs ' + game.opponent + '\n\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì!')) {
        return;
    }
    
    // „É≠„Éº„Ç´„É´„ÅÆ„ÉÅ„Éº„É†„Éá„Éº„Çø„Åã„ÇâÂâäÈô§
    teamGames.splice(currentEditingGameIndex, 1);
    
    // ÂÄã‰∫∫„Éá„Éº„Çø„Åã„Çâ„ÇÇÂâäÈô§(Ë©¶ÂêàID„ÅßÁ¢∫ÂÆü„Å´ÂâäÈô§)
personalGames = personalGames.filter(function(g) {
    return !(g.source === 'team' && g.teamGameId === game.id);
});
    
    saveData();
    
    // „Çµ„Éº„Éê„Éº„Åã„Çâ„ÇÇÂâäÈô§
    if (teamData && teamData.adminPassword) {
        try {
            showSyncIndicator('syncing', '„Çµ„Éº„Éê„Éº„Åã„ÇâÂâäÈô§‰∏≠...');
            
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({
                    action: 'deleteGame',
                    teamCode: teamData.code,
                    gameId: game.id,
                    adminPassword: teamData.adminPassword
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showSyncIndicator('success', 'ÂâäÈô§ÂÆå‰∫Ü!');
            } else {
                showSyncIndicator('error', result.error || 'ÂâäÈô§Â§±Êïó');
                alert('‚ö†Ô∏è „Çµ„Éº„Éê„Éº„Åã„Çâ„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
            }
        } catch (error) {
            console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
            showSyncIndicator('error', 'ÂâäÈô§Â§±Êïó');
            alert('‚ö†Ô∏è „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:' + error.message);
        }
    }
    
    // ÁîªÈù¢„ÇíÊõ¥Êñ∞
    displayGames();
    displayRankings();
    updateCharts();
    if (typeof displayTeamGamesHistory === 'function') {
        displayTeamGamesHistory();
    }
    
    closeModal('editGameModal');
    currentEditingGameIndex = null;
}

        
        function showJoinTeamModal() {
            document.getElementById('joinTeamModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openGlossary() {
            document.getElementById('glossaryModal').classList.add('active');
        }
        
        function generateTeamCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function createTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            if (!teamName) {
                alert('„ÉÅ„Éº„É†Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            showSyncIndicator('syncing', '„ÉÅ„Éº„É†„Çí‰ΩúÊàê‰∏≠...');
            
            const teamCode = generateTeamCode();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'createTeam',
                        teamName: teamName,
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teamData = {
                        name: teamName,
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        createdAt: new Date().toISOString()
                    };
                    saveData();
                    closeModal('createTeamModal');
                    displayTeamStatus();
                    showSyncIndicator('success', '„ÉÅ„Éº„É†‰ΩúÊàêÂÆå‰∫Ü!');
                    
                    alert('‚úÖ „ÉÅ„Éº„É†„Äå' + teamName + '„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü!\n\n„ÉÅ„Éº„É†„Ç≥„Éº„Éâ: ' + teamCode + '\n\n„Åì„ÅÆ„Ç≥„Éº„Éâ„ÇíÂèãÈÅî„Å´ÂÖ±Êúâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà: ' + result.spreadsheetUrl);
                } else {
                    throw new Error(result.error || '„ÉÅ„Éº„É†‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„Ç®„É©„Éº:', error);
                showSyncIndicator('error', '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                alert('‚ùå „Ç®„É©„Éº: ' + error.message + '\n\n„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }

        async function joinTeam() {
            const teamCode = document.getElementById('joinTeamCode').value.trim().toUpperCase();
            if (!teamCode || teamCode.length !== 6) {
                alert('Ê≠£„Åó„ÅÑ6Ê°Å„ÅÆ„ÉÅ„Éº„É†„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            showSyncIndicator('syncing', '„ÉÅ„Éº„É†„Å´ÂèÇÂä†‰∏≠...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'joinTeam',
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teamData = {
                        name: result.teamData ? result.teamData.name : '„ÉÅ„Éº„É†',
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        joinedAt: new Date().toISOString()
                    };
                    
                    saveData();
                    closeModal('joinTeamModal');
                    
                    // „Éá„Éº„Çø„ÇíÂèñÂæó
                    await loadTeamData();
                    
                    // Ë°®Á§∫„ÇíÊõ¥Êñ∞
                    displayTeamStatus();
                    displayPlayers();
                    updateMyPlayerSelect();
                    
                    showSyncIndicator('success', '„ÉÅ„Éº„É†ÂèÇÂä†ÂÆå‰∫Ü!');
                    alert('‚úÖ „ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü!\n\n„ÉÅ„Éº„É†Âêç: ' + teamData.name + '\n„ÉÅ„Éº„É†„Ç≥„Éº„Éâ: ' + teamCode + '\n\nÈÅ∏Êâã„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Åæ„Åó„Åü„ÄÇ\nË®≠ÂÆö„Çø„Éñ„ÅÆ„ÄåÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„Äç„ÅßÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                } else {
                    throw new Error(result.error || '„ÉÅ„Éº„É†ÂèÇÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„Ç®„É©„Éº:', error);
                showSyncIndicator('error', '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                alert('‚ùå „Ç®„É©„Éº: ' + error.message);
            }
        }

        async function syncWithServer(options = { pushPlayers: false, pushGames: true }) {
    if (!teamData) return;

    showSyncIndicator('syncing', 'ÂêåÊúü‰∏≠...');

    try {
        const payload = {
            action: 'syncData',
            teamCode: teamData.code
        };

        // Êñ∞Ë¶èËøΩÂä†„Åó„ÅüÈÅ∏Êâã„Å†„ÅëÈÄÅ„Çã(ÂæåËø∞„ÅÆ addPlayer „Åß _localNew „Çí‰ªò„Åë„Çã)
        if (options.pushPlayers) {
            const newPlayers = players.filter(p => p && p._localNew === true);
            if (newPlayers.length > 0) payload.players = newPlayers;
        }

        if (options.pushGames) {
            payload.games = teamGames;
        }

        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        if (!result.success) throw new Error(result.error || 'syncData failed');

        // ÈÄÅ‰ø°„Å´ÊàêÂäü„Åó„Åü"Êñ∞Ë¶èÈÅ∏Êâã"„ÅØ„Éï„É©„Ç∞„ÇíÂ§ñ„Åó„Å¶„Åä„Åè
        if (options.pushPlayers) {
            players.forEach(p => { if (p._localNew) p._localNew = false; });
        }

        showSyncIndicator('success', 'ÈÄÅ‰ø°ÂÆå‰∫Ü');
    } catch (e) {
        console.error(e);
        showSyncIndicator('error', 'ÂêåÊúüÂ§±Êïó:' + e.message);
    }
}

// ‚ñº‚ñº‚ñº ËøΩÂä†:Ë©¶Âêà„Å†„Åë„ÇíÈÄÅ„ÇãÂêåÊúü(ÈÅ∏Êâã„ÅØÈÄÅ„Çâ„Å™„ÅÑ) ‚ñº‚ñº‚ñº
async function syncGamesOnly() {
  if (!teamData) return;

  showSyncIndicator('syncing', 'ÂêåÊúü‰∏≠...');

  try {
    const payload = {
      action: 'syncData',
      teamCode: teamData.code,
      // ‚Üê ÈÅ∏Êâã„ÅØÈÄÅ„Çâ„Å™„ÅÑ
      games: teamGames       // ‚Üê Ë©¶Âêà„Å†„ÅëÈÄÅ„Çã
    };

    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    });

    const result = await response.json();
    if (!result.success) throw new Error(result.error || 'syncData failed');

    showSyncIndicator('success', 'ÈÄÅ‰ø°ÂÆå‰∫Ü');
  } catch (e) {
    console.error(e);
    showSyncIndicator('error', 'ÂêåÊúüÂ§±Êïó:' + e.message);
  }
}
// ‚ñ≤‚ñ≤‚ñ≤ ËøΩÂä†„Åì„Åì„Åæ„Åß ‚ñ≤‚ñ≤‚ñ≤
        
        
        // ‚ñº‚ñº‚ñº „Åì„Åì„Åã„ÇâËøΩÂä†:ÈÄÅÂèó‰ø°„Åæ„Å®„ÇÅ„Å¶Ë°å„ÅÜ ‚ñº‚ñº‚ñº
async function syncAll() {
  if (!teamData) { alert('„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì'); return; }
  showSyncIndicator('syncing', 'ÂêåÊúü‰∏≠‚Ä¶');

  try {
    // 1) „Åæ„Åö„Çµ„Éº„Éê„Éº„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂèñÂæó(Âèó‰ø°ÂÑ™ÂÖà)
    await loadTeamData();

    // 2) ÁîªÈù¢„ÇíÊúÄÊñ∞Âåñ
    displayPlayers();
    updateMyPlayerSelect();
    displayGames();
    displayRankings();
    updateCharts();

    showSyncIndicator('success', 'ÂêåÊúüÂÆå‰∫Ü!');
  } catch (e) {
    console.error(e);
    showSyncIndicator('error', 'ÂêåÊúüÂ§±Êïó:' + e.message);
  }
}
// ‚ñ≤‚ñ≤‚ñ≤ ËøΩÂä†„Åì„Åì„Åæ„Åß ‚ñ≤‚ñ≤‚ñ≤


        async function loadTeamData() {
    if (!teamData) return;
    
    showSyncIndicator('syncing', '„Éá„Éº„ÇøÂèñÂæó‰∏≠...');
    
    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain',
            },
            body: JSON.stringify({
                action: 'getData',
                teamCode: teamData.code
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            let addedCount = 0;
            
            // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíteamData„Å´‰øùÂ≠ò
if (result.teamData && result.teamData.adminPassword) {
    teamData.adminPassword = result.teamData.adminPassword;
    saveData();  // „Åô„Åê„Å´‰øùÂ≠ò
}
            
            // ÈÅ∏Êâã„Éá„Éº„Çø„ÇíÂèñÂæó(„Çµ„Éº„Éê„Éº„ÅÆ„Éá„Éº„Çø„ÅßÂÆåÂÖ®„Å´‰∏äÊõ∏„Åç)
if (result.players) {
    // „Çµ„Éº„Éê„Éº„ÅÆ„Éá„Éº„Çø„Çí‰ø°È†º„Åó„Å¶ÂÆåÂÖ®„Å´ÁΩÆ„ÅçÊèõ„Åà„Çã
    players = result.players.map(function(serverPlayer) {
        serverPlayer._localNew = false;
        return serverPlayer;
    });
    addedCount = players.length;
}
            
            // Ë©¶Âêà„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶personalGames„Å´Â§âÊèõ
            if (result.games) {
                // „Çµ„Éº„Éê„Éº„ÅÆ„Éá„Éº„Çø„ÅßÂÆåÂÖ®„Å´‰∏äÊõ∏„Åç„Åô„Çã
                teamGames = [];
                personalGames = personalGames.filter(function(g) {
                    return g.source !== 'team';
                });
                
                result.games.forEach(function(game) {
                    teamGames.push(game);
                    
                    // ÂêÑÈÅ∏Êâã„ÅÆ„Éá„Éº„Çø„ÇípersonalGames„Å´ËøΩÂä†
                    Object.keys(game.playerStats).forEach(function(playerId) {
                        const stats = game.playerStats[playerId];
                        const totalReb = stats.offensiveRebounds + stats.defensiveRebounds;
                        const totalPts = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                        
                        const personalGame = {
                            id: Date.now() + Math.random(),
                            date: game.date,
                            opponent: game.opponent,
                            playTime: 0,
                            playerId: playerId,
                            twoPointsMade: stats.twoPointsMade,
                            twoPointsAttempted: stats.twoPointsAttempted,
                            threePointsMade: stats.threePointsMade,
                            threePointsAttempted: stats.threePointsAttempted,
                            freeThrowsMade: stats.freeThrowsMade,
                            freeThrowsAttempted: stats.freeThrowsAttempted,
                            offensiveRebounds: stats.offensiveRebounds,
                            defensiveRebounds: stats.defensiveRebounds,
                            assists: stats.assists,
                            steals: stats.steals,
                            blocks: stats.blocks,
                            turnovers: stats.turnovers,
                            fouls: stats.fouls,
                            totalRebounds: totalReb,
                            twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                            threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                            freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                            totalPoints: totalPts,
                            source: 'team',
                            teamGameId: game.id  // ‚Üê „Åì„ÅÆË°å„ÇíËøΩÂä†
                        };
                        
                        personalGames.unshift(personalGame);
                    });
                });
            }
            
            saveData();
            
            const gameCount = result.games ? result.games.length : 0;
            showSyncIndicator('success', addedCount + '‰∫∫„ÅÆÈÅ∏Êâã„ÄÅ' + gameCount + 'Ë©¶Âêà„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó');
            
            return addedCount;
        } else {
            showSyncIndicator('error', '„Éá„Éº„ÇøÂèñÂæóÂ§±Êïó');
        }
    } catch (error) {
        console.error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
        showSyncIndicator('error', '„Éá„Éº„ÇøÂèñÂæóÂ§±Êïó');
    }
}
        function displayTeamStatus() {
            const statusEl = document.getElementById('teamStatus');

            if (!statusEl) {
                console.error('teamStatusË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            if (!teamData) {
                statusEl.innerHTML = '<p style="color: #999; text-align: center;">„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                return;
            }

            const teamName = teamData.name || '„ÉÅ„Éº„É†ÂêçÊú™Ë®≠ÂÆö';
            const teamCode = teamData.code || '‰∏çÊòé';
            
            statusEl.innerHTML = 
                '<div class="team-code-display">' +
                '<div style="font-size: 0.9em; color: #666;">ÁèæÂú®„ÅÆ„ÉÅ„Éº„É†</div>' +
                '<div style="font-size: 1.3em; font-weight: bold; color: #667eea; margin: 10px 0;">' + teamData.name + '</div>' +
                '<div style="font-size: 0.9em; color: #666;">„ÉÅ„Éº„É†„Ç≥„Éº„Éâ</div>' +
                '<div class="code">' + teamData.code + '</div>' +
                '<button class="primary-btn" style="background: #2ecc71; margin-top: 15px;" onclick="syncAll()">‰ªä„Åô„ÅêÂêåÊúü(ÈÄÅÂèó‰ø°)</button>' +
                '<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="leaveTeam()">„ÉÅ„Éº„É†„Åã„ÇâÈÄÄÂá∫</button>' +
                '</div>';
        }

        function leaveTeam() {
            if (confirm('Êú¨ÂΩì„Å´„ÉÅ„Éº„É†„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åô„Åã?')) {
                teamData = null;
                saveData();
                displayTeamStatus();
                alert('‚úÖ „ÉÅ„Éº„É†„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åó„Åü');
            }
        }

        document.getElementById('gameDate').valueAsDate = new Date();
        document.getElementById('teamGameDate').valueAsDate = new Date();

        function switchMode(mode) {
           currentMode = mode;
            
            // „Åô„Åπ„Å¶„ÅÆ„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.mode-btn').forEach(function(btn) {
               btn.classList.remove('active');
               btn.classList.remove('team-mode');
           });
            
            // ËÉåÊôØËâ≤„Çí„É™„Çª„ÉÉ„Éà
           document.body.classList.remove('personal-mode', 'team-mode');
           
            // „Åô„Åπ„Å¶„ÅÆ„É¢„Éº„Éâ„ÇíÈùûË°®Á§∫
            document.getElementById('personalMode').style.display = 'none';
            document.getElementById('teamMode').style.display = 'none';
            document.getElementById('settingsMode').style.display = 'none';
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„É¢„Éº„Éâ„ÇíË°®Á§∫
           if (mode === 'personal') {
                document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
                document.getElementById('personalMode').style.display = 'block';
                document.body.classList.add('personal-mode');
                displayGames();
            } else if (mode === 'team') {
                const teamBtn = document.querySelector('.mode-btn:nth-child(2)');
                teamBtn.classList.add('active');
                teamBtn.classList.add('team-mode');
                document.getElementById('teamMode').style.display = 'block';
                document.body.classList.add('team-mode');
            } else if (mode === 'settings') {
                document.querySelector('.mode-btn:nth-child(3)').classList.add('active');
                document.getElementById('settingsMode').style.display = 'block';
           }
        }
        
        function switchTab(tab) {
            document.querySelectorAll('#personalMode .tab').forEach(function(t) {
                t.classList.remove('active');
            });
            document.querySelectorAll('#personalMode .tab-content').forEach(function(c) {
                c.classList.remove('active');
            });
            
            const tabs = ['input', 'list', 'ranking', 'graph', 'settings'];
            const index = tabs.indexOf(tab);
            document.querySelector('#personalMode .tab:nth-child(' + (index + 1) + ')').classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'graph') updateCharts();
            if (tab === 'settings') { 
                displayPlayers(); 
                updateMyPlayerSelect();
                displayTeamStatus();
            }
            if (tab === 'ranking') displayRankings();
            if (tab === 'list') displayGames();
        }

        function changeValue(key, delta) {
            stats[key] = Math.max(0, stats[key] + delta);
            
            if (key === 'twoPointsMade' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsAttempted = stats.twoPointsMade;
            }
            if (key === 'twoPointsAttempted' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsMade = stats.twoPointsAttempted;
            }
            if (key === 'threePointsMade' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsAttempted = stats.threePointsMade;
            }
            if (key === 'threePointsAttempted' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsMade = stats.threePointsAttempted;
            }
            if (key === 'freeThrowsMade' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsAttempted = stats.freeThrowsMade;
            }
            if (key === 'freeThrowsAttempted' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsMade = stats.freeThrowsAttempted;
            }
            
            updateDisplay();
        }

        function updateDisplay() {
            Object.keys(stats).forEach(function(key) {
                const el = document.getElementById(key);
                if (el) el.textContent = stats[key];
            });
            
            const twoP = stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0';
            const threeP = stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0';
            const ft = stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0';
            const totalPoints = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            
            document.getElementById('twoPointPercentage').textContent = twoP + '%';
            document.getElementById('threePointPercentage').textContent = threeP + '%';
            document.getElementById('freeThrowPercentage').textContent = ft + '%';
            document.getElementById('totalPoints').textContent = totalPoints;
            
            // ÂàÜÊï∞„ÇíË°®Á§∫
            document.getElementById('twoPointFraction').textContent = '(' + stats.twoPointsMade + '/' + stats.twoPointsAttempted + ')';
            document.getElementById('threePointFraction').textContent = '(' + stats.threePointsMade + '/' + stats.threePointsAttempted + ')';
            document.getElementById('freeThrowFraction').textContent = '(' + stats.freeThrowsMade + '/' + stats.freeThrowsAttempted + ')';
        }
        function savePersonalGame() {
            const date = document.getElementById('gameDate').value;
            if (!date) {
                alert('Ë©¶ÂêàÊó•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const saveBtn = document.getElementById('saveGameBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‰øùÂ≠ò‰∏≠...';

            const game = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('opponent').value.trim(),
                playTime: parseInt(document.getElementById('playTime').value) || 0,
                playerId: myPlayerId,
                twoPointsMade: stats.twoPointsMade,
                twoPointsAttempted: stats.twoPointsAttempted,
                threePointsMade: stats.threePointsMade,
                threePointsAttempted: stats.threePointsAttempted,
                freeThrowsMade: stats.freeThrowsMade,
                freeThrowsAttempted: stats.freeThrowsAttempted,
                offensiveRebounds: stats.offensiveRebounds,
                defensiveRebounds: stats.defensiveRebounds,
                assists: stats.assists,
                steals: stats.steals,
                blocks: stats.blocks,
                turnovers: stats.turnovers,
                fouls: stats.fouls,
                totalRebounds: stats.offensiveRebounds + stats.defensiveRebounds,
                twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                totalPoints: (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade,
                source: 'personal'
            };

            personalGames.unshift(game);
            saveData();
            
            if (teamData) {
                syncGamesOnly();
            }
            
            displayGames();
            resetForm();
            
            saveBtn.disabled = false;
            saveBtn.textContent = 'Ë®òÈå≤„Çí‰øùÂ≠ò';
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!');
        }

        function resetForm() {
            Object.keys(stats).forEach(function(key) {
                stats[key] = 0;
            });
            document.getElementById('gameDate').valueAsDate = new Date();
            document.getElementById('opponent').value = '';
            document.getElementById('playTime').value = 0;
            updateDisplay();
        }

        function displayGames() {
    updatePlayerBanners();
    const gameList = document.getElementById('gameList');
    
    // myPlayerId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®„Éá„Éº„Çø„ÇíË°®Á§∫
    const myGames = myPlayerId 
        ? personalGames.filter(function(g) {
            return !g.playerId || g.playerId === myPlayerId;
          })
        : personalGames;
    
    if (myGames.length === 0) {
        gameList.innerHTML = '<div class="empty-state"><div class="icon">üèÄ</div><h3>„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3><p>ÊúÄÂàù„ÅÆË©¶Âêà„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ!</p></div>';
        return;
    }

            gameList.innerHTML = myGames.map(function(g) {
                const dateObj = new Date(g.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                const sourceLabel = g.source === 'team' ? ' <span style="background: #2ecc71; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">Ë©¶ÂêàË®òÈå≤</span>' : '';
                
                return '<div class="game-item">' +
                    '<div class="game-date">' + dateStr + 
                    (g.opponent ? ' vs ' + g.opponent : '') + 
                    (g.playTime ? ' (' + g.playTime + 'ÂàÜ)' : '') + 
                    sourceLabel +
                    '</div>' +
                    '<div class="game-stats">' +
                    '<div class="stat-box"><div class="label">Á∑èÂæóÁÇπ</div><div class="value">' + g.totalPoints + 'ÁÇπ</div></div>' +
                    '<div class="stat-box"><div class="label">2PÁéá</div><div class="value">' + g.twoPointPercentage + '%</div><div class="fraction">(' + g.twoPointsMade + '/' + g.twoPointsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">3PÁéá</div><div class="value">' + g.threePointPercentage + '%</div><div class="fraction">(' + g.threePointsMade + '/' + g.threePointsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">FTÁéá</div><div class="value">' + g.freeThrowPercentage + '%</div><div class="fraction">(' + g.freeThrowsMade + '/' + g.freeThrowsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">„É™„Éê„Ç¶„É≥„Éâ</div><div class="value">' + g.totalRebounds + '</div></div>' +
                    '<div class="stat-box"><div class="label">„Ç¢„Ç∑„Çπ„Éà</div><div class="value">' + g.assists + '</div></div>' +
                    '</div>' +
                    '<button class="shot-chart-button" onclick="showShotChart(' + g.id + ')">üéØ „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„ÇíË¶ã„Çã</button>'
                    '</div>';
            }).join('');
        }

        // ========== „Åì„Åì„Åã„ÇâËøΩÂä† ==========
        
        // „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showShotChart(gameId) {
    // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÔºàÊú¨Áï™Áí∞Â¢É„Åß„ÅØÂâäÈô§ÂèØËÉΩÔºâ
    console.log('showShotChart called:', {
        gameId: gameId,
        type: typeof gameId,
        fromTeam: personalGames.find(g => g.id === gameId)?.fromTeam
    });
    
    // ÊñáÂ≠óÂàó„Å®„Åó„Å¶Ê∏°„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çã„ÅÆ„ÅßÊï∞ÂÄ§„Å´Â§âÊèõ
    const numericId = typeof gameId === 'string' ? parseFloat(gameId) : gameId;
    const game = personalGames.find(g => g.id === numericId);
    
    if (!game) {
        alert('Ë©¶Âêà„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        console.error('Ë©¶Âêà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', {
            searchId: numericId,
            availableIds: personalGames.map(g => g.id)
        });
        return;
    }
    
    // fromTeam„ÉÅ„Çß„ÉÉ„ÇØ
    if (!game.fromTeam) {
        console.warn('fromTeam„Ååfalse„Åæ„Åü„ÅØundefined:', game);
    }
    
    // „ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅßË®òÈå≤„Åï„Çå„ÅüË©¶Âêà„ÅÆÂ†¥Âêà
    if (game.fromTeam && teamGames) {
        const teamGame = teamGames.find(tg => tg.id === game.teamGameId);
        
        if (teamGame && teamGame.plays) {
            // Ëá™ÂàÜ„ÅÆ„Éó„É¨„Ç§„Å†„Åë„Çí„Éï„Ç£„É´„Çø„Éº
            const myPlays = teamGame.plays.filter(p => p.playerId === game.playerId);
            
            if (myPlays.length === 0) {
                alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Éó„É¨„Ç§Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                console.warn('„Éó„É¨„Ç§„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', {
                    teamGameId: game.teamGameId,
                    playerId: game.playerId,
                    totalPlays: teamGame.plays.length
                });
                return;
            }
            
            showShotChartModal(myPlays, game.opponent, game.date);
        } else {
            alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
        }
    } else {
        alert('„Åì„ÅÆË©¶Âêà„ÅØ„ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅßË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„ÇíË°®Á§∫„Åß„Åç„Åæ„Åõ„Çì');
        console.warn('„ÉÅ„Éº„É†„É¢„Éº„Éâ„Åß„ÅØ„Å™„ÅÑ:', {
            fromTeam: game.fromTeam,
            teamGamesExists: !!teamGames
        });
    }
}
        
       
        // „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showShotChartModal(plays, opponent, date) {
            // „Éó„É¨„Ç§„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç
            if (!plays || plays.length === 0) {
                alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Éó„É¨„Ç§„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // „Ç∑„É•„Éº„ÉàÁ≥ª„ÅÆ„Éó„É¨„Ç§„ÅÆ„Åø„Çí„Éï„Ç£„É´„Çø„ÉºÔºàplayType„Çí‰ΩøÁî®Ôºâ
            const shotPlays = plays.filter(p => 
                (p.playType === '2p-made' || p.playType === '2p-miss' || 
                 p.playType === '3p-made' || p.playType === '3p-miss') &&
                p.position && p.position.x !== undefined && p.position.y !== undefined
            );
            
            if (shotPlays.length === 0) {
                alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì\n\n„ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅÆ„ÄåË®òÈå≤„Äç„Çø„Éñ„Åß„Ç∑„É•„Éº„Éà„ÇíË®òÈå≤„Åô„ÇãÈöõ„Å´„ÄÅ„Ç≥„Éº„Éà‰∏ä„ÅÆ‰ΩçÁΩÆ„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ');
                return;
            }
            
            // „É¢„Éº„ÉÄ„É´„Çí‰ΩúÊàê„Åó„Å¶Ë°®Á§∫
            const modal = document.createElement('div');
            modal.className = 'shot-chart-modal active';
            modal.innerHTML = `
                <div class="shot-chart-content">
                    <h2 style="text-align: center; color: #667eea;">üéØ „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà</h2>
                    <p style="text-align: center; color: #666;">
                        ${opponent} vs ${new Date(date).toLocaleDateString('ja-JP')}
                    </p>
                    
                    <div class="court-container" style="cursor: default;">
                        <canvas id="displayShotCanvas" class="court-canvas" width="300" height="400"></canvas>
                    </div>
                    
                    <div class="zone-stats" id="zoneStatsContainer">
                        <h3 style="color: #667eea; margin-bottom: 10px;">üìä „Ç®„É™„Ç¢Âà•ÊàêÂäüÁéá</h3>
                        <div id="zoneStatsContent"></div>
                    </div>
                    
                    <button class="shot-chart-button" onclick="this.parentElement.parentElement.remove()">
                        Èñâ„Åò„Çã
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // „Ç≥„Éº„ÉàÂõ≥„ÇíÊèèÁîª
            const canvas = document.getElementById('displayShotCanvas');
            drawCourt(canvas);
            
            // „Ç∑„É•„Éº„Éà„Çí„Éó„É≠„ÉÉ„Éà
            const ctx = canvas.getContext('2d');
            shotPlays.forEach(play => {
                if (play.position) {
                    const isMade = play.playType.includes('made');
                    
                    ctx.fillStyle = isMade ? '#2ecc71' : '#e74c3c';
                    ctx.beginPath();
                    ctx.arc(play.position.x, play.position.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
            
            // „Ç®„É™„Ç¢Âà•Áµ±Ë®à„ÇíË°®Á§∫
            setTimeout(() => {
                const statsElement = document.getElementById('zoneStatsContent');
                if (statsElement) {
                    displayZoneStats(shotPlays);
                }
            }, 100);
        }
        
        // „Ç®„É™„Ç¢Âà•Áµ±Ë®à„ÇíË®àÁÆó„Åó„Å¶Ë°®Á§∫
        function displayZoneStats(shotPlays) {
            const zoneData = {};
            
            shotPlays.forEach(play => {
                if (play.position) {
                    const zone = play.position.zone || getZoneFromPosition(
                        play.position.x, 
                        play.position.y, 
                        300, 
                        400
                    );
                    
                    if (!zoneData[zone]) {
                        zoneData[zone] = { made: 0, total: 0 };
                    }
                    
                    zoneData[zone].total++;
                    if (play.playType.includes('made')) {
                        zoneData[zone].made++;
                    }
                }
            });
            
            // „Ç®„É™„Ç¢Âà•Áµ±Ë®à„ÇíHTMLÂåñ
            let html = '';
            const zones = ['paint', 'left_wing', 'right_wing', 'mid_range', 'top', 'backcourt'];
            
            zones.forEach(zone => {
                if (zoneData[zone]) {
                    const data = zoneData[zone];
                    const percentage = ((data.made / data.total) * 100).toFixed(1);
                    
                    html += `
                        <div class="zone-item">
                            <span class="zone-name">${getZoneNameJP(zone)}</span>
                            <span class="zone-percentage">
                                ${percentage}% (${data.made}/${data.total})
                            </span>
                        </div>
                    `;
                }
            });
            
            document.getElementById('zoneStatsContent').innerHTML = html || '<p style="text-align: center; color: #999;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
        }
        
        // ========== „Åì„Åì„Åæ„ÅßËøΩÂä† ==========

        function displayRankings() {
            const myGames = myPlayerId 
    ? personalGames.filter(function(g) {
        return !g.playerId || g.playerId === myPlayerId;
      })
    : personalGames;
            
            if (myGames.length === 0) {
                document.getElementById('topPoints').innerHTML = '<p style="text-align: center; color: #999;">Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            const topPoints = myGames.slice().sort(function(a, b) {
                return b.totalPoints - a.totalPoints;
            }).slice(0, 10);

            if (topPoints.length > 0) {
                const top = topPoints[0];
                const dateObj = new Date(top.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                let html = '<div class="top-record">' +
                    '<div class="trophy">üèÜ</div>' +
                    '<div style="font-size: 1.2em; margin-bottom: 10px;">ÊúÄÈ´òÂæóÁÇπ</div>' +
                    '<div class="value">' + top.totalPoints + 'ÁÇπ</div>' +
                    '<div style="font-size: 1.1em; opacity: 0.95;">' + dateStr;
                
                if (top.opponent) {
                    html += '<br>vs ' + top.opponent;
                }
                
                html += '</div></div>';
                
                document.getElementById('topPoints').innerHTML = html;
            }
        }

        function updateCharts() {
            const myGames = myPlayerId 
    ? personalGames.filter(function(g) {
        return !g.playerId || g.playerId === myPlayerId;
      })
    : personalGames;
            
            if (myGames.length === 0) return;

            const sorted = myGames.slice().reverse();
            const labels = sorted.map(function(g) {
                const d = new Date(g.date).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'});
                return g.opponent ? d + ' vs ' + g.opponent : d;
            });

            if (charts.shooting) charts.shooting.destroy();
            charts.shooting = new Chart(document.getElementById('shootingChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '2PÊàêÂäüÁéá',
                        data: sorted.map(function(g) { return parseFloat(g.twoPointPercentage); }),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: '3PÊàêÂäüÁéá',
                        data: sorted.map(function(g) { return parseFloat(g.threePointPercentage); }),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'FTÊàêÂäüÁéá',
                        data: sorted.map(function(g) { return parseFloat(g.freeThrowPercentage); }),
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(v) { return v + '%'; } }
                        }
                    }
                }
            });
        }

        function addPlayer() {
            const num = document.getElementById('playerNumber').value;
            const name = document.getElementById('playerName').value.trim();

            if (!num || !name) { 
                alert('ËÉåÁï™Âè∑„Å®ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); 
                return; 
            }
            
            const exists = players.some(function(p) {
                return p.number === num;
            });
            
            if (exists) { 
                alert('„Åì„ÅÆËÉåÁï™Âè∑„ÅØÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô'); 
                return; 
            }

            const player = { 
                id: Date.now().toString(), 
                number: num, 
                name: name 
            };
            players.push(player);
            
            if (!myPlayerId) myPlayerId = player.id;
            
            saveData();

if (teamData) {
    // Êñ∞Ë¶èËøΩÂä†„Éï„É©„Ç∞„Çí„Å§„Åë„Çã
    // („Åì„ÅÆË°å„ÅØ„ÄÅ„Éó„É¨„Ç§„É§„Éº„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÁîüÊàêÁõ¥Âæå„Åß„ÇÇOK)
    player._localNew = true;

    // ÈÅ∏Êâã„Å†„ÅëÈÄÅ‰ø°(Ë©¶Âêà„ÅØÈÄÅ„Çâ„Å™„ÅÑ)
    syncWithServer({ pushPlayers: true, pushGames: false });
}
            
            displayPlayers();
            updateMyPlayerSelect();

            document.getElementById('playerNumber').value = '';
            document.getElementById('playerName').value = '';
            
            alert('‚úÖ ' + name + ' #' + num + ' „ÇíÁôªÈå≤„Åó„Åæ„Åó„Åü!');
        }

        function editPlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            const newNumber = prompt('Êñ∞„Åó„ÅÑËÉåÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ(ÁèæÂú®: #' + player.number + ')', player.number);
            if (newNumber === null) return;
            
            if (!newNumber || newNumber.trim() === '') {
                alert('ËÉåÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const duplicate = players.some(function(p) {
                return p.id !== playerId && p.number === newNumber.trim();
            });
            
            if (duplicate) {
                alert('„Åì„ÅÆËÉåÁï™Âè∑„ÅØÊó¢„Å´‰ªñ„ÅÆÈÅ∏Êâã„Åå‰ΩøÁî®„Åó„Å¶„ÅÑ„Åæ„Åô');
                return;
            }
            
            const newName = prompt('Êñ∞„Åó„ÅÑÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ(ÁèæÂú®: ' + player.name + ')', player.name);
            if (newName === null) return;
            
            if (!newName || newName.trim() === '') {
                alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            player.number = newNumber.trim();
            player.name = newName.trim();
            
            saveData();

// „Çµ„Éº„Éê„Å∏„ÅØÈÄÅ„Çâ„Å™„ÅÑ(Á∑®ÈõÜ/ÂâäÈô§„ÅØÊâãÂãï„Åß„Ç∑„Éº„Éà„ÇíÁõ¥„ÅôÈÅãÁî®)
/* if (teamData) {
    syncWithServer();
} */
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('‚úÖ ÈÅ∏ÊâãÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü!\n\n#' + player.number + ' ' + player.name);
        }

        function deletePlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            if (!confirm('„Äå#' + player.number + ' ' + player.name + '„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?\n\n‚ö†Ô∏è „Åì„ÅÆÈÅ∏Êâã„ÅÆË©¶ÂêàË®òÈå≤„ÇÇÂÖ®„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ')) {
                return;
            }
            
            players = players.filter(function(p) {
                return p.id !== playerId;
            });
            
            personalGames = personalGames.filter(function(g) {
                return g.playerId !== playerId;
            });
            
            teamGames.forEach(function(game) {
                if (game.playerStats && game.playerStats[playerId]) {
                    delete game.playerStats[playerId];
                }
                if (game.plays) {
                    game.plays = game.plays.filter(function(play) {
                        return play.playerId !== playerId;
                    });
                }
            });
            
            if (myPlayerId === playerId) {
                myPlayerId = players.length > 0 ? players[0].id : null;
            }
            
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('‚úÖ ÈÅ∏Êâã„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
        }
        
        function changeMyPlayer() {
            myPlayerId = document.getElementById('myPlayerSelect').value || null;
            saveData();
            displayGames();
            displayRankings();
            updateCharts();
            
            updatePlayerBanners();  // ‚Üê ËøΩÂä†
            
            if (myPlayerId) {
                const p = players.find(function(pl) {
                    return pl.id === myPlayerId;
                });
                alert('‚úÖ ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫„Çí„Äå' + p.name + ' #' + p.number + '„Äç„Å´Ë®≠ÂÆö„Åó„Åæ„Åó„Åü\n\nÂ±•Ê≠¥„Éª„É©„É≥„Ç≠„É≥„Ç∞„Éª„Ç∞„É©„Éï„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü!');
            }
        }

        function updatePlayerBanners() {
            // ÈÅ∏Êâã„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            if (myPlayerId && players.length > 0) {
                const player = players.find(function(p) { return p.id === myPlayerId; });
                const playerText = player ? player.name + ' #' + player.number : 'ÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì';

                const banners = [
                    { banner: 'inputPlayerBanner', name: 'inputPlayerName' },
                    { banner: 'listPlayerBanner', name: 'listPlayerName' },
                    { banner: 'rankingPlayerBanner', name: 'rankingPlayerName' },
                    { banner: 'graphPlayerBanner', name: 'graphPlayerName' }
                ];

                banners.forEach(function(b) {
                    const bannerEl = document.getElementById(b.banner);
                    const nameEl = document.getElementById(b.name);
                    
                    if (bannerEl && nameEl) {
                        bannerEl.style.display = 'flex';
                        nameEl.textContent = playerText;
                        
                        // „ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÇíËøΩÂä†
                        bannerEl.style.cursor = 'pointer';
                        bannerEl.style.transition = 'all 0.3s';
                        bannerEl.onclick = showPlayerSelectDialog;
                        
                        // „Éû„Ç¶„Çπ„Çí‰πó„Åõ„Åü„Å®„Åç„ÅÆÂäπÊûú
                        bannerEl.onmouseenter = function() {
                            this.style.transform = 'scale(1.02)';
                            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                        };
                        
                        bannerEl.onmouseleave = function() {
                            this.style.transform = 'scale(1)';
                            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                        };
                    }
                });
            } else {
                // ÈÅ∏Êâã„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÈùûË°®Á§∫
                ['inputPlayerBanner', 'listPlayerBanner', 'rankingPlayerBanner', 'graphPlayerBanner'].forEach(function(id) {
                    const el = document.getElementById(id);
                    if (el) {
                        el.style.display = 'none';
                    }
                });
            }
        }
        
        // ÈÅ∏ÊâãÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showPlayerSelectDialog() {
            if (!players || players.length === 0) {
                alert('ÈÅ∏Êâã„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nÂÖà„Å´„ÄåÈÅ∏ÊâãÁÆ°ÁêÜ„Äç„ÅßÈÅ∏Êâã„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            const modal = document.getElementById('playerSelectModal');
    if (!modal) {
        console.error('„É¢„Éº„ÉÄ„É´„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        createPlayerSelectDialog();
    }
    
    const dropdown = document.getElementById('playerSelectDropdown');
    if (!dropdown) {
        console.error('„Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        alert('„Ç®„É©„Éº: „Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
            dropdown.innerHTML = '<option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû...</option>';
            
            players.forEach(function(p) {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.name + ' #' + p.number;
                
                // ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏Êâã„Å´„Éû„Éº„ÇØ„Çí‰ªò„Åë„Çã
                if (p.id === myPlayerId) {
                    option.textContent = '‚òÖ ' + option.textContent;
                    option.selected = true;
                }
                
                dropdown.appendChild(option);
            });
            
            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            const modal = document.getElementById('playerSelectModal');
            modal.style.display = 'flex';
        }
        
        // „ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñâ„Åò„ÇãÈñ¢Êï∞
        function closePlayerSelectDialog() {
            const modal = document.getElementById('playerSelectModal');
            modal.style.display = 'none';
        }
        
        // ÈÅ∏ÊâãÈÅ∏Êäû„ÇíÁ¢∫ÂÆö„Åô„ÇãÈñ¢Êï∞
        function confirmPlayerSelection() {
            const dropdown = document.getElementById('playerSelectDropdown');
            const selectedPlayerId = dropdown.value;
            
            if (!selectedPlayerId || selectedPlayerId === '') {
                alert('‚ùå ÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ÈÅ∏Êäû„Åó„ÅüÈÅ∏Êâã„ÇíÊé¢„Åô
            const selectedPlayer = players.find(function(p) {
                return p.id === selectedPlayerId;
            });
            
            if (!selectedPlayer) {
                alert('‚ùå ÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                return;
            }
            
            // ÈÅ∏Êâã„ÇíÂàá„ÇäÊõø„Åà
            myPlayerId = selectedPlayer.id;
            saveData();
            
            // „ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñâ„Åò„Çã
            closePlayerSelectDialog();
            
            // ÁîªÈù¢„ÇíÊõ¥Êñ∞
            updateDisplay();
            updatePlayerBanners();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('‚úÖ ' + selectedPlayer.name + ' #' + selectedPlayer.number + ' „ÇíÈÅ∏Êäû„Åó„Åæ„Åó„Åü!');
        }
        function updateMyPlayerSelect() {
            const sel = document.getElementById('myPlayerSelect');
            sel.innerHTML = '<option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
            players.forEach(function(p) {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name + ' #' + p.number;
                if (p.id === myPlayerId) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        function displayPlayers() {
            const playerList = document.getElementById('playerList');
            
            if (players.length === 0) {
                playerList.innerHTML = '<p style="text-align: center; color: #999;">„Åæ„Å†ÈÅ∏Êâã„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                return;
            }

            playerList.innerHTML = players.map(function(p) {
                const isMyPlayer = p.id === myPlayerId;
                
                return '<div class="player-item">' +
                    '<div class="player-info">' +
                    '<div>' +
                    '<span class="number">#' + p.number + '</span>' +
                    '<span style="font-weight: bold; margin-left: 10px;">' + p.name + '</span>' +
                    '</div>' +
                    '<div>' +
                    (isMyPlayer ? '<span class="my-data-badge">ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫‰∏≠</span>' : '') +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 10px; margin-top: 10px;">' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #3498db;" onclick="editPlayer(\'' + p.id + '\')">Á∑®ÈõÜ</button>' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #e74c3c;" onclick="deletePlayer(\'' + p.id + '\')">ÂâäÈô§</button>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function exportData() {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '„Éê„Çπ„Ç±Ë®òÈå≤_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü!');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (confirm('‚ö†Ô∏è „Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô\n\nÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã?')) {
                        personalGames = data.personalGames || [];
                        teamGames = data.teamGames || [];
                        players = data.players || [];
                        myPlayerId = data.myPlayerId || null;
                        teamData = data.teamData || null;
                        saveData();
                        displayGames();
                        displayPlayers();
                        alert('‚úÖ „Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü!');
                        location.reload();
                    }
                } catch (err) {
                    alert('‚ùå „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }
        // ========== ÂÄã‰∫∫Áî®:„Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢ ==========
        function confirmClearLocalData() {
            const message = '‚ö†Ô∏è „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆË©¶Âêà„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô\n\n' +
                '„Äê„ÇØ„É™„Ç¢„Åï„Çå„Çã„ÇÇ„ÅÆ„Äë\n' +
                '‚Ä¢ „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆË©¶ÂêàË®òÈå≤(' + personalGames.length + '‰ª∂)\n\n' +
                '„Äê„ÇØ„É™„Ç¢„Åï„Çå„Å™„ÅÑ„ÇÇ„ÅÆ„Äë\n' +
                '‚Ä¢ ÈÅ∏ÊâãÊÉÖÂ†±\n' +
                '‚Ä¢ Google Sheets„ÅÆ„Éá„Éº„Çø(ÂÖ®Âì°ÂÖ±Êúâ)\n' +
                '‚Ä¢ ‰ªñ„ÅÆ‰∫∫„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø\n\n' +
                'üí° „Éí„É≥„Éà:„Äå‰ªä„Åô„ÅêÂêåÊúü„Äç„ÅßÂæ©ÂÖÉ„Åß„Åç„Åæ„Åô\n\n' +
                'Êú¨ÂΩì„Å´„ÇØ„É™„Ç¢„Åó„Åæ„Åô„Åã?';
            
            if (confirm(message)) {
                clearLocalData();
            }
        }

        function clearLocalData() {
    personalGames = [];
    teamGames = [];
    players = [];
    myPlayerId = null;

    saveData();

    displayGames();
    displayRankings();
    updateCharts();
    // ...ÂøÖË¶Å„Å™UIÊõ¥Êñ∞
}
        // ========== ÁÆ°ÁêÜËÄÖÁî®:„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà ==========
        function confirmResetTeamData() {
    if (!teamData) {
        alert('„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
        return;
    }
    
    const message = 'üîê ÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÂÆüË°åÂèØËÉΩ\n\n' +
        '‚ö†Ô∏è „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆË©¶Âêà„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô\n\n' +
        '„ÄêÂΩ±Èüø„Äë\n' +
        '‚Ä¢ Google Sheets„ÅÆË©¶Âêà„Éá„Éº„Çø„ÅåÂâäÈô§„Åï„Çå„Åæ„Åô\n' +
        '‚Ä¢ ÂÖ®„É°„É≥„Éê„Éº„ÅÆ„Çπ„Éû„Éõ„Åã„ÇâË©¶ÂêàË®òÈå≤„ÅåÊ∂à„Åà„Åæ„Åô\n' +
        '‚Ä¢ Âæ©ÂÖÉ„Åß„Åç„Åæ„Åõ„Çì!\n\n' +
        '„ÄêÊÆã„Çã„ÇÇ„ÅÆ„Äë\n' +
        '‚Ä¢ ÈÅ∏ÊâãÊÉÖÂ†±\n' +
        '‚Ä¢ „ÉÅ„Éº„É†Ë®≠ÂÆö\n\n' +
        'Á∂ö„Åë„Çã„Å´„ÅØ„ÄÅÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:';
    
    const inputPassword = prompt(message);
    
    if (inputPassword === null) {
        return;
    }
    
    if (!inputPassword || inputPassword.trim() === '') {
        alert('‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    const finalConfirm = confirm(
        '‚ö†Ô∏è ÊúÄÁµÇÁ¢∫Ë™ç\n\n' +
        '„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÄÇ\n' +
        '„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ\n\n' +
        'Êú¨ÂΩì„Å´ÂÆüË°å„Åó„Åæ„Åô„Åã?'
    );
    
    if (finalConfirm) {
        resetTeamData(inputPassword);
    }
}

        function resetTeamData(adminPassword) {  // ‚Üê „Éë„É©„É°„Éº„ÇøËøΩÂä†
    personalGames = [];
    teamGames = [];
    saveData();
    
    if (teamData) {
        clearServerGameData(adminPassword);  // ‚Üê „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÊ∏°„Åô
    }
    
    displayGames();
    displayRankings();
    updateCharts();
    if (typeof displayTeamGamesHistory === 'function') {
        displayTeamGamesHistory();
    }
    
    alert('‚úÖ „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü!\n\nÂÖ®„É°„É≥„Éê„Éº„Å´ÂΩ±Èüø„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\nÂêÑ„É°„É≥„Éê„Éº„ÅØ„Äå‰ªä„Åô„ÅêÂêåÊúü„Äç„ÅßÁ©∫„ÅÆ„Éá„Éº„Çø„ÅåÂèñÂæó„Åï„Çå„Åæ„Åô„ÄÇ');
}

async function clearServerGameData(adminPassword) {  // ‚Üê „Éë„É©„É°„Éº„ÇøËøΩÂä†
    try {
        showSyncIndicator('syncing', '„Çµ„Éº„Éê„Éº„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇíÂâäÈô§‰∏≠...');
        
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain',
            },
            body: JSON.stringify({
                action: 'clearGames',
                teamCode: teamData.code,
                adminPassword: adminPassword  // ‚Üê „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÈÄÅ‰ø°
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showSyncIndicator('success', '„Çµ„Éº„Éê„Éº„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇÇÂâäÈô§ÂÆå‰∫Ü');
        } else {
            showSyncIndicator('error', result.error || '„Çµ„Éº„Éê„ÉºÂâäÈô§Â§±Êïó');
            alert('‚ùå ' + (result.error || '„Çµ„Éº„Éê„ÉºÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
        }
    } catch (error) {
        console.error('„Çµ„Éº„Éê„ÉºÂâäÈô§„Ç®„É©„Éº:', error);
        showSyncIndicator('error', '„Çµ„Éº„Éê„ÉºÂâäÈô§Â§±Êïó');
        alert('‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
    }
}

        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openShotPositionModal(callback) {
            shotChartCallback = callback;
            currentShotPosition = null;
            
            const modal = document.getElementById('shotPositionModal');
            const canvas = document.getElementById('shotCourtCanvas');
            const container = document.getElementById('shotCourtContainer');
            
            // „Ç≥„Éº„ÉàÂõ≥„ÇíÊèèÁîª
            drawCourt(canvas);
            
            // „Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
            container.onclick = function(e) {
                const rect = canvas.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * canvas.width;
                const y = ((e.clientY - rect.top) / rect.height) * canvas.height;
                
                // Ë®òÈå≤„Åï„Çå„Åü‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                currentShotPosition = { x: x, y: y };
                
                // ‰∏ÄÊôÇÁöÑ„Å™„Éû„Éº„Ç´„Éº„ÇíË°®Á§∫
                drawCourt(canvas);
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Ëá™ÂãïÁöÑ„Å´„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶Ë®òÈå≤
                setTimeout(function() {
                    confirmShotPosition();
                }, 300);
            };
            
            modal.classList.add('active');
        }
        
        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeShotPositionModal() {
            const modal = document.getElementById('shotPositionModal');
            modal.classList.remove('active');
            currentShotPosition = null;
            shotChartCallback = null;
        }
        
        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÇíÁ¢∫ÂÆö
        function confirmShotPosition() {
            if (currentShotPosition && shotChartCallback) {
                const canvas = document.getElementById('shotCourtCanvas');
                const zone = getZoneFromPosition(
                    currentShotPosition.x,
                    currentShotPosition.y,
                    canvas.width,
                    canvas.height
                );
                
                shotChartCallback({
                    x: currentShotPosition.x,
                    y: currentShotPosition.y,
                    zone: zone
                });
            }
            closeShotPositionModal();
        }
        
        // ‰ΩçÁΩÆË®òÈå≤„Çí„Çπ„Ç≠„ÉÉ„Éó
        function skipShotPosition() {
            if (shotChartCallback) {
                shotChartCallback(null);
            }
            closeShotPositionModal();
        }
        loadData();
        migrateData();
        updateDisplay();
        displayGames();
        displayPlayers();
        updateMyPlayerSelect();
        displayTeamStatus();
        updatePlayerBanners();
        loadTeamData();
        checkAndShowDraftGame();
        
        // ========== ÈÅ∏ÊâãÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅÆHTML‰ΩúÊàê ==========
        function createPlayerSelectDialog() {
            const dialogHTML = `
                <div id="playerSelectModal" class="modal-overlay" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>üèÄ ÈÅ∏Êâã„ÇíÈÅ∏Êäû</h2>
                            <button class="modal-close" onclick="closePlayerSelectDialog()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <p style="margin-bottom: 15px; color: #666;">ÂÄã‰∫∫„É¢„Éº„Éâ„ÅßË°®Á§∫„Åô„ÇãÈÅ∏Êâã„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
                            <select id="playerSelectDropdown" class="player-select-dropdown">
                                <option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû...</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn cancel-btn" onclick="closePlayerSelectDialog()">„Ç≠„É£„É≥„Çª„É´</button>
                            <button class="modal-btn confirm-btn" onclick="confirmPlayerSelection()">ÈÅ∏Êäû</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Çí‰ΩúÊàê
        createPlayerSelectDialog();
    </script>
    <!-- ========== „Åì„Åì„Åã„ÇâËøΩÂä† ========== -->
    
    <!-- „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´ -->
    <div id="shotPositionModal" class="shot-chart-modal">
        <div class="shot-chart-content">
            <h2 style="text-align: center; color: #667eea;">üéØ „Å©„Åì„Åã„ÇâÊâì„Å£„ÅüÔºü</h2>
            <p style="text-align: center; color: #666; margin-bottom: 10px;">
                „Ç≥„Éº„Éà„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÇíË®òÈå≤
            </p>
            
            <div class="court-container" id="shotCourtContainer">
                <canvas id="shotCourtCanvas" class="court-canvas" width="300" height="400"></canvas>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modal-btn cancel-btn" style="flex: 1;" onclick="closeShotPositionModal()">
                    „Ç≠„É£„É≥„Çª„É´
                </button>
                <button class="modal-btn confirm-btn" style="flex: 1;" onclick="skipShotPosition()">
                    ‰ΩçÁΩÆ„ÇíË®òÈå≤„Åõ„Åö„Çπ„Ç≠„ÉÉ„Éó
                </button>
            </div>
        </div>
    </div>

    </body>
</html>
    
