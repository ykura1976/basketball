<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ ãƒã‚¹ã‚±è¨˜éŒ²</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .sync-indicator.syncing {
            display: block;
            color: #667eea;
        }

        .sync-indicator.success {
            display: block;
            color: #2ecc71;
        }

        .sync-indicator.error {
            display: block;
            color: #ff4757;
        }

        .mode-switch {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid white;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
        }

        .tab-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .stepper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stepper button {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stepper button:active {
            transform: scale(0.95);
        }

        .stepper .value {
            flex: 1;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stats-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 12px;
            color: white;
            text-align: center;
        }

        .stats-display h3 {
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stats-display .percentage {
            font-size: 1.8em;
            font-weight: bold;
        }

        .save-btn, .primary-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn:active, .primary-btn:active {
            transform: scale(0.98);
        }

        .save-btn:disabled, .primary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .game-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .stat-box {
            text-align: center;
            padding: 8px;
            background: #f7f7f7;
            border-radius: 8px;
        }

        .stat-box .label {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-box .value {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        input[type="date"], input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .saved-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: bold;
            z-index: 1000;
        }

        .saved-indicator.show {
            opacity: 1;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: bold;
            margin: 25px 0 15px 0;
            color: #333;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .player-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .player-btn .number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-btn .name {
            font-size: 0.85em;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.success {
            background: #2ecc71;
            color: white;
        }

        .action-btn.miss {
            background: #e0e0e0;
            color: #666;
        }

        .action-btn.other {
            background: #667eea;
            color: white;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .play-history {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: #f7f7f7;
            border-radius: 10px;
            padding: 10px;
        }

        .play-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .play-item:last-child {
            margin-bottom: 0;
        }

        .undo-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #ff4757;
            color: white;
            font-size: 0.85em;
            cursor: pointer;
        }

        .period-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            color: #666;
        }

        .period-btn.selected {
            background: #ffc107;
            color: white;
            border-color: #ffc107;
        }

        .team-code-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .team-code-display .code {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        .player-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-info .number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .my-data-badge {
            background: #2ecc71;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }

        .top-record {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .top-record .trophy {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .top-record .value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .close-modal {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            width: 100%;
            margin-top: 15px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="sync-indicator" id="syncIndicator">åŒæœŸä¸­...</div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ€ ãƒã‚¹ã‚±è¨˜éŒ²</h1>
            <p>æˆé•·ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>
        </div>

        <div class="mode-switch">
            <button class="mode-btn active" onclick="switchMode('personal')">ğŸ‘¤ å€‹äºº</button>
            <button class="mode-btn" onclick="switchMode('team')">âš¡ è©¦åˆè¨˜éŒ²</button>
        </div>

        <div id="personalMode">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTab('input')">ğŸ“ è¨˜éŒ²</button>
                <button class="tab" onclick="switchTab('list')">ğŸ“Š å±¥æ­´</button>
                <button class="tab" onclick="switchTab('ranking')">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
                <button class="tab" onclick="switchTab('graph')">ğŸ“ˆ ã‚°ãƒ©ãƒ•</button>
                <button class="tab" onclick="switchTab('settings')">âš™ï¸ è¨­å®š</button>
            </div>

            <div id="inputTab" class="tab-content active">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">æ–°ã—ã„è©¦åˆã‚’è¨˜éŒ²</h2>
                    
                    <div class="input-group">
                        <label>è©¦åˆæ—¥</label>
                        <input type="date" id="gameDate">
                    </div>

                    <div class="input-group">
                        <label>å¯¾æˆ¦ç›¸æ‰‹</label>
                        <input type="text" id="opponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                    </div>

                    <div class="input-group">
                        <label>ãƒ—ãƒ¬ã‚¤æ™‚é–“ï¼ˆåˆ†ï¼‰</label>
                        <input type="number" id="playTime" value="0" min="0" max="200">
                    </div>

                    <div class="section-title">ğŸ€ ã‚·ãƒ¥ãƒ¼ãƒˆ</div>
                    
                    <div class="input-group">
                        <label>2ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsMade', -1)">âˆ’</button>
                            <div class="value" id="twoPointsMade">0</div>
                            <button onclick="changeValue('twoPointsMade', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>2ãƒã‚¤ãƒ³ãƒˆè©¦æŠ•</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsAttempted', -1)">âˆ’</button>
                            <div class="value" id="twoPointsAttempted">0</div>
                            <button onclick="changeValue('twoPointsAttempted', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsMade', -1)">âˆ’</button>
                            <div class="value" id="threePointsMade">0</div>
                            <button onclick="changeValue('threePointsMade', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3ãƒã‚¤ãƒ³ãƒˆè©¦æŠ•</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsAttempted', -1)">âˆ’</button>
                            <div class="value" id="threePointsAttempted">0</div>
                            <button onclick="changeValue('threePointsAttempted', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼æˆåŠŸ</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsMade', -1)">âˆ’</button>
                            <div class="value" id="freeThrowsMade">0</div>
                            <button onclick="changeValue('freeThrowsMade', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼è©¦æŠ•</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsAttempted', -1)">âˆ’</button>
                            <div class="value" id="freeThrowsAttempted">0</div>
                            <button onclick="changeValue('freeThrowsAttempted', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stats-display">
                            <h3>2PæˆåŠŸç‡</h3>
                            <div class="percentage" id="twoPointPercentage">0%</div>
                        </div>
                        <div class="stats-display">
                            <h3>3PæˆåŠŸç‡</h3>
                            <div class="percentage" id="threePointPercentage">0%</div>
                        </div>
                        <div class="stats-display">
                            <h3>FTæˆåŠŸç‡</h3>
                            <div class="percentage" id="freeThrowPercentage">0%</div>
                        </div>
                        <div class="stats-display">
                            <h3>ç·å¾—ç‚¹</h3>
                            <div class="percentage" id="totalPoints">0</div>
                        </div>
                    </div>

                    <div class="section-title">ğŸ¯ ãƒªãƒã‚¦ãƒ³ãƒ‰</div>

                    <div class="input-group">
                        <label>ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</label>
                        <div class="stepper">
                            <button onclick="changeValue('offensiveRebounds', -1)">âˆ’</button>
                            <div class="value" id="offensiveRebounds">0</div>
                            <button onclick="changeValue('offensiveRebounds', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</label>
                        <div class="stepper">
                            <button onclick="changeValue('defensiveRebounds', -1)">âˆ’</button>
                            <div class="value" id="defensiveRebounds">0</div>
                            <button onclick="changeValue('defensiveRebounds', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="section-title">ğŸ“Š ãã®ä»–ã®çµ±è¨ˆ</div>

                    <div class="input-group">
                        <label>ã‚¢ã‚·ã‚¹ãƒˆ</label>
                        <div class="stepper">
                            <button onclick="changeValue('assists', -1)">âˆ’</button>
                            <div class="value" id="assists">0</div>
                            <button onclick="changeValue('assists', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</label>
                        <div class="stepper">
                            <button onclick="changeValue('steals', -1)">âˆ’</button>
                            <div class="value" id="steals">0</div>
                            <button onclick="changeValue('steals', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ–ãƒ­ãƒƒã‚¯</label>
                        <div class="stepper">
                            <button onclick="changeValue('blocks', -1)">âˆ’</button>
                            <div class="value" id="blocks">0</div>
                            <button onclick="changeValue('blocks', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</label>
                        <div class="stepper">
                            <button onclick="changeValue('turnovers', -1)">âˆ’</button>
                            <div class="value" id="turnovers">0</div>
                            <button onclick="changeValue('turnovers', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ•ã‚¡ã‚¦ãƒ«</label>
                        <div class="stepper">
                            <button onclick="changeValue('fouls', -1)">âˆ’</button>
                            <div class="value" id="fouls">0</div>
                            <button onclick="changeValue('fouls', 1)">ï¼‹</button>
                        </div>
                    </div>

                    <button class="save-btn" id="saveGameBtn" onclick="savePersonalGame()">è¨˜éŒ²ã‚’ä¿å­˜</button>
                </div>
            </div>

            <div id="listTab" class="tab-content">
                <div id="gameList"></div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ† ãƒ™ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                        é¸æŠã—ãŸé¸æ‰‹ã®è‡ªå·±ãƒ™ã‚¹ãƒˆè¨˜éŒ²ã§ã™
                    </p>
                    <div id="topPoints"></div>
                </div>
            </div>

            <div id="graphTab" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ã®æ¨ç§»</h2>
                    <div class="chart-container">
                        <canvas id="shootingChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ”— ãƒãƒ¼ãƒ é€£æº</h2>
                    <div id="teamStatus"></div>
                    
                    <button class="primary-btn" style="margin-bottom: 10px;" onclick="showCreateTeamModal()">
                        ğŸ†• æ–°ã—ã„ãƒãƒ¼ãƒ ã‚’ä½œæˆ
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="showJoinTeamModal()">
                        ğŸ‘‹ ãƒãƒ¼ãƒ ã«å‚åŠ 
                    </button>
                    
                    <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 0.9em; color: #1976d2;">
                        ğŸ’¡ <strong>ãƒãƒ¼ãƒ æ©Ÿèƒ½:</strong> è¨˜éŒ²ä¿‚1äººãŒå…¨é¸æ‰‹ã‚’è¨˜éŒ²â†’å…¨å“¡ã®ã‚¹ãƒãƒ›ã«è‡ªå‹•åŒæœŸ
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ‘¤ å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºè¨­å®š</h2>
                    <div class="input-group">
                        <label>å€‹äººãƒ¢ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹é¸æ‰‹</label>
                        <select id="myPlayerSelect" onchange="changeMyPlayer()">
                            <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        é¸æŠã—ãŸé¸æ‰‹ã®å€‹äººæˆç¸¾ãŒå±¥æ­´ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ã‚°ãƒ©ãƒ•ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </p>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ‘¥ é¸æ‰‹ç™»éŒ²</h2>
                    <div class="input-group">
                        <label>èƒŒç•ªå·</label>
                        <input type="number" id="playerNumber" placeholder="ä¾‹: 7" min="0" max="99">
                    </div>
                    <div class="input-group">
                        <label>åå‰</label>
                        <input type="text" id="playerName" placeholder="ä¾‹: å±±ç”° èŠ±å­">
                    </div>
                    <button class="primary-btn" style="margin-top: 15px;" onclick="addPlayer()">é¸æ‰‹ã‚’è¿½åŠ </button>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ç™»éŒ²æ¸ˆã¿é¸æ‰‹</h2>
                    <div id="playerList"></div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                    <button class="primary-btn" style="background: #2ecc71; margin-bottom: 10px;" onclick="exportData()">
                        ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="document.getElementById('importFile').click()">
                        ğŸ“‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                </div>
            </div>
        </div>

        <div id="teamMode" style="display: none;">
            <div class="card">
                <h2 style="margin-bottom: 20px;">âš¡ è©¦åˆè¨˜éŒ²</h2>
                
                <div class="input-group">
                    <label>è©¦åˆæ—¥</label>
                    <input type="date" id="teamGameDate">
                </div>

                <div class="input-group">
                    <label>å¯¾æˆ¦ç›¸æ‰‹</label>
                    <input type="text" id="teamOpponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                </div>

                <button class="primary-btn" onclick="startTeamGame()">è©¦åˆé–‹å§‹</button>
            </div>

            <div id="teamRecording" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 15px;">ãƒ”ãƒªã‚ªãƒ‰ã‚’é¸æŠ</h2>
                    <div class="period-selector">
                        <div class="period-btn selected" onclick="selectPeriod(1)" id="period1">1Q</div>
                        <div class="period-btn" onclick="selectPeriod(2)" id="period2">2Q</div>
                        <div class="period-btn" onclick="selectPeriod(3)" id="period3">3Q</div>
                        <div class="period-btn" onclick="selectPeriod(4)" id="period4">4Q</div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">é¸æ‰‹ã‚’é¸æŠ</h2>
                    <div id="playerSelector" class="player-grid"></div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">ãƒ—ãƒ¬ã‚¤ã‚’è¨˜éŒ²</h2>
                    <div class="action-buttons">
                        <button class="action-btn success" onclick="recordPlay('2p-made')">2PæˆåŠŸ</button>
                        <button class="action-btn miss" onclick="recordPlay('2p-miss')">2På¤±æ•—</button>
                        <button class="action-btn success" onclick="recordPlay('3p-made')">3PæˆåŠŸ</button>
                        <button class="action-btn miss" onclick="recordPlay('3p-miss')">3På¤±æ•—</button>
                        <button class="action-btn success" onclick="recordPlay('ft-made')">FTæˆåŠŸ</button>
                        <button class="action-btn miss" onclick="recordPlay('ft-miss')">FTå¤±æ•—</button>
                        <button class="action-btn other" onclick="recordPlay('oreb')">ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</button>
                        <button class="action-btn other" onclick="recordPlay('dreb')">ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</button>
                        <button class="action-btn other" onclick="recordPlay('ast')">ã‚¢ã‚·ã‚¹ãƒˆ</button>
                        <button class="action-btn other" onclick="recordPlay('stl')">ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</button>
                        <button class="action-btn other" onclick="recordPlay('blk')">ãƒ–ãƒ­ãƒƒã‚¯</button>
                        <button class="action-btn other" onclick="recordPlay('to')">ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</button>
                        <button class="action-btn other" onclick="recordPlay('foul')">ãƒ•ã‚¡ã‚¦ãƒ«</button>
                    </div>

                    <div class="play-history" id="playHistory">
                        <div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">è©¦åˆçµ±è¨ˆ</h2>
                    <div id="teamStats"></div>
                    <button class="save-btn" style="margin-top: 20px;" onclick="saveTeamGame()">è©¦åˆçµ‚äº†ãƒ»ä¿å­˜</button>
                </div>
            </div>
        </div>
    </div>

    <div id="createTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ†• ãƒãƒ¼ãƒ ã‚’ä½œæˆ</h2>
            <div class="input-group">
                <label>ãƒãƒ¼ãƒ å</label>
                <input type="text" id="newTeamName" placeholder="ä¾‹: ã•ãã‚‰ãƒã‚¹ã‚±éƒ¨">
            </div>
            <button class="primary-btn" onclick="createTeam()">ä½œæˆ</button>
            <button class="close-modal" onclick="closeModal('createTeamModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <div id="joinTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ‘‹ ãƒãƒ¼ãƒ ã«å‚åŠ </h2>
            <div class="input-group">
                <label>ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰</label>
                <input type="text" id="joinTeamCode" placeholder="6æ¡ã®ã‚³ãƒ¼ãƒ‰" maxlength="6">
            </div>
            <button class="primary-btn" onclick="joinTeam()">å‚åŠ </button>
            <button class="close-modal" onclick="closeModal('joinTeamModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <div class="saved-indicator" id="savedIndicator">âœ“ ä¿å­˜ã—ã¾ã—ãŸ</div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwbPUgd-QAVhwBmhyBwiCtS1GDvZks0imrC78ZsJu5dV-d-Zt6reEW0oi1Lkc_MbW_agQ/exec';
        
        let currentMode = 'personal';
        let personalGames = [];
        let teamGames = [];
        let players = [];
        let myPlayerId = null;
        let teamData = null;
        let charts = {};
        
        let stats = {
            twoPointsMade: 0, twoPointsAttempted: 0,
            threePointsMade: 0, threePointsAttempted: 0,
            freeThrowsMade: 0, freeThrowsAttempted: 0,
            offensiveRebounds: 0, defensiveRebounds: 0,
            assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
        };

        let currentTeamGame = null;
        let selectedPlayer = null;
        let currentPeriod = 1;

        function showSyncIndicator(status, message) {
            const indicator = document.getElementById('syncIndicator');
            indicator.className = 'sync-indicator ' + status;
            indicator.textContent = message;
            
            if (status === 'success' || status === 'error') {
                setTimeout(function() {
                    indicator.className = 'sync-indicator';
                }, 3000);
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('basketballData');
                if (saved) {
                    const data = JSON.parse(saved);
                    personalGames = data.personalGames || [];
                    teamGames = data.teamGames || [];
                    players = data.players || [];
                    myPlayerId = data.myPlayerId || null;
                    teamData = data.teamData || null;
                }
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        function saveData() {
            const data = {
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData
            };
            localStorage.setItem('basketballData', JSON.stringify(data));
            showSavedIndicator();
        }

        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.classList.add('show');
            setTimeout(function() {
                indicator.classList.remove('show');
            }, 2000);
        }

        function selectPeriod(period) {
            currentPeriod = period;
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById('period' + i);
                if (i === period) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            }
        }

        function startTeamGame() {
            if (players.length === 0) { 
                alert('å…ˆã«é¸æ‰‹ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ï¼ˆè¨­å®šã‚¿ãƒ–ï¼‰'); 
                return; 
            }

            const date = document.getElementById('teamGameDate').value;
            if (!date) { 
                alert('è©¦åˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„'); 
                return; 
            }

            currentTeamGame = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('teamOpponent').value.trim(),
                plays: [],
                playerStats: {}
            };

            players.forEach(function(p) {
                currentTeamGame.playerStats[p.id] = {
                    twoPointsMade: 0, twoPointsAttempted: 0,
                    threePointsMade: 0, threePointsAttempted: 0,
                    freeThrowsMade: 0, freeThrowsAttempted: 0,
                    offensiveRebounds: 0, defensiveRebounds: 0,
                    assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
                };
            });

            currentPeriod = 1;
            selectPeriod(1);
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
        }

        function displayPlayerSelector() {
            const sel = document.getElementById('playerSelector');
            sel.innerHTML = players.map(function(p) {
                const isSelected = selectedPlayer === p.id;
                return '<div class="player-btn' + (isSelected ? ' selected' : '') + '" onclick="selectPlayer(\'' + p.id + '\')">' +
                    '<div class="number">#' + p.number + '</div>' +
                    '<div class="name">' + p.name + '</div>' +
                    '</div>';
            }).join('');
        }

        function selectPlayer(id) {
            selectedPlayer = id;
            displayPlayerSelector();
        }

        function getPlayLabel(type) {
            const labels = {
                '2p-made': '2PæˆåŠŸ', '2p-miss': '2På¤±æ•—',
                '3p-made': '3PæˆåŠŸ', '3p-miss': '3På¤±æ•—',
                'ft-made': 'FTæˆåŠŸ', 'ft-miss': 'FTå¤±æ•—',
                'oreb': 'ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰', 'dreb': 'ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰',
                'ast': 'ã‚¢ã‚·ã‚¹ãƒˆ', 'stl': 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«', 'blk': 'ãƒ–ãƒ­ãƒƒã‚¯',
                'to': 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼', 'foul': 'ãƒ•ã‚¡ã‚¦ãƒ«'
            };
            return labels[type] || type;
        }

        function recordPlay(type) {
            if (!selectedPlayer) { 
                alert('å…ˆã«é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„'); 
                return; 
            }

            const st = currentTeamGame.playerStats[selectedPlayer];
            
            if (type === '2p-made') { st.twoPointsMade++; st.twoPointsAttempted++; }
            else if (type === '2p-miss') { st.twoPointsAttempted++; }
            else if (type === '3p-made') { st.threePointsMade++; st.threePointsAttempted++; }
            else if (type === '3p-miss') { st.threePointsAttempted++; }
            else if (type === 'ft-made') { st.freeThrowsMade++; st.freeThrowsAttempted++; }
            else if (type === 'ft-miss') { st.freeThrowsAttempted++; }
            else if (type === 'oreb') { st.offensiveRebounds++; }
            else if (type === 'dreb') { st.defensiveRebounds++; }
            else if (type === 'ast') { st.assists++; }
            else if (type === 'stl') { st.steals++; }
            else if (type === 'blk') { st.blocks++; }
            else if (type === 'to') { st.turnovers++; }
            else if (type === 'foul') { st.fouls++; }

            currentTeamGame.plays.push({
                playerId: selectedPlayer,
                playType: type,
                period: currentPeriod,
                timestamp: Date.now()
            });

            updateTeamStats();
            displayPlayHistory();
        }

        function deletePlay(timestamp) {
            const playIndex = currentTeamGame.plays.findIndex(function(p) {
                return p.timestamp === timestamp;
            });
            if (playIndex === -1) return;
            
            const play = currentTeamGame.plays[playIndex];
            const st = currentTeamGame.playerStats[play.playerId];
            
            if (play.playType === '2p-made') { st.twoPointsMade--; st.twoPointsAttempted--; }
            else if (play.playType === '2p-miss') { st.twoPointsAttempted--; }
            else if (play.playType === '3p-made') { st.threePointsMade--; st.threePointsAttempted--; }
            else if (play.playType === '3p-miss') { st.threePointsAttempted--; }
            else if (play.playType === 'ft-made') { st.freeThrowsMade--; st.freeThrowsAttempted--; }
            else if (play.playType === 'ft-miss') { st.freeThrowsAttempted--; }
            else if (play.playType === 'oreb') { st.offensiveRebounds--; }
            else if (play.playType === 'dreb') { st.defensiveRebounds--; }
            else if (play.playType === 'ast') { st.assists--; }
            else if (play.playType === 'stl') { st.steals--; }
            else if (play.playType === 'blk') { st.blocks--; }
            else if (play.playType === 'to') { st.turnovers--; }
            else if (play.playType === 'foul') { st.fouls--; }
            
            currentTeamGame.plays.splice(playIndex, 1);
            
            updateTeamStats();
            displayPlayHistory();
        }

        function displayPlayHistory() {
            const histEl = document.getElementById('playHistory');
            
            if (currentTeamGame.plays.length === 0) {
                histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>';
                return;
            }
            
            const recentPlays = currentTeamGame.plays.slice().reverse().slice(0, 10);
            histEl.innerHTML = '<div style="margin-bottom: 10px; font-size: 0.9em; color: #666; font-weight: bold;">æœ€æ–°ã®ãƒ—ãƒ¬ã‚¤ï¼ˆæœ€å¤§10ä»¶ï¼‰ - ã‚¿ãƒƒãƒ—ã§å‰Šé™¤</div>' +
                recentPlays.map(function(play) {
                    const p = players.find(function(pl) {
                        return pl.id === play.playerId;
                    });
                    return '<div class="play-item">' +
                        '<div>' +
                        '<strong>' + play.period + 'Q | #' + p.number + ' ' + p.name + '</strong>' +
                        '<div style="font-size: 0.85em; color: #666; margin-top: 2px;">' + getPlayLabel(play.playType) + '</div>' +
                        '</div>' +
                        '<button class="undo-btn" onclick="deletePlay(' + play.timestamp + ')">å‰Šé™¤</button>' +
                        '</div>';
                }).join('');
        }

        function updateTeamStats() {
            const el = document.getElementById('teamStats');
            let html = '';

            players.forEach(function(p) {
                const st = currentTeamGame.playerStats[p.id];
                const pts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;
                const reb = st.offensiveRebounds + st.defensiveRebounds;

                html += '<div style="padding: 10px; background: #f7f7f7; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="font-weight: bold; margin-bottom: 5px;">#' + p.number + ' ' + p.name + '</div>' +
                    '<div style="font-size: 0.9em; color: #666;">' +
                    pts + 'ç‚¹ | ' + reb + 'ãƒªãƒã‚¦ãƒ³ãƒ‰ | ' + st.assists + 'ã‚¢ã‚·ã‚¹ãƒˆ | ' + st.steals + 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ« | ' + st.blocks + 'ãƒ–ãƒ­ãƒƒã‚¯' +
                    '</div>' +
                    '</div>';
            });

            el.innerHTML = html;
        }

        function saveTeamGame() {
            if (!currentTeamGame) return;

            teamGames.unshift(currentTeamGame);

            players.forEach(function(player) {
                if (currentTeamGame.playerStats[player.id]) {
                    const st = currentTeamGame.playerStats[player.id];
                    const totalReb = st.offensiveRebounds + st.defensiveRebounds;
                    const totalPts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;

                    const personalGame = {
                        id: Date.now() + Math.random(),
                        date: currentTeamGame.date,
                        opponent: currentTeamGame.opponent,
                        playTime: 0,
                        playerId: player.id,
                        twoPointsMade: st.twoPointsMade,
                        twoPointsAttempted: st.twoPointsAttempted,
                        threePointsMade: st.threePointsMade,
                        threePointsAttempted: st.threePointsAttempted,
                        freeThrowsMade: st.freeThrowsMade,
                        freeThrowsAttempted: st.freeThrowsAttempted,
                        offensiveRebounds: st.offensiveRebounds,
                        defensiveRebounds: st.defensiveRebounds,
                        assists: st.assists,
                        steals: st.steals,
                        blocks: st.blocks,
                        turnovers: st.turnovers,
                        fouls: st.fouls,
                        totalRebounds: totalReb,
                        twoPointPercentage: st.twoPointsAttempted > 0 ? ((st.twoPointsMade / st.twoPointsAttempted) * 100).toFixed(1) : '0',
                        threePointPercentage: st.threePointsAttempted > 0 ? ((st.threePointsMade / st.threePointsAttempted) * 100).toFixed(1) : '0',
                        freeThrowPercentage: st.freeThrowsAttempted > 0 ? ((st.freeThrowsMade / st.freeThrowsAttempted) * 100).toFixed(1) : '0',
                        totalPoints: totalPts,
                        source: 'team'
                    };

                    personalGames.unshift(personalGame);
                }
            });

            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            currentTeamGame = null;
            selectedPlayer = null;
            currentPeriod = 1;
            document.getElementById('teamRecording').style.display = 'none';
            document.getElementById('teamGameDate').valueAsDate = new Date();
            document.getElementById('teamOpponent').value = '';
            
            alert('âœ… è©¦åˆè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼\n\nå…¨é¸æ‰‹ã®ãƒ‡ãƒ¼ã‚¿ãŒå€‹äººãƒ¢ãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã¾ã™ã€‚');
        }

        function showCreateTeamModal() {
            document.getElementById('createTeamModal').classList.add('active');
        }

        function showJoinTeamModal() {
            document.getElementById('joinTeamModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function generateTeamCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function createTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            if (!teamName) {
                alert('ãƒãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showSyncIndicator('syncing', 'ãƒãƒ¼ãƒ ã‚’ä½œæˆä¸­...');
            
            const teamCode = generateTeamCode();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'createTeam',
                        teamName: teamName,
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teamData = {
                        name: teamName,
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        createdAt: new Date().toISOString()
                    };
                    saveData();
                    closeModal('createTeamModal');
                    displayTeamStatus();
                    showSyncIndicator('success', 'ãƒãƒ¼ãƒ ä½œæˆå®Œäº†!');
                    
                    alert('âœ… ãƒãƒ¼ãƒ ã€Œ' + teamName + 'ã€ã‚’ä½œæˆã—ã¾ã—ãŸï¼\n\nãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰: ' + teamCode + '\n\nã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å‹é”ã«å…±æœ‰ã—ã¦ãã ã•ã„ã€‚\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ: ' + result.spreadsheetUrl);
                } else {
                    throw new Error(result.error || 'ãƒãƒ¼ãƒ ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message + '\n\nã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }

        async function joinTeam() {
            const teamCode = document.getElementById('joinTeamCode').value.trim().toUpperCase();
            if (!teamCode || teamCode.length !== 6) {
                alert('æ­£ã—ã„6æ¡ã®ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showSyncIndicator('syncing', 'ãƒãƒ¼ãƒ ã«å‚åŠ ä¸­...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'joinTeam',
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teamData = {
                        name: result.teamData ? result.teamData.name : 'ãƒãƒ¼ãƒ ',
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        joinedAt: new Date().toISOString()
                    };
                    
                    saveData();
                    closeModal('joinTeamModal');
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    await loadTeamData();
                    
                    // è¡¨ç¤ºã‚’æ›´æ–°
                    displayTeamStatus();
                    displayPlayers();
                    updateMyPlayerSelect();
                    
                    showSyncIndicator('success', 'ãƒãƒ¼ãƒ å‚åŠ å®Œäº†!');
                    alert('âœ… ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¾ã—ãŸï¼\n\nãƒãƒ¼ãƒ å: ' + teamData.name + '\nãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰: ' + teamCode + '\n\né¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸã€‚\nè¨­å®šã‚¿ãƒ–ã®ã€Œå€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºè¨­å®šã€ã§é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                } else {
                    throw new Error(result.error || 'ãƒãƒ¼ãƒ å‚åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        async function syncWithServer() {
            if (!teamData) return;
            
            showSyncIndicator('syncing', 'åŒæœŸä¸­...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'syncData',
                        teamCode: teamData.code,
                        players: players,
                        games: teamGames
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSyncIndicator('success', 'åŒæœŸå®Œäº†!');
                } else {
                    throw new Error(result.error || 'åŒæœŸã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error', 'åŒæœŸå¤±æ•—');
            }
        }

        async function loadTeamData() {
            if (!teamData) return;
            
            showSyncIndicator('syncing', 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'getData',
                        teamCode: teamData.code
                    })
                });
                
                const result = await response.json();
                
                if (result.success && result.players) {
                    let addedCount = 0;
                    result.players.forEach(function(serverPlayer) {
                        const exists = players.some(function(p) {
                            return p.id === serverPlayer.id;
                        });
                        if (!exists) {
                            players.push(serverPlayer);
                            addedCount++;
                        }
                    });
                    
                    saveData();
                    showSyncIndicator('success', addedCount + 'äººã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—');
                    
                    return addedCount;
                } else {
                    showSyncIndicator('error', 'ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
                }
            } catch (error) {
                console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error', 'ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
            }
        }

        function displayTeamStatus() {
            const statusEl = document.getElementById('teamStatus');
            
            if (!teamData) {
                statusEl.innerHTML = '<p style="color: #999; text-align: center;">ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“</p>';
                return;
            }
            
            statusEl.innerHTML = 
                '<div class="team-code-display">' +
                '<div style="font-size: 0.9em; color: #666;">ç¾åœ¨ã®ãƒãƒ¼ãƒ </div>' +
                '<div style="font-size: 1.3em; font-weight: bold; color: #667eea; margin: 10px 0;">' + teamData.name + '</div>' +
                '<div style="font-size: 0.9em; color: #666;">ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰</div>' +
                '<div class="code">' + teamData.code + '</div>' +
                '<button class="primary-btn" style="background: #2ecc71; margin-top: 15px;" onclick="syncWithServer()">ä»Šã™ãåŒæœŸ</button>' +
                '<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="leaveTeam()">ãƒãƒ¼ãƒ ã‹ã‚‰é€€å‡º</button>' +
                '</div>';
        }

        function leaveTeam() {
            if (confirm('æœ¬å½“ã«ãƒãƒ¼ãƒ ã‹ã‚‰é€€å‡ºã—ã¾ã™ã‹ï¼Ÿ')) {
                teamData = null;
                saveData();
                displayTeamStatus();
                alert('âœ… ãƒãƒ¼ãƒ ã‹ã‚‰é€€å‡ºã—ã¾ã—ãŸ');
            }
        }

        document.getElementById('gameDate').valueAsDate = new Date();
        document.getElementById('teamGameDate').valueAsDate = new Date();

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(function(btn) {
                btn.classList.remove('active');
            });
            
            if (mode === 'personal') {
                document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
                document.getElementById('personalMode').style.display = 'block';
                document.getElementById('teamMode').style.display = 'none';
                displayGames();
            } else if (mode === 'team') {
                document.querySelector('.mode-btn:nth-child(2)').classList.add('active');
                document.getElementById('personalMode').style.display = 'none';
                document.getElementById('teamMode').style.display = 'block';
            }
        }

        function switchTab(tab) {
            document.querySelectorAll('#personalMode .tab').forEach(function(t) {
                t.classList.remove('active');
            });
            document.querySelectorAll('#personalMode .tab-content').forEach(function(c) {
                c.classList.remove('active');
            });
            
            const tabs = ['input', 'list', 'ranking', 'graph', 'settings'];
            const index = tabs.indexOf(tab);
            document.querySelector('#personalMode .tab:nth-child(' + (index + 1) + ')').classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'graph') updateCharts();
            if (tab === 'settings') { 
                displayPlayers(); 
                updateMyPlayerSelect();
                displayTeamStatus();
            }
            if (tab === 'ranking') displayRankings();
            if (tab === 'list') displayGames();
        }

        function changeValue(key, delta) {
            stats[key] = Math.max(0, stats[key] + delta);
            
            if (key === 'twoPointsMade' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsAttempted = stats.twoPointsMade;
            }
            if (key === 'twoPointsAttempted' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsMade = stats.twoPointsAttempted;
            }
            if (key === 'threePointsMade' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsAttempted = stats.threePointsMade;
            }
            if (key === 'threePointsAttempted' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsMade = stats.threePointsAttempted;
            }
            if (key === 'freeThrowsMade' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsAttempted = stats.freeThrowsMade;
            }
            if (key === 'freeThrowsAttempted' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsMade = stats.freeThrowsAttempted;
            }
            
            updateDisplay();
        }

        function updateDisplay() {
            Object.keys(stats).forEach(function(key) {
                const el = document.getElementById(key);
                if (el) el.textContent = stats[key];
            });
            
            const twoP = stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0';
            const threeP = stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0';
            const ft = stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0';
            const totalPoints = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            
            document.getElementById('twoPointPercentage').textContent = twoP + '%';
            document.getElementById('threePointPercentage').textContent = threeP + '%';
            document.getElementById('freeThrowPercentage').textContent = ft + '%';
            document.getElementById('totalPoints').textContent = totalPoints;
        }

        function savePersonalGame() {
            const date = document.getElementById('gameDate').value;
            if (!date) {
                alert('è©¦åˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const saveBtn = document.getElementById('saveGameBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';

            const game = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('opponent').value.trim(),
                playTime: parseInt(document.getElementById('playTime').value) || 0,
                playerId: myPlayerId,
                twoPointsMade: stats.twoPointsMade,
                twoPointsAttempted: stats.twoPointsAttempted,
                threePointsMade: stats.threePointsMade,
                threePointsAttempted: stats.threePointsAttempted,
                freeThrowsMade: stats.freeThrowsMade,
                freeThrowsAttempted: stats.freeThrowsAttempted,
                offensiveRebounds: stats.offensiveRebounds,
                defensiveRebounds: stats.defensiveRebounds,
                assists: stats.assists,
                steals: stats.steals,
                blocks: stats.blocks,
                turnovers: stats.turnovers,
                fouls: stats.fouls,
                totalRebounds: stats.offensiveRebounds + stats.defensiveRebounds,
                twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                totalPoints: (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade,
                source: 'personal'
            };

            personalGames.unshift(game);
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayGames();
            resetForm();
            
            saveBtn.disabled = false;
            saveBtn.textContent = 'è¨˜éŒ²ã‚’ä¿å­˜';
            
            alert('âœ… è©¦åˆè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        function resetForm() {
            Object.keys(stats).forEach(function(key) {
                stats[key] = 0;
            });
            document.getElementById('gameDate').valueAsDate = new Date();
            document.getElementById('opponent').value = '';
            document.getElementById('playTime').value = 0;
            updateDisplay();
        }

        function displayGames() {
            const gameList = document.getElementById('gameList');
            
            const myGames = personalGames.filter(function(g) {
                return !g.playerId || g.playerId === myPlayerId;
            });
            
            if (myGames.length === 0) {
                gameList.innerHTML = '<div class="empty-state"><div class="icon">ğŸ€</div><h3>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>æœ€åˆã®è©¦åˆã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†ï¼</p></div>';
                return;
            }

            gameList.innerHTML = myGames.map(function(g) {
                const dateObj = new Date(g.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                const sourceLabel = g.source === 'team' ? ' <span style="background: #2ecc71; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">è©¦åˆè¨˜éŒ²</span>' : '';
                
                return '<div class="game-item">' +
                    '<div class="game-date">' + dateStr + 
                    (g.opponent ? ' vs ' + g.opponent : '') + 
                    (g.playTime ? ' (' + g.playTime + 'åˆ†)' : '') + 
                    sourceLabel +
                    '</div>' +
                    '<div class="game-stats">' +
                    '<div class="stat-box"><div class="label">ç·å¾—ç‚¹</div><div class="value">' + g.totalPoints + 'ç‚¹</div></div>' +
                    '<div class="stat-box"><div class="label">2Pç‡</div><div class="value">' + g.twoPointPercentage + '%</div></div>' +
                    '<div class="stat-box"><div class="label">3Pç‡</div><div class="value">' + g.threePointPercentage + '%</div></div>' +
                    '<div class="stat-box"><div class="label">FTç‡</div><div class="value">' + g.freeThrowPercentage + '%</div></div>' +
                    '<div class="stat-box"><div class="label">ãƒªãƒã‚¦ãƒ³ãƒ‰</div><div class="value">' + g.totalRebounds + '</div></div>' +
                    '<div class="stat-box"><div class="label">ã‚¢ã‚·ã‚¹ãƒˆ</div><div class="value">' + g.assists + '</div></div>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function displayRankings() {
            const myGames = personalGames.filter(function(g) {
                return !g.playerId || g.playerId === myPlayerId;
            });
            
            if (myGames.length === 0) {
                document.getElementById('topPoints').innerHTML = '<p style="text-align: center; color: #999;">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            const topPoints = myGames.slice().sort(function(a, b) {
                return b.totalPoints - a.totalPoints;
            }).slice(0, 10);

            if (topPoints.length > 0) {
                const top = topPoints[0];
                const dateObj = new Date(top.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                let html = '<div class="top-record">' +
                    '<div class="trophy">ğŸ†</div>' +
                    '<div style="font-size: 1.2em; margin-bottom: 10px;">æœ€é«˜å¾—ç‚¹</div>' +
                    '<div class="value">' + top.totalPoints + 'ç‚¹</div>' +
                    '<div style="font-size: 1.1em; opacity: 0.95;">' + dateStr;
                
                if (top.opponent) {
                    html += '<br>vs ' + top.opponent;
                }
                
                html += '</div></div>';
                
                document.getElementById('topPoints').innerHTML = html;
            }
        }

        function updateCharts() {
            const myGames = personalGames.filter(function(g) {
                return !g.playerId || g.playerId === myPlayerId;
            });
            
            if (myGames.length === 0) return;

            const sorted = myGames.slice().reverse();
            const labels = sorted.map(function(g) {
                const d = new Date(g.date).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'});
                return g.opponent ? d + ' vs ' + g.opponent : d;
            });

            if (charts.shooting) charts.shooting.destroy();
            charts.shooting = new Chart(document.getElementById('shootingChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '2PæˆåŠŸç‡',
                        data: sorted.map(function(g) { return parseFloat(g.twoPointPercentage); }),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: '3PæˆåŠŸç‡',
                        data: sorted.map(function(g) { return parseFloat(g.threePointPercentage); }),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'FTæˆåŠŸç‡',
                        data: sorted.map(function(g) { return parseFloat(g.freeThrowPercentage); }),
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(v) { return v + '%'; } }
                        }
                    }
                }
            });
        }

        function addPlayer() {
            const num = document.getElementById('playerNumber').value;
            const name = document.getElementById('playerName').value.trim();

            if (!num || !name) { 
                alert('èƒŒç•ªå·ã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); 
                return; 
            }
            
            const exists = players.some(function(p) {
                return p.number === num;
            });
            
            if (exists) { 
                alert('ã“ã®èƒŒç•ªå·ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™'); 
                return; 
            }

            const player = { 
                id: Date.now().toString(), 
                number: num, 
                name: name 
            };
            players.push(player);
            
            if (!myPlayerId) myPlayerId = player.id;
            
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayPlayers();
            updateMyPlayerSelect();

            document.getElementById('playerNumber').value = '';
            document.getElementById('playerName').value = '';
            
            alert('âœ… ' + name + ' #' + num + ' ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
        }

        function editPlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            const newNumber = prompt('æ–°ã—ã„èƒŒç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨: #' + player.number + 'ï¼‰', player.number);
            if (newNumber === null) return;
            
            if (!newNumber || newNumber.trim() === '') {
                alert('èƒŒç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const duplicate = players.some(function(p) {
                return p.id !== playerId && p.number === newNumber.trim();
            });
            
            if (duplicate) {
                alert('ã“ã®èƒŒç•ªå·ã¯æ—¢ã«ä»–ã®é¸æ‰‹ãŒä½¿ç”¨ã—ã¦ã„ã¾ã™');
                return;
            }
            
            const newName = prompt('æ–°ã—ã„åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨: ' + player.name + 'ï¼‰', player.name);
            if (newName === null) return;
            
            if (!newName || newName.trim() === '') {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            player.number = newNumber.trim();
            player.name = newName.trim();
            
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('âœ… é¸æ‰‹æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼\n\n#' + player.number + ' ' + player.name);
        }

        function deletePlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            if (!confirm('ã€Œ#' + player.number + ' ' + player.name + 'ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ ã“ã®é¸æ‰‹ã®è©¦åˆè¨˜éŒ²ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
                return;
            }
            
            players = players.filter(function(p) {
                return p.id !== playerId;
            });
            
            personalGames = personalGames.filter(function(g) {
                return g.playerId !== playerId;
            });
            
            teamGames.forEach(function(game) {
                if (game.playerStats && game.playerStats[playerId]) {
                    delete game.playerStats[playerId];
                }
                if (game.plays) {
                    game.plays = game.plays.filter(function(play) {
                        return play.playerId !== playerId;
                    });
                }
            });
            
            if (myPlayerId === playerId) {
                myPlayerId = players.length > 0 ? players[0].id : null;
            }
            
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('âœ… é¸æ‰‹ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
        
        function changeMyPlayer() {
            myPlayerId = document.getElementById('myPlayerSelect').value || null;
            saveData();
            displayGames();
            displayRankings();
            updateCharts();
            
            if (myPlayerId) {
                const p = players.find(function(pl) {
                    return pl.id === myPlayerId;
                });
                alert('âœ… å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’ã€Œ' + p.name + ' #' + p.number + 'ã€ã«è¨­å®šã—ã¾ã—ãŸ\n\nå±¥æ­´ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ã‚°ãƒ©ãƒ•ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸï¼');
            }
        }

        function updateMyPlayerSelect() {
            const sel = document.getElementById('myPlayerSelect');
            sel.innerHTML = '<option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            players.forEach(function(p) {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name + ' #' + p.number;
                if (p.id === myPlayerId) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        function displayPlayers() {
            const playerList = document.getElementById('playerList');
            
            if (players.length === 0) {
                playerList.innerHTML = '<p style="text-align: center; color: #999;">ã¾ã é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }

            playerList.innerHTML = players.map(function(p) {
                const isMyPlayer = p.id === myPlayerId;
                
                return '<div class="player-item">' +
                    '<div class="player-info">' +
                    '<div>' +
                    '<span class="number">#' + p.number + '</span>' +
                    '<span style="font-weight: bold; margin-left: 10px;">' + p.name + '</span>' +
                    '</div>' +
                    '<div>' +
                    (isMyPlayer ? '<span class="my-data-badge">å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºä¸­</span>' : '') +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 10px; margin-top: 10px;">' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #3498db;" onclick="editPlayer(\'' + p.id + '\')">ç·¨é›†</button>' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #e74c3c;" onclick="deletePlayer(\'' + p.id + '\')">å‰Šé™¤</button>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function exportData() {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ãƒã‚¹ã‚±è¨˜éŒ²_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (confirm('âš ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™\n\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                        personalGames = data.personalGames || [];
                        teamGames = data.teamGames || [];
                        players = data.players || [];
                        myPlayerId = data.myPlayerId || null;
                        teamData = data.teamData || null;
                        saveData();
                        displayGames();
                        displayPlayers();
                        alert('âœ… ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                        location.reload();
                    }
                } catch (err) {
                    alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }

        loadData();
        updateDisplay();
        displayGames();
        displayPlayers();
        updateMyPlayerSelect();
        displayTeamStatus();
    </script>
</body>
</html>
