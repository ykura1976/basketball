<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÄ „Éê„Çπ„Ç±Ë®òÈå≤</title>
    <!-- PWA„Ç≠„É£„ÉÉ„Ç∑„É•ÂØæÁ≠ñ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- „Ç¢„Éó„É™„Éê„Éº„Ç∏„Éß„É≥ -->
    <meta name="app-version" content="37.1">
    
    <!-- PWAË®≠ÂÆö -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="„Éê„Çπ„Ç±Ë®òÈå≤">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        /* üÜï ÂêåÊúü„Ç§„É≥„Ç∏„Ç±„Éº„Çø„Éº - ÁîªÈù¢‰∏≠Â§Æ„Å´Â§ß„Åç„ÅèË°®Á§∫ */
        .sync-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px 50px;
            border-radius: 20px;
            font-size: 1.3em;
            font-weight: bold;
            z-index: 10000;
            display: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            min-width: 300px;
            text-align: center;
            animation: fadeInScale 0.3s ease-out;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .sync-indicator.syncing {
            display: block;
            color: #fff;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .sync-indicator.syncing::before {
            content: '‚è≥ ';
            font-size: 1.5em;
            display: block;
            margin-bottom: 10px;
            animation: rotate 1s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .sync-indicator.success {
            display: block;
            color: #fff;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .sync-indicator.success::before {
            content: '‚úÖ ';
            font-size: 1.5em;
            display: block;
            margin-bottom: 10px;
        }

        .sync-indicator.error {
            display: block;
            color: #fff;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .sync-indicator.error::before {
            content: '‚ö†Ô∏è ';
            font-size: 1.5em;
            display: block;
            margin-bottom: 10px;
        }

        /* üÜï ËÉåÊôØ„Ç™„Éº„Éê„Éº„É¨„Ç§ÔºàÂêåÊúü‰∏≠„ÅØ‰ªñ„ÅÆÊìç‰Ωú„ÇíÈò≤„ÅêÔºâ */
        .sync-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            z-index: 9999;
            display: none;
        }

        .sync-overlay.active {
            display: block;
        }

        .mode-switch {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid white;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
        }

        .mode-btn.active.team-mode {
            color: #f39c12;
        }

        .mode-btn.active.team-mode {
            color: #f39c12;
        }

        /* ÂÄã‰∫∫„É¢„Éº„Éâ„ÅÆÊôÇ„ÅÆÂÖ®‰ΩìËÉåÊôØ */
        body.personal-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* „ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅÆÊôÇ„ÅÆÂÖ®‰ΩìËÉåÊôØ */
        body.team-mode {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .tab-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .stepper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stepper button {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stepper button:active {
            transform: scale(0.95);
        }

        .stepper .value {
            flex: 1;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stats-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 12px;
            color: white;
            text-align: center;
        }

        .stats-display h3 {
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stats-display .percentage {
            font-size: 1.8em;
            font-weight: bold;
        }

        .stats-display .fraction {
            font-size: 0.9em;
            opacity: 0.85;
            margin-top: 5px;
            font-weight: normal;
        }

        .save-btn, .primary-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn:active, .primary-btn:active {
            transform: scale(0.98);
        }

        .save-btn:disabled, .primary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .game-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .stat-box {
            text-align: center;
            padding: 8px;
            background: #f7f7f7;
            border-radius: 8px;
        }

        .stat-box .label {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-box .value {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .fraction {
            font-size: 0.75em;
            color: #999;
            margin-top: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        input[type="date"], input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .saved-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: bold;
            z-index: 1000;
        }

        .saved-indicator.show {
            opacity: 1;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: bold;
            margin: 25px 0 15px 0;
            color: #333;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .player-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .player-btn .number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-btn .name {
            font-size: 0.85em;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.success {
            background: #2ecc71;
            color: white;
        }

        .action-btn.miss {
            background: #e0e0e0;
            color: #666;
        }

        .action-btn.other {
            background: #667eea;
            color: white;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .play-history {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: #f7f7f7;
            border-radius: 10px;
            padding: 10px;
        }

        .play-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .play-item:last-child {
            margin-bottom: 0;
        }

        .undo-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #ff4757;
            color: white;
            font-size: 0.85em;
            cursor: pointer;
        }

        .period-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            color: #666;
        }

        .period-btn.selected {
            background: #ffc107;
            color: white;
            border-color: #ffc107;
        }

        .team-code-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .team-code-display .code {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        .player-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-info .number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .my-data-badge {
            background: #2ecc71;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }

        .top-record {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .top-record .trophy {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .top-record .value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .close-modal {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            width: 100%;
            margin-top: 15px;
            font-size: 16px;
            cursor: pointer;
        }
        .ranking-medal {
            font-size: 2em;
            display: inline-block;
            width: 50px;
            text-align: center;
        }

        .ranking-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-info .rank {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }

        .ranking-info .player-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .ranking-info .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-left: 10px;
        }

        .game-history-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .game-history-item:hover {
            transform: translateY(-2px);
        }

        .game-history-item .game-date {
            font-size: 1em;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .game-history-item .game-opponent {
            font-size: 1.3em;
            font-weight: bold;
        }

        .game-detail {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .game-detail.active {
            display: block;
        }

        .ranking-section {
            margin-bottom: 30px;
        }

        .ranking-section h3 {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }

        .top3-container {
            margin-bottom: 15px;
        }

        .all-rankings {
            display: none;
            margin-top: 10px;
        }

        .all-rankings.active {
            display: block;
        }

        .toggle-rankings {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            color: #667eea;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .toggle-rankings:hover {
            background: #667eea;
            color: white;
        }

        .toggle-rankings.active {
            background: #667eea;
            color: white;
        }

        /* „Çπ„Ç≥„Ç¢ÂÖ•ÂäõÊ¨Ñ */
        .score-input-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-input-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-input-box label {
            font-size: 0.9em;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        .score-input-box input {
            width: 80px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            color: #667eea;
        }

        .score-vs {
            font-size: 1.5em;
            font-weight: bold;
            color: #999;
        }

        /* Ë©¶ÂêàÁµêÊûúË°®Á§∫ */
        .game-result {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .game-result.loss {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .game-result .result-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .game-result .result-score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .game-result .result-outcome {
            font-size: 1.3em;
            font-weight: bold;
        }

        .quarter-scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .quarter-score-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .quarter-score-item .quarter-label {
            font-size: 0.85em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .quarter-score-item .quarter-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .quarter-score-item .quarter-diff {
            font-size: 0.9em;
            margin-top: 3px;
        }

        .quarter-diff.positive {
            color: #2ecc71;
        }

        .quarter-diff.negative {
            color: #e74c3c;
        }

        /* Ë©¶ÂêàÁ∑®ÈõÜÊ©üËÉΩ */
        .edit-game-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            width: 100%;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-game-btn:hover {
            background: #e67e22;
        }

        .edit-modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .edit-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .edit-section:last-child {
            border-bottom: none;
        }

        .edit-section h3 {
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .player-stat-edit {
            background: #f7f7f7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .player-stat-edit .player-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .stat-edit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-edit-item {
            display: flex;
            flex-direction: column;
        }

        .stat-edit-item label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .stat-edit-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .save-edit-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            margin-top: 15px;
        }

        .save-edit-btn:hover {
            background: #27ae60;
        }

        .delete-game-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 0.95em;
            margin-top: 10px;
        }

        .delete-game-btn:hover {
            background: #c0392b;
        }

        /* „Éú„Çø„É≥„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes button-press {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
            100% { transform: scale(1); }
        }

        .action-btn.pressed {
            animation: button-press 0.3s ease;
        }

        /* „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü• */
        .feedback-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 10000;
            animation: fade-in-out 1s ease;
            pointer-events: none;
        }

        @keyframes fade-in-out {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .feedback-notification.success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .feedback-notification.miss {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .feedback-notification.other {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        /* ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏ÊâãË°®Á§∫ */
        .current-player-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .current-player-banner .player-icon {
            font-size: 1.5em;
        }

        .current-player-banner .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .current-player-banner .player-label {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .current-player-banner .player-name {
            font-size: 1.2em;
        }
         /* ========== ÈÅ∏ÊâãÈÅ∏Êäû„É¢„Éº„ÉÄ„É´„ÅÆ„Çπ„Çø„Ç§„É´ ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .modal-header h2 {
            font-size: 1.3em;
            color: #333;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .player-select-dropdown {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .player-select-dropdown:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .player-select-dropdown option {
            padding: 10px;
            font-size: 1em;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            padding: 20px 25px;
            border-top: 2px solid #f0f0f0;
        }
        
        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .cancel-btn {
            background: #f0f0f0;
            color: #666;
        }
        
        .cancel-btn:hover {
            background: #e0e0e0;
        }
        
        .confirm-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .confirm-btn:active {
            transform: translateY(0);
        }
        /* ========== „ÉÅ„Éº„É†ÂêçË°®Á§∫„ÅÆ„Çπ„Çø„Ç§„É´ ========== */
        .team-names {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .our-team-name {
            color: white;
            font-weight: 600;
            margin-right: 20px;
        }
        
        .vs-label {
            color: white;
            font-size: 0.75em;
            font-weight: normal;
            opacity: 0.8;
            min-width: 30px;
            text-align: center;
            padding: 0 15px;
        }
        
        .opp-team-name {
            color: white;
            font-weight: 600;
            margin-left: 20px;
        }
        /* „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„ÉàÁî®„ÅÆ„Çπ„Çø„Ç§„É´ */
        .shot-chart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .shot-chart-modal.active {
            display: flex;
        }
        
        .shot-chart-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }
        
        .court-container {
            position: relative;
            width: 300px;
            height: 400px;
            margin: 20px auto;
            background: #f5f5f5;
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: crosshair;
        }
        
        .court-canvas {
            width: 100%;
            height: 100%;
        }
        
        .shot-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .shot-marker.made {
            background: #2ecc71;
            border: 2px solid #27ae60;
        }
        
        .shot-marker.missed {
            background: #e74c3c;
            border: 2px solid #c0392b;
        }
        
        .zone-stats {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .zone-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
        }
        
        .zone-name {
            font-weight: bold;
            color: #667eea;
        }
        
        .zone-percentage {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .shot-chart-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        .shot-chart-button:hover {
            transform: scale(1.05);
        }
        /* üÜï ÈÄî‰∏≠‰øùÂ≠ò„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫ */
        .draft-status-banner {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        .draft-status-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .draft-status-icon {
            font-size: 1.5em;
        }

        .draft-status-text {
            display: flex;
            flex-direction: column;
        }

        .draft-status-label {
            font-size: 0.85em;
            opacity: 0.9;
        }

        .draft-status-time {
            font-size: 1.1em;
            font-weight: bold;
        }

        .draft-status-actions {
            display: flex;
            gap: 8px;
        }

        .draft-resume-btn {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid white;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .draft-resume-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        /* üÜï „ÇØ„Ç§„ÉÉ„ÇØÁôªÈå≤„Ç´„Éº„Éâ„ÅÆ„Çπ„Çø„Ç§„É´ */
        #quickPlayerNumber,
        #quickPlayerName {
            font-size: 1.1em;
            font-weight: bold;
        }
        
        #quickPlayerNumber:focus,
        #quickPlayerName:focus {
            border-color: #00b894;
            box-shadow: 0 0 0 3px rgba(0, 184, 148, 0.1);
        }
        /* Á∑¥Áøí„É°„Éã„É•„Éº„ÅÆ„Éú„Çø„É≥ÈÖçÁΩÆ */
    .practice-menu-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3Âàó„Å´‰∏¶„Åπ„Çã */
        gap: 10px; /* „Éú„Çø„É≥ÂêåÂ£´„ÅÆÈñìÈöî */
        margin-top: 10px;
    }
    
    /* Á∑¥Áøí„É°„Éã„É•„Éº„Éú„Çø„É≥„ÅÆ„Éá„Ç∂„Ç§„É≥ */
    .practice-menu-btn {
        padding: 15px 10px;
        border: 2px solid #ddd;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease; /* Ëâ≤„ÅåÂ§â„Çè„Çã„Å®„Åç„ÅÆÊªë„Çâ„Åã„Åï */
        text-align: center;
    }
    
    /* Á∑¥Áøí„É°„Éã„É•„Éº„Éú„Çø„É≥„Å´„Éû„Ç¶„Çπ„Çí‰πó„Åõ„Åü„Å®„Åç */
    .practice-menu-btn:hover {
        border-color: #667eea;
        background: #f0f4ff;
    }
    
    /* Á∑¥Áøí„É°„Éã„É•„Éº„Éú„Çø„É≥„ÅåÈÅ∏„Å∞„Çå„Åü„Å®„Åç */
    .practice-menu-btn.selected {
        border-color: #667eea;
        background: #667eea;
        color: white;
    }
    
    /* Ë™øÂ≠êÈÅ∏Êäû„Éú„Çø„É≥„ÅÆÈÖçÁΩÆ */
    .mood-selection {
        display: flex;
        gap: 10px;
        justify-content: space-around; /* „Éú„Çø„É≥„ÇíÂùáÁ≠â„Å´ÈÖçÁΩÆ */
        margin-top: 10px;
    }
    
    /* Ë™øÂ≠êÈÅ∏Êäû„Éú„Çø„É≥„ÅÆ„Éá„Ç∂„Ç§„É≥ */
    .mood-btn {
        flex: 1; /* „Éú„Çø„É≥„ÇíÂùáÁ≠â„Å™ÂπÖ„Å´„Åô„Çã */
        padding: 15px 10px;
        border: 2px solid #ddd;
        background: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 0.9em;
        transition: all 0.3s ease;
        text-align: center;
    }
    
    /* Ë™øÂ≠êÈÅ∏Êäû„Éú„Çø„É≥„Å´„Éû„Ç¶„Çπ„Çí‰πó„Åõ„Åü„Å®„Åç */
    .mood-btn:hover {
        border-color: #667eea;
        background: #f0f4ff;
    }
    
    /* Ë™øÂ≠êÈÅ∏Êäû„Éú„Çø„É≥„ÅåÈÅ∏„Å∞„Çå„Åü„Å®„Åç */
    .mood-btn.selected {
        border-color: #667eea;
        background: #667eea;
        color: white;
    }
    
    /* Á∑¥ÁøíÂ±•Ê≠¥„É™„Çπ„Éà„ÅÆ„Çπ„Çø„Ç§„É´ */
    #practiceHistoryList {
        margin-top: 15px;
    }
    
    /* Á∑¥ÁøíÂ±•Ê≠¥1„Å§1„Å§„ÅÆ„Ç´„Éº„Éâ */
    .practice-history-item {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
    }
    
    /* Á∑¥ÁøíÂ±•Ê≠¥„ÅÆÊó•‰ªòÈÉ®ÂàÜ */
    .practice-history-date {
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
    }
    
    /* Á∑¥ÁøíÂ±•Ê≠¥„ÅÆ„É°„Éã„É•„ÉºÈÉ®ÂàÜ */
    .practice-history-menus {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 8px;
    }
    
    /* Á∑¥Áøí„É°„Éã„É•„Éº„ÅÆ„Çø„Ç∞ */
    .practice-menu-tag {
        background: #667eea;
        color: white;
        padding: 3px 8px;
        border-radius: 5px;
        font-size: 0.8em;
    }
    
    /* Á∑¥ÁøíÂ±•Ê≠¥„ÅÆË™øÂ≠êË°®Á§∫ */
    .practice-history-mood {
        font-size: 1.2em;
        margin-bottom: 5px;
    }
    
    /* Á∑¥ÁøíÂ±•Ê≠¥„ÅÆ„É°„É¢ÈÉ®ÂàÜ */
    .practice-history-note {
        color: #666;
        font-size: 0.9em;
        font-style: italic;
        margin-top: 5px;
    }
    </style>
</head>
<body>
    <!-- ‚Üê „Åì„Åì„Åã„Çâ -->
    <div id="syncOverlay" class="sync-overlay"></div>
    <div class="sync-indicator" id="syncIndicator"></div>
    <!-- ‚Üê „Åì„Åì„Åæ„ÅßËøΩÂä†/‰øÆÊ≠£ -->
    
    <div class="container">
        <div class="header">
            <h1>üèÄ „Éê„Çπ„Ç±Ë®òÈå≤</h1>
            <p>ÊàêÈï∑„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ</p>
        </div>

        <div class="mode-switch">
           <button class="mode-btn active" onclick="switchMode('personal')">üë§ ÂÄã‰∫∫„Éá„Éº„Çø</button>
           <button class="mode-btn" onclick="switchMode('team')">‚ö° „ÉÅ„Éº„É†„Éá„Éº„Çø</button>
           <button class="mode-btn" onclick="switchMode('settings')">‚öôÔ∏è Ë®≠ÂÆö</button>
        </div>

        <div id="personalMode">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTab('input')">üìù Ë®òÈå≤</button>
                <button class="tab" onclick="switchTab('list')">üìä Ë©¶ÂêàÂ±•Ê≠¥</button>
                <button class="tab" onclick="switchTab('ranking')">üèÜ Ëá™Â∑±„Éô„Çπ„Éà</button>
                <button class="tab" onclick="switchTab('graph')">üìà „Ç∞„É©„Éï</button>
                <button class="tab" onclick="switchTab('practice')">üéØ Á∑¥Áøí</button>
            </div>

            <div id="inputTab" class="tab-content active">
                <div id="inputPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="inputPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">Êñ∞„Åó„ÅÑË©¶Âêà„ÇíË®òÈå≤</h2>
                    
                    <div class="input-group">
                        <label>Ë©¶ÂêàÊó•</label>
                        <input type="date" id="gameDate">
                    </div>

                    <div class="input-group">
                        <label>ÂØæÊà¶Áõ∏Êâã</label>
                        <input type="text" id="opponent" placeholder="Áõ∏Êâã„ÉÅ„Éº„É†Âêç„ÇíÂÖ•Âäõ">
                    </div>

                    <div class="input-group">
                        <label>„Éó„É¨„Ç§ÊôÇÈñì(ÂàÜ)</label>
                        <input type="number" id="playTime" value="0" min="0" max="200">
                    </div>

                    <div class="section-title">üèÄ „Ç∑„É•„Éº„Éà</div>
                    
                    <div class="input-group">
                        <label>2„Éù„Ç§„É≥„ÉàÊàêÂäü</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsMade', -1)">‚àí</button>
                            <div class="value" id="twoPointsMade">0</div>
                            <button onclick="changeValue('twoPointsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>2„Éù„Ç§„É≥„ÉàË©¶Êäï</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsAttempted', -1)">‚àí</button>
                            <div class="value" id="twoPointsAttempted">0</div>
                            <button onclick="changeValue('twoPointsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3„Éù„Ç§„É≥„ÉàÊàêÂäü</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsMade', -1)">‚àí</button>
                            <div class="value" id="threePointsMade">0</div>
                            <button onclick="changeValue('threePointsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3„Éù„Ç§„É≥„ÉàË©¶Êäï</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsAttempted', -1)">‚àí</button>
                            <div class="value" id="threePointsAttempted">0</div>
                            <button onclick="changeValue('threePointsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éï„É™„Éº„Çπ„É≠„ÉºÊàêÂäü</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsMade', -1)">‚àí</button>
                            <div class="value" id="freeThrowsMade">0</div>
                            <button onclick="changeValue('freeThrowsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éï„É™„Éº„Çπ„É≠„ÉºË©¶Êäï</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsAttempted', -1)">‚àí</button>
                            <div class="value" id="freeThrowsAttempted">0</div>
                            <button onclick="changeValue('freeThrowsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stats-display">
                            <h3>2PÊàêÂäüÁéá</h3>
                            <div class="percentage" id="twoPointPercentage">0%</div>
                            <div class="fraction" id="twoPointFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>3PÊàêÂäüÁéá</h3>
                            <div class="percentage" id="threePointPercentage">0%</div>
                            <div class="fraction" id="threePointFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>FTÊàêÂäüÁéá</h3>
                            <div class="percentage" id="freeThrowPercentage">0%</div>
                            <div class="fraction" id="freeThrowFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>Á∑èÂæóÁÇπ</h3>
                            <div class="percentage" id="totalPoints">0</div>
                        </div>
                    </div>

                    <div class="section-title">üéØ „É™„Éê„Ç¶„É≥„Éâ</div>

                    <div class="input-group">
                        <label>„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</label>
                        <div class="stepper">
                            <button onclick="changeValue('offensiveRebounds', -1)">‚àí</button>
                            <div class="value" id="offensiveRebounds">0</div>
                            <button onclick="changeValue('offensiveRebounds', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</label>
                        <div class="stepper">
                            <button onclick="changeValue('defensiveRebounds', -1)">‚àí</button>
                            <div class="value" id="defensiveRebounds">0</div>
                            <button onclick="changeValue('defensiveRebounds', 1)">+</button>
                        </div>
                    </div>

                    <div class="section-title">üìä „Åù„ÅÆ‰ªñ„ÅÆÁµ±Ë®à</div>

                    <div class="input-group">
                        <label>„Ç¢„Ç∑„Çπ„Éà</label>
                        <div class="stepper">
                            <button onclick="changeValue('assists', -1)">‚àí</button>
                            <div class="value" id="assists">0</div>
                            <button onclick="changeValue('assists', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Çπ„ÉÜ„Ç£„Éº„É´</label>
                        <div class="stepper">
                            <button onclick="changeValue('steals', -1)">‚àí</button>
                            <div class="value" id="steals">0</div>
                            <button onclick="changeValue('steals', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éñ„É≠„ÉÉ„ÇØ</label>
                        <div class="stepper">
                            <button onclick="changeValue('blocks', -1)">‚àí</button>
                            <div class="value" id="blocks">0</div>
                            <button onclick="changeValue('blocks', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Çø„Éº„É≥„Ç™„Éº„Éê„Éº</label>
                        <div class="stepper">
                            <button onclick="changeValue('turnovers', -1)">‚àí</button>
                            <div class="value" id="turnovers">0</div>
                            <button onclick="changeValue('turnovers', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>„Éï„Ç°„Ç¶„É´</label>
                        <div class="stepper">
                            <button onclick="changeValue('fouls', -1)">‚àí</button>
                            <div class="value" id="fouls">0</div>
                            <button onclick="changeValue('fouls', 1)">+</button>
                        </div>
                    </div>

                    <button class="save-btn" id="saveGameBtn" onclick="savePersonalGame()">Ë®òÈå≤„Çí‰øùÂ≠ò</button>
                </div>
            </div>

            <div id="listTab" class="tab-content">
                <div id="listPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="listPlayerName"></span>
                    </div>
                </div>
                <div id="gameList"></div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div id="rankingPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="rankingPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">üèÜ „Éô„Çπ„Éà„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ</h2>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                        ÈÅ∏Êäû„Åó„ÅüÈÅ∏Êâã„ÅÆËá™Â∑±„Éô„Çπ„ÉàË®òÈå≤„Åß„Åô
                    </p>
                    <div id="topPoints"></div>
                </div>
            </div>

            <div id="graphTab" class="tab-content">
                <div id="graphPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="graphPlayerName"></span>
                    </div>
                </div>
                
                
                
                <div class="card">
                    <h2 style="margin-bottom: 20px;">„Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„ÅÆÊé®Áßª</h2>
                    <div class="chart-container">
                        <canvas id="shootingChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Á∑¥Áøí„Çø„Éñ -->
            <div id="practiceTab" class="tab-content">
                <!--ÈÅ∏Êâã„Éê„Éä„Éº -->
                <div id="practicePlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">üë§</span>
                    <div class="player-info">
                        <span class="player-label">ÁèæÂú®Ë°®Á§∫‰∏≠</span>
                        <span class="player-name" id="practicePlayerName"></span>
                    </div>
                </div>
                <!--„Åì„Åì„Åæ„ÅßËøΩÂä† -->
                <!-- ==================== Week 7-8: „É¨„Éô„É´„ÉªXPË°®Á§∫„Ç®„É™„Ç¢ ËøΩÂä†ÈñãÂßã ==================== -->
                
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                                        color: white; 
                                        text-align: center;">
                    <!-- „É¨„Éô„É´Ë°®Á§∫ -->
                    <div style="font-size: 48px; 
                                font-weight: bold; 
                                margin-bottom: 10px;
                                text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                        ‚≠ê Lv.<span id="userLevelDisplay">1</span>
                    </div>
                    
                    <!-- XPË°®Á§∫ -->
                    <div style="font-size: 20px; 
                                margin-bottom: 20px;
                                opacity: 0.95;">
                        <span id="userXPDisplay">0</span> XP
                    </div>
                    
                    <!-- „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº -->
                    <div style="background: rgba(255,255,255,0.25);
                                height: 25px;
                                border-radius: 12px;
                                overflow: hidden;
                                margin-bottom: 12px;
                                box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);">
                        <div id="xpProgressBar" 
                             style="background: linear-gradient(90deg, #4CAF50 0%, #8BC34A 100%);
                                    height: 100%;
                                    width: 0%;
                                    transition: width 0.5s ease;
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    font-weight: bold;
                                    font-size: 14px;">
                            <span id="xpProgressText">0%</span>
                        </div>
                    </div>
                    
                    <!-- Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÆÊÉÖÂ†± -->
                    <div style="font-size: 15px; 
                                opacity: 0.9;
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                gap: 10px;">
                        <span>Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß</span>
                        <span id="xpToNextLevel" 
                              style="font-size: 18px; 
                                     font-weight: bold;
                                     color: #FFD700;">
                            „ÅÇ„Å® 100 XP
                        </span>
                    </div>
                </div>
                
                <!-- ==================== Week 7-8: „É¨„Éô„É´„ÉªXPË°®Á§∫„Ç®„É™„Ç¢ ËøΩÂä†ÁµÇ‰∫Ü ==================== -->
                
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <div style="display: flex; justify-content: space-around; align-items: center;">
                        <div style="text-align: center;">
                            <div style="font-size: 3em;">üî•</div>
                            <div style="font-size: 2em; font-weight: bold;" id="currentStreakDisplay">0</div>
                            <div style="font-size: 0.9em;">Êó•ÈÄ£Á∂ö</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em;">üèÜ</div>
                            <div style="font-size: 1.5em; font-weight: bold;" id="longestStreakDisplay">0</div>
                            <div style="font-size: 0.9em;">ÊúÄÈï∑Ë®òÈå≤</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2em;">‚≠ê</div>
                            <div style="font-size: 1.5em; font-weight: bold;" id="totalXPDisplay">0</div>
                            <div style="font-size: 0.9em;">XP</div>
                        </div>
                    </div>
                </div>

                <!--  „Åì„Åì„Åã„Çâ„Ç´„É¨„É≥„ÉÄ„ÉºË°®Á§∫„Ç´„Éº„Éâ„ÇíËøΩÂä†  -->
                <div class="card">
                    <h3>üìÖ ÊúÄËøë„ÅÆÁ∑¥ÁøíË®òÈå≤</h3>
                    <div id="practiceCalendar" style="display: flex; gap: 5px; justify-content: center; margin-top: 15px;"></div>
                </div>
                <!--  „Åì„Åì„Åæ„ÅßËøΩÂä†  -->
                
                <div class="card">
                    <h2>üìù ‰ªäÊó•„ÅÆÁ∑¥Áøí„ÇíË®òÈå≤„Åó„Çà„ÅÜ!</h2>
                    <p style="color: #666; margin-bottom: 20px;">30Áßí„ÅßÂÆå‰∫Ü!Á∑¥Áøí„ÇíË®òÈå≤„Åó„Å¶ÁøíÊÖ£Âåñ„Åó„Çà„ÅÜ</p>
                    
                    <!-- Êó•‰ªòÂÖ•Âäõ -->
                    <div class="input-group">
                        <label>üìÖ Êó•‰ªò</label>
                        <input type="date" id="practiceDate" value="">
                    </div>
                    
                    <!-- Á∑¥Áøí„É°„Éã„É•„ÉºÈÅ∏Êäû -->
                    <div class="input-group">
                        <label>üèÄ ‰ªäÊó•„ÇÑ„Å£„ÅüÁ∑¥Áøí(Ë§áÊï∞ÈÅ∏ÊäûOK!)</label>
                        <div class="practice-menu-grid">
                            <button class="practice-menu-btn" data-menu="shoot" onclick="togglePracticeMenu(this)">
                                üèÄ<br>„Ç∑„É•„Éº„Éà
                            </button>
                            <button class="practice-menu-btn" data-menu="dribble" onclick="togglePracticeMenu(this)">
                                ‚ö°<br>„Éâ„É™„Éñ„É´
                            </button>
                            <button class="practice-menu-btn" data-menu="pass" onclick="togglePracticeMenu(this)">
                                ü§ù<br>„Éë„Çπ
                            </button>
                            <button class="practice-menu-btn" data-menu="defense" onclick="togglePracticeMenu(this)">
                                üõ°Ô∏è<br>„Éá„Ç£„Éï„Çß„É≥„Çπ
                            </button>
                            <button class="practice-menu-btn" data-menu="fitness" onclick="togglePracticeMenu(this)">
                                üí™<br>‰ΩìÂäõ
                            </button>
                            <button class="practice-menu-btn" data-menu="other" onclick="togglePracticeMenu(this)">
                                üìã<br>„Åù„ÅÆ‰ªñ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ‰ªäÊó•„ÅÆË™øÂ≠ê -->
                    <div class="input-group">
                        <label>üòä ‰ªäÊó•„ÅÆË™øÂ≠ê„ÅØ„Å©„ÅÜ„Å†„Å£„Åü?</label>
                        <div class="mood-selection">
                            <button class="mood-btn" data-mood="good" onclick="selectMood(this)">
                                üòä<br>ËâØ„Åã„Å£„Åü
                            </button>
                            <button class="mood-btn" data-mood="normal" onclick="selectMood(this)">
                                üòê<br>ÊôÆÈÄö
                            </button>
                            <button class="mood-btn" data-mood="bad" onclick="selectMood(this)">
                                üò¢<br>„Ç§„Éû„Ç§„ÉÅ
                            </button>
                        </div>
                    </div>
                    
                    <!-- „Å≤„Å®„Åì„Å®Êó•Ë®ò(‰ªªÊÑè) -->
                    <div class="input-group">
                        <label>üí¨ „Å≤„Å®„Åì„Å®Êó•Ë®ò(Êõ∏„ÅÑ„Å¶„ÇÇÊõ∏„Åã„Å™„Åè„Å¶„ÇÇOK!)</label>
                        <textarea id="practiceNote" placeholder="‰æã: 3P„Åå10Êú¨‰∏≠7Êú¨Ê±∫„Åæ„Å£„Åü!&#10;‰æã: Â∑¶Êâã„ÅÆ„Éâ„É™„Éñ„É´„Åå‰∏äÊâã„Åè„Å™„Å£„Å¶„Åç„Åü" rows="3"></textarea>
                    </div>
                    
                    <!-- Á∑¥ÁøíÊôÇÈñì(‰ªªÊÑè) -->
                    <div class="input-group">
                        <label>‚è±Ô∏è Á∑¥ÁøíÊôÇÈñì(ÂàÜ) - ‰ªªÊÑè</label>
                        <input type="number" id="practiceDuration" min="0" max="300" placeholder="‰æã: 60">
                    </div>
                    
                    <!-- ‰øùÂ≠ò„Éú„Çø„É≥ -->
                    <button class="primary-btn" onclick="savePracticeRecord()">
                        ‚úÖ ‰øùÂ≠ò„Åó„Å¶ +10XP Áç≤Âæó!
                    </button>
                </div>
                
                <!-- Á∑¥ÁøíÂ±•Ê≠¥ -->
                <div class="card">
                    <h2>üìä ÊúÄËøë„ÅÆÁ∑¥ÁøíË®òÈå≤</h2>
                    <div id="practiceHistoryList"></div>
                </div>
            </div>
            
        </div>
        <div id="settingsMode" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">üîÑ „ÉÅ„Éº„É†Âàá„ÇäÊõø„Åà</h2>
                    <div id="teamListContainer"></div>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        üí° „ÉÅ„Éº„É†„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®„ÄÅ„Åù„ÅÆ„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„Å´Âàá„ÇäÊõø„Çè„Çä„Åæ„Åô
                    </p>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">üîó „ÉÅ„Éº„É†ÈÄ£Êê∫</h2>
                    <div id="teamStatus"></div>
                    
                    <button class="primary-btn" style="margin-bottom: 10px;" onclick="showCreateTeamModal()">
                        üÜï Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†„Çí‰ΩúÊàê
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="showJoinTeamModal()">
                        üëã „ÉÅ„Éº„É†„Å´ÂèÇÂä†
                    </button>
                    
                    <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 0.9em; color: #1976d2;">
                        üí° <strong>„ÉÅ„Éº„É†Ê©üËÉΩ:</strong> Ë®òÈå≤‰øÇ1‰∫∫„ÅåÂÖ®ÈÅ∏Êâã„ÇíË®òÈå≤‚ÜíÂÖ®Âì°„ÅÆ„Çπ„Éû„Éõ„Å´Ëá™ÂãïÂêåÊúü
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">üë§ ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫Ë®≠ÂÆö</h2>
                    <div class="input-group">
                        <label>ÂÄã‰∫∫„É¢„Éº„Éâ„ÅßË°®Á§∫„Åô„ÇãÈÅ∏Êâã</label>
                        <select id="myPlayerSelect" onchange="changeMyPlayer()">
                            <option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        </select>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        ÈÅ∏Êäû„Åó„ÅüÈÅ∏Êâã„ÅÆÂÄã‰∫∫ÊàêÁ∏æ„ÅåÂ±•Ê≠¥„Éª„É©„É≥„Ç≠„É≥„Ç∞„Éª„Ç∞„É©„Éï„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô
                    </p>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">üë• ÈÅ∏ÊâãÁôªÈå≤</h2>
                    <div class="input-group">
                        <label>ËÉåÁï™Âè∑</label>
                        <input type="number" id="playerNumber" placeholder="‰æã: 7" min="0" max="99">
                    </div>
                    <div class="input-group">
                        <label>ÂêçÂâç</label>
                        <input type="text" id="playerName" placeholder="‰æã: Â±±Áî∞ Ëä±Â≠ê">
                    </div>
                    <button class="primary-btn" style="margin-top: 15px;" onclick="addPlayer()">ÈÅ∏Êâã„ÇíËøΩÂä†</button>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ÁôªÈå≤Ê∏à„ÅøÈÅ∏Êâã</h2>
                    <div id="playerList"></div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">üì• „Éá„Éº„ÇøÁÆ°ÁêÜ</h2>
                    <button class="primary-btn" style="background: #2ecc71; margin-bottom: 10px;" onclick="exportData()">
                        üíæ „Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="document.getElementById('importFile').click()">
                        üìÇ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„ÇâÂæ©ÂÖÉ
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
             <button class="primary-btn" style="background: #3498db; margin-top: 10px;" onclick="confirmClearLocalData()">
    üóëÔ∏è „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
</button>

<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="confirmResetTeamData()">
    ‚ö†Ô∏è „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà
</button>
                    
                </div>
            </div>
        <div id="teamMode" style="display: none;">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTeamTab('record')">‚ö° Ë®òÈå≤</button>
                <button class="tab" onclick="switchTeamTab('history')">üìä Â±•Ê≠¥</button>
                <button class="tab" onclick="switchTeamTab('ranking')">üìà „É©„É≥„Ç≠„É≥„Ç∞</button>
            </div>

            <div id="teamRecordTab">
            <div class="card">
                <h2 style="margin-bottom: 20px;">‚ö° Ë©¶ÂêàË®òÈå≤</h2>
                
                <div class="input-group">
                    <label>Ë©¶ÂêàÊó•</label>
                    <input type="date" id="teamGameDate">
                </div>

                <div class="input-group">
                    <label>ÂØæÊà¶Áõ∏Êâã</label>
                    <input type="text" id="teamOpponent" placeholder="Áõ∏Êâã„ÉÅ„Éº„É†Âêç„ÇíÂÖ•Âäõ">
                </div>

                <button class="primary-btn" onclick="startTeamGame()">Ë©¶ÂêàÈñãÂßã</button>
            </div>

            <div id="teamRecording" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 15px;">„Éî„É™„Ç™„Éâ„ÇíÈÅ∏Êäû</h2>
                    <div class="period-selector">
                        <div class="period-btn selected" onclick="selectPeriod(1)" id="period1">1Q</div>
                        <div class="period-btn" onclick="selectPeriod(2)" id="period2">2Q</div>
                        <div class="period-btn" onclick="selectPeriod(3)" id="period3">3Q</div>
                        <div class="period-btn" onclick="selectPeriod(4)" id="period4">4Q</div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="font-size: 1em; color: #666; margin-bottom: 10px;">„Åì„ÅÆ„ÇØ„Ç©„Éº„Çø„Éº„ÅÆÂæóÁÇπ</h3>
                        <div class="score-input-container">
                            <div class="score-input-box">
                                <label>Ëá™„ÉÅ„Éº„É†</label>
                                <input type="number" id="ourScoreInput" min="0" max="99" value="0" onchange="updateQuarterScore(currentPeriod, 'our')">
                            </div>
                            <div class="score-vs">-</div>
                            <div class="score-input-box">
                                <label>Áõ∏Êâã</label>
                                <input type="number" id="oppScoreInput" min="0" max="99" value="0" onchange="updateQuarterScore(currentPeriod, 'opp')">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">ÈÅ∏Êâã„ÇíÈÅ∏Êäû</h2>
                    <div id="playerSelector" class="player-grid"></div>
                </div>

                <!-- üÜï Ë©¶Âêà‰∏≠„ÅÆÈÅ∏Êâã„ÇØ„Ç§„ÉÉ„ÇØÁôªÈå≤ -->
                    <div class="card" style="background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                            <span style="font-size: 1.5em;">‚ö°</span>
                            <h2 style="margin: 0;">ÈÅ∏Êâã„ÇØ„Ç§„ÉÉ„ÇØÁôªÈå≤</h2>
                        </div>
                        <p style="font-size: 0.9em; color: #666; margin-bottom: 15px;">
                            Ë©¶Âêà‰∏≠„Å´ÂèÇÂä†„Åó„ÅüÈÅ∏Êâã„Çí„Åô„Åê„Å´ÁôªÈå≤„Åß„Åç„Åæ„Åô
                        </p>
                        
                        <div class="input-group">
                            <label>ËÉåÁï™Âè∑</label>
                            <input type="number" id="quickPlayerNumber" placeholder="‰æã: 7" min="0" max="99">
                        </div>

                        <div class="input-group">
                            <label>ÂêçÂâç</label>
                            <input type="text" id="quickPlayerName" placeholder="‰æã: Â±±Áî∞Â§™ÈÉé">
                        </div>

                        <button class="primary-btn" style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); margin-top: 10px;" onclick="quickAddPlayer()">
                            ‚ö° „Åô„Åê„Å´ÁôªÈå≤„Åó„Å¶ÈÅ∏Êäû
                        </button>
                    </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">„Éó„É¨„Ç§„ÇíË®òÈå≤</h2>
                        <button class="primary-btn" style="background: #3498db; padding: 8px 16px; font-size: 0.9em;" onclick="openGlossary()">
                            ‚ùì Áî®Ë™ûËß£Ë™¨
                        </button>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn success" onclick="recordPlay('2p-made')">2PÊàêÂäü</button>
                        <button class="action-btn miss" onclick="recordPlay('2p-miss')">2PÂ§±Êïó</button>
                        <button class="action-btn success" onclick="recordPlay('3p-made')">3PÊàêÂäü</button>
                        <button class="action-btn miss" onclick="recordPlay('3p-miss')">3PÂ§±Êïó</button>
                        <button class="action-btn success" onclick="recordPlay('ft-made')">FTÊàêÂäü</button>
                        <button class="action-btn miss" onclick="recordPlay('ft-miss')">FTÂ§±Êïó</button>
                        <button class="action-btn other" onclick="recordPlay('oreb')">„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</button>
                        <button class="action-btn other" onclick="recordPlay('dreb')">„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ</button>
                        <button class="action-btn other" onclick="recordPlay('ast')">„Ç¢„Ç∑„Çπ„Éà</button>
                        <button class="action-btn other" onclick="recordPlay('stl')">„Çπ„ÉÜ„Ç£„Éº„É´</button>
                        <button class="action-btn other" onclick="recordPlay('blk')">„Éñ„É≠„ÉÉ„ÇØ</button>
                        <button class="action-btn other" onclick="recordPlay('to')">„Çø„Éº„É≥„Ç™„Éº„Éê„Éº</button>
                        <button class="action-btn other" onclick="recordPlay('foul')">„Éï„Ç°„Ç¶„É´</button>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; margin-bottom: 15px;">
                        <button class="primary-btn" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); padding: 15px; box-shadow: 0 4px 12px rgba(243, 156, 18, 0.3);" onclick="saveDraftTeamGame()">
                            üíæ ÈÄî‰∏≠‰øùÂ≠ò
                        </button>
                        <button class="save-btn" style="background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); padding: 15px; box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);" onclick="saveTeamGame()">
                            ‚úÖ Ë©¶ÂêàÁµÇ‰∫Ü„Éª‰øùÂ≠ò
                        </button>
                    </div>
                    
                    <div class="play-history" id="playHistory">
                        <div style="text-align: center; color: #999; font-size: 0.9em;">„Éó„É¨„Ç§Â±•Ê≠¥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">Ë©¶ÂêàÁµ±Ë®à</h2>
                    <div id="teamStats"></div>
                    
                    
                </div>
            </div>
     </div>
     <div id="teamHistoryTab" style="display: none;">
         <div id="teamGamesList"></div>
     </div>
     <div id="teamRankingTab" style="display: none;">
         <div id="teamRankingsDisplay"></div>
     </div>
        </div>
    </div>

    <div id="createTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">üÜï „ÉÅ„Éº„É†„Çí‰ΩúÊàê</h2>
            <div class="input-group">
                <label>„ÉÅ„Éº„É†Âêç</label>
                <input type="text" id="newTeamName" placeholder="‰æã: „Åï„Åè„Çâ„Éê„Çπ„Ç±ÈÉ®">
            </div>
            <button class="primary-btn" onclick="createTeam()">‰ΩúÊàê</button>
            <button class="close-modal" onclick="closeModal('createTeamModal')">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>

    <div id="joinTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">üëã „ÉÅ„Éº„É†„Å´ÂèÇÂä†</h2>
            <div class="input-group">
                <label>„ÉÅ„Éº„É†„Ç≥„Éº„Éâ</label>
                <input type="text" id="joinTeamCode" placeholder="6Ê°Å„ÅÆ„Ç≥„Éº„Éâ" maxlength="6">
            </div>
            <button class="primary-btn" onclick="joinTeam()">ÂèÇÂä†</button>
            <button class="close-modal" onclick="closeModal('joinTeamModal')">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>
  <div id="glossaryModal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 class="modal-title">üìö „Éê„Çπ„Ç±Áî®Ë™ûËß£Ë™¨</h2>
            
            <div style="text-align: left;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #2ecc71; margin-top: 0;">‚úÖ ÊàêÂäü„Éó„É¨„Ç§</h3>
                    
                    <p style="margin: 10px 0;"><strong>2PÊàêÂäü(„ÉÑ„Éº„Éù„Ç§„É≥„ÉàÊàêÂäü)</strong><br>
                    2ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂÖ•„Å£„Åü„Å®„Åç„ÄÇ„Ç¥„Éº„É´„Å´Ëøë„ÅÑÂ†¥ÊâÄ„Åã„Çâ„ÅÆ„Ç∑„É•„Éº„Éà„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>3PÊàêÂäü(„Çπ„É™„Éº„Éù„Ç§„É≥„ÉàÊàêÂäü)</strong><br>
                    3ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂÖ•„Å£„Åü„Å®„Åç„ÄÇ3ÁÇπ„É©„Ç§„É≥„ÅÆÂ§ñÂÅ¥„Åã„Çâ„ÅÆ„Ç∑„É•„Éº„Éà„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>FTÊàêÂäü(„Éï„É™„Éº„Çπ„É≠„ÉºÊàêÂäü)</strong><br>
                    „Éï„É™„Éº„Çπ„É≠„Éº(1ÁÇπ)„ÅåÂÖ•„Å£„Åü„Å®„Åç„ÄÇ„Éï„Ç°„Ç¶„É´„Åï„Çå„ÅüÂæå„ÅÆÁÑ°Â¶®ÂÆ≥„Ç∑„É•„Éº„Éà„ÄÇ</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #95a5a6; margin-top: 0;">‚ùå Â§±Êïó„Éó„É¨„Ç§</h3>
                    
                    <p style="margin: 10px 0;"><strong>2PÂ§±Êïó</strong><br>
                    2ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>3PÂ§±Êïó</strong><br>
                    3ÁÇπ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>FTÂ§±Êïó</strong><br>
                    „Éï„É™„Éº„Çπ„É≠„Éº„ÅåÂ§ñ„Çå„Åü„Å®„Åç„ÄÇ</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #3498db; margin-top: 0;">üìä „Åù„ÅÆ‰ªñ„ÅÆË®òÈå≤</h3>
                    
                    <p style="margin: 10px 0;"><strong>„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ(ÊîªÊíÉ„É™„Éê„Ç¶„É≥„Éâ)</strong><br>
                    Âë≥Êñπ„ÅÆ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„ÅüÂæå„ÄÅËá™ÂàÜ„ÅÆ„ÉÅ„Éº„É†„ÅåÂÜç„Å≥„Éú„Éº„É´„ÇíÂèñ„Å£„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ(ÂÆàÂÇô„É™„Éê„Ç¶„É≥„Éâ)</strong><br>
                    Áõ∏Êâã„ÅÆ„Ç∑„É•„Éº„Éà„ÅåÂ§ñ„Çå„ÅüÂæå„ÄÅ„Éú„Éº„É´„ÇíÂèñ„Å£„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Ç¢„Ç∑„Çπ„Éà</strong><br>
                    „Éë„Çπ„ÇíÂá∫„Åó„Å¶„ÄÅ„Åù„ÅÆ„Éë„Çπ„ÇíÂèó„Åë„ÅüÂë≥Êñπ„Åå„Ç∑„É•„Éº„Éà„ÇíÊ±∫„ÇÅ„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Çπ„ÉÜ„Ç£„Éº„É´</strong><br>
                    Áõ∏Êâã„Åã„Çâ„Éú„Éº„É´„ÇíÂ•™„Å£„Åü„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Éñ„É≠„ÉÉ„ÇØ</strong><br>
                    Áõ∏Êâã„ÅÆ„Ç∑„É•„Éº„Éà„ÇíÊâã„ÅßÈò≤„ÅÑ„Å†„Å®„Åç„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Çø„Éº„É≥„Ç™„Éº„Éê„Éº</strong><br>
                    „Éú„Éº„É´„ÇíÂ§±„Å£„Åü„Å®„Åç„ÄÇ„Éë„Çπ„Éü„Çπ„ÄÅ„Éâ„É™„Éñ„É´„Éü„Çπ„ÄÅÁõ∏Êâã„Å´Â•™„Çè„Çå„Åü„Å®„Åç„Å™„Å©„ÄÇ</p>
                    
                    <p style="margin: 10px 0;"><strong>„Éï„Ç°„Ç¶„É´</strong><br>
                    ÂèçÂâá„Çí„Åó„Åü„Å®„Åç„ÄÇÁõ∏Êâã„ÇíÊäº„Åô„ÄÅÂè©„Åè„ÄÅ‰∏çÊ≠£„Å™„Éñ„É≠„ÉÉ„ÇØ„Å™„Å©„ÄÇ</p>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #f39c12; margin-top: 0;">üí° Ë®òÈå≤„ÅÆ„Ç≥„ÉÑ</h3>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Ëø∑„Å£„Åü„ÇâË®òÈå≤„Åó„Å™„ÅÑ„Çà„Çä„ÄÅË®òÈå≤„Åó„ÅüÊñπ„Åå„ÅÑ„ÅÑ</li>
                        <li>ÈñìÈÅï„Åà„Åü„Çâ„Äå„Éó„É¨„Ç§Â±•Ê≠¥„Äç„Åã„ÇâÂâäÈô§„Åß„Åç„Çã</li>
                        <li>„Ç∑„É•„Éº„Éà„ÅØ„ÄåÊàêÂäü„Äç„Åæ„Åü„ÅØ„ÄåÂ§±Êïó„Äç„ÅÆ‰∏°Êñπ„ÇíÂøÖ„ÅöË®òÈå≤</li>
                        <li>„É™„Éê„Ç¶„É≥„Éâ„ÅØË™∞„ÅåÂèñ„Å£„Åü„Åã„ÅåÈáçË¶Å</li>
                    </ul>
                </div>
            </div>
            
            <button class="primary-btn" onclick="closeModal('glossaryModal')">Èñâ„Åò„Çã</button>
        </div>
    </div>

    <!-- Ë©¶ÂêàÁ∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="editGameModal" class="modal">
        <div class="modal-content edit-modal-content">
            <h2 class="modal-title">üîí Ë©¶ÂêàË®òÈå≤„ÇíÁ∑®ÈõÜ</h2>
            
            <div class="edit-section">
                <h3>üìÖ Ë©¶ÂêàÊÉÖÂ†±</h3>
                <div class="input-group">
                    <label>Ë©¶ÂêàÊó•</label>
                    <input type="date" id="editGameDate">
                </div>
                <div class="input-group">
                    <label>ÂØæÊà¶Áõ∏Êâã</label>
                    <input type="text" id="editOpponent" placeholder="Áõ∏Êâã„ÉÅ„Éº„É†Âêç">
                </div>
            </div>

            <div class="edit-section">
                <h3>üèÄ Ë©¶Âêà„Çπ„Ç≥„Ç¢</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div class="input-group">
                        <label>Q1 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ1" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q1 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ1" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q2 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ2" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q2 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ2" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q3 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ3" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q3 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ3" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q4 Ëá™„ÉÅ„Éº„É†</label>
                        <input type="number" id="editOurQ4" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q4 Áõ∏Êâã</label>
                        <input type="number" id="editOppQ4" min="0" max="99" value="0">
                    </div>
                </div>
            </div>

            <div class="edit-section" id="editPlayersSection">
                <h3>üë• ÈÅ∏ÊâãÁµ±Ë®à</h3>
                <div id="editPlayersList"></div>
            </div>

            <button class="save-edit-btn" onclick="saveGameEdit()">‚úÖ Â§âÊõ¥„Çí‰øùÂ≠ò</button>
            <button class="delete-game-btn" onclick="deleteGame()">üóëÔ∏è „Åì„ÅÆË©¶Âêà„ÇíÂâäÈô§</button>
            <button class="close-modal" onclick="closeModal('editGameModal')">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    </div>
    
    <div class="saved-indicator" id="savedIndicator">‚úì ‰øùÂ≠ò„Åó„Åæ„Åó„Åü</div>

    <script>
        // ========== „Éê„Éº„Ç∏„Éß„É≥ÁÆ°ÁêÜ„Å®„Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ ==========
        const APP_VERSION = '37.2';
        
        (function checkAppVersion() {
            const STORED_VERSION = localStorage.getItem('appVersion');
            
            if (STORED_VERSION !== APP_VERSION) {
                console.log('üîÑ Êñ∞„Åó„ÅÑ„Éê„Éº„Ç∏„Éß„É≥„ÇíÊ§úÂá∫:', STORED_VERSION, '‚Üí', APP_VERSION);
                
                if ('caches' in window) {
                    caches.keys().then(function(cacheNames) {
                        return Promise.all(
                            cacheNames.map(function(cacheName) {
                                console.log('üóëÔ∏è „Ç≠„É£„ÉÉ„Ç∑„É•„ÇíÂâäÈô§:', cacheName);
                                return caches.delete(cacheName);
                            })
                        );
                    }).then(function() {
                        console.log('‚úÖ „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢ÂÆå‰∫Ü');
                    }).catch(function(error) {
                        console.warn('‚ö†Ô∏è „Ç≠„É£„ÉÉ„Ç∑„É•„ÇØ„É™„Ç¢„Ç®„É©„Éº:', error);
                    });
                }
                
                localStorage.setItem('appVersion', APP_VERSION);
                
                if (STORED_VERSION) {
                    console.log('üîÑ „Ç¢„Éó„É™„ÇíÊõ¥Êñ∞‰∏≠...');
                    setTimeout(function() {
                        window.location.reload(true);
                    }, 1000);
                    return;
                } else {
                    console.log('‚úÖ ÂàùÂõûËµ∑Âãï');
                }
            } else {
                console.log('‚úÖ ÊúÄÊñ∞„Éê„Éº„Ç∏„Éß„É≥:', APP_VERSION);
            }
        })();
        const API_URL = 'https://script.google.com/macros/s/AKfycbwbPUgd-QAVhwBmhyBwiCtS1GDvZks0imrC78ZsJu5dV-d-Zt6reEW0oi1Lkc_MbW_agQ/exec';
        
        let currentMode = 'personal';
        // „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„ÉàÈñ¢ÈÄ£„ÅÆÂ§âÊï∞
        let currentShotPosition = null;
        let shotChartCallback = null;

        let practiceRecords = [];
        let userProfile = {
            totalXP: 0,        // ÂêàË®àÁµåÈ®ìÂÄ§(ÊúÄÂàù„ÅØ0)
            level: 1,            // „É¨„Éô„É´(ÊúÄÂàù„ÅØ1)
            currentStreak: 0,    // ÈÄ£Á∂öË®òÈå≤Êó•Êï∞(ÊúÄÂàù„ÅØ0)
            longestStreak: 0,    // ÊúÄÈï∑ÈÄ£Á∂öË®òÈå≤(ÊúÄÂàù„ÅØ0)
            lastPracticeDate: null    // ÊúÄÂæå„ÅÆÁ∑¥ÁøíÊó•(ÊúÄÂàù„ÅØÁÑ°„Åó)
        };
        
        // „Ç≥„Éº„ÉàÂõ≥„ÇíÊèèÁîª„Åô„ÇãÈñ¢Êï∞
        function drawCourt(canvas) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // ËÉåÊôØ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // „Ç®„É™„Ç¢Â¢ÉÁïåÂÄ§
            const paintTop = height * 0.25;      // 100px
            const midRangeTop = height * 0.6;    // 240px - „Åì„Çå„ÅØÂâäÈô§‰∫àÂÆö
            const centerLine = height / 2;       // 200px - „Çª„É≥„Çø„Éº„É©„Ç§„É≥
            const paintLeft = width * 0.2;       // 60px
            const paintRight = width * 0.8;      // 240px
            const topLeft = width * 0.4;         // 120px
            const topRight = width * 0.6;        // 180px
            
            // ‚òÖ‚òÖ‚òÖ „Ç®„É™„Ç¢Ëâ≤ÂàÜ„Åë - „Çª„É≥„Çø„Éº„É©„Ç§„É≥„Åæ„Åß ‚òÖ‚òÖ‚òÖ
            
            // 1. „Éö„Ç§„É≥„Éà„Ç®„É™„Ç¢(ËñÑ„ÅÑ„Éî„É≥„ÇØ)
            ctx.fillStyle = 'rgba(255, 182, 193, 0.3)';
            ctx.fillRect(paintLeft, 10, paintRight - paintLeft, paintTop - 10);

            
            // 2. Â∑¶„Ç≥„Éº„Éä„Éº(Á∑ë)
            ctx.fillStyle = 'rgba(52, 168, 83, 0.15)';
            ctx.fillRect(10, 10, paintLeft - 10, paintTop - 10);
            
            // 3. Âè≥„Ç≥„Éº„Éä„Éº(Á∑ë)
            ctx.fillStyle = 'rgba(52, 168, 83, 0.15)';
            ctx.fillRect(paintRight, 10, width - 10 - paintRight, paintTop - 10);
            
            // 4. Â∑¶„Ç¶„Ç£„É≥„Ç∞(„Ç™„É¨„É≥„Ç∏) - „Çª„É≥„Çø„Éº„É©„Ç§„É≥„Åæ„Åß
            ctx.fillStyle = 'rgba(251, 188, 5, 0.15)';
            ctx.fillRect(10, paintTop, topLeft - 10, centerLine - paintTop);
            
            // 5. Âè≥„Ç¶„Ç£„É≥„Ç∞(„Ç™„É¨„É≥„Ç∏) - „Çª„É≥„Çø„Éº„É©„Ç§„É≥„Åæ„Åß
            ctx.fillStyle = 'rgba(251, 188, 5, 0.15)';
            ctx.fillRect(topRight, paintTop, width - 10 - topRight, centerLine - paintTop);
            
            // 6. „Éà„ÉÉ„Éó - „Éü„ÉÉ„Éâ„É¨„É≥„Ç∏ÈÉ®ÂàÜ(Á¥´) - „Çª„É≥„Çø„Éº„É©„Ç§„É≥„Åæ„Åß
            ctx.fillStyle = 'rgba(142, 68, 173, 0.15)';
            ctx.fillRect(topLeft, paintTop, topRight - topLeft, centerLine - paintTop);
            
            // ‚òÖ‚òÖ‚òÖ 7Áï™ÁõÆ„ÅÆ„Äå„Éà„ÉÉ„Éó - 3P„É©„Ç§„É≥ÈÉ®ÂàÜ„Äç„ÅØÂâäÈô§! ‚òÖ‚òÖ‚òÖ
            // „Çª„É≥„Çø„Éº„É©„Ç§„É≥„Çà„Çä‰∏ã„ÅØËâ≤„Çí‰ªò„Åë„Å™„ÅÑ
            
            // „Ç≥„Éº„Éà„É©„Ç§„É≥
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.strokeRect(10, 10, width - 20, height - 20);
            
            ctx.beginPath();
            ctx.moveTo(width * 0.2, 10);
            ctx.lineTo(width * 0.3, height * 0.25);
            ctx.lineTo(width * 0.7, height * 0.25);
            ctx.lineTo(width * 0.8, 10);
            ctx.closePath();
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(width / 2, 10, width * 0.45, 0, Math.PI);
            ctx.stroke();
            
            ctx.beginPath();
            ctx.arc(width / 2, 10, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#e74c3c';
            ctx.fill();
            
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(10, height / 2);
            ctx.lineTo(width - 10, height / 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // „Ç®„É™„Ç¢Âêç
            ctx.fillStyle = '#666';
            ctx.font = 'bold 11px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('„Éö„Ç§„É≥„Éà', width / 2, 70);
            ctx.fillText('Â∑¶', width * 0.15, 40);
            ctx.fillText('„Ç≥„Éº„Éä„Éº', width * 0.15, 55);
            ctx.fillText('Âè≥', width * 0.85, 40);
            ctx.fillText('„Ç≥„Éº„Éä„Éº', width * 0.85, 55);
            ctx.fillText('Â∑¶', width * 0.23, 155);
            ctx.fillText('„Ç¶„Ç£„É≥„Ç∞', width * 0.23, 170);
            ctx.fillText('Âè≥', width * 0.77, 155);
            ctx.fillText('„Ç¶„Ç£„É≥„Ç∞', width * 0.77, 170);
            ctx.fillText('„Éà„ÉÉ„Éó', width / 2, 170);
        }
        
        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„Åå„Å©„ÅÆ„Ç®„É™„Ç¢„Å´Â±û„Åô„Çã„ÅãÂà§ÂÆö„Åô„ÇãÈñ¢Êï∞
        function getZoneFromPosition(x, y, width, height) {
            // CanvasÂØ∏Ê≥ï: width=300, height=400
            // ‰∏ªË¶Å„Å™Â¢ÉÁïåÂÄ§„ÇíÂÆöÁæ©
            const paintTop = height * 0.25;        // 100px - „Éö„Ç§„É≥„Éà„Ç®„É™„Ç¢„ÅÆ‰∏ãÁ´Ø
            const midRangeTop = height * 0.6;      // 240px - „Éü„ÉÉ„Éâ„É¨„É≥„Ç∏„ÅÆ‰∏ãÁ´Ø
            const threePointTop = height * 0.75;   // 300px - 3P„É©„Ç§„É≥„ÅÆ‰∏ãÁ´Ø
            
            const paintLeft = width * 0.2;         // 60px - „Éö„Ç§„É≥„Éà„Ç®„É™„Ç¢„ÅÆÂ∑¶Á´Ø
            const paintRight = width * 0.8;        // 240px - „Éö„Ç§„É≥„Éà„Ç®„É™„Ç¢„ÅÆÂè≥Á´Ø
            
            const topLeft = width * 0.4;           // 120px - „Éà„ÉÉ„Éó„Ç®„É™„Ç¢„ÅÆÂ∑¶Á´Ø
            const topRight = width * 0.6;          // 180px - „Éà„ÉÉ„Éó„Ç®„É™„Ç¢„ÅÆÂè≥Á´Ø
            
            // 1. „Éö„Ç§„É≥„Éà„Ç®„É™„Ç¢ & „Ç≥„Éº„Éä„Éº (Y < 100px)
            if (y < paintTop) {
                if (x >= paintLeft && x <= paintRight) {
                    return 'paint';        // „Éö„Ç§„É≥„Éà„Ç®„É™„Ç¢(‰∏≠Â§Æ)
                } else if (x < paintLeft) {
                    return 'left_corner';  // Â∑¶„Ç≥„Éº„Éä„Éº
                } else {
                    return 'right_corner'; // Âè≥„Ç≥„Éº„Éä„Éº
                }
            }
            
            // 2. „Éü„ÉÉ„Éâ„É¨„É≥„Ç∏„Ç®„É™„Ç¢ (100px < Y < 240px)
            if (y < midRangeTop) {
                if (x >= topLeft && x <= topRight) {
                    return 'top';          // „Éà„ÉÉ„Éó(‰∏≠Â§Æ)
                } else if (x < topLeft) {
                    return 'left_wing';    // Â∑¶„Ç¶„Ç£„É≥„Ç∞
                } else {
                    return 'right_wing';   // Âè≥„Ç¶„Ç£„É≥„Ç∞
                }
            }
            
            // 3. 3P„É©„Ç§„É≥„Ç®„É™„Ç¢ (240px < Y < 300px)
            if (y < threePointTop) {
                return 'top';              // „Éà„ÉÉ„Éó(3P„É©„Ç§„É≥Âë®Ëæ∫„ÅØ‰∏≠Â§ÆÊâ±„ÅÑ)
            }
            
            // 4. „Éê„ÉÉ„ÇØ„Ç≥„Éº„Éà (Y > 300px)
            return 'backcourt';
        }
        
        // „Ç®„É™„Ç¢Âêç„ÇíÊó•Êú¨Ë™û„Å´Â§âÊèõ
        function getZoneNameJP(zone) {
            const names = {
                'paint': '„Éö„Ç§„É≥„Éà',
                'left_corner': 'Â∑¶„Ç≥„Éº„Éä„Éº',
                'right_corner': 'Âè≥„Ç≥„Éº„Éä„Éº',
                'left_wing': 'Â∑¶„Ç¶„Ç£„É≥„Ç∞',
                'right_wing': 'Âè≥„Ç¶„Ç£„É≥„Ç∞',
                'top': '„Éà„ÉÉ„Éó',
                'backcourt': '„Éê„ÉÉ„ÇØ„Ç≥„Éº„Éà'
            };
            return names[zone] || zone;
        }
        let personalGames = [];
        let teamGames = [];
        let players = [];
        let myPlayerId = null;
        let teamData = null;
        let charts = {};
        let allTeamsData = {};  // ÂÖ®„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åô„ÇãÁÆ±
        let currentTeamCode = null;  // ‰ªäÈÅ∏„Çì„Åß„ÅÑ„Çã„ÉÅ„Éº„É†„ÅÆ„Ç≥„Éº„Éâ
        
        let stats = {
            twoPointsMade: 0, twoPointsAttempted: 0,
            threePointsMade: 0, threePointsAttempted: 0,
            freeThrowsMade: 0, freeThrowsAttempted: 0,
            offensiveRebounds: 0, defensiveRebounds: 0,
            assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
        };

        let currentTeamGame = null;
        let draftTeamGame = null;
        let selectedPlayer = null;
        let currentPeriod = 1;

        function showSyncIndicator(status, message) {
            const indicator = document.getElementById('syncIndicator');
            const overlay = document.getElementById('syncOverlay');
            
            // üÜï „É°„ÉÉ„Çª„Éº„Ç∏„ÇíÂàÜ„Åã„Çä„ÇÑ„Åô„ÅèÊï¥ÂΩ¢
            let displayMessage = message;
            
            if (status === 'syncing') {
                displayMessage = message || 'Âá¶ÁêÜ‰∏≠„Åß„Åô...\n„Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ';
                
                // üÜï „Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíË°®Á§∫Ôºà‰ªñ„ÅÆÊìç‰Ωú„ÇíÈò≤„ÅêÔºâ
                if (overlay) {
                    overlay.classList.add('active');
                }
            } else {
                // üÜï ÂÆå‰∫ÜÊôÇ„ÅØ„Ç™„Éº„Éê„Éº„É¨„Ç§„ÇíÈùûË°®Á§∫
                if (overlay) {
                    overlay.classList.remove('active');
                }
            }
            
            indicator.className = 'sync-indicator ' + status;
            indicator.textContent = displayMessage;
            
            // üÜï ÊàêÂäü„Éª„Ç®„É©„ÉºÊôÇ„ÅØ3ÁßíÂæå„Å´Ëá™Âãï„ÅßÊ∂à„Åô
            if (status === 'success' || status === 'error') {
                setTimeout(function() {
                    indicator.className = 'sync-indicator';
                    if (overlay) {
                        overlay.classList.remove('active');
                    }
                }, 3000);
            }
        }

        function loadData() {
            try {
                // „Çπ„ÉÜ„ÉÉ„Éó1: ÂÖ®„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
                const savedAllTeams = localStorage.getItem('allTeamsData');
                if (savedAllTeams) {
                    allTeamsData = JSON.parse(savedAllTeams);
                }
                
                // „Çπ„ÉÜ„ÉÉ„Éó2: ‰ªäÈÅ∏„Çì„Åß„ÅÑ„Çã„ÉÅ„Éº„É†„ÅÆ„Ç≥„Éº„Éâ„ÇíË™≠„ÅøËæº„ÇÄ
                const savedCurrentTeam = localStorage.getItem('currentTeamCode');
                if (savedCurrentTeam) {
                    currentTeamCode = savedCurrentTeam;
                }
                
                // „Çπ„ÉÜ„ÉÉ„Éó3: ‰ªäÈÅ∏„Çì„Åß„ÅÑ„Çã„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
                if (currentTeamCode && allTeamsData[currentTeamCode]) {
                    const data = allTeamsData[currentTeamCode];
                    personalGames = data.personalGames || [];
                    teamGames = data.teamGames || [];
                    players = data.players || [];
                    myPlayerId = data.myPlayerId || null;
                    teamData = data.teamInfo || null;
                    draftTeamGame = data.draftTeamGame || null;
                    
                    // ‚≠ê‚≠ê‚≠ê „Åì„Åì„Å´2Ë°åËøΩÂä† ‚≠ê‚≠ê‚≠ê
                    practiceRecords = data.practiceRecords || [];
                    userProfile = data.userProfile || {
                        totalXP: 0,
                        level: 1,
                        currentStreak: 0,
                        longestStreak: 0,
                        lastPracticeDate: null
                    };
                    // ‚≠ê‚≠ê‚≠ê „Åì„Åì„Åæ„ÅßËøΩÂä† ‚≠ê‚≠ê‚≠ê
                    
                    // ÈÅ∏„Çì„Åß„ÅÑ„ÇãÈÅ∏Êâã„ÅåÂ≠òÂú®„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    if (myPlayerId && players.length > 0) {
                        const playerExists = players.find(function(p) {
                            return p.id === myPlayerId;
                        });
                        
                        if (!playerExists) {
                            console.warn('ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÊúÄÂàù„ÅÆÈÅ∏Êâã„ÇíËá™ÂãïÈÅ∏Êäû„Åó„Åæ„Åô„ÄÇ');
                            myPlayerId = players[0].id;
                            saveData();
                        }
                    }
                } else {
                    // „ÉÅ„Éº„É†„ÅåÈÅ∏„Å∞„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÄÅÁ©∫„Å£„ÅΩ„Å´„Åô„Çã
                    personalGames = [];
                    teamGames = [];
                    players = [];
                    myPlayerId = null;
                    teamData = null;
                    draftTeamGame = null;
                    
                    // ‚≠ê‚≠ê‚≠ê „Åì„Åì„Å´„ÇÇ2Ë°åËøΩÂä† ‚≠ê‚≠ê‚≠ê
                    practiceRecords = [];
                    userProfile = {
                        totalXP: 0,
                        level: 1,
                        currentStreak: 0,
                        longestStreak: 0,
                        lastPracticeDate: null
                    };
                    // ‚≠ê‚≠ê‚≠ê „Åì„Åì„Åæ„ÅßËøΩÂä† ‚≠ê‚≠ê‚≠ê
                }
                
                // „Çπ„ÉÜ„ÉÉ„Éó4: Âè§„ÅÑ„Éá„Éº„Çø„Åå„ÅÇ„Å£„Åü„ÇâÊñ∞„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ„Åô„Çã
                migrateOldData();
                
            } catch (e) {
                console.error('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', e);
            }
        }
        
        function saveData() {
            try {
                // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£: currentTeamCode„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆÂá¶ÁêÜ„ÇíËøΩÂä† ‚òÖ‚òÖ‚òÖ
                if (!currentTeamCode) {
                    console.warn('‚ö†Ô∏è currentTeamCode„ÅåÊú™Ë®≠ÂÆö„Åß„Åô');
                    
                    // teamData„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØ„ÄÅ„Åù„ÅÆ„Ç≥„Éº„Éâ„Çí‰Ωø„ÅÜ
                    if (teamData && teamData.code) {
                        console.log('üìù teamData„Åã„ÇâcurrentTeamCode„ÇíË®≠ÂÆö:', teamData.code);
                        currentTeamCode = teamData.code;
                    } else {
                        console.warn('‚ùå ‰øùÂ≠ò„Åß„Åç„Åæ„Åõ„Çì: „ÉÅ„Éº„É†„Ç≥„Éº„Éâ„Åå‰∏çÊòé');
                        return;
                    }
                }
                
                console.log('üíæ „Éá„Éº„Çø‰øùÂ≠ò‰∏≠:', currentTeamCode);
                
                // ‰ªäÈÅ∏„Çì„Åß„ÅÑ„Çã„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„ÇíÊõ¥Êñ∞„Åô„Çã
                allTeamsData[currentTeamCode] = {
                    personalGames: personalGames,
                    teamGames: teamGames,
                    players: players,
                    myPlayerId: myPlayerId,
                    teamInfo: teamData,
                    draftTeamGame: draftTeamGame,
                    practiceRecords: practiceRecords,
                    userProfile: userProfile,
                    lastModified: new Date().toISOString()
                };
                
                // ÂÖ®„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„Çí‰øùÂ≠ò
                localStorage.setItem('allTeamsData', JSON.stringify(allTeamsData));
                localStorage.setItem('currentTeamCode', currentTeamCode);
                
                console.log('‚úÖ ‰øùÂ≠òÂÆå‰∫Ü');
                showSavedIndicator();
            } catch (e) {
                console.error('‚ùå „Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:', e);
            }
        }

        // ========== „ÉÅ„Éº„É†Âàá„ÇäÊõø„ÅàÈñ¢Êï∞ ==========
        function switchTeam(teamCode) {
            console.log('üîÑ „ÉÅ„Éº„É†Âàá„ÇäÊõø„ÅàÈñãÂßã:', teamCode);
            if (!teamCode) {
                console.error('„ÉÅ„Éº„É†„Ç≥„Éº„Éâ„ÅåÊåáÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            console.log('üîÑ „ÉÅ„Éº„É†Âàá„ÇäÊõø„ÅàÈñãÂßã:', teamCode);
            
            // „Çπ„ÉÜ„ÉÉ„Éó1: ‰ªä„ÅÆ„Éá„Éº„Çø„Çí‰øùÂ≠ò
            if (currentTeamCode) {
                saveData();
            }
            
            // „Çπ„ÉÜ„ÉÉ„Éó2: Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†„Å´Âàá„ÇäÊõø„Åà
            currentTeamCode = teamCode;
            localStorage.setItem('currentTeamCode', teamCode);
            
            // „Çπ„ÉÜ„ÉÉ„Éó3: Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„ÇÄ
            if (allTeamsData[teamCode]) {
                const data = allTeamsData[teamCode];
                personalGames = data.personalGames || [];
                teamGames = data.teamGames || [];
                players = data.players || [];
                myPlayerId = data.myPlayerId || null;
                teamData = data.teamInfo || null;
                draftTeamGame = data.draftTeamGame || null;

                // Á∑¥ÁøíË®òÈå≤„Å®„É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç°„Ç§„É´„ÇÇË™≠„ÅøËæº„ÇÄ
                practiceRecords = data.practiceRecords || [];
                userProfile = data.userProfile || {
                    totalXP: 0,
                    level: 1,
                    currentStreak: 0,
                    longestStreak: 0,
                    lastPracticeDate: null
                };
                
                console.log('‚úÖ „ÉÅ„Éº„É†„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');
                console.log('  ÈÅ∏ÊâãÊï∞:', players.length);
                console.log('  ÂÄã‰∫∫Ë©¶ÂêàÊï∞:', personalGames.length);
                console.log('  „ÉÅ„Éº„É†Ë©¶ÂêàÊï∞:', teamGames.length);
            } else {
                // Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†„ÅÆÂ†¥Âêà„ÄÅÁ©∫„Å£„ÅΩ„Å´„Åô„Çã
                console.log('‚ö†Ô∏è Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†Ôºà„Éá„Éº„Çø„Å™„ÅóÔºâ');
                allTeamsData[teamCode] = {
                    personalGames: [],
                    teamGames: [],
                    players: [],
                    myPlayerId: null,
                    teamInfo: null,
                    draftTeamGame: null
                };
                personalGames = [];
                teamGames = [];
                players = [];
                myPlayerId = null;
                teamData = null;
                draftTeamGame = null;

                practiceRecords = [];
                userProfile = {
                    totalXP: 0,
                    level: 1,
                    currentStreak: 0,
                    longestStreak: 0,
                    lastPracticeDate: null
                };
            }
            
            // „Çπ„ÉÜ„ÉÉ„Éó4: „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
            
            // „Çπ„ÉÜ„ÉÉ„Éó5: ÁîªÈù¢„ÇíÊõ¥Êñ∞ÔºàÈ†ÜÁï™„ÅåÈáçË¶ÅÔºâ
            console.log('üîÑ ÁîªÈù¢Êõ¥Êñ∞ÈñãÂßã...');
            
            // 5-1: ÈÅ∏Êâã„É™„Çπ„Éà„ÇíÊõ¥Êñ∞
            if (typeof displayPlayers === 'function') {
                displayPlayers();
                console.log('  ‚úÖ displayPlayersÂÆå‰∫Ü');
            }
            
            // 5-2: ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫Ë®≠ÂÆö„ÇíÊõ¥Êñ∞
            if (typeof updateMyPlayerSelect === 'function') {
                updateMyPlayerSelect();
                console.log('  ‚úÖ updateMyPlayerSelectÂÆå‰∫Ü');
            }
            
            // 5-3: ÂÄã‰∫∫„Çø„Éñ„ÅÆË©¶ÂêàÂ±•Ê≠¥„ÇíÊõ¥Êñ∞
            if (typeof displayGames === 'function') {
                displayGames();
                console.log('  ‚úÖ displayGamesÂÆå‰∫Ü');
            }
            
            // 5-4: „É©„É≥„Ç≠„É≥„Ç∞„ÇíÊõ¥Êñ∞
            if (typeof displayRankings === 'function') {
                displayRankings();
                console.log('  ‚úÖ displayRankingsÂÆå‰∫Ü');
            }
            
            // 5-5: „Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
            if (typeof updateCharts === 'function') {
                updateCharts();
                console.log('  ‚úÖ updateChartsÂÆå‰∫Ü');
            }
            
            // 5-6: „ÉÅ„Éº„É†ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            if (typeof displayTeamStatus === 'function') {
                displayTeamStatus();
                console.log('  ‚úÖ displayTeamStatusÂÆå‰∫Ü');
            }
            
            // 5-7: „ÉÅ„Éº„É†‰∏ÄË¶ß„ÇíÊõ¥Êñ∞
            if (typeof displayTeamList === 'function') {
                displayTeamList();
                console.log('  ‚úÖ displayTeamListÂÆå‰∫Ü');
            }
            
            // 5-8: „ÉÅ„Éº„É†„Çø„Éñ„ÅÆÂ±•Ê≠¥„ÇíÊõ¥Êñ∞
            if (typeof displayTeamGamesHistory === 'function') {
                displayTeamGamesHistory();
                console.log('  ‚úÖ displayTeamGamesHistoryÂÆå‰∫Ü');
            }
            
            // 5-9: ÈÅ∏Êâã„Éê„Éä„Éº„ÇíÊõ¥Êñ∞
            if (typeof updatePlayerBanners === 'function') {
                updatePlayerBanners();
                console.log('  ‚úÖ updatePlayerBannersÂÆå‰∫Ü');
            }
            
            console.log('‚úÖ ÁîªÈù¢Êõ¥Êñ∞ÂÆå‰∫Ü');
            alert('‚úÖ „ÉÅ„Éº„É†Âàá„ÇäÊõø„ÅàÂÆå‰∫Ü!');
        }

        // ========== Âè§„ÅÑ„Éá„Éº„Çø„ÇíÊñ∞„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ„Åô„ÇãÈñ¢Êï∞ ==========
        function migrateOldData() {
            try {
                const oldData = localStorage.getItem('basketballData');
                if (oldData) {
                    const data = JSON.parse(oldData);
                    
                    // Âè§„ÅÑ„Éá„Éº„Çø„Åå„ÅÇ„Çä„ÄÅ„ÉÅ„Éº„É†ÊÉÖÂ†±„Åå„ÅÇ„ÇãÂ†¥Âêà
                    if (data.teamData && data.teamData.code) {
                        const oldTeamCode = data.teamData.code;
                        
                        // „Åæ„Å†Â§âÊèõ„Åó„Å¶„ÅÑ„Å™„ÅÑ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                        if (!allTeamsData[oldTeamCode]) {
                            console.log('Âè§„ÅÑ„Éá„Éº„Çø„ÇíÊñ∞„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ„Åó„Åæ„Åô:', oldTeamCode);
                            
                            // Âè§„ÅÑ„Éá„Éº„Çø„ÇíÊñ∞„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ
                            allTeamsData[oldTeamCode] = {
                                personalGames: data.personalGames || [],
                                teamGames: data.teamGames || [],
                                players: data.players || [],
                                myPlayerId: data.myPlayerId || null,
                                teamInfo: data.teamData,
                                draftTeamGame: data.draftTeamGame || null,
                                practiceRecords: data.practiceRecords || [],
                                userProfile: data.userProfile || {
                                    totalXP: 0,
                                    level: 1,
                                    currentStreak: 0,
                                    longestStreak: 0,
                                    lastPracticeDate: null
                                },
                                lastModified: new Date().toISOString()
                            };
                            
                            // ‰ªäÈÅ∏„Çì„Åß„ÅÑ„Çã„ÉÅ„Éº„É†„Å´Ë®≠ÂÆö
                            currentTeamCode = oldTeamCode;
                            
                            // Â§âÊï∞„ÇÇÊõ¥Êñ∞
                            personalGames = allTeamsData[oldTeamCode].personalGames;
                            teamGames = allTeamsData[oldTeamCode].teamGames;
                            players = allTeamsData[oldTeamCode].players;
                            myPlayerId = allTeamsData[oldTeamCode].myPlayerId;
                            teamData = allTeamsData[oldTeamCode].teamInfo;
                            draftTeamGame = allTeamsData[oldTeamCode].draftTeamGame;
                            practiceRecords = allTeamsData[oldTeamCode].practiceRecords;
                            userProfile = allTeamsData[oldTeamCode].userProfile;
                            
                            // Êñ∞„Åó„ÅÑÂΩ¢Âºè„Åß‰øùÂ≠ò
                            localStorage.setItem('allTeamsData', JSON.stringify(allTeamsData));
                            localStorage.setItem('currentTeamCode', currentTeamCode);
                            
                            // Âè§„ÅÑ„Éá„Éº„Çø„ÇíÂâäÈô§
                            localStorage.removeItem('basketballData');
                            
                            console.log('‚úÖ „Éá„Éº„ÇøÂ§âÊèõÂÆå‰∫Ü');
                        }
                    } else if (data.players && data.players.length > 0) {
                        // „ÉÅ„Éº„É†ÊÉÖÂ†±„ÅåÁÑ°„ÅÑ„ÅåÈÅ∏Êâã„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà
                        // ‚Üí „ÉÄ„Éü„Éº„ÅÆ„ÉÅ„Éº„É†„Ç≥„Éº„Éâ„ÇíÁîüÊàê
                        console.warn('‚ö†Ô∏è „ÉÅ„Éº„É†ÊÉÖÂ†±„ÅåÁÑ°„ÅÑ„Éá„Éº„Çø„ÇíÁô∫Ë¶ã„ÄÇ„ÉÄ„Éü„Éº„ÉÅ„Éº„É†„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ');
                        const dummyCode = 'LOCAL' + Date.now().toString().substr(-6);
                        
                        allTeamsData[dummyCode] = {
                            personalGames: data.personalGames || [],
                            teamGames: data.teamGames || [],
                            players: data.players || [],
                            myPlayerId: data.myPlayerId || null,
                            teamInfo: {
                                name: '„É≠„Éº„Ç´„É´„ÉÅ„Éº„É†',
                                code: dummyCode
                            },
                            draftTeamGame: data.draftTeamGame || null,
                            practiceRecords: data.practiceRecords || [],
                            userProfile: data.userProfile || {
                                totalXP: 0,
                                level: 1,
                                currentStreak: 0,
                                longestStreak: 0,
                                lastPracticeDate: null
                            },
                            lastModified: new Date().toISOString()
                        };
                        
                        currentTeamCode = dummyCode;
                        teamData = allTeamsData[dummyCode].teamInfo;
                        personalGames = allTeamsData[dummyCode].personalGames;
                        teamGames = allTeamsData[dummyCode].teamGames;
                        players = allTeamsData[dummyCode].players;
                        myPlayerId = allTeamsData[dummyCode].myPlayerId;
                        draftTeamGame = allTeamsData[dummyCode].draftTeamGame;
                        practiceRecords = allTeamsData[dummyCode].practiceRecords;
                        userProfile = allTeamsData[dummyCode].userProfile;
                        
                        localStorage.setItem('allTeamsData', JSON.stringify(allTeamsData));
                        localStorage.setItem('currentTeamCode', currentTeamCode);
                        localStorage.removeItem('basketballData');
                        
                        console.log('‚úÖ „É≠„Éº„Ç´„É´„ÉÅ„Éº„É†‰ΩúÊàêÂÆå‰∫Ü:', dummyCode);
                    }
                }
            } catch (e) {
                console.error('„Éá„Éº„ÇøÂ§âÊèõ„Ç®„É©„Éº:', e);
            }
        }

        // ========== „ÉÅ„Éº„É†‰∏ÄË¶ß„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞ ==========
        function displayTeamList() {
            const container = document.getElementById('teamListContainer');
            if (!container) return;
            
            const teamCodes = Object.keys(allTeamsData);
            
            if (teamCodes.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">„ÉÅ„Éº„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            let html = '<div style="margin-top: 15px;">';
            html += '<h4 style="color: #667eea; margin-bottom: 10px;">üèÄ ÂèÇÂä†„ÉÅ„Éº„É†‰∏ÄË¶ß</h4>';
            
            teamCodes.forEach(function(code) {
                const team = allTeamsData[code];
                const isActive = code === currentTeamCode;
                const teamInfo = team.teamInfo || {};
                const teamName = teamInfo.name || '„ÉÅ„Éº„É†';
                
                html += `
                    <div style="
                        padding: 12px;
                        margin-bottom: 8px;
                        background: ${isActive ? '#e8f0fe' : '#f5f5f5'};
                        border: 2px solid ${isActive ? '#667eea' : '#ddd'};
                        border-radius: 8px;
                        cursor: pointer;
                    " onclick="switchTeam('${code}')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: bold; color: #333;">
                                    ${isActive ? '‚úÖ ' : ''}${teamName}
                                </div>
                                <div style="font-size: 0.85em; color: #666; margin-top: 4px;">
                                    „Ç≥„Éº„Éâ: ${code}
                                </div>
                                <div style="font-size: 0.75em; color: #999; margin-top: 2px;">
                                    ÈÅ∏Êâã: ${team.players ? team.players.length : 0}Âêç | 
                                    Ë©¶Âêà: ${team.teamGames ? team.teamGames.length : 0}‰ª∂
                                </div>
                            </div>
                            ${isActive ? '<div style="color: #667eea; font-size: 1.5em;">‚óè</div>' : ''}
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.classList.add('show');
            setTimeout(function() {
                indicator.classList.remove('show');
            }, 2000);
        }

        
        function startTeamGame() {
            // ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà„ÅØË≠¶Âëä
            if (draftTeamGame) {
                if (!confirm('‚ö†Ô∏è Êú™ÂÆå‰∫Ü„ÅÆË©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô\n\nÊñ∞„Åó„ÅÑË©¶Âêà„ÇíÈñãÂßã„Åô„Çã„Å®„ÄÅÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ\nÁ∂ö„Åë„Åæ„Åô„Åã?')) {
                    return;
                }
            }
            
            if (players.length === 0) { 
                alert('ÂÖà„Å´ÈÅ∏Êâã„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ(Ë®≠ÂÆö„Çø„Éñ)'); 
                return; 
            }

            const date = document.getElementById('teamGameDate').value;
            if (!date) { 
                alert('Ë©¶ÂêàÊó•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); 
                return; 
            }

            currentTeamGame = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('teamOpponent').value.trim(),
                plays: [],
                playerStats: {},
                scores: {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                }
            };

            players.forEach(function(p) {
                currentTeamGame.playerStats[p.id] = {
                    twoPointsMade: 0, twoPointsAttempted: 0,
                    threePointsMade: 0, threePointsAttempted: 0,
                    freeThrowsMade: 0, freeThrowsAttempted: 0,
                    offensiveRebounds: 0, defensiveRebounds: 0,
                    assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
                };
            });

            currentPeriod = 1;
            selectPeriod(1);
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
            updateDraftStatusDisplay();
        }

        function displayPlayerSelector() {
            const sel = document.getElementById('playerSelector');
            sel.innerHTML = players.map(function(p) {
                const isSelected = selectedPlayer === p.id;
                return '<div class="player-btn' + (isSelected ? ' selected' : '') + '" onclick="selectPlayer(\'' + p.id + '\')">' +
                    '<div class="number">#' + p.number + '</div>' +
                    '<div class="name">' + p.name + '</div>' +
                    '</div>';
            }).join('');
        }

        function selectPlayer(id) {
            selectedPlayer = id;
            displayPlayerSelector();
        }

        function selectPeriod(period) {
            currentPeriod = period;
            
            // „Éî„É™„Ç™„Éâ„Éú„Çø„É≥„ÅÆË¶ã„ÅüÁõÆ„ÇíÊõ¥Êñ∞
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById('period' + i);
                if (i === period) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            }
            
            // „Çπ„Ç≥„Ç¢ÂÖ•ÂäõÊ¨Ñ„ÅÆÂÄ§„ÇíÊõ¥Êñ∞(ID„ÅØÂõ∫ÂÆö)
            const ourScoreInput = document.querySelector('.score-input-container input[id^="ourScore"]');
            const oppScoreInput = document.querySelector('.score-input-container input[id^="oppScore"]');
            
            if (ourScoreInput && oppScoreInput) {
                // onchange„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö„ÅóÁõ¥„Åó
                ourScoreInput.onchange = function() { updateQuarterScore(period, 'our'); };
                oppScoreInput.onchange = function() { updateQuarterScore(period, 'opp'); };
                
                // ÁèæÂú®„ÅÆ„ÇØ„Ç©„Éº„Çø„Éº„ÅÆ„Çπ„Ç≥„Ç¢„ÇíË°®Á§∫
                if (currentTeamGame && currentTeamGame.scores) {
                    ourScoreInput.value = currentTeamGame.scores.our['q' + period] || 0;
                    oppScoreInput.value = currentTeamGame.scores.opp['q' + period] || 0;
                }
            }
        }

        function updateQuarterScore(quarter, team) {
            if (!currentTeamGame) return;
            
            const inputId = team === 'our' ? 'ourScoreInput' : 'oppScoreInput';
            const value = parseInt(document.getElementById(inputId).value) || 0;
            
            currentTeamGame.scores[team]['q' + quarter] = value;
        }

        function getPlayLabel(type) {
            const labels = {
                '2p-made': '2PÊàêÂäü', '2p-miss': '2PÂ§±Êïó',
                '3p-made': '3PÊàêÂäü', '3p-miss': '3PÂ§±Êïó',
                'ft-made': 'FTÊàêÂäü', 'ft-miss': 'FTÂ§±Êïó',
                'oreb': '„Ç™„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ', 'dreb': '„Éá„Ç£„Éï„Çß„É≥„Çπ„É™„Éê„Ç¶„É≥„Éâ',
                'ast': '„Ç¢„Ç∑„Çπ„Éà', 'stl': '„Çπ„ÉÜ„Ç£„Éº„É´', 'blk': '„Éñ„É≠„ÉÉ„ÇØ',
                'to': '„Çø„Éº„É≥„Ç™„Éº„Éê„Éº', 'foul': '„Éï„Ç°„Ç¶„É´'
            };
            return labels[type] || type;
        }

        function recordPlay(type) {
            if (!selectedPlayer || !currentPeriod) {
                alert('ÈÅ∏Êâã„Å®„ÇØ„Ç©„Éº„Çø„Éº„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!currentTeamGame) {
                alert('Ë©¶Âêà„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // „Ç∑„É•„Éº„ÉàÁ≥ª„ÅÆ„Éó„É¨„Ç§„ÅÆÂ†¥Âêà„ÅØ‰ΩçÁΩÆ„ÇíË®òÈå≤
            const shotTypes = ['2p-made', '2p-miss', '3p-made', '3p-miss'];
            
            if (shotTypes.includes(type)) {
                // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
                openShotPositionModal(function(position) {
                    // ‰ΩçÁΩÆÊÉÖÂ†±„Å®ÂÖ±„Å´„Éó„É¨„Ç§„ÇíË®òÈå≤
                    recordPlayWithPosition(type, position);
                });
            } else {
                // „Ç∑„É•„Éº„Éà‰ª•Â§ñ„ÅØ„Åù„ÅÆ„Åæ„ÅæË®òÈå≤
                recordPlayWithPosition(type, null);
            }
        }
        
        // ‰ΩçÁΩÆÊÉÖÂ†±‰ªò„Åç„Åß„Éó„É¨„Ç§„ÇíË®òÈå≤„Åô„ÇãÊñ∞„Åó„ÅÑÈñ¢Êï∞
        function recordPlayWithPosition(type, position) {
            if (!currentTeamGame) {
                alert('Ë©¶Âêà„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const play = {
                playType: type,
                playerId: selectedPlayer,
                period: currentPeriod,  // ‚Üê currentQuarter„Åß„ÅØ„Å™„ÅècurrentPeriod
                timestamp: Date.now()
            };
            
            // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆÊÉÖÂ†±„ÇíËøΩÂä†
            if (position) {
                play.position = position;
            }
            
            currentTeamGame.plays.push(play);  // ‚Üê currentPlays„Åß„ÅØ„Å™„ÅècurrentTeamGame.plays„Å´Â§âÊõ¥
            updatePlayerStats(selectedPlayer, type);
            displayPlayHistory();
            updateTeamStats();  // ‚Üê displayCurrentStats„Åß„ÅØ„Å™„ÅèupdateTeamStats„ÇíÂëº„Å∂
            
            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫„ÇíËøΩÂä†
            const player = players.find(p => p.id === selectedPlayer);
            const playerName = player ? '#' + player.number + ' ' + player.name : '';
            showPlayFeedback(playerName + ' ' + getPlayLabel(type), type);
            
            saveData();
        }

        // „Éó„É¨„Ç§„Çø„Ç§„Éó„Å´Âøú„Åò„Å¶ÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
        function updatePlayerStats(playerId, playType) {
            if (!currentTeamGame || !currentTeamGame.playerStats[playerId]) {
                return;
            }
            
            const stats = currentTeamGame.playerStats[playerId];
            
            switch(playType) {
                case '2p-made':
                    stats.twoPointsMade++;
                    stats.twoPointsAttempted++;
                    break;
                case '2p-miss':
                    stats.twoPointsAttempted++;
                    break;
                case '3p-made':
                    stats.threePointsMade++;
                    stats.threePointsAttempted++;
                    break;
                case '3p-miss':
                    stats.threePointsAttempted++;
                    break;
                case 'ft-made':
                    stats.freeThrowsMade++;
                    stats.freeThrowsAttempted++;
                    break;
                case 'ft-miss':
                    stats.freeThrowsAttempted++;
                    break;
                case 'oreb':
                    stats.offensiveRebounds++;
                    break;
                case 'dreb':
                    stats.defensiveRebounds++;
                    break;
                case 'ast':
                    stats.assists++;
                    break;
                case 'stl':
                    stats.steals++;
                    break;
                case 'blk':
                    stats.blocks++;
                    break;
                case 'to':
                    stats.turnovers++;
                    break;
                case 'foul':
                    stats.fouls++;
                    break;
            }
        }

        function showPlayFeedback(message, type) {
            // Êó¢Â≠ò„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
            const existing = document.querySelector('.feedback-notification');
            if (existing) {
                existing.remove();
            }

            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü•„Çí‰ΩúÊàê
            const feedback = document.createElement('div');
            feedback.className = 'feedback-notification';
            
            // „Çø„Ç§„Éó„Å´Âøú„Åò„Å¶„ÇØ„É©„Çπ„ÇíËøΩÂä†
            if (type.includes('made')) {
                feedback.classList.add('success');
            } else if (type.includes('miss')) {
                feedback.classList.add('miss');
            } else {
                feedback.classList.add('other');
            }
            
            feedback.textContent = message;
            document.body.appendChild(feedback);

            // 1ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(function() {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 1000);

            // „Éú„Çø„É≥„Å´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„ÇíËøΩÂä†
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(function(btn) {
                if (btn.textContent.toLowerCase().includes(type.split('-')[0])) {
                    btn.classList.add('pressed');
                    setTimeout(function() {
                        btn.classList.remove('pressed');
                    }, 300);
                }
            });
        }

        function deletePlay(timestamp) {
            const playIndex = currentTeamGame.plays.findIndex(function(p) {
                return p.timestamp === timestamp;
            });
            if (playIndex === -1) return;
            
            const play = currentTeamGame.plays[playIndex];
            
            // üÜï ÂâäÈô§„Åô„ÇãÈÅ∏Êâã„Å®„Éó„É¨„Ç§„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó
            const player = players.find(function(p) { return p.id === play.playerId; });
            const playerName = player ? '#' + player.number + ' ' + player.name : '';
            const playLabel = getPlayLabel(play.playType);
            
            const st = currentTeamGame.playerStats[play.playerId];
            
            if (play.playType === '2p-made') { st.twoPointsMade--; st.twoPointsAttempted--; }
            else if (play.playType === '2p-miss') { st.twoPointsAttempted--; }
            else if (play.playType === '3p-made') { st.threePointsMade--; st.threePointsAttempted--; }
            else if (play.playType === '3p-miss') { st.threePointsAttempted--; }
            else if (play.playType === 'ft-made') { st.freeThrowsMade--; st.freeThrowsAttempted--; }
            else if (play.playType === 'ft-miss') { st.freeThrowsAttempted--; }
            else if (play.playType === 'oreb') { st.offensiveRebounds--; }
            else if (play.playType === 'dreb') { st.defensiveRebounds--; }
            else if (play.playType === 'ast') { st.assists--; }
            else if (play.playType === 'stl') { st.steals--; }
            else if (play.playType === 'blk') { st.blocks--; }
            else if (play.playType === 'to') { st.turnovers--; }
            else if (play.playType === 'foul') { st.fouls--; }
            
            currentTeamGame.plays.splice(playIndex, 1);
            
            updateTeamStats();
            displayPlayHistory();
            
            // üÜï ÂâäÈô§ÊàêÂäü„ÅÆ„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóË°®Á§∫
            showDeleteFeedback(playerName + ' ' + playLabel);
            
            // üÜï „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
        }
        
        // üÜï ÂâäÈô§„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫Èñ¢Êï∞„ÇíËøΩÂä†
        function showDeleteFeedback(message) {
            // Êó¢Â≠ò„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
            const existing = document.querySelector('.delete-feedback');
            if (existing) {
                existing.remove();
            }
        
            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü•„Çí‰ΩúÊàê
            const feedback = document.createElement('div');
            feedback.className = 'feedback-notification delete-feedback';
            feedback.style.background = 'linear-gradient(135deg, #e74c3c 0%, #c0392b 100%)';
            feedback.textContent = 'üóëÔ∏è ÂâäÈô§„Åó„Åæ„Åó„Åü: ' + message;
            document.body.appendChild(feedback);
        
            // 1.5ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(function() {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 1500);
        }

        function displayPlayHistory() {
            const histEl = document.getElementById('playHistory');
            
            // ========== ËøΩÂä†:Â≠òÂú®„ÉÅ„Çß„ÉÉ„ÇØ ==========
            if (!currentTeamGame || !currentTeamGame.plays) {
                histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">„Éó„É¨„Ç§Â±•Ê≠¥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>';
                return;
            }
            // ========================================
            
            if (currentTeamGame.plays.length === 0) {
                histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">„Éó„É¨„Ç§Â±•Ê≠¥„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô</div>';
                return;
            }
            
            const recentPlays = currentTeamGame.plays.slice().reverse().slice(0, 10);
            histEl.innerHTML = '<div style="margin-bottom: 10px; font-size: 0.9em; color: #666; font-weight: bold;">ÊúÄÊñ∞„ÅÆ„Éó„É¨„Ç§(ÊúÄÂ§ß10‰ª∂) - „Çø„ÉÉ„Éó„ÅßÂâäÈô§</div>' +
                recentPlays.map(function(play) {
                    const p = players.find(function(pl) {
                        return pl.id === play.playerId;
                    });
                    return '<div class="play-item">' +
                        '<div>' +
                        '<strong>' + play.period + 'Q | #' + p.number + ' ' + p.name + '</strong>' +
                        '<div style="font-size: 0.85em; color: #666; margin-top: 2px;">' + getPlayLabel(play.playType) + '</div>' +
                        '</div>' +
                        '<button class="undo-btn" onclick="deletePlay(' + play.timestamp + ')">ÂâäÈô§</button>' +
                        '</div>';
                }).join('');
        }

        function updateTeamStats() {
            const el = document.getElementById('teamStats');
            let html = '';

            players.forEach(function(p) {
                const st = currentTeamGame.playerStats[p.id];
                const pts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;
                const reb = st.offensiveRebounds + st.defensiveRebounds;

                html += '<div style="padding: 10px; background: #f7f7f7; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="font-weight: bold; margin-bottom: 5px;">#' + p.number + ' ' + p.name + '</div>' +
                    '<div style="font-size: 0.9em; color: #666;">' +
                    pts + 'ÁÇπ | ' + reb + '„É™„Éê„Ç¶„É≥„Éâ | ' + st.assists + '„Ç¢„Ç∑„Çπ„Éà | ' + st.steals + '„Çπ„ÉÜ„Ç£„Éº„É´ | ' + st.blocks + '„Éñ„É≠„ÉÉ„ÇØ' +
                    '</div>' +
                    '</div>';
            });

            el.innerHTML = html;
        }

        function saveTeamGame() {
            if (!currentTeamGame) return;

            teamGames.unshift(currentTeamGame);

            players.forEach(function(player) {
                if (currentTeamGame.playerStats[player.id]) {
                    const st = currentTeamGame.playerStats[player.id];
                    const totalReb = st.offensiveRebounds + st.defensiveRebounds;
                    const totalPts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;

                    const personalGame = {
                        id: Date.now() + Math.random(),
                        date: currentTeamGame.date,
                        opponent: currentTeamGame.opponent,
                        playTime: 0,
                        playerId: player.id,
                        twoPointsMade: st.twoPointsMade,
                        twoPointsAttempted: st.twoPointsAttempted,
                        threePointsMade: st.threePointsMade,
                        threePointsAttempted: st.threePointsAttempted,
                        freeThrowsMade: st.freeThrowsMade,
                        freeThrowsAttempted: st.freeThrowsAttempted,
                        offensiveRebounds: st.offensiveRebounds,
                        defensiveRebounds: st.defensiveRebounds,
                        assists: st.assists,
                        steals: st.steals,
                        blocks: st.blocks,
                        turnovers: st.turnovers,
                        fouls: st.fouls,
                        totalRebounds: totalReb,
                        twoPointPercentage: st.twoPointsAttempted > 0 ? ((st.twoPointsMade / st.twoPointsAttempted) * 100).toFixed(1) : '0',
                        threePointPercentage: st.threePointsAttempted > 0 ? ((st.threePointsMade / st.threePointsAttempted) * 100).toFixed(1) : '0',
                        freeThrowPercentage: st.freeThrowsAttempted > 0 ? ((st.freeThrowsMade / st.freeThrowsAttempted) * 100).toFixed(1) : '0',
                        totalPoints: totalPts,
                        source: 'team',
                        teamGameId: currentTeamGame.id
                    };

                    personalGames.unshift(personalGame);
                }
            });

            saveData();
            
            if (teamData) {
                syncGamesOnly();
            }

            // ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§(Ë©¶ÂêàÂÆå‰∫Ü„Åó„Åü„ÅÆ„Åß‰∏çË¶Å)
            clearDraftTeamGame();
            
            // Ë≠¶Âëä„Éú„ÉÉ„ÇØ„Çπ„ÇÇÂâäÈô§
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            currentTeamGame = null;
            selectedPlayer = null;
            currentPeriod = 1;
            document.getElementById('teamRecording').style.display = 'none';
            document.getElementById('teamGameDate').valueAsDate = new Date();
            document.getElementById('teamOpponent').value = '';
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!\n\nÂÖ®ÈÅ∏Êâã„ÅÆ„Éá„Éº„Çø„ÅåÂÄã‰∫∫„É¢„Éº„Éâ„Å´ÂèçÊò†„Åï„Çå„Åæ„Åô„ÄÇ');
        }

        // ========== ÈÄî‰∏≠‰øùÂ≠òÊ©üËÉΩ ==========
        function saveDraftTeamGame() {
            if (!currentTeamGame) {
                alert('‚ö†Ô∏è Ë®òÈå≤‰∏≠„ÅÆË©¶Âêà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // üÜï ÁèæÂú®„ÅÆ„Éî„É™„Ç™„Éâ„ÇÇ‰øùÂ≠ò
            draftTeamGame = {
                id: currentTeamGame.id,
                date: currentTeamGame.date,
                opponent: currentTeamGame.opponent,
                plays: JSON.parse(JSON.stringify(currentTeamGame.plays)),
                playerStats: JSON.parse(JSON.stringify(currentTeamGame.playerStats)),
                scores: JSON.parse(JSON.stringify(currentTeamGame.scores)),
                currentPeriod: currentPeriod,
                savedAt: new Date().toISOString()
            };
            
            saveData();
            
            // üÜï ‰øùÂ≠òÊàêÂäü„ÅÆË¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÔºàÊîπÂñÑÁâàÔºâ
            showSaveFeedback();
            
            // üÜï „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞
            updateDraftStatusDisplay();
            
            // üÜï „Éú„Çø„É≥„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂ§âÊõ¥
            const draftBtn = document.querySelector('button[onclick="saveDraftTeamGame()"]');
            if (draftBtn) {
                const now = new Date();
                const timeStr = now.getHours().toString().padStart(2, '0') + ':' + 
                               now.getMinutes().toString().padStart(2, '0');
                draftBtn.innerHTML = '‚úÖ ‰øùÂ≠òÊ∏à„Åø (' + timeStr + ')';
                draftBtn.style.background = 'linear-gradient(135deg, #2ecc71 0%, #27ae60 100%)';
                
                // 3ÁßíÂæå„Å´ÂÖÉ„Å´Êàª„Åô
                setTimeout(function() {
                    draftBtn.innerHTML = 'üíæ ÈÄî‰∏≠‰øùÂ≠ò';
                    draftBtn.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';
                }, 3000);
            }
        }
        
        // üÜï ÈÄî‰∏≠‰øùÂ≠ò„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫Èñ¢Êï∞
        function showSaveFeedback() {
            // Êó¢Â≠ò„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
            const existing = document.querySelector('.save-feedback');
            if (existing) {
                existing.remove();
            }
        
            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü•„Çí‰ΩúÊàê
            const feedback = document.createElement('div');
            feedback.className = 'feedback-notification save-feedback';
            feedback.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';
            feedback.innerHTML = 'üíæ ÈÄî‰∏≠‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ<br><span style="font-size: 0.85em; opacity: 0.9;">„Åù„ÅÆ„Åæ„ÅæË®òÈå≤„ÇíÁ∂ö„Åë„Çâ„Çå„Åæ„Åô</span>';
            document.body.appendChild(feedback);
        
            // 2ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(function() {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 2000);
        }

        // üÜï ÈÄî‰∏≠‰øùÂ≠ò„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
        function updateDraftStatusDisplay() {
            let statusDiv = document.getElementById('draftStatusBanner');
            
            // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„Åå„Åæ„Å†„Å™„ÅÑÂ†¥Âêà„ÅØ‰ΩúÊàê
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'draftStatusBanner';
                statusDiv.className = 'draft-status-banner';
                
                // „Éó„É¨„Ç§Ë®òÈå≤„Ç®„É™„Ç¢„ÅÆÂâç„Å´ÊåøÂÖ•
                const playActions = document.querySelector('.play-actions');
                if (playActions && playActions.parentNode) {
                    playActions.parentNode.insertBefore(statusDiv, playActions);
                }
            }
            
            if (draftTeamGame && draftTeamGame.timestamp) {
                const saveTime = new Date(draftTeamGame.timestamp);
                const timeStr = saveTime.getHours().toString().padStart(2, '0') + ':' + 
                               saveTime.getMinutes().toString().padStart(2, '0');
                
                statusDiv.innerHTML = `
                    <div class="draft-status-info">
                        <div class="draft-status-icon">üíæ</div>
                        <div class="draft-status-text">
                            <div class="draft-status-label">ÈÄî‰∏≠‰øùÂ≠òÊ∏à„ÅøÔºà${timeStr}Ôºâ</div>
                            <div class="draft-status-time" style="font-size: 0.9em; margin-top: 3px;">
                                ‚ú® „Éó„É¨„Ç§„Éú„Çø„É≥„ÇíÊäº„Åõ„Å∞Ë®òÈå≤„ÇíÁ∂ö„Åë„Çâ„Çå„Åæ„Åô
                            </div>
                        </div>
                    </div>
                `;
                statusDiv.style.display = 'flex';
            } else {
                statusDiv.style.display = 'none';
            }
        }

        // ========== Á∂ö„Åç„Åã„ÇâË®òÈå≤(ÂÜçÈñã)Ê©üËÉΩ ==========
        function resumeDraftGame() {
            console.log('resumeDraftGame called');
            console.log('draftTeamGame:', draftTeamGame);
            
            if (!draftTeamGame) {
                alert('‚ö†Ô∏è ÈÄî‰∏≠‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // üÜï Âè§„ÅÑÂΩ¢Âºè„ÅÆ„Éá„Éº„Çø„ÇíÊñ∞„Åó„ÅÑÂΩ¢Âºè„Å´Â§âÊèõ
            if (draftTeamGame.game && !draftTeamGame.id) {
                // Âè§„ÅÑÂΩ¢Âºè: { game: {...}, timestamp: ... }
                const oldGame = draftTeamGame.game;
                draftTeamGame = {
                    id: oldGame.id,
                    date: oldGame.date,
                    opponent: oldGame.opponent,
                    plays: oldGame.plays || [],
                    playerStats: oldGame.playerStats || {},
                    scores: oldGame.scores || {
                        our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                        opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                    },
                    currentPeriod: 1,
                    savedAt: draftTeamGame.timestamp || new Date().toISOString()
                };
                console.log('Âè§„ÅÑÂΩ¢Âºè„Åã„ÇâÂ§âÊèõ„Åó„Åæ„Åó„Åü');
            }
            
            // Á¢∫Ë™ç„É°„ÉÉ„Çª„Éº„Ç∏
            const dateStr = new Date(draftTeamGame.date).toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            if (!confirm('üìã Êú™ÂÆå‰∫Ü„ÅÆË©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô\n\n' +
                        'Êó•‰ªò: ' + dateStr + '\n' +
                        'ÂØæÊà¶Áõ∏Êâã: ' + (draftTeamGame.opponent || 'Êú™Ë®≠ÂÆö') + '\n' +
                        '‰øùÂ≠òÊó•ÊôÇ: ' + new Date(draftTeamGame.savedAt).toLocaleString('ja-JP') + '\n\n' +
                        'Á∂ö„Åç„Åã„ÇâË®òÈå≤„Åó„Åæ„Åô„Åã?')) {
                return;
            }
            
            // ‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Åü„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
            currentTeamGame = {
                id: draftTeamGame.id,
                date: draftTeamGame.date,
                opponent: draftTeamGame.opponent,
                plays: draftTeamGame.plays ? draftTeamGame.plays.slice() : [],
                playerStats: draftTeamGame.playerStats ? JSON.parse(JSON.stringify(draftTeamGame.playerStats)) : {},
                scores: draftTeamGame.scores ? JSON.parse(JSON.stringify(draftTeamGame.scores)) : {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                }
            };
            
            console.log('currentTeamGame restored:', currentTeamGame);
            
            // „Éî„É™„Ç™„Éâ„ÇÇÂæ©ÂÖÉ
            currentPeriod = draftTeamGame.currentPeriod || 1;
            selectedPlayer = null; // üÜï ÈÅ∏ÊâãÈÅ∏Êäû„Çí„É™„Çª„ÉÉ„Éà
            
            selectPeriod(currentPeriod);
            
            // Êó•‰ªò„Å®ÂØæÊà¶Áõ∏Êâã„ÇíÁîªÈù¢„Å´Ë°®Á§∫
            document.getElementById('teamGameDate').value = draftTeamGame.date;
            document.getElementById('teamOpponent').value = draftTeamGame.opponent || '';
            
            // üÜï Ë©¶ÂêàÈñãÂßã„Çª„ÇØ„Ç∑„Éß„É≥„ÇíÈùûË°®Á§∫„ÄÅË®òÈå≤ÁîªÈù¢„ÇíË°®Á§∫
            const startSection = document.querySelector('#teamRecordTab .card:first-child');
            if (startSection) {
                startSection.style.display = 'none';
            }
            
            // Ë®òÈå≤ÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
            
            // üÜï „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„ÇíÊõ¥Êñ∞
            updateDraftStatusDisplay();
            
            // üÜï Ë≠¶Âëä„Éú„ÉÉ„ÇØ„Çπ„ÇíÂâäÈô§
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„ÇíÂÜçÈñã„Åó„Åæ„Åó„Åü!\n\nÂâçÂõû„ÅÆÁ∂ö„Åç„Åã„ÇâË®òÈå≤„Åß„Åç„Åæ„Åô„ÄÇ');
        }

        // ========== ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÅÆÂâäÈô§(Ë©¶ÂêàÂÆå‰∫ÜÊôÇ)==========
        function clearDraftTeamGame() {
            draftTeamGame = null;
            saveData();
        }

        // ========== Ëµ∑ÂãïÊôÇ„Å´ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ ==========
        function checkAndShowDraftGame() {
            // ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„Åå„Å™„Åë„Çå„Å∞‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (!draftTeamGame) {
                return;
            }
            
            // „ÉÅ„Éº„É†Ë®òÈå≤„Çø„Éñ„ÅÆ‰∏ÄÁï™‰∏ä„Å´„ÄåÁ∂ö„Åç„Åã„ÇâË®òÈå≤„Äç„Éú„Çø„É≥„ÇíË°®Á§∫
            const teamRecordTab = document.getElementById('teamRecordTab');
            
            // Êó¢„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„Å™„Çâ‰Ωï„ÇÇ„Åó„Å™„ÅÑ
            if (document.getElementById('draftGameAlert')) {
                return;
            }
            
            // Êó•‰ªò„ÇíË¶ã„ÇÑ„Åô„ÅèÊï¥ÂΩ¢
            const dateStr = new Date(draftTeamGame.date).toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // „Ç¢„É©„Éº„Éà„Éú„ÉÉ„ÇØ„Çπ„Çí‰ΩúÊàê
            const alertBox = document.createElement('div');
            alertBox.id = 'draftGameAlert';
            alertBox.className = 'card';
            alertBox.style.background = 'linear-gradient(135deg, #ffd93d 0%, #ffb03a 100%)';
            alertBox.style.color = '#333';
            alertBox.style.marginBottom = '20px';
            alertBox.innerHTML = 
                '<div style="display: flex; align-items: center; margin-bottom: 15px;">' +
                '<span style="font-size: 2em; margin-right: 10px;">‚ö†Ô∏è</span>' +
                '<h2 style="margin: 0;">Êú™ÂÆå‰∫Ü„ÅÆË©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åô</h2>' +
                '</div>' +
                '<div style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px; margin-bottom: 15px;">' +
                '<div style="margin-bottom: 8px;"><strong>üìÖ Ë©¶ÂêàÊó•:</strong> ' + dateStr + '</div>' +
                '<div style="margin-bottom: 8px;"><strong>üèÄ ÂØæÊà¶Áõ∏Êâã:</strong> ' + (draftTeamGame.opponent || 'Êú™Ë®≠ÂÆö') + '</div>' +
                '<div><strong>üíæ ‰øùÂ≠òÊó•ÊôÇ:</strong> ' + new Date(draftTeamGame.savedAt).toLocaleString('ja-JP') + '</div>' +
                '</div>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">' +
                '<button class="primary-btn" style="background: #2ecc71;" onclick="resumeDraftGame()">‚ñ∂Ô∏è Á∂ö„Åç„Åã„ÇâË®òÈå≤</button>' +
                '<button class="primary-btn" style="background: #e74c3c;" onclick="deleteDraftGame()">üóëÔ∏è ÂâäÈô§„Åó„Å¶Êñ∞Ë¶è‰ΩúÊàê</button>' +
                '</div>';
            
            // „Çø„Éñ„ÅÆÊúÄÂàù„Å´ÊåøÂÖ•
            teamRecordTab.insertBefore(alertBox, teamRecordTab.firstChild);
        }

        // ========== ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Å¶Êñ∞Ë¶è‰ΩúÊàê ==========
        function deleteDraftGame() {
            if (!confirm('‚ö†Ô∏è ÈÄî‰∏≠‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô\n\nÂâäÈô§„Åô„Çã„Å®Âæ©ÂÖÉ„Åß„Åç„Åæ„Åõ„Çì„ÄÇ\nÊú¨ÂΩì„Å´„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã?')) {
                return;
            }
            
            clearDraftTeamGame();
            
            // Ë≠¶Âëä„Éú„ÉÉ„ÇØ„Çπ„ÇíÂâäÈô§
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            alert('‚úÖ ÈÄî‰∏≠‰øùÂ≠ò„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü\n\nÊñ∞„Åó„ÅÑË©¶Âêà„ÇíË®òÈå≤„Åß„Åç„Åæ„Åô„ÄÇ');
        }

        

        function switchTeamTab(tab) {
            // „Çø„Éñ„Éú„Çø„É≥„ÅÆÂàá„ÇäÊõø„Åà
            const tabs = document.querySelectorAll('#teamMode .tab');
            tabs.forEach(function(t) {
                t.classList.remove('active');
            });
            
            if (tab === 'record') {
                tabs[0].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'block';
                document.getElementById('teamHistoryTab').style.display = 'none';
                document.getElementById('teamRankingTab').style.display = 'none';
                checkAndShowDraftGame();
            } else if (tab === 'history') {
                tabs[1].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'none';
                document.getElementById('teamHistoryTab').style.display = 'block';
                document.getElementById('teamRankingTab').style.display = 'none';
                displayTeamGamesHistory();
            } else if (tab === 'ranking') {
                tabs[2].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'none';
                document.getElementById('teamHistoryTab').style.display = 'none';
                document.getElementById('teamRankingTab').style.display = 'block';
                displayTeamRankings();
            }
        }

        function displayTeamGamesHistory() {
            const listEl = document.getElementById('teamGamesList');
            
            if (teamGames.length === 0) {
                listEl.innerHTML = '<div class="empty-state"><div class="icon">üèÄ</div><h3>„Åæ„Å†Ë©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3><p>Ë©¶ÂêàË®òÈå≤„Çø„Éñ„ÅßË®òÈå≤„ÇíÈñãÂßã„Åó„Åæ„Åó„Çá„ÅÜ!</p></div>';
                return;
            }
            
            let html = '<div class="card"><h2 style="margin-bottom: 20px;">üìä Ë©¶ÂêàÂ±•Ê≠¥</h2></div>';
            
            // ========== ÊúÄÊñ∞„ÅÆË©¶Âêà„Åå‰∏ä„Å´Êù•„Çã„Çà„ÅÜ„Å´„ÇΩ„Éº„Éà ==========
            const sortedGames = teamGames.slice().sort(function(a, b) {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return dateB - dateA; // Êñ∞„Åó„ÅÑÈ†Ü(ÈôçÈ†Ü)
            });
            // ====================================================
            
            sortedGames.forEach(function(game, index) {
                // ÂÖÉ„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíÂèñÂæó(Á∑®ÈõÜ„ÉªÂâäÈô§Áî®)
                const originalIndex = teamGames.indexOf(game);
                const dateObj = new Date(game.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                // „Çπ„Ç≥„Ç¢ÊÉÖÂ†±„ÇíË®àÁÆó
                let scoreHtml = '';
                if (game.scores) {
                    const ourTotal = (game.scores.our.q1 || 0) + (game.scores.our.q2 || 0) + (game.scores.our.q3 || 0) + (game.scores.our.q4 || 0);
                    const oppTotal = (game.scores.opp.q1 || 0) + (game.scores.opp.q2 || 0) + (game.scores.opp.q3 || 0) + (game.scores.opp.q4 || 0);
                    const isWin = ourTotal > oppTotal;
                    const outcome = ourTotal === oppTotal ? 'Âºï„ÅçÂàÜ„Åë' : (isWin ? 'ÂãùÂà©' : 'ÊïóÂåó');
                    
                    scoreHtml = '<div style="font-size: 1.5em; font-weight: bold; margin-top: 5px;">' +
                        ourTotal + ' - ' + oppTotal + ' (' + outcome + ')' +
                        '</div>';
                }
                
                html += '<div class="game-history-item" onclick="toggleGameDetail(' + originalIndex + ')">' +
                    '<div class="game-date">' + dateStr + '</div>' +
                    '<div class="game-opponent">vs ' + (game.opponent || 'ÂØæÊà¶Áõ∏Êâã„Å™„Åó') + '</div>' +
                    scoreHtml +
                    '</div>' +
                    '<div class="game-detail" id="gameDetail' + originalIndex + '">' +
                    generateScoreDetail(game) +
                    '<button class="edit-game-btn" onclick="event.stopPropagation(); openEditGameModal(' + originalIndex + ')">üìù Ë©¶ÂêàË®òÈå≤„ÇíÁ∑®ÈõÜ(ÁÆ°ÁêÜËÄÖ„ÅÆ„Åø)</button>' +
                    generateGameRankings(game) +
                    '</div>';
            });
            
            listEl.innerHTML = html;
        }

        function toggleGameDetail(index) {
            const detail = document.getElementById('gameDetail' + index);
            detail.classList.toggle('active');
        }

        function generateScoreDetail(game) {
            if (!game.scores) return '';
            
            const ourTotal = (game.scores.our.q1 || 0) + (game.scores.our.q2 || 0) + (game.scores.our.q3 || 0) + (game.scores.our.q4 || 0);
            const oppTotal = (game.scores.opp.q1 || 0) + (game.scores.opp.q2 || 0) + (game.scores.opp.q3 || 0) + (game.scores.opp.q4 || 0);
            const isWin = ourTotal > oppTotal;
            const outcome = ourTotal === oppTotal ? 'Âºï„ÅçÂàÜ„Åë' : (isWin ? 'ÂãùÂà©' : 'ÊïóÂåó');
            
            // „ÉÅ„Éº„É†Âêç„ÇíÂèñÂæó
            const ourTeamName = teamData ? teamData.name : 'Ëá™„ÉÅ„Éº„É†';
            const oppTeamName = game.opponent || 'ÂØæÊà¶Áõ∏Êâã';
            
            let html = '<div class="game-result' + (isWin ? '' : ' loss') + '">';
            html += '<div class="result-label">Ë©¶ÂêàÁµêÊûú</div>';
            html += '<div class="result-score">' + ourTotal + ' - ' + oppTotal + '</div>';
            
            // ========== „ÉÅ„Éº„É†Âêç„ÇíËøΩÂä† ==========
            html += '<div class="team-names">';
            html += '<span class="our-team-name">' + ourTeamName + '</span>';
            html += '<span class="vs-label">VS</span>';
            html += '<span class="opp-team-name">' + oppTeamName + '</span>';
            html += '</div>';
            // ===================================
            
            html += '<div class="result-outcome">' + outcome + '</div>';
            html += '</div>';
            
            html += '<div class="quarter-scores">';
            for (let i = 1; i <= 4; i++) {
                const ourScore = game.scores.our['q' + i] || 0;
                const oppScore = game.scores.opp['q' + i] || 0;
                const diff = ourScore - oppScore;
                const diffClass = diff > 0 ? 'positive' : (diff < 0 ? 'negative' : '');
                const diffText = diff > 0 ? '+' + diff : diff;
                
                html += '<div class="quarter-score-item">';
                html += '<div class="quarter-label">Q' + i + '</div>';
                html += '<div class="quarter-value">' + ourScore + ' - ' + oppScore + '</div>';
                html += '<div class="quarter-diff ' + diffClass + '">(' + diffText + ')</div>';
                html += '</div>';
            }
            html += '</div>';
            
            return html;
        }

        function generateGameRankings(game) {
            let html = '';
            
            // ÂæóÁÇπ„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'points', 'üèÜ ÂæóÁÇπÁéã', function(stats) {
                return (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            }, 'ÁÇπ');
            
            // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'fieldGoalPct', 'üéØ „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá', function(stats) {
                const made = stats.twoPointsMade + stats.threePointsMade;
                const attempted = stats.twoPointsAttempted + stats.threePointsAttempted;
                return attempted > 0 ? ((made / attempted) * 100).toFixed(1) : 0;
            }, '%', true);
            
            // „É™„Éê„Ç¶„É≥„Éâ„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'rebounds', 'üì¶ „É™„Éê„Ç¶„É≥„ÉâÁéã', function(stats) {
                return stats.offensiveRebounds + stats.defensiveRebounds;
            }, 'Êú¨');
            
            // „Ç¢„Ç∑„Çπ„Éà„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'assists', 'ü§ù „Ç¢„Ç∑„Çπ„ÉàÁéã', function(stats) {
                return stats.assists;
            }, 'Âõû');
            
            // „Çπ„ÉÜ„Ç£„Éº„É´„É©„É≥„Ç≠„É≥„Ç∞
            html += generateRankingSection(game, 'steals', 'üõ°Ô∏è „Çπ„ÉÜ„Ç£„Éº„É´Áéã', function(stats) {
                return stats.steals;
            }, 'Âõû');
            
            return html;
        }
        

        function generateRankingSection(game, key, title, calcFunc, unit, isPercentage) {
            // ÈÅ∏Êâã„Éá„Éº„Çø„ÇíÈÖçÂàó„Å´Â§âÊèõ„Åó„Å¶ÂÄ§„ÇíË®àÁÆó
            const playerData = [];
            Object.keys(game.playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (player) {
                    const stats = game.playerStats[playerId];
                    const value = calcFunc(stats);
                    
                    // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„ÅÆÂ†¥Âêà„ÄÅË©¶ÊäïÊï∞„Åå0„ÅÆÈÅ∏Êâã„ÅØÈô§Â§ñ
                    if (isPercentage) {
                        const attempted = stats.twoPointsAttempted + stats.threePointsAttempted;
                        if (attempted > 0) {
                            playerData.push({
                                player: player,
                                value: parseFloat(value),
                                displayValue: value
                            });
                        }
                    } else {
                        playerData.push({
                            player: player,
                            value: parseFloat(value),
                            displayValue: value
                        });
                    }
                }
            });
            
            // ÂÄ§„Åß„ÇΩ„Éº„Éà(ÈôçÈ†Ü)
            playerData.sort(function(a, b) { return b.value - a.value; });
            
            if (playerData.length === 0) {
                return '';
            }
            
            let html = '<div class="ranking-section">';
            html += '<h3>' + title + '</h3>';
            
            // TOP3„ÇíË°®Á§∫
            html += '<div class="top3-container">';
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            for (let i = 0; i < Math.min(3, playerData.length); i++) {
                const data = playerData[i];
                html += '<div class="ranking-card">' +
                    '<span class="ranking-medal">' + medals[i] + '</span>' +
                    '<div class="ranking-info">' +
                    '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                    '<span class="stat-value">' + data.displayValue + unit + '</span>' +
                    '</div>' +
                    '</div>';
            }
            html += '</div>';
            
            // ÂÖ®ÈÅ∏Êâã„É©„É≥„Ç≠„É≥„Ç∞(Êäò„Çä„Åü„Åü„Åø)
            if (playerData.length > 3) {
                html += '<button class="toggle-rankings" onclick="toggleAllRankings(\'' + key + game.id + '\')">' +
                    '‚ñº ÂÖ®' + playerData.length + 'Âêç„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË°®Á§∫' +
                    '</button>';
                
                html += '<div class="all-rankings" id="allRankings' + key + game.id + '">';
                playerData.forEach(function(data, index) {
                    html += '<div class="ranking-card">' +
                        '<div class="ranking-info">' +
                        '<span class="rank">' + (index + 1) + '‰Ωç</span>' +
                        '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                        '<span class="stat-value">' + data.displayValue + unit + '</span>' +
                        '</div>' +
                        '</div>';
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }

        function toggleAllRankings(id) {
            const el = document.getElementById('allRankings' + id);
            const btn = event.target;
            
            if (el.classList.contains('active')) {
                el.classList.remove('active');
                btn.classList.remove('active');
                btn.textContent = btn.textContent.replace('‚ñ≤ Èñâ„Åò„Çã', '‚ñº ÂÖ®' + btn.textContent.match(/\d+/)[0] + 'Âêç„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË°®Á§∫');
            } else {
                el.classList.add('active');
                btn.classList.add('active');
                btn.textContent = '‚ñ≤ Èñâ„Åò„Çã';
            }
        }
        

        // ========== „ÉÅ„Éº„É†„É©„É≥„Ç≠„É≥„Ç∞Ë°®Á§∫Èñ¢Êï∞ ==========
        function displayTeamRankings() {
            const container = document.getElementById('teamRankingsDisplay');
            
            if (teamGames.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">üèÜ</div><h3>„Åæ„Å†Ë©¶ÂêàË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3><p>Ë©¶ÂêàË®òÈå≤„Çø„Éñ„ÅßË®òÈå≤„ÇíÈñãÂßã„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p></div>';
                return;
            }
            
            let html = '';
            
            // Áõ¥Ëøë3Ë©¶Âêà„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞
            html += '<div class="card">';
            html += '<h2 style="margin-bottom: 20px;">üìä Áõ¥Ëøë3Ë©¶Âêà„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞</h2>';
            html += '<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">ÊúÄÊñ∞3Ë©¶Âêà„ÅÆÂêàË®àÂÄ§„ÉªÂπ≥ÂùáÂÄ§„ÅßÁÆóÂá∫</p>';
            html += calculateRecentGamesRankings();
            html += '</div>';
            
            // ÂÖ®Ë©¶Âêà„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞
            html += '<div class="card">';
            html += '<h2 style="margin-bottom: 20px;">üèÜ ÂÖ®Ë©¶ÂêàÈÄöÁÆó„É©„É≥„Ç≠„É≥„Ç∞</h2>';
            html += '<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">ÂÖ®' + teamGames.length + 'Ë©¶Âêà„ÅÆÂπ≥ÂùáÂÄ§„ÉªÂêàË®àÂÄ§„ÅßÁÆóÂá∫</p>';
            html += calculateAllGamesRankings();
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        function calculateRecentGamesRankings() {
            // ÊúÄÊñ∞3Ë©¶Âêà„ÇíÂèñÂæó
            const recentGames = teamGames.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            }).slice(0, 3);
            
            if (recentGames.length === 0) return '';
            
            // ÂêÑÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÈõÜË®à
            const playerStats = {};
            
            recentGames.forEach(function(game) {
                Object.keys(game.playerStats).forEach(function(playerId) {
                    const stats = game.playerStats[playerId];
                    
                    if (!playerStats[playerId]) {
                        playerStats[playerId] = {
                            gamesPlayed: 0,
                            totalPoints: 0,
                            totalRebounds: 0,
                            totalAssists: 0,
                            totalFGMade: 0,
                            totalFGAttempted: 0
                        };
                    }
                    
                    playerStats[playerId].gamesPlayed++;
                    playerStats[playerId].totalPoints += (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                    playerStats[playerId].totalRebounds += stats.offensiveRebounds + stats.defensiveRebounds;
                    playerStats[playerId].totalAssists += stats.assists;
                    playerStats[playerId].totalFGMade += stats.twoPointsMade + stats.threePointsMade;
                    playerStats[playerId].totalFGAttempted += stats.twoPointsAttempted + stats.threePointsAttempted;
                });
            });
            
            let html = '';
            
            // ÂæóÁÇπÁéãÔºàÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üèÜ ÂæóÁÇπÁéãÔºàÂêàË®àÔºâ',
                function(stats) { return stats.totalPoints; },
                'ÁÇπ',
                false,
                'recentPoints'
            );
            
            // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéáÔºàÂπ≥ÂùáÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üéØ „Ç∑„É•„Éº„ÉàÊàêÂäüÁéáÔºàÂπ≥ÂùáÔºâ',
                function(stats) { 
                    return stats.totalFGAttempted > 0 ? (stats.totalFGMade / stats.totalFGAttempted * 100).toFixed(1) : 0;
                },
                '%',
                true,
                'recentFG'
            );
            
            // „É™„Éê„Ç¶„É≥„ÉâÁéãÔºàÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üì¶ „É™„Éê„Ç¶„É≥„ÉâÁéãÔºàÂêàË®àÔºâ',
                function(stats) { return stats.totalRebounds; },
                'Êú¨',
                false,
                'recentReb'
            );
            
            // „Ç¢„Ç∑„Çπ„ÉàÁéãÔºàÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'ü§ù „Ç¢„Ç∑„Çπ„ÉàÁéãÔºàÂêàË®àÔºâ',
                function(stats) { return stats.totalAssists; },
                'Âõû',
                false,
                'recentAst'
            );
            
            return html;
        }
        
        function calculateAllGamesRankings() {
            if (teamGames.length === 0) return '';
            
            // ÂêÑÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÈõÜË®à
            const playerStats = {};
            
            teamGames.forEach(function(game) {
                Object.keys(game.playerStats).forEach(function(playerId) {
                    const stats = game.playerStats[playerId];
                    
                    if (!playerStats[playerId]) {
                        playerStats[playerId] = {
                            gamesPlayed: 0,
                            totalPoints: 0,
                            totalRebounds: 0,
                            totalAssists: 0,
                            totalFGMade: 0,
                            totalFGAttempted: 0
                        };
                    }
                    
                    playerStats[playerId].gamesPlayed++;
                    playerStats[playerId].totalPoints += (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                    playerStats[playerId].totalRebounds += stats.offensiveRebounds + stats.defensiveRebounds;
                    playerStats[playerId].totalAssists += stats.assists;
                    playerStats[playerId].totalFGMade += stats.twoPointsMade + stats.threePointsMade;
                    playerStats[playerId].totalFGAttempted += stats.twoPointsAttempted + stats.threePointsAttempted;
                });
            });
            
            let html = '';
            
            // ÂæóÁÇπÁéãÔºàÂπ≥Âùá + ÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üèÜ ÂæóÁÇπÁéã',
                function(stats) { 
                    const avg = (stats.totalPoints / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'ÁÇπÔºàÂêàË®à' + stats.totalPoints + 'ÁÇπÔºâ' };
                },
                '',
                false,
                'allPoints',
                true
            );
            
            // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéáÔºàÂπ≥ÂùáÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üéØ „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá',
                function(stats) { 
                    return stats.totalFGAttempted > 0 ? (stats.totalFGMade / stats.totalFGAttempted * 100).toFixed(1) : 0;
                },
                '%',
                true,
                'allFG'
            );
            
            // „É™„Éê„Ç¶„É≥„ÉâÁéãÔºàÂπ≥Âùá + ÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'üì¶ „É™„Éê„Ç¶„É≥„ÉâÁéã',
                function(stats) { 
                    const avg = (stats.totalRebounds / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'Êú¨ÔºàÂêàË®à' + stats.totalRebounds + 'Êú¨Ôºâ' };
                },
                '',
                false,
                'allReb',
                true
            );
            
            // „Ç¢„Ç∑„Çπ„ÉàÁéãÔºàÂπ≥Âùá + ÂêàË®àÔºâ
            html += generateTeamRankingSection(
                playerStats,
                'ü§ù „Ç¢„Ç∑„Çπ„ÉàÁéã',
                function(stats) { 
                    const avg = (stats.totalAssists / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'ÂõûÔºàÂêàË®à' + stats.totalAssists + 'ÂõûÔºâ' };
                },
                '',
                false,
                'allAst',
                true
            );
            
            return html;
        }
        
        function generateTeamRankingSection(playerStats, title, calcFunc, unit, isPercentage, key, useCustomDisplay) {
            const playerData = [];
            
            Object.keys(playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (!player) return;
                
                const stats = playerStats[playerId];
                const result = calcFunc(stats);
                
                let value, displayValue;
                if (useCustomDisplay && typeof result === 'object') {
                    value = result.value;
                    displayValue = result.display;
                } else {
                    value = parseFloat(result);
                    displayValue = result + unit;
                }
                
                // „Ç∑„É•„Éº„ÉàÊàêÂäüÁéá„ÅÆÂ†¥Âêà„ÄÅË©¶ÊäïÊï∞„Åå0„ÅÆÈÅ∏Êâã„ÅØÈô§Â§ñ
                if (isPercentage && stats.totalFGAttempted === 0) {
                    return;
                }
                
                // ÂÄ§„Åå0‰ª•‰∏ä„ÅÆÂ†¥Âêà„ÅÆ„ÅøËøΩÂä†
                if (value > 0 || !isPercentage) {
                    playerData.push({
                        player: player,
                        value: value,
                        displayValue: displayValue
                    });
                }
            });
            
            // ÂÄ§„Åß„ÇΩ„Éº„ÉàÔºàÈôçÈ†ÜÔºâ
            playerData.sort(function(a, b) { return b.value - a.value; });
            
            if (playerData.length === 0) {
                return '';
            }
            
            let html = '<div class="ranking-section">';
            html += '<h3>' + title + '</h3>';
            
            // TOP3„ÇíË°®Á§∫
            html += '<div class="top3-container">';
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            for (let i = 0; i < Math.min(3, playerData.length); i++) {
                const data = playerData[i];
                html += '<div class="ranking-card">' +
                    '<span class="ranking-medal">' + medals[i] + '</span>' +
                    '<div class="ranking-info">' +
                    '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                    '<span class="stat-value">' + data.displayValue + '</span>' +
                    '</div>' +
                    '</div>';
            }
            html += '</div>';
            
            // ÂÖ®ÈÅ∏Êâã„É©„É≥„Ç≠„É≥„Ç∞ÔºàÊäò„Çä„Åü„Åü„ÅøÔºâ
            if (playerData.length > 3) {
                html += '<button class="toggle-rankings" onclick="toggleAllRankings(\'' + key + '\')">' +
                    '‚ñº ÂÖ®' + playerData.length + 'Âêç„ÅÆ„É©„É≥„Ç≠„É≥„Ç∞„ÇíË°®Á§∫' +
                    '</button>';
                
                html += '<div class="all-rankings" id="allRankings' + key + '">';
                playerData.forEach(function(data, index) {
                    html += '<div class="ranking-card">' +
                        '<div class="ranking-info">' +
                        '<span class="rank">' + (index + 1) + '‰Ωç</span>' +
                        '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                        '<span class="stat-value">' + data.displayValue + '</span>' +
                        '</div>' +
                        '</div>';
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }
        
        function showCreateTeamModal() {
            document.getElementById('createTeamModal').classList.add('active');
        }

        let currentEditingGameIndex = null;

        function openEditGameModal(gameIndex) {
            // „ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
            if (!teamData) {
                alert('‚ùå „ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            // „Éá„Éê„ÉÉ„Ç∞:ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÂèñÂæó„Åß„Åç„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç
            console.log('teamData:', teamData);
            console.log('ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ:', teamData.adminPassword);
            
            // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
            if (!teamData.adminPassword) {
                alert('‚ö†Ô∏è ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì\n\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Äå„ÉÅ„Éº„É†ÊÉÖÂ†±„Äç„Ç∑„Éº„ÉàB4„Çª„É´„Å´„Éë„Çπ„ÉØ„Éº„Éâ„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ\n„Åù„ÅÆÂæå„ÄÅ„Äå‰ªä„Åô„ÅêÂêåÊúü„Äç„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÁ¢∫Ë™ç
            const password = prompt('üîí ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ\n\n‚Äª„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Äå„ÉÅ„Éº„É†ÊÉÖÂ†±„Äç„Ç∑„Éº„ÉàB4„Çª„É´„ÅßÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô');
            
            if (!password) {
                return;
            }
            
            // Á©∫ÁôΩ„ÉÅ„Çß„ÉÉ„ÇØ
            if (password.trim() === '') {
                alert('‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÊ§úË®º
            const correctPassword = teamData.adminPassword || '';
            
            if (password !== correctPassword) {
                alert('‚ùå ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì\n\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÅÆ„Äå„ÉÅ„Éº„É†ÊÉÖÂ†±„Äç„Ç∑„Éº„ÉàB4„Çª„É´„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // „Éë„Çπ„ÉØ„Éº„ÉâË™çË®ºÊàêÂäü
            currentEditingGameIndex = gameIndex;
            const game = teamGames[gameIndex];
            
            // Ë©¶ÂêàÊÉÖÂ†±„ÇíÂÖ•ÂäõÊ¨Ñ„Å´Ë®≠ÂÆö
            document.getElementById('editGameDate').value = game.date;
            document.getElementById('editOpponent').value = game.opponent || '';
            
            // „Çπ„Ç≥„Ç¢„ÇíÂÖ•ÂäõÊ¨Ñ„Å´Ë®≠ÂÆö
            if (game.scores) {
                document.getElementById('editOurQ1').value = game.scores.our.q1 || 0;
                document.getElementById('editOppQ1').value = game.scores.opp.q1 || 0;
                document.getElementById('editOurQ2').value = game.scores.our.q2 || 0;
                document.getElementById('editOppQ2').value = game.scores.opp.q2 || 0;
                document.getElementById('editOurQ3').value = game.scores.our.q3 || 0;
                document.getElementById('editOppQ3').value = game.scores.opp.q3 || 0;
                document.getElementById('editOurQ4').value = game.scores.our.q4 || 0;
                document.getElementById('editOppQ4').value = game.scores.opp.q4 || 0;
            }
            
            // ÈÅ∏ÊâãÁµ±Ë®à„ÇíË°®Á§∫
            displayEditPlayerStats(game);
            
            // „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
            document.getElementById('editGameModal').classList.add('active');
        }

        function displayEditPlayerStats(game) {
            const container = document.getElementById('editPlayersList');
            let html = '';
            
            Object.keys(game.playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (!player) return;
                
                const stats = game.playerStats[playerId];
                
                html += '<div class="player-stat-edit">';
                html += '<div class="player-header">#' + player.number + ' ' + player.name + '</div>';
                html += '<div class="stat-edit-grid">';
                
                html += '<div class="stat-edit-item"><label>2PÊàêÂäü</label><input type="number" min="0" id="edit_' + playerId + '_2pm" value="' + stats.twoPointsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>2PË©¶Êäï</label><input type="number" min="0" id="edit_' + playerId + '_2pa" value="' + stats.twoPointsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>3PÊàêÂäü</label><input type="number" min="0" id="edit_' + playerId + '_3pm" value="' + stats.threePointsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>3PË©¶Êäï</label><input type="number" min="0" id="edit_' + playerId + '_3pa" value="' + stats.threePointsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>FTÊàêÂäü</label><input type="number" min="0" id="edit_' + playerId + '_ftm" value="' + stats.freeThrowsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>FTË©¶Êäï</label><input type="number" min="0" id="edit_' + playerId + '_fta" value="' + stats.freeThrowsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>„Ç™„Éï„Çß„É≥„ÇπRB</label><input type="number" min="0" id="edit_' + playerId + '_oreb" value="' + stats.offensiveRebounds + '"></div>';
                html += '<div class="stat-edit-item"><label>„Éá„Ç£„Éï„Çß„É≥„ÇπRB</label><input type="number" min="0" id="edit_' + playerId + '_dreb" value="' + stats.defensiveRebounds + '"></div>';
                html += '<div class="stat-edit-item"><label>„Ç¢„Ç∑„Çπ„Éà</label><input type="number" min="0" id="edit_' + playerId + '_ast" value="' + stats.assists + '"></div>';
                html += '<div class="stat-edit-item"><label>„Çπ„ÉÜ„Ç£„Éº„É´</label><input type="number" min="0" id="edit_' + playerId + '_stl" value="' + stats.steals + '"></div>';
                html += '<div class="stat-edit-item"><label>„Éñ„É≠„ÉÉ„ÇØ</label><input type="number" min="0" id="edit_' + playerId + '_blk" value="' + stats.blocks + '"></div>';
                html += '<div class="stat-edit-item"><label>TO</label><input type="number" min="0" id="edit_' + playerId + '_to" value="' + stats.turnovers + '"></div>';
                html += '<div class="stat-edit-item"><label>„Éï„Ç°„Ç¶„É´</label><input type="number" min="0" id="edit_' + playerId + '_foul" value="' + stats.fouls + '"></div>';
                
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        function saveGameEdit() {
            if (currentEditingGameIndex === null) return;
            
            const game = teamGames[currentEditingGameIndex];
            
            // Ë©¶ÂêàÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            game.date = document.getElementById('editGameDate').value;
            game.opponent = document.getElementById('editOpponent').value;
            
            // „Çπ„Ç≥„Ç¢„ÇíÊõ¥Êñ∞
            if (!game.scores) {
                game.scores = {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                };
            }
            
            game.scores.our.q1 = parseInt(document.getElementById('editOurQ1').value) || 0;
            game.scores.opp.q1 = parseInt(document.getElementById('editOppQ1').value) || 0;
            game.scores.our.q2 = parseInt(document.getElementById('editOurQ2').value) || 0;
            game.scores.opp.q2 = parseInt(document.getElementById('editOppQ2').value) || 0;
            game.scores.our.q3 = parseInt(document.getElementById('editOurQ3').value) || 0;
            game.scores.opp.q3 = parseInt(document.getElementById('editOppQ3').value) || 0;
            game.scores.our.q4 = parseInt(document.getElementById('editOurQ4').value) || 0;
            game.scores.opp.q4 = parseInt(document.getElementById('editOppQ4').value) || 0;
            
            // ÂêÑÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇíÊõ¥Êñ∞
            Object.keys(game.playerStats).forEach(function(playerId) {
                const stats = game.playerStats[playerId];
                
                stats.twoPointsMade = parseInt(document.getElementById('edit_' + playerId + '_2pm').value) || 0;
                stats.twoPointsAttempted = parseInt(document.getElementById('edit_' + playerId + '_2pa').value) || 0;
                stats.threePointsMade = parseInt(document.getElementById('edit_' + playerId + '_3pm').value) || 0;
                stats.threePointsAttempted = parseInt(document.getElementById('edit_' + playerId + '_3pa').value) || 0;
                stats.freeThrowsMade = parseInt(document.getElementById('edit_' + playerId + '_ftm').value) || 0;
                stats.freeThrowsAttempted = parseInt(document.getElementById('edit_' + playerId + '_fta').value) || 0;
                stats.offensiveRebounds = parseInt(document.getElementById('edit_' + playerId + '_oreb').value) || 0;
                stats.defensiveRebounds = parseInt(document.getElementById('edit_' + playerId + '_dreb').value) || 0;
                stats.assists = parseInt(document.getElementById('edit_' + playerId + '_ast').value) || 0;
                stats.steals = parseInt(document.getElementById('edit_' + playerId + '_stl').value) || 0;
                stats.blocks = parseInt(document.getElementById('edit_' + playerId + '_blk').value) || 0;
                stats.turnovers = parseInt(document.getElementById('edit_' + playerId + '_to').value) || 0;
                stats.fouls = parseInt(document.getElementById('edit_' + playerId + '_foul').value) || 0;
            });
            
            // ÂÄã‰∫∫„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
            updatePersonalGamesFromTeamGame(game);
            
            // „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
            
            // ÂêåÊúü
            if (teamData) {
                syncGamesOnly();
            }
            
            // Ë°®Á§∫„ÇíÊõ¥Êñ∞
            displayTeamGamesHistory();
            
            // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            closeModal('editGameModal');
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü!');
        }

        function updatePersonalGamesFromTeamGame(teamGame) {
    // „Åì„ÅÆË©¶Âêà„Å´Èñ¢ÈÄ£„Åô„ÇãÂÄã‰∫∫„Éá„Éº„Çø„ÇíÂÖ®„Å¶ÂâäÈô§(Ë©¶ÂêàID„ÅßÁ¢∫ÂÆü„Å´ÂâäÈô§)
    personalGames = personalGames.filter(function(g) {
        return !(g.source === 'team' && g.teamGameId === teamGame.id);
    });
    
    // Êñ∞„Åó„ÅÑÂÄã‰∫∫„Éá„Éº„Çø„Çí‰ΩúÊàê
    Object.keys(teamGame.playerStats).forEach(function(playerId) {
        const stats = teamGame.playerStats[playerId];
        const totalReb = stats.offensiveRebounds + stats.defensiveRebounds;
        const totalPts = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
        
        const personalGame = {
            id: Date.now() + Math.random(),
            date: teamGame.date,
            opponent: teamGame.opponent,
            playTime: 0,
            playerId: playerId,
            twoPointsMade: stats.twoPointsMade,
            twoPointsAttempted: stats.twoPointsAttempted,
            threePointsMade: stats.threePointsMade,
            threePointsAttempted: stats.threePointsAttempted,
            freeThrowsMade: stats.freeThrowsMade,
            freeThrowsAttempted: stats.freeThrowsAttempted,
            offensiveRebounds: stats.offensiveRebounds,
            defensiveRebounds: stats.defensiveRebounds,
            assists: stats.assists,
            steals: stats.steals,
            blocks: stats.blocks,
            turnovers: stats.turnovers,
            fouls: stats.fouls,
            totalRebounds: totalReb,
            twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
            threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
            freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
            totalPoints: totalPts,
            source: 'team',
            fromTeam: true,
            teamGameId: teamGame.id  // ‚Üê ‚òÖ„Åì„Åì„ÅåÈáçË¶Å!„ÉÅ„Éº„É†„Ç≤„Éº„É†ID„Çí‰øùÂ≠ò
        };
        
        personalGames.unshift(personalGame);
    });
    
    // Â±•Ê≠¥„ÇÑ„Ç∞„É©„Éï„ÇíÊõ¥Êñ∞
    displayGames();
    displayRankings();
    updateCharts();
}
        async function deleteGame() {
    if (currentEditingGameIndex === null) return;
    
    const game = teamGames[currentEditingGameIndex];
    const dateStr = new Date(game.date).toLocaleDateString('ja-JP');
    
    if (!confirm('‚ö†Ô∏è Êú¨ÂΩì„Å´„Åì„ÅÆË©¶Âêà„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?\n\n' + dateStr + ' vs ' + game.opponent + '\n\n„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì!')) {
        return;
    }
    
    // „É≠„Éº„Ç´„É´„ÅÆ„ÉÅ„Éº„É†„Éá„Éº„Çø„Åã„ÇâÂâäÈô§
    teamGames.splice(currentEditingGameIndex, 1);
    
    // ÂÄã‰∫∫„Éá„Éº„Çø„Åã„Çâ„ÇÇÂâäÈô§(Ë©¶ÂêàID„ÅßÁ¢∫ÂÆü„Å´ÂâäÈô§)
personalGames = personalGames.filter(function(g) {
    return !(g.source === 'team' && g.teamGameId === game.id);
});
    
    saveData();
    
    // „Çµ„Éº„Éê„Éº„Åã„Çâ„ÇÇÂâäÈô§
    if (teamData && teamData.adminPassword) {
        try {
            showSyncIndicator('syncing', '„Çµ„Éº„Éê„Éº„Åã„ÇâÂâäÈô§‰∏≠...');
            
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({
                    action: 'deleteGame',
                    teamCode: teamData.code,
                    gameId: game.id,
                    adminPassword: teamData.adminPassword
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showSyncIndicator('success', 'ÂâäÈô§ÂÆå‰∫Ü!');
            } else {
                showSyncIndicator('error', result.error || 'ÂâäÈô§Â§±Êïó');
                alert('‚ö†Ô∏è „Çµ„Éº„Éê„Éº„Åã„Çâ„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü:' + (result.error || '‰∏çÊòé„Å™„Ç®„É©„Éº'));
            }
        } catch (error) {
            console.error('ÂâäÈô§„Ç®„É©„Éº:', error);
            showSyncIndicator('error', 'ÂâäÈô§Â§±Êïó');
            alert('‚ö†Ô∏è „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü:' + error.message);
        }
    }
    
    // ÁîªÈù¢„ÇíÊõ¥Êñ∞
    displayGames();
    displayRankings();
    updateCharts();
    if (typeof displayTeamGamesHistory === 'function') {
        displayTeamGamesHistory();
    }
    
    closeModal('editGameModal');
    currentEditingGameIndex = null;
}

        
        function showJoinTeamModal() {
            document.getElementById('joinTeamModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openGlossary() {
            document.getElementById('glossaryModal').classList.add('active');
        }
        
        function generateTeamCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function createTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            if (!teamName) {
                alert('„ÉÅ„Éº„É†Âêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
        
            // „Çπ„ÉÜ„ÉÉ„Éó1: „ÉÅ„Éº„É†„Ç≥„Éº„Éâ„ÇíÁîüÊàê
            const newTeamCode = generateTeamCode();
            
            showSyncIndicator('syncing', 'üèÄ „ÉÅ„Éº„É†„Çí‰ΩúÊàê‰∏≠...\n\n„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„ÇíÊ∫ñÂÇô„Åó„Å¶„ÅÑ„Åæ„Åô');
            
            try {
                // „Çπ„ÉÜ„ÉÉ„Éó2: „Çµ„Éº„Éê„Éº„Å´„ÉÅ„Éº„É†‰ΩúÊàê„É™„ÇØ„Ç®„Çπ„Éà„ÇíÈÄÅ‰ø°
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'createTeam',
                        teamName: teamName,
                        teamCode: newTeamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const returnedTeamCode = result.teamCode || newTeamCode;
                    
                    // ‚òÖ‚òÖ‚òÖ ÈáçË¶Å: Âè§„ÅÑ„Éá„Éº„Çø„ÅåÊÆã„Å£„Å¶„ÅÑ„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çã„ÅÆ„ÅßÂÆåÂÖ®„ÇØ„É™„Ç¢ ‚òÖ‚òÖ‚òÖ
                    // „Çπ„ÉÜ„ÉÉ„Éó3: ÁèæÂú®„ÅÆ„ÉÅ„Éº„É†„ÅÆ„Éá„Éº„Çø„ÇíÂÖà„Å´‰øùÂ≠ò(„ÇÇ„Åó„ÅÇ„Çå„Å∞)
                    if (currentTeamCode && allTeamsData[currentTeamCode]) {
                        allTeamsData[currentTeamCode] = {
                            personalGames: personalGames,
                            teamGames: teamGames,
                            players: players,
                            myPlayerId: myPlayerId,
                            teamInfo: teamData,
                            draftTeamGame: draftTeamGame,
                            practiceRecords: typeof practiceRecords !== 'undefined' ? practiceRecords : [],
                            userProfile: typeof userProfile !== 'undefined' ? userProfile : undefined,
                            lastModified: new Date().toISOString()
                        };
                    }
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó4: „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„ÇíÂÆåÂÖ®„Å´„ÇØ„É™„Ç¢
                    personalGames = [];
                    teamGames = [];
                    players = [];
                    myPlayerId = null;
                    draftTeamGame = null;
                    if (typeof practiceRecords !== 'undefined') {
                        practiceRecords = [];
                    }
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó5: „ÉÅ„Éº„É†„Éá„Éº„Çø„ÇíË®≠ÂÆö
                    teamData = {
                        name: result.teamData ? result.teamData.name : teamName,
                        code: returnedTeamCode,
                        spreadsheetId: result.spreadsheetId,
                        createdAt: new Date().toISOString(),
                        adminPassword: result.teamData ? result.teamData.adminPassword : null
                    };
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó6: currentTeamCode„ÇíË®≠ÂÆö
                    currentTeamCode = returnedTeamCode;
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó7: Êñ∞„Åó„ÅÑ„ÉÅ„Éº„É†„ÅÆÁ©∫„Éá„Éº„Çø„Çí‰ΩúÊàê
                    allTeamsData[returnedTeamCode] = {
                        personalGames: [],
                        teamGames: [],
                        players: [],
                        myPlayerId: null,
                        teamInfo: teamData,
                        draftTeamGame: null,
                        practiceRecords: [],
                        userProfile: typeof userProfile !== 'undefined' ? {
                            totalXP: 0,
                            level: 1,
                            currentStreak: 0,
                            longestStreak: 0,
                            lastPracticeDate: null
                        } : undefined,
                        lastModified: new Date().toISOString()
                    };
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó8: „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                    localStorage.setItem('allTeamsData', JSON.stringify(allTeamsData));
                    localStorage.setItem('currentTeamCode', currentTeamCode);
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó9: ÁîªÈù¢„ÇíÊõ¥Êñ∞
                    displayPlayers();
                    updateMyPlayerSelect();
                    displayGames();
                    displayRankings();
                    updateCharts();
                    displayTeamStatus();
                    displayTeamList();
                    if (typeof displayTeamGamesHistory === 'function') {
                        displayTeamGamesHistory();
                    }
                    
                    // „Çπ„ÉÜ„ÉÉ„Éó10: ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
                    showSyncIndicator('success', '‚úÖ „ÉÅ„Éº„É†‰ΩúÊàêÂÆå‰∫Ü!');
                    closeModal('createTeamModal');
                    document.getElementById('newTeamName').value = '';
                    
                    alert('‚úÖ „ÉÅ„Éº„É†„Äå' + teamName + '„Äç„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü!\n\n„ÉÅ„Éº„É†„Ç≥„Éº„Éâ: ' + returnedTeamCode);
                    
                } else {
                    throw new Error(result.error || '„ÉÅ„Éº„É†‰ΩúÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„Ç®„É©„Éº:', error);
                showSyncIndicator('error', '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                alert('‚ùå „Ç®„É©„Éº: ' + error.message + '\n\n„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ„ÄÇ');
            }
        }
        
        async function joinTeam() {
            const teamCode = document.getElementById('joinTeamCode').value.trim().toUpperCase();
            if (!teamCode || teamCode.length !== 6) {
                alert('Ê≠£„Åó„ÅÑ6Ê°Å„ÅÆ„ÉÅ„Éº„É†„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
        
            showSyncIndicator('syncing', 'ü§ù „ÉÅ„Éº„É†„Å´ÂèÇÂä†‰∏≠...\n\n„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        action: 'joinTeam',
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£: ÂÖà„Å´switchTeam ‚òÖ‚òÖ‚òÖ
                    switchTeam(teamCode);
                    
                    // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£: Âæå„ÅßteamData„ÇíË®≠ÂÆö ‚òÖ‚òÖ‚òÖ
                    teamData = {
                        name: result.teamData ? result.teamData.name : '„ÉÅ„Éº„É†',
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        joinedAt: new Date().toISOString()
                    };
                    
                    // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£: allTeamsData„Å´‰øùÂ≠ò ‚òÖ‚òÖ‚òÖ
                    allTeamsData[teamCode].teamInfo = teamData;
                    
                    closeModal('joinTeamModal');
                    
                    // „Éá„Éº„Çø„ÇíÂèñÂæó
                    await loadTeamData();
                    
                    // ÁîªÈù¢„ÇíÊõ¥Êñ∞
                    saveData();
                    displayTeamStatus();
                    displayPlayers();
                    updateMyPlayerSelect();
                    displayTeamList();
                    
                    showSyncIndicator('success', '‚úÖ „ÉÅ„Éº„É†ÂèÇÂä†ÂÆå‰∫ÜÔºÅ');
                    alert('‚úÖ „ÉÅ„Éº„É†„Äå' + teamData.name + '„Äç„Å´ÂèÇÂä†„Åó„Åæ„Åó„Åü!');
                } else {
                    throw new Error(result.error || '„ÉÅ„Éº„É†ÂèÇÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            } catch (error) {
                console.error('„Ç®„É©„Éº:', error);
                showSyncIndicator('error', '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü');
                alert('‚ùå „Ç®„É©„Éº: ' + error.message);
            }
        }
        async function syncWithServer(options = { pushPlayers: false, pushGames: true }) {
    if (!teamData) return;

    showSyncIndicator('syncing', 'üì§ „Éá„Éº„Çø„ÇíÈÄÅ‰ø°‰∏≠...\n\n„Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ');

    try {
        const payload = {
            action: 'syncData',
            teamCode: teamData.code
        };

        // Êñ∞Ë¶èËøΩÂä†„Åó„ÅüÈÅ∏Êâã„Å†„ÅëÈÄÅ„Çã(ÂæåËø∞„ÅÆ addPlayer „Åß _localNew „Çí‰ªò„Åë„Çã)
        if (options.pushPlayers) {
            const newPlayers = players.filter(p => p && p._localNew === true);
            if (newPlayers.length > 0) payload.players = newPlayers;
        }

        if (options.pushGames) {
            payload.games = teamGames;
        }

        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        if (!result.success) throw new Error(result.error || 'syncData failed');

        // ÈÄÅ‰ø°„Å´ÊàêÂäü„Åó„Åü"Êñ∞Ë¶èÈÅ∏Êâã"„ÅØ„Éï„É©„Ç∞„ÇíÂ§ñ„Åó„Å¶„Åä„Åè
        if (options.pushPlayers) {
            players.forEach(p => { if (p._localNew) p._localNew = false; });
        }

        showSyncIndicator('success', '‚úÖ ÈÄÅ‰ø°ÂÆå‰∫ÜÔºÅ');
    } catch (e) {
        console.error(e);
        showSyncIndicator('error', '‚ùå ÈÄÅ‰ø°Â§±Êïó\n\n' + e.message);
    }
}

// ‚ñº‚ñº‚ñº ËøΩÂä†:Ë©¶Âêà„Å†„Åë„ÇíÈÄÅ„ÇãÂêåÊúü(ÈÅ∏Êâã„ÅØÈÄÅ„Çâ„Å™„ÅÑ) ‚ñº‚ñº‚ñº
async function syncGamesOnly() {
  if (!teamData) return;

  showSyncIndicator('syncing', 'ÂêåÊúü‰∏≠...');

  try {
    const payload = {
      action: 'syncData',
      teamCode: teamData.code,
      // ‚Üê ÈÅ∏Êâã„ÅØÈÄÅ„Çâ„Å™„ÅÑ
      games: teamGames       // ‚Üê Ë©¶Âêà„Å†„ÅëÈÄÅ„Çã
    };

    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    });

    const result = await response.json();
    if (!result.success) throw new Error(result.error || 'syncData failed');

    showSyncIndicator('success', 'ÈÄÅ‰ø°ÂÆå‰∫Ü');
  } catch (e) {
    console.error(e);
    showSyncIndicator('error', 'ÂêåÊúüÂ§±Êïó:' + e.message);
  }
}
// ‚ñ≤‚ñ≤‚ñ≤ ËøΩÂä†„Åì„Åì„Åæ„Åß ‚ñ≤‚ñ≤‚ñ≤
        
        
        // ‚ñº‚ñº‚ñº „Åì„Åì„Åã„ÇâËøΩÂä†:ÈÄÅÂèó‰ø°„Åæ„Å®„ÇÅ„Å¶Ë°å„ÅÜ ‚ñº‚ñº‚ñº
async function syncAll() {
  if (!teamData) { alert('„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì'); return; }
  showSyncIndicator('syncing', 'üîÑ „Éá„Éº„Çø„ÇíÂêåÊúü‰∏≠...\n\nÈÄÅ‰ø°„Å®Âèó‰ø°„ÇíË°å„Å£„Å¶„ÅÑ„Åæ„Åô\n„Åó„Å∞„Çâ„Åè„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ');

  try {
    // 1) „Åæ„Åö„Çµ„Éº„Éê„Éº„Åã„ÇâÊúÄÊñ∞„Éá„Éº„Çø„ÇíÂèñÂæó(Âèó‰ø°ÂÑ™ÂÖà)
    await loadTeamData();

    // 2) ÁîªÈù¢„ÇíÊúÄÊñ∞Âåñ
    displayPlayers();
    updateMyPlayerSelect();
    displayGames();
    displayRankings();
    updateCharts();

    showSyncIndicator('success', '‚úÖ ÂêåÊúüÂÆå‰∫ÜÔºÅ\n\nÊúÄÊñ∞„ÅÆ„Éá„Éº„Çø„Å´Êõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü');
  } catch (e) {
    console.error(e);
    showSyncIndicator('error', '‚ùå ÂêåÊúü„Å´Â§±Êïó„Åó„Åæ„Åó„Åü\n\n„Éç„ÉÉ„Éà„ÉØ„Éº„ÇØ„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
  }
}
// ‚ñ≤‚ñ≤‚ñ≤ ËøΩÂä†„Åì„Åì„Åæ„Åß ‚ñ≤‚ñ≤‚ñ≤


        async function loadTeamData() {
    if (!teamData) return;
    
    showSyncIndicator('syncing', 'üì• „Éá„Éº„Çø„ÇíÂèñÂæó‰∏≠...\n\n„Çµ„Éº„Éê„Éº„Åã„ÇâË™≠„ÅøËæº„Çì„Åß„ÅÑ„Åæ„Åô');
    
    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain',
            },
            body: JSON.stringify({
                action: 'getData',
                teamCode: teamData.code
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            let addedCount = 0;
            
            // ÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíteamData„Å´‰øùÂ≠ò
if (result.teamData && result.teamData.adminPassword) {
    teamData.adminPassword = result.teamData.adminPassword;
    saveData();  // „Åô„Åê„Å´‰øùÂ≠ò
}
            
            // ÈÅ∏Êâã„Éá„Éº„Çø„ÇíÂèñÂæó(„Çµ„Éº„Éê„Éº„ÅÆ„Éá„Éº„Çø„ÅßÂÆåÂÖ®„Å´‰∏äÊõ∏„Åç)
if (result.players) {
    // „Çµ„Éº„Éê„Éº„ÅÆ„Éá„Éº„Çø„Çí‰ø°È†º„Åó„Å¶ÂÆåÂÖ®„Å´ÁΩÆ„ÅçÊèõ„Åà„Çã
    players = result.players.map(function(serverPlayer) {
        serverPlayer._localNew = false;
        return serverPlayer;
    });
    addedCount = players.length;
}
            
            // Ë©¶Âêà„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶personalGames„Å´Â§âÊèõ
            if (result.games) {
                // „Çµ„Éº„Éê„Éº„ÅÆ„Éá„Éº„Çø„ÅßÂÆåÂÖ®„Å´‰∏äÊõ∏„Åç„Åô„Çã
                teamGames = [];
                personalGames = personalGames.filter(function(g) {
                    return g.source !== 'team';
                });
                
                result.games.forEach(function(game) {
                    teamGames.push(game);
                    
                    // ÂêÑÈÅ∏Êâã„ÅÆ„Éá„Éº„Çø„ÇípersonalGames„Å´ËøΩÂä†
                    Object.keys(game.playerStats).forEach(function(playerId) {
                        const stats = game.playerStats[playerId];
                        const totalReb = stats.offensiveRebounds + stats.defensiveRebounds;
                        const totalPts = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                        
                        const personalGame = {
                            id: Date.now() + Math.random(),
                            date: game.date,
                            opponent: game.opponent,
                            playTime: 0,
                            playerId: playerId,
                            twoPointsMade: stats.twoPointsMade,
                            twoPointsAttempted: stats.twoPointsAttempted,
                            threePointsMade: stats.threePointsMade,
                            threePointsAttempted: stats.threePointsAttempted,
                            freeThrowsMade: stats.freeThrowsMade,
                            freeThrowsAttempted: stats.freeThrowsAttempted,
                            offensiveRebounds: stats.offensiveRebounds,
                            defensiveRebounds: stats.defensiveRebounds,
                            assists: stats.assists,
                            steals: stats.steals,
                            blocks: stats.blocks,
                            turnovers: stats.turnovers,
                            fouls: stats.fouls,
                            totalRebounds: totalReb,
                            twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                            threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                            freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                            totalPoints: totalPts,
                            source: 'team',
                            teamGameId: game.id  // ‚Üê „Åì„ÅÆË°å„ÇíËøΩÂä†
                        };
                        
                        personalGames.unshift(personalGame);
                    });
                });
            }
            
            saveData();
            
            const gameCount = result.games ? result.games.length : 0;
            showSyncIndicator('success', addedCount + '‰∫∫„ÅÆÈÅ∏Êâã„ÄÅ' + gameCount + 'Ë©¶Âêà„ÅÆ„Éá„Éº„Çø„ÇíÂèñÂæó');
            
            return addedCount;
        } else {
            showSyncIndicator('error', '‚ùå „Éá„Éº„ÇøÂèñÂæóÂ§±Êïó\n\n' + error.message);
        }
    } catch (error) {
        console.error('„Éá„Éº„ÇøÂèñÂæó„Ç®„É©„Éº:', error);
        showSyncIndicator('error', '‚ùå „Éá„Éº„ÇøÂèñÂæóÂ§±Êïó\n\n' + error.message);
    }
}
        function displayTeamStatus() {
            const statusEl = document.getElementById('teamStatus');
            
            // ‚òÖ‚òÖ‚òÖ „Éá„Éê„ÉÉ„Ç∞Áî® ‚òÖ‚òÖ‚òÖ
            console.log('displayTeamStatus called');
            console.log('teamData:', teamData);
            console.log('teamStatus element:', document.getElementById('teamStatus'));
            
            if (!statusEl) {
                console.error('teamStatusË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            if (!teamData) {
                console.log('teamData„Åånull„ÅÆ„Åü„ÇÅ„ÄÅÊú™ÂèÇÂä†„É°„ÉÉ„Çª„Éº„Ç∏„ÇíË°®Á§∫');
                statusEl.innerHTML = '<p style="color: #999; text-align: center;">„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                return;
            }
            
            // ‚òÖ‚òÖ‚òÖ ËøΩÂä†: teamData„ÅÆÂÄ§„ÇíÁ¢∫Ë™ç ‚òÖ‚òÖ‚òÖ
            const teamName = teamData.name || '„ÉÅ„Éº„É†ÂêçÊú™Ë®≠ÂÆö';
            const teamCode = teamData.code || '‰∏çÊòé';

            console.log('„ÉÅ„Éº„É†ÊÉÖÂ†±„ÇíË°®Á§∫:', teamData.name, teamData.code);
            console.log('Ë°®Á§∫„Åô„Çã„ÉÅ„Éº„É†Âêç:', teamName);
            console.log('Ë°®Á§∫„Åô„Çã„ÉÅ„Éº„É†„Ç≥„Éº„Éâ:', teamCode);
            
            statusEl.innerHTML = 
                '<div class="team-code-display">' +
                '<div style="font-size: 0.9em; color: #666;">ÁèæÂú®„ÅÆ„ÉÅ„Éº„É†</div>' +
                '<div style="font-size: 1.3em; font-weight: bold; color: #667eea; margin: 10px 0;">' + teamName + '</div>' +
                '<div style="font-size: 0.9em; color: #666;">„ÉÅ„Éº„É†„Ç≥„Éº„Éâ</div>' +
                '<div class="code">' + teamCode + '</div>' +
                '<button class="primary-btn" style="background: #2ecc71; margin-top: 15px;" onclick="syncAll()">‰ªä„Åô„ÅêÂêåÊúü(ÈÄÅÂèó‰ø°)</button>' +
                '<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="leaveTeam()">„ÉÅ„Éº„É†„Åã„ÇâÈÄÄÂá∫</button>' +
                '</div>';
            displayTeamList();
        }

        function leaveTeam() {
            if (!currentTeamCode || !teamData) {
                alert('„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                return;
            }
            
            const teamNameToLeave = teamData.name;
            const teamCodeToLeave = currentTeamCode;
            
            const message = 
                '‚ö†Ô∏è „ÉÅ„Éº„É†ÈÄÄÂá∫„ÅÆÁ¢∫Ë™ç\n\n' +
                '„ÉÅ„Éº„É†„Äå' + teamNameToLeave + '„Äç„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åô„Åã?\n\n' +
                '„Äê„Åì„ÅÆ„Çπ„Éû„Éõ„Åã„ÇâÂâäÈô§„Åï„Çå„Çã„ÇÇ„ÅÆ„Äë\n' +
                '‚Ä¢ „ÉÅ„Éº„É†ÊÉÖÂ†±\n' +
                '‚Ä¢ ÈÅ∏Êâã„Éá„Éº„Çø\n' +
                '‚Ä¢ Ë©¶ÂêàË®òÈå≤\n' +
                (typeof practiceRecords !== 'undefined' ? '‚Ä¢ Á∑¥ÁøíË®òÈå≤\n' : '') +
                '\n' +
                '„ÄêÂΩ±ÈüøÁØÑÂõ≤„Äë\n' +
                '‚Ä¢ „Åì„ÅÆ„Çπ„Éû„Éõ„Åã„Çâ„ÅÆ„ÅøÂâäÈô§„Åï„Çå„Åæ„Åô\n' +
                '‚Ä¢ Google Sheets„ÅÆ„Éá„Éº„Çø„ÅØÊÆã„Çä„Åæ„Åô\n' +
                '‚Ä¢ ‰ªñ„ÅÆ„É°„É≥„Éê„Éº„Å´„ÅØÂΩ±Èüø„ÅÇ„Çä„Åæ„Åõ„Çì\n' +
                '‚Ä¢ Âæå„ÅßÂÜçÂ∫¶ÂèÇÂä†„Åô„Çã„Åì„Å®„ÇÇ„Åß„Åç„Åæ„Åô\n\n' +
                'Êú¨ÂΩì„Å´ÈÄÄÂá∫„Åó„Åæ„Åô„Åã?';
            
            if (!confirm(message)) {
                return;
            }
            
            try {
                console.log('üö™ „ÉÅ„Éº„É†„Åã„ÇâÈÄÄÂá∫ÈñãÂßã:', teamCodeToLeave);
                
                // ‚òÖ‚òÖ‚òÖ ÈáçË¶Å: ÂÖà„Å´currentTeamCode„Çí„ÇØ„É™„Ç¢„Åó„Å¶„ÄÅsaveData()„ÅßÂÜç‰øùÂ≠ò„Åï„Çå„Å™„ÅÑ„Çà„ÅÜ„Å´„Åô„Çã ‚òÖ‚òÖ‚òÖ
                const tempCurrentCode = currentTeamCode;
                currentTeamCode = null;  // ‚Üê „Åì„Çå„ÅåÈáçË¶Å!
                
                console.log('üìå allTeamsDataÂâäÈô§Ââç:', Object.keys(allTeamsData));
                
                // allTeamsData„Åã„ÇâÂâäÈô§
                if (allTeamsData[teamCodeToLeave]) {
                    delete allTeamsData[teamCodeToLeave];
                    console.log('‚úÖ allTeamsData„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü:', teamCodeToLeave);
                    console.log('üìå allTeamsDataÂâäÈô§Âæå:', Object.keys(allTeamsData));
                }
                
                // localStorage„ÇíÊõ¥Êñ∞
                localStorage.setItem('allTeamsData', JSON.stringify(allTeamsData));
                localStorage.removeItem('currentTeamCode');
                console.log('üíæ localStorage„Å´‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
                
                // ÊÆã„Çä„ÅÆ„ÉÅ„Éº„É†„ÇíÁ¢∫Ë™ç
                const remainingTeams = Object.keys(allTeamsData);
                console.log('üìä ÊÆã„Çä„ÅÆ„ÉÅ„Éº„É†Êï∞:', remainingTeams.length);
                
                if (remainingTeams.length > 0) {
                    // Âà•„ÅÆ„ÉÅ„Éº„É†„Å´Âàá„ÇäÊõø„Åà
                    const nextTeamCode = remainingTeams[0];
                    console.log('üîÑ Âà•„ÅÆ„ÉÅ„Éº„É†„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô:', nextTeamCode);
                    
                    // switchTeam()„ÇíÂëº„Å∂Ôºà„Åì„Çå„ÅåcurrentTeamCode„ÇíË®≠ÂÆö„Åô„ÇãÔºâ
                    switchTeam(nextTeamCode);
                    
                } else {
                    // ÂÖ®ÈÉ®ÂàùÊúüÂåñ
                    console.log('üîÑ ÂÖ®„ÉÅ„Éº„É†„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åó„Åü');
                    
                    teamData = null;
                    personalGames = [];
                    teamGames = [];
                    players = [];
                    myPlayerId = null;
                    draftTeamGame = null;
                    
                    if (typeof practiceRecords !== 'undefined') {
                        practiceRecords = [];
                    }
                    if (typeof userProfile !== 'undefined') {
                        userProfile = {
                            totalXP: 0,
                            level: 1,
                            currentStreak: 0,
                            longestStreak: 0,
                            lastPracticeDate: null
                        };
                    }
                    
                    // ÁîªÈù¢„ÇíÊõ¥Êñ∞
                    console.log('üîÑ ÁîªÈù¢„ÇíÊõ¥Êñ∞„Åó„Åæ„Åô');
                    displayPlayers();
                    if (typeof updateMyPlayerSelect === 'function') {
                        updateMyPlayerSelect();
                    }
                    displayGames();
                    displayRankings();
                    updateCharts();
                    displayTeamStatus();
                    displayTeamList();
                    if (typeof displayTeamGamesHistory === 'function') {
                        displayTeamGamesHistory();
                    }
                    
                    alert('‚úÖ „ÉÅ„Éº„É†„Äå' + teamNameToLeave + '„Äç„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åó„Åü\n\n„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Å™„ÅÑÁä∂ÊÖã„Å´„Å™„Çä„Åæ„Åó„Åü');
                    return;
                }
                
                alert('‚úÖ „ÉÅ„Éº„É†„Äå' + teamNameToLeave + '„Äç„Åã„ÇâÈÄÄÂá∫„Åó„Åæ„Åó„Åü');
                console.log('üéâ ÈÄÄÂá∫Âá¶ÁêÜ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü');
                
            } catch (error) {
                console.error('‚ùå „ÉÅ„Éº„É†ÈÄÄÂá∫„Ç®„É©„Éº:', error);
                alert('‚ö†Ô∏è „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
        document.getElementById('gameDate').valueAsDate = new Date();
        document.getElementById('teamGameDate').valueAsDate = new Date();

        function switchMode(mode) {
           currentMode = mode;
           localStorage.setItem('lastMode', mode);
            
            // „Åô„Åπ„Å¶„ÅÆ„Éú„Çø„É≥„ÅÆ„Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„Çí„É™„Çª„ÉÉ„Éà
            document.querySelectorAll('.mode-btn').forEach(function(btn) {
               btn.classList.remove('active');
               btn.classList.remove('team-mode');
           });
            
            // ËÉåÊôØËâ≤„Çí„É™„Çª„ÉÉ„Éà
           document.body.classList.remove('personal-mode', 'team-mode');
           
            // „Åô„Åπ„Å¶„ÅÆ„É¢„Éº„Éâ„ÇíÈùûË°®Á§∫
            document.getElementById('personalMode').style.display = 'none';
            document.getElementById('teamMode').style.display = 'none';
            document.getElementById('settingsMode').style.display = 'none';
            
            // ÈÅ∏Êäû„Åï„Çå„Åü„É¢„Éº„Éâ„ÇíË°®Á§∫
           if (mode === 'personal') {
                document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
                document.getElementById('personalMode').style.display = 'block';
                document.body.classList.add('personal-mode');
                displayGames();
            } else if (mode === 'team') {
                const teamBtn = document.querySelector('.mode-btn:nth-child(2)');
                teamBtn.classList.add('active');
                teamBtn.classList.add('team-mode');
                document.getElementById('teamMode').style.display = 'block';
                document.body.classList.add('team-mode');
            } else if (mode === 'settings') {
                document.querySelector('.mode-btn:nth-child(3)').classList.add('active');
                document.getElementById('settingsMode').style.display = 'block';
                displayPlayers();           // ‚Üê ËøΩÂä†
                updateMyPlayerSelect();     // ‚Üê ËøΩÂä†
                displayTeamStatus();        // ‚Üê ËøΩÂä†Ôºà„Åì„Çå„ÅåÈáçË¶ÅÔºÅÔºâ
           }
        }
        
        function switchTab(tab) {
            document.querySelectorAll('#personalMode .tab').forEach(function(t) {
                t.classList.remove('active');
            });
            document.querySelectorAll('#personalMode .tab-content').forEach(function(c) {
                c.classList.remove('active');
            });
            
            // ‚≠ê „Åæ„Åö„ÅØ„Ç∑„É≥„Éó„É´„Å´Âãï„Åè„Éê„Éº„Ç∏„Éß„É≥„Å´Êàª„Åô ‚≠ê
            if (tab === 'input') {
                document.querySelector('#personalMode .tab:nth-child(1)').classList.add('active');
                document.getElementById('inputTab').classList.add('active');
            } else if (tab === 'list') {
                document.querySelector('#personalMode .tab:nth-child(2)').classList.add('active');
                document.getElementById('listTab').classList.add('active');
            } else if (tab === 'ranking') {
                document.querySelector('#personalMode .tab:nth-child(3)').classList.add('active');
                document.getElementById('rankingTab').classList.add('active');
                displayRankings();
            } else if (tab === 'graph') {
                document.querySelector('#personalMode .tab:nth-child(4)').classList.add('active');
                document.getElementById('graphTab').classList.add('active');
                updateCharts();
            } else if (tab === 'practice') {
                document.querySelector('#personalMode .tab:nth-child(5)').classList.add('active');
                document.getElementById('practiceTab').classList.add('active');
                document.getElementById('practiceDate').valueAsDate = new Date();
                displayPracticeHistory();
                updateStreakDisplay();
                displayPracticeCalendar();
            }
        }

        function changeValue(key, delta) {
            stats[key] = Math.max(0, stats[key] + delta);
            
            if (key === 'twoPointsMade' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsAttempted = stats.twoPointsMade;
            }
            if (key === 'twoPointsAttempted' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsMade = stats.twoPointsAttempted;
            }
            if (key === 'threePointsMade' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsAttempted = stats.threePointsMade;
            }
            if (key === 'threePointsAttempted' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsMade = stats.threePointsAttempted;
            }
            if (key === 'freeThrowsMade' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsAttempted = stats.freeThrowsMade;
            }
            if (key === 'freeThrowsAttempted' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsMade = stats.freeThrowsAttempted;
            }
            
            updateDisplay();
        }

        function updateDisplay() {
            Object.keys(stats).forEach(function(key) {
                const el = document.getElementById(key);
                if (el) el.textContent = stats[key];
            });
            
            const twoP = stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0';
            const threeP = stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0';
            const ft = stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0';
            const totalPoints = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            
            document.getElementById('twoPointPercentage').textContent = twoP + '%';
            document.getElementById('threePointPercentage').textContent = threeP + '%';
            document.getElementById('freeThrowPercentage').textContent = ft + '%';
            document.getElementById('totalPoints').textContent = totalPoints;
            
            // ÂàÜÊï∞„ÇíË°®Á§∫
            document.getElementById('twoPointFraction').textContent = '(' + stats.twoPointsMade + '/' + stats.twoPointsAttempted + ')';
            document.getElementById('threePointFraction').textContent = '(' + stats.threePointsMade + '/' + stats.threePointsAttempted + ')';
            document.getElementById('freeThrowFraction').textContent = '(' + stats.freeThrowsMade + '/' + stats.freeThrowsAttempted + ')';
        }
        function savePersonalGame() {
            const date = document.getElementById('gameDate').value;
            if (!date) {
                alert('Ë©¶ÂêàÊó•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const saveBtn = document.getElementById('saveGameBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = '‰øùÂ≠ò‰∏≠...';

            const game = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('opponent').value.trim(),
                playTime: parseInt(document.getElementById('playTime').value) || 0,
                playerId: myPlayerId,
                twoPointsMade: stats.twoPointsMade,
                twoPointsAttempted: stats.twoPointsAttempted,
                threePointsMade: stats.threePointsMade,
                threePointsAttempted: stats.threePointsAttempted,
                freeThrowsMade: stats.freeThrowsMade,
                freeThrowsAttempted: stats.freeThrowsAttempted,
                offensiveRebounds: stats.offensiveRebounds,
                defensiveRebounds: stats.defensiveRebounds,
                assists: stats.assists,
                steals: stats.steals,
                blocks: stats.blocks,
                turnovers: stats.turnovers,
                fouls: stats.fouls,
                totalRebounds: stats.offensiveRebounds + stats.defensiveRebounds,
                twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                totalPoints: (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade,
                source: 'personal'
            };

            // ==================== Week 7-8: XPÂá¶ÁêÜ„ÇíËøΩÂä† ÈñãÂßã ====================
            
            // XP„ÇíË®àÁÆó
            const xpData = calculateGameXP(game);
            
            // XP„Çí„Ç≤„Éº„É†„Éá„Éº„Çø„Å´Ë®òÈå≤
            game.xpEarned = xpData.total;
            game.xpBreakdown = xpData.breakdown;
            
            // „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç°„Ç§„É´„ÅÆXP„ÇíÂ¢ó„ÇÑ„Åô
            userProfile.totalXP += xpData.total;
            
            // ==================== Week 7-8: XPÂá¶ÁêÜ„ÇíËøΩÂä† ÁµÇ‰∫Ü ====================

            personalGames.unshift(game);
            saveData();
            
            if (teamData) {
                syncGamesOnly();
            }
            
            // ==================== Week 7-8: XP„Éª„É¨„Éô„É´„Ç¢„ÉÉ„ÉóË°®Á§∫„ÇíËøΩÂä† ÈñãÂßã ====================
            
            // XPÁç≤Âæó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë°®Á§∫
            showXPAnimation(xpData);
            
            // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„ÉÅ„Çß„ÉÉ„ÇØ
            checkLevelUp();
            
            // ==================== Week 7-8: XP„Éª„É¨„Éô„É´„Ç¢„ÉÉ„ÉóË°®Á§∫„ÇíËøΩÂä† ÁµÇ‰∫Ü ====================
            
            displayGames();
            resetForm();
            
            saveBtn.disabled = false;
            saveBtn.textContent = 'Ë®òÈå≤„Çí‰øùÂ≠ò';
            
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!');
        }
        function resetForm() {
            Object.keys(stats).forEach(function(key) {
                stats[key] = 0;
            });
            document.getElementById('gameDate').valueAsDate = new Date();
            document.getElementById('opponent').value = '';
            document.getElementById('playTime').value = 0;
            updateDisplay();
        }

        function displayGames() {
    updatePlayerBanners();
    const gameList = document.getElementById('gameList');
    
    // myPlayerId„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØÂÖ®„Éá„Éº„Çø„ÇíË°®Á§∫
    const myGames = myPlayerId 
        ? personalGames.filter(function(g) {
            return !g.playerId || g.playerId === myPlayerId;
          })
        : personalGames;
    
    if (myGames.length === 0) {
        gameList.innerHTML = '<div class="empty-state"><div class="icon">üèÄ</div><h3>„Åæ„Å†Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3><p>ÊúÄÂàù„ÅÆË©¶Âêà„ÇíË®òÈå≤„Åó„Åæ„Åó„Çá„ÅÜ!</p></div>';
        return;
    }

            gameList.innerHTML = myGames.map(function(g) {
                const dateObj = new Date(g.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                const sourceLabel = g.source === 'team' ? ' <span style="background: #2ecc71; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">Ë©¶ÂêàË®òÈå≤</span>' : '';
                
                return '<div class="game-item">' +
                    '<div class="game-date">' + dateStr + 
                    (g.opponent ? ' vs ' + g.opponent : '') + 
                    (g.playTime ? ' (' + g.playTime + 'ÂàÜ)' : '') + 
                    sourceLabel +
                    '</div>' +
                    '<div class="game-stats">' +
                    '<div class="stat-box"><div class="label">Á∑èÂæóÁÇπ</div><div class="value">' + g.totalPoints + 'ÁÇπ</div></div>' +
                    '<div class="stat-box"><div class="label">2PÁéá</div><div class="value">' + g.twoPointPercentage + '%</div><div class="fraction">(' + g.twoPointsMade + '/' + g.twoPointsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">3PÁéá</div><div class="value">' + g.threePointPercentage + '%</div><div class="fraction">(' + g.threePointsMade + '/' + g.threePointsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">FTÁéá</div><div class="value">' + g.freeThrowPercentage + '%</div><div class="fraction">(' + g.freeThrowsMade + '/' + g.freeThrowsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">„É™„Éê„Ç¶„É≥„Éâ</div><div class="value">' + g.totalRebounds + '</div></div>' +
                    '<div class="stat-box"><div class="label">„Ç¢„Ç∑„Çπ„Éà</div><div class="value">' + g.assists + '</div></div>' +
                    '</div>' +
                    '<button class="shot-chart-button" onclick="showShotChart(\'' + g.id + '\')">üéØ „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„ÇíË¶ã„Çã</button>' +
                    '</div>';
            }).join('');
        }

        // ========== „Åì„Åì„Åã„ÇâËøΩÂä† ==========
        
        // „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showShotChart(gameId) {
    // „Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ÔºàÊú¨Áï™Áí∞Â¢É„Åß„ÅØÂâäÈô§ÂèØËÉΩÔºâ
    console.log('showShotChart called:', {
        gameId: gameId,
        type: typeof gameId,
        fromTeam: personalGames.find(g => g.id === gameId)?.fromTeam
    });
    
    // ÊñáÂ≠óÂàó„Å®„Åó„Å¶Ê∏°„Åï„Çå„ÇãÂ†¥Âêà„Åå„ÅÇ„Çã„ÅÆ„ÅßÊï∞ÂÄ§„Å´Â§âÊèõ
    const numericId = typeof gameId === 'string' ? parseFloat(gameId) : gameId;
    const game = personalGames.find(g => g.id === numericId);
    
    if (!game) {
        alert('Ë©¶Âêà„Éá„Éº„Çø„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
        console.error('Ë©¶Âêà„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', {
            searchId: numericId,
            availableIds: personalGames.map(g => g.id)
        });
        return;
    }
    
    // fromTeam„ÉÅ„Çß„ÉÉ„ÇØ
    if (!game.fromTeam) {
        console.warn('fromTeam„Ååfalse„Åæ„Åü„ÅØundefined:', game);
    }
    
    // „ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅßË®òÈå≤„Åï„Çå„ÅüË©¶Âêà„ÅÆÂ†¥Âêà
    if ((game.fromTeam || game.source === 'team') && teamGames) {
        const teamGame = teamGames.find(tg => tg.id === game.teamGameId);
        
        if (teamGame && teamGame.plays) {
            // Ëá™ÂàÜ„ÅÆ„Éó„É¨„Ç§„Å†„Åë„Çí„Éï„Ç£„É´„Çø„Éº
            const myPlays = teamGame.plays.filter(p => p.playerId === game.playerId);
            
            if (myPlays.length === 0) {
                alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Éó„É¨„Ç§Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                console.warn('„Éó„É¨„Ç§„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì:', {
                    teamGameId: game.teamGameId,
                    playerId: game.playerId,
                    totalPlays: teamGame.plays.length
                });
                return;
            }
            
            showShotChartModal(myPlays, game.opponent, game.date);
        } else {
            alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
        }
    } else {
        alert('„Åì„ÅÆË©¶Âêà„ÅØ„ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅßË®òÈå≤„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„ÇíË°®Á§∫„Åß„Åç„Åæ„Åõ„Çì');
        console.warn('„ÉÅ„Éº„É†„É¢„Éº„Éâ„Åß„ÅØ„Å™„ÅÑ:', {
            fromTeam: game.fromTeam,
            source: game.source,
            teamGamesExists: !!teamGames
        });
    }
}
        
       
        // „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà„É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
        function showShotChartModal(plays, opponent, date) {
            // „Éó„É¨„Ç§„Éá„Éº„Çø„ÅÆÁ¢∫Ë™ç
            if (!plays || plays.length === 0) {
                alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Éó„É¨„Ç§„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // „Ç∑„É•„Éº„ÉàÁ≥ª„ÅÆ„Éó„É¨„Ç§„ÅÆ„Åø„Çí„Éï„Ç£„É´„Çø„ÉºÔºàplayType„Çí‰ΩøÁî®Ôºâ
            const shotPlays = plays.filter(p => 
                (p.playType === '2p-made' || p.playType === '2p-miss' || 
                 p.playType === '3p-made' || p.playType === '3p-miss') &&
                p.position && p.position.x !== undefined && p.position.y !== undefined
            );
            
            if (shotPlays.length === 0) {
                alert('„Åì„ÅÆË©¶Âêà„Å´„ÅØ„Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÅÆË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì\n\n„ÉÅ„Éº„É†„É¢„Éº„Éâ„ÅÆ„ÄåË®òÈå≤„Äç„Çø„Éñ„Åß„Ç∑„É•„Éº„Éà„ÇíË®òÈå≤„Åô„ÇãÈöõ„Å´„ÄÅ„Ç≥„Éº„Éà‰∏ä„ÅÆ‰ΩçÁΩÆ„Çí„Çø„ÉÉ„Éó„Åô„Çã„Å®Ë®òÈå≤„Åï„Çå„Åæ„Åô„ÄÇ');
                return;
            }
            
            // „É¢„Éº„ÉÄ„É´„Çí‰ΩúÊàê„Åó„Å¶Ë°®Á§∫
            const modal = document.createElement('div');
            modal.className = 'shot-chart-modal active';
            modal.innerHTML = `
                <div class="shot-chart-content">
                    <h2 style="text-align: center; color: #667eea;">üéØ „Ç∑„É•„Éº„Éà„ÉÅ„É£„Éº„Éà</h2>
                    <p style="text-align: center; color: #666;">
                        ${opponent} vs ${new Date(date).toLocaleDateString('ja-JP')}
                    </p>
                    
                    <div class="court-container" style="cursor: default;">
                        <canvas id="displayShotCanvas" class="court-canvas" width="300" height="400"></canvas>
                    </div>

                    <div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: #2ecc71; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
                            <span style="color: #333; font-size: 0.9em; font-weight: 500;">„Ç∑„É•„Éº„ÉàÊàêÂäü</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 16px; height: 16px; background: #e74c3c; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
                            <span style="color: #333; font-size: 0.9em; font-weight: 500;">„Ç∑„É•„Éº„ÉàÂ§±Êïó</span>
                        </div>
                    </div>
                    
                    <div class="zone-stats" id="zoneStatsContainer">
                        <h3 style="color: #667eea; margin-bottom: 10px;">üìä „Ç®„É™„Ç¢Âà•ÊàêÂäüÁéá</h3>
                        <div id="zoneStatsContent"></div>
                    </div>
                    
                    <button class="shot-chart-button" onclick="this.parentElement.parentElement.remove()">
                        Èñâ„Åò„Çã
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // „Ç≥„Éº„ÉàÂõ≥„ÇíÊèèÁîª
            const canvas = document.getElementById('displayShotCanvas');
            drawCourt(canvas);
            
            // „Ç∑„É•„Éº„Éà„Çí„Éó„É≠„ÉÉ„Éà
            const ctx = canvas.getContext('2d');
            shotPlays.forEach(play => {
                if (play.position) {
                    const isMade = play.playType.includes('made');
                    
                    ctx.fillStyle = isMade ? '#2ecc71' : '#e74c3c';
                    ctx.beginPath();
                    ctx.arc(play.position.x, play.position.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
            
            // „Ç®„É™„Ç¢Âà•Áµ±Ë®à„ÇíË°®Á§∫
            setTimeout(() => {
                const statsElement = document.getElementById('zoneStatsContent');
                if (statsElement) {
                    displayZoneStats(shotPlays);
                }
            }, 100);
        }
        
        // „Ç®„É™„Ç¢Âà•Áµ±Ë®à„ÇíË®àÁÆó„Åó„Å¶Ë°®Á§∫
        function displayZoneStats(shotPlays) {
            const zoneData = {};
            
            // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£: play.position.zone„ÇíÁÑ°Ë¶ñ„Åó„Å¶„ÄÅÂ∏∏„Å´getZoneFromPosition„ÅßÂÜçË®àÁÆó ‚òÖ‚òÖ‚òÖ
            shotPlays.forEach(play => {
                if (play.position) {
                    // Â∏∏„Å´ÁèæÂú®„ÅÆ„Ç®„É™„Ç¢Âà§ÂÆö„É≠„Ç∏„ÉÉ„ÇØ„Çí‰ΩøÁî®
                    const zone = getZoneFromPosition(
                        play.position.x, 
                        play.position.y, 
                        300, 
                        400
                    );
                    
                    // „Éá„Éê„ÉÉ„Ç∞Áî®„É≠„Ç∞(Âæå„ÅßÂâäÈô§ÂèØËÉΩ)
                    console.log('Shot at:', play.position, 'Zone:', zone, 'Type:', play.playType);
                    
                    if (!zoneData[zone]) {
                        zoneData[zone] = { made: 0, total: 0 };
                    }
                    
                    zoneData[zone].total++;
                    if (play.playType.includes('made')) {
                        zoneData[zone].made++;
                    }
                }
            });
            
            // „Éá„Éê„ÉÉ„Ç∞Áî®: ÈõÜË®àÁµêÊûú„ÇíË°®Á§∫
            console.log('Zone statistics:', zoneData);
            
            // ‚òÖ‚òÖ‚òÖ ‰øÆÊ≠£: „Ç≥„Éº„Éä„Éº„ÇíËøΩÂä†„ÄÅmid_range„ÇíÂâäÈô§ ‚òÖ‚òÖ‚òÖ
            const zones = ['paint', 'left_corner', 'right_corner', 'left_wing', 'right_wing', 'top', 'backcourt'];
            
            // „Ç®„É™„Ç¢Âà•Áµ±Ë®à„ÇíHTMLÂåñ
            let html = '';
            zones.forEach(zone => {
                if (zoneData[zone]) {
                    const data = zoneData[zone];
                    const percentage = ((data.made / data.total) * 100).toFixed(1);
                    
                    html += `
                        <div class="zone-item">
                            <span class="zone-name">${getZoneNameJP(zone)}</span>
                            <span class="zone-percentage">
                                ${percentage}% (${data.made}/${data.total})
                            </span>
                        </div>
                    `;
                }
            });
            
            document.getElementById('zoneStatsContent').innerHTML = html || '<p style="text-align: center; color: #999;">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
        }
        
        // ========== „Åì„Åì„Åæ„ÅßËøΩÂä† ==========

        function displayRankings() {
            const myGames = myPlayerId 
    ? personalGames.filter(function(g) {
        return !g.playerId || g.playerId === myPlayerId;
      })
    : personalGames;
            
            if (myGames.length === 0) {
                document.getElementById('topPoints').innerHTML = '<p style="text-align: center; color: #999;">Ë®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            const topPoints = myGames.slice().sort(function(a, b) {
                return b.totalPoints - a.totalPoints;
            }).slice(0, 10);

            if (topPoints.length > 0) {
                const top = topPoints[0];
                const dateObj = new Date(top.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                let html = '<div class="top-record">' +
                    '<div class="trophy">üèÜ</div>' +
                    '<div style="font-size: 1.2em; margin-bottom: 10px;">ÊúÄÈ´òÂæóÁÇπ</div>' +
                    '<div class="value">' + top.totalPoints + 'ÁÇπ</div>' +
                    '<div style="font-size: 1.1em; opacity: 0.95;">' + dateStr;
                
                if (top.opponent) {
                    html += '<br>vs ' + top.opponent;
                }
                
                html += '</div></div>';
                
                document.getElementById('topPoints').innerHTML = html;
            }
        }

        function updateCharts() {
            const myGames = myPlayerId 
        ? personalGames.filter(function(g) {
            return !g.playerId || g.playerId === myPlayerId;
          })
        : personalGames;
            
            if (myGames.length === 0) return;
        
            // üÜï Êó•‰ªòÈ†Ü„Å´„ÇΩ„Éº„ÉàÔºàÂè§„ÅÑÈ†ÜÔºâ- reverse„ÇíÂâäÈô§
            const sorted = myGames.slice().sort(function(a, b) {
                return new Date(a.date) - new Date(b.date);
            });
            
            const labels = sorted.map(function(g) {
                const d = new Date(g.date).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'});
                return g.opponent ? d + ' vs ' + g.opponent : d;
            });

            if (charts.shooting) charts.shooting.destroy();
            charts.shooting = new Chart(document.getElementById('shootingChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '2PÊàêÂäüÁéá',
                        data: sorted.map(function(g) { return parseFloat(g.twoPointPercentage); }),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: '3PÊàêÂäüÁéá',
                        data: sorted.map(function(g) { return parseFloat(g.threePointPercentage); }),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'FTÊàêÂäüÁéá',
                        data: sorted.map(function(g) { return parseFloat(g.freeThrowPercentage); }),
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(v) { return v + '%'; } }
                        }
                    }
                }
            });
            
            // ==================== Week 7-8: „É¨„Éô„É´„ÉªXPË°®Á§∫„ÇíÊõ¥Êñ∞ ËøΩÂä†ÈñãÂßã ====================
            updateLevelDisplay();
            // ==================== Week 7-8: „É¨„Éô„É´„ÉªXPË°®Á§∫„ÇíÊõ¥Êñ∞ ËøΩÂä†ÁµÇ‰∫Ü ====================
        }
        
        // ==================== Week 7-8: „É¨„Éô„É´„ÉªXPË°®Á§∫Êõ¥Êñ∞Èñ¢Êï∞ ËøΩÂä†ÈñãÂßã ====================
        
        /**
         * „Ç∞„É©„Éï„Çø„Éñ„ÅÆ„É¨„Éô„É´„ÉªXPË°®Á§∫„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
         */
        function updateLevelDisplay() {
            // „É¨„Éô„É´Ë°®Á§∫
            const levelEl = document.getElementById('userLevelDisplay');
            if (levelEl) {
                levelEl.textContent = userProfile.level;
            }
            
            // XPË°®Á§∫
            const xpEl = document.getElementById('userXPDisplay');
            if (xpEl) {
                xpEl.textContent = userProfile.totalXP;
            }
            
            // ÈÄ≤Êçó„Éë„Éº„Çª„É≥„Éà
            const progress = getProgressToNextLevel();
            const progressBar = document.getElementById('xpProgressBar');
            const progressText = document.getElementById('xpProgressText');
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = progress + '%';
            }
            
            // Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÆXP
            const xpToNext = getXPToNextLevel();
            const xpToNextEl = document.getElementById('xpToNextLevel');
            if (xpToNextEl) {
                xpToNextEl.textContent = '„ÅÇ„Å® ' + xpToNext + ' XP';
            }
        }
        
        // ==================== Week 7-8: „É¨„Éô„É´„ÉªXPË°®Á§∫Êõ¥Êñ∞Èñ¢Êï∞ ËøΩÂä†ÁµÇ‰∫Ü ====================

        function addPlayer() {
            const num = document.getElementById('playerNumber').value;
            const name = document.getElementById('playerName').value.trim();

            if (!num || !name) { 
                alert('ËÉåÁï™Âè∑„Å®ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ'); 
                return; 
            }
            
            const exists = players.some(function(p) {
                return p.number === num;
            });
            
            if (exists) { 
                alert('„Åì„ÅÆËÉåÁï™Âè∑„ÅØÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô'); 
                return; 
            }

            const player = { 
                id: Date.now().toString(), 
                number: num, 
                name: name 
            };
            players.push(player);
            
            if (!myPlayerId) myPlayerId = player.id;
            
            saveData();

if (teamData) {
    // Êñ∞Ë¶èËøΩÂä†„Éï„É©„Ç∞„Çí„Å§„Åë„Çã
    // („Åì„ÅÆË°å„ÅØ„ÄÅ„Éó„É¨„Ç§„É§„Éº„Ç™„Éñ„Ç∏„Çß„ÇØ„ÉàÁîüÊàêÁõ¥Âæå„Åß„ÇÇOK)
    player._localNew = true;

    // ÈÅ∏Êâã„Å†„ÅëÈÄÅ‰ø°(Ë©¶Âêà„ÅØÈÄÅ„Çâ„Å™„ÅÑ)
    syncWithServer({ pushPlayers: true, pushGames: false });
}
            
            displayPlayers();
            updateMyPlayerSelect();

            document.getElementById('playerNumber').value = '';
            document.getElementById('playerName').value = '';
            
            alert('‚úÖ ' + name + ' #' + num + ' „ÇíÁôªÈå≤„Åó„Åæ„Åó„Åü!');
        }

        // üÜï Ë©¶Âêà‰∏≠„ÅÆÈÅ∏Êâã„ÇØ„Ç§„ÉÉ„ÇØÁôªÈå≤Ê©üËÉΩ
        function quickAddPlayer() {
            const number = document.getElementById('quickPlayerNumber').value.trim();
            const name = document.getElementById('quickPlayerName').value.trim();
            
            // ÂÖ•Âäõ„ÉÅ„Çß„ÉÉ„ÇØ
            if (!number || !name) {
                alert('‚ö†Ô∏è ËÉåÁï™Âè∑„Å®ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ËÉåÁï™Âè∑„ÅÆÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            const duplicate = players.find(function(p) {
                return p.number === number;
            });
            
            if (duplicate) {
                alert('‚ö†Ô∏è ËÉåÁï™Âè∑ #' + number + ' „ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô\n\n' + 
                      'ÁèæÂú®„ÅÆÈÅ∏Êâã: ' + duplicate.name + '\n\n' +
                      'Âà•„ÅÆËÉåÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // Êñ∞„Åó„ÅÑÈÅ∏Êâã„ÇíÁôªÈå≤
            const newPlayer = {
                id: Date.now().toString(),
                number: number,
                name: name,
                _localNew: true
            };
            
            players.push(newPlayer);
            
            // Ë©¶Âêà‰∏≠„ÅÆÂ†¥Âêà„ÄÅ„Åì„ÅÆÈÅ∏Êâã„ÅÆÁµ±Ë®à„ÇÇÂàùÊúüÂåñ
            if (currentTeamGame) {
                currentTeamGame.playerStats[newPlayer.id] = {
                    twoPointsMade: 0, twoPointsAttempted: 0,
                    threePointsMade: 0, threePointsAttempted: 0,
                    freeThrowsMade: 0, freeThrowsAttempted: 0,
                    offensiveRebounds: 0, defensiveRebounds: 0,
                    assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
                };
            }
            
            // „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
            
            // „Çµ„Éº„Éê„Éº„Å´ÂêåÊúüÔºà„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„ÇãÂ†¥ÂêàÔºâ
            if (teamData) {
                syncWithServer({ pushPlayers: true, pushGames: false });
            }
            
            // ÁîªÈù¢„ÇíÊõ¥Êñ∞
            displayPlayerSelector();
            updateMyPlayerSelect();
            displayPlayers();
            
            // ÂÖ•ÂäõÊ¨Ñ„Çí„ÇØ„É™„Ç¢
            document.getElementById('quickPlayerNumber').value = '';
            document.getElementById('quickPlayerName').value = '';
            
            // üÜï ÁôªÈå≤„Åó„ÅüÈÅ∏Êâã„ÇíËá™ÂãïÁöÑ„Å´ÈÅ∏Êäû
            selectedPlayer = newPlayer.id;
            displayPlayerSelector();
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
            showQuickAddFeedback(newPlayer.name + ' #' + newPlayer.number);
        }
        
        // üÜï „ÇØ„Ç§„ÉÉ„ÇØÁôªÈå≤„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫
        function showQuickAddFeedback(playerInfo) {
            // Êó¢Â≠ò„ÅÆ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ„Åå„ÅÇ„Çå„Å∞ÂâäÈô§
            const existing = document.querySelector('.quick-add-feedback');
            if (existing) {
                existing.remove();
            }
        
            // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÈÄöÁü•„Çí‰ΩúÊàê
            const feedback = document.createElement('div');
            feedback.className = 'feedback-notification quick-add-feedback';
            feedback.style.background = 'linear-gradient(135deg, #00b894 0%, #00cec9 100%)';
            feedback.innerHTML = '‚ö° ÁôªÈå≤ÂÆå‰∫Ü: ' + playerInfo + '<br><span style="font-size: 0.85em; opacity: 0.9;">„Åô„Åê„Å´Ë®òÈå≤„Åß„Åç„Åæ„Åô</span>';
            document.body.appendChild(feedback);
        
            // 2ÁßíÂæå„Å´ÂâäÈô§
            setTimeout(function() {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 2000);
        }

        function editPlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            const newNumber = prompt('Êñ∞„Åó„ÅÑËÉåÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ(ÁèæÂú®: #' + player.number + ')', player.number);
            if (newNumber === null) return;
            
            if (!newNumber || newNumber.trim() === '') {
                alert('ËÉåÁï™Âè∑„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const duplicate = players.some(function(p) {
                return p.id !== playerId && p.number === newNumber.trim();
            });
            
            if (duplicate) {
                alert('„Åì„ÅÆËÉåÁï™Âè∑„ÅØÊó¢„Å´‰ªñ„ÅÆÈÅ∏Êâã„Åå‰ΩøÁî®„Åó„Å¶„ÅÑ„Åæ„Åô');
                return;
            }
            
            const newName = prompt('Êñ∞„Åó„ÅÑÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ(ÁèæÂú®: ' + player.name + ')', player.name);
            if (newName === null) return;
            
            if (!newName || newName.trim() === '') {
                alert('ÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            player.number = newNumber.trim();
            player.name = newName.trim();
            
            saveData();

// „Çµ„Éº„Éê„Å∏„ÅØÈÄÅ„Çâ„Å™„ÅÑ(Á∑®ÈõÜ/ÂâäÈô§„ÅØÊâãÂãï„Åß„Ç∑„Éº„Éà„ÇíÁõ¥„ÅôÈÅãÁî®)
/* if (teamData) {
    syncWithServer();
} */
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('‚úÖ ÈÅ∏ÊâãÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü!\n\n#' + player.number + ' ' + player.name);
        }

        function deletePlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            if (!confirm('„Äå#' + player.number + ' ' + player.name + '„Äç„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?\n\n‚ö†Ô∏è „Åì„ÅÆÈÅ∏Êâã„ÅÆË©¶ÂêàË®òÈå≤„ÇÇÂÖ®„Å¶ÂâäÈô§„Åï„Çå„Åæ„Åô„ÄÇ')) {
                return;
            }
            
            players = players.filter(function(p) {
                return p.id !== playerId;
            });
            
            personalGames = personalGames.filter(function(g) {
                return g.playerId !== playerId;
            });
            
            teamGames.forEach(function(game) {
                if (game.playerStats && game.playerStats[playerId]) {
                    delete game.playerStats[playerId];
                }
                if (game.plays) {
                    game.plays = game.plays.filter(function(play) {
                        return play.playerId !== playerId;
                    });
                }
            });
            
            if (myPlayerId === playerId) {
                myPlayerId = players.length > 0 ? players[0].id : null;
            }
            
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('‚úÖ ÈÅ∏Êâã„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
        }
        
        function changeMyPlayer() {
            myPlayerId = document.getElementById('myPlayerSelect').value || null;
            saveData();
            displayGames();
            displayRankings();
            updateCharts();
            
            updatePlayerBanners();  // ‚Üê ËøΩÂä†
            
            if (myPlayerId) {
                const p = players.find(function(pl) {
                    return pl.id === myPlayerId;
                });
                alert('‚úÖ ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫„Çí„Äå' + p.name + ' #' + p.number + '„Äç„Å´Ë®≠ÂÆö„Åó„Åæ„Åó„Åü\n\nÂ±•Ê≠¥„Éª„É©„É≥„Ç≠„É≥„Ç∞„Éª„Ç∞„É©„Éï„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü!');
            }
        }

        function updatePlayerBanners() {
            const banners = [
                { banner: 'inputPlayerBanner', name: 'inputPlayerName' },
                { banner: 'listPlayerBanner', name: 'listPlayerName' },
                { banner: 'rankingPlayerBanner', name: 'rankingPlayerName' },
                { banner: 'graphPlayerBanner', name: 'graphPlayerName' },
                { banner: 'practicePlayerBanner', name: 'practicePlayerName' }
            ];
        
            banners.forEach(function(b) {
                const bannerEl = document.getElementById(b.banner);
                const nameEl = document.getElementById(b.name);
                
                if (!bannerEl || !nameEl) return;
        
                // üÜï Â∏∏„Å´„Éê„Éä„Éº„ÇíË°®Á§∫
                bannerEl.style.display = 'flex';
                
                // ÈÅ∏Êâã„ÅåÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                if (myPlayerId && players.length > 0) {
                    const player = players.find(function(p) { return p.id === myPlayerId; });
                    const playerText = player ? player.name + ' #' + player.number : 'ÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì';
                    nameEl.textContent = playerText;
                } else if (players.length > 0) {
                    // üÜï ÈÅ∏Êâã„ÅåÊú™ÈÅ∏Êäû„Åß„ÇÇÁôªÈå≤ÈÅ∏Êâã„Åå„ÅÑ„ÇãÂ†¥Âêà
                    nameEl.textContent = '„Çø„ÉÉ„Éó„Åó„Å¶ÈÅ∏Êâã„ÇíÈÅ∏Êäû';
                    bannerEl.style.background = 'linear-gradient(135deg, #f39c12 0%, #e67e22 100%)';
                } else {
                    // üÜï ÈÅ∏Êâã„Åå1‰∫∫„ÇÇÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà
                    nameEl.textContent = 'ÈÅ∏Êâã„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                    bannerEl.style.background = 'linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%)';
                }
                
                // „ÇØ„É™„ÉÉ„ÇØÊ©üËÉΩ„ÇíËøΩÂä†
                bannerEl.style.cursor = 'pointer';
                bannerEl.style.transition = 'all 0.3s';
                bannerEl.onclick = showPlayerSelectDialog;
                
                // „Éû„Ç¶„Çπ„Çí‰πó„Åõ„Åü„Å®„Åç„ÅÆÂäπÊûú
                bannerEl.onmouseenter = function() {
                    this.style.transform = 'scale(1.02)';
                    this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                };
                
                bannerEl.onmouseleave = function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                };
            });
        }
        
        // ÈÅ∏ÊâãÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function showPlayerSelectDialog() {
            if (!players || players.length === 0) {
                alert('ÈÅ∏Êâã„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇ\nÂÖà„Å´„ÄåÈÅ∏ÊâãÁÆ°ÁêÜ„Äç„ÅßÈÅ∏Êâã„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            // ‚òÖ‚òÖ‚òÖ ËøΩÂä†: „É¢„Éº„ÉÄ„É´„ÅåÂ≠òÂú®„Åô„Çã„ÅãÁ¢∫Ë™ç ‚òÖ‚òÖ‚òÖ
            const modal = document.getElementById('playerSelectModal');
            if (!modal) {
                console.error('playerSelectModal„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÂÜç‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ');
                createPlayerSelectDialog();
                // ÂÜçÂ∫¶ÂèñÂæó
                const modal2 = document.getElementById('playerSelectModal');
                if (!modal2) {
                    alert('ÈÅ∏ÊâãÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅÆË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ\n„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                    return;
                }
            }
            
            // „Éâ„É≠„ÉÉ„Éó„ÉÄ„Ç¶„É≥„Å´ÈÅ∏Êâã„ÇíËøΩÂä†
            const dropdown = document.getElementById('playerSelectDropdown');
            
            // ‚òÖ‚òÖ‚òÖ ËøΩÂä†: dropdown„ÅåÂ≠òÂú®„Åô„Çã„ÅãÁ¢∫Ë™ç ‚òÖ‚òÖ‚òÖ
            if (!dropdown) {
                console.error('playerSelectDropdown„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                alert('ÈÅ∏ÊâãÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅÆË°®Á§∫„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ\n„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                return;
            }
            
            dropdown.innerHTML = '<option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû...</option>';
            
            players.forEach(function(p) {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.name + ' #' + p.number;
                
                // ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏Êâã„Å´„Éû„Éº„ÇØ„Çí‰ªò„Åë„Çã
                if (p.id === myPlayerId) {
                    option.textContent = '‚òÖ ' + option.textContent;
                    option.selected = true;
                }
                
                dropdown.appendChild(option);
            });
            
            // „É¢„Éº„ÉÄ„É´„ÇíË°®Á§∫
            modal.style.display = 'flex';
        }
        
        // „ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñâ„Åò„ÇãÈñ¢Êï∞
        function closePlayerSelectDialog() {
            const modal = document.getElementById('playerSelectModal');
            modal.style.display = 'none';
        }
        
        // ÈÅ∏ÊâãÈÅ∏Êäû„ÇíÁ¢∫ÂÆö„Åô„ÇãÈñ¢Êï∞
        function confirmPlayerSelection() {
            const dropdown = document.getElementById('playerSelectDropdown');
            const selectedPlayerId = dropdown.value;
            
            if (!selectedPlayerId || selectedPlayerId === '') {
                alert('‚ùå ÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ÈÅ∏Êäû„Åó„ÅüÈÅ∏Êâã„ÇíÊé¢„Åô
            const selectedPlayer = players.find(function(p) {
                return p.id === selectedPlayerId;
            });
            
            if (!selectedPlayer) {
                alert('‚ùå ÈÅ∏Êâã„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                return;
            }
            
            // ÈÅ∏Êâã„ÇíÂàá„ÇäÊõø„Åà
            myPlayerId = selectedPlayer.id;
            saveData();
            
            // „ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÇíÈñâ„Åò„Çã
            closePlayerSelectDialog();
            
            // ÁîªÈù¢„ÇíÊõ¥Êñ∞
            updateDisplay();
            updatePlayerBanners();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('‚úÖ ' + selectedPlayer.name + ' #' + selectedPlayer.number + ' „ÇíÈÅ∏Êäû„Åó„Åæ„Åó„Åü!');
        }
        function updateMyPlayerSelect() {
            const sel = document.getElementById('myPlayerSelect');
            sel.innerHTML = '<option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>';
            players.forEach(function(p) {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name + ' #' + p.number;
                if (p.id === myPlayerId) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        function displayPlayers() {
            const playerList = document.getElementById('playerList');
            
            if (players.length === 0) {
                playerList.innerHTML = '<p style="text-align: center; color: #999;">„Åæ„Å†ÈÅ∏Êâã„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                return;
            }

            playerList.innerHTML = players.map(function(p) {
                const isMyPlayer = p.id === myPlayerId;
                
                return '<div class="player-item">' +
                    '<div class="player-info">' +
                    '<div>' +
                    '<span class="number">#' + p.number + '</span>' +
                    '<span style="font-weight: bold; margin-left: 10px;">' + p.name + '</span>' +
                    '</div>' +
                    '<div>' +
                    (isMyPlayer ? '<span class="my-data-badge">ÂÄã‰∫∫„É¢„Éº„ÉâË°®Á§∫‰∏≠</span>' : '') +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 10px; margin-top: 10px;">' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #3498db;" onclick="editPlayer(\'' + p.id + '\')">Á∑®ÈõÜ</button>' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #e74c3c;" onclick="deletePlayer(\'' + p.id + '\')">ÂâäÈô§</button>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function exportData() {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '„Éê„Çπ„Ç±Ë®òÈå≤_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ „Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü!');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (confirm('‚ö†Ô∏è „Éá„Éº„Çø„ÇíÂæ©ÂÖÉ„Åó„Åæ„Åô\n\nÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„Åã?')) {
                        personalGames = data.personalGames || [];
                        teamGames = data.teamGames || [];
                        players = data.players || [];
                        myPlayerId = data.myPlayerId || null;
                        teamData = data.teamData || null;
                        saveData();
                        displayGames();
                        displayPlayers();
                        alert('‚úÖ „Éá„Éº„Çø„ÅÆÂæ©ÂÖÉ„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü!');
                        location.reload();
                    }
                } catch (err) {
                    alert('‚ùå „Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }
        // ========== ÂÄã‰∫∫Áî®:„Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢ ==========
        function confirmClearLocalData() {
            const message = '‚ö†Ô∏è „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆË©¶Âêà„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô\n\n' +
                '„Äê„ÇØ„É™„Ç¢„Åï„Çå„Çã„ÇÇ„ÅÆ„Äë\n' +
                '‚Ä¢ „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆË©¶ÂêàË®òÈå≤(' + personalGames.length + '‰ª∂)\n\n' +
                '„Äê„ÇØ„É™„Ç¢„Åï„Çå„Å™„ÅÑ„ÇÇ„ÅÆ„Äë\n' +
                '‚Ä¢ ÈÅ∏ÊâãÊÉÖÂ†±\n' +
                '‚Ä¢ Google Sheets„ÅÆ„Éá„Éº„Çø(ÂÖ®Âì°ÂÖ±Êúâ)\n' +
                '‚Ä¢ ‰ªñ„ÅÆ‰∫∫„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø\n\n' +
                'üí° „Éí„É≥„Éà:„Äå‰ªä„Åô„ÅêÂêåÊúü„Äç„ÅßÂæ©ÂÖÉ„Åß„Åç„Åæ„Åô\n\n' +
                'Êú¨ÂΩì„Å´„ÇØ„É™„Ç¢„Åó„Åæ„Åô„Åã?';
            
            if (confirm(message)) {
                clearLocalData();
            }
        }

        function clearLocalData() {
        // „Åô„Åπ„Å¶„ÅÆ„É≠„Éº„Ç´„É´„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢
        localStorage.removeItem('basketballData');
        localStorage.removeItem('allTeamsData');
        localStorage.removeItem('currentTeamCode');
        
        // Â§âÊï∞„ÇÇ„ÇØ„É™„Ç¢
        allTeamsData = {};
        currentTeamCode = null;
        personalGames = [];
        teamGames = [];
        players = [];
        myPlayerId = null;
        teamData = null;
        draftTeamGame = null;
        practiceRecords = [];
        userProfile = {
            totalXP: 0,
            level: 1,
            currentStreak: 0,
            longestStreak: 0,
            lastPracticeDate: null
        };
        
        // UI„ÇíÊõ¥Êñ∞
        displayGames();
        displayRankings();
        updateCharts();
        displayPlayers();
        updateMyPlayerSelect();
        displayTeamStatus();
        displayTeamList();
        
        alert('‚úÖ „Åì„ÅÆ„Çπ„Éû„Éõ„ÅÆ„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü!\n\n„ÉÅ„Éº„É†„Å´ÂÜçÂ∫¶ÂèÇÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        
        // Ë®≠ÂÆö„Çø„Éñ„ÇíË°®Á§∫
        switchMode('settings');
    }
        // ========== ÁÆ°ÁêÜËÄÖÁî®:„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà ==========
        function confirmResetTeamData() {
    if (!teamData) {
        alert('„ÉÅ„Éº„É†„Å´ÂèÇÂä†„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
        return;
    }
    
    const message = 'üîê ÁÆ°ÁêÜËÄÖ„ÅÆ„ÅøÂÆüË°åÂèØËÉΩ\n\n' +
        '‚ö†Ô∏è „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆË©¶Âêà„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô\n\n' +
        '„ÄêÂΩ±Èüø„Äë\n' +
        '‚Ä¢ Google Sheets„ÅÆË©¶Âêà„Éá„Éº„Çø„ÅåÂâäÈô§„Åï„Çå„Åæ„Åô\n' +
        '‚Ä¢ ÂÖ®„É°„É≥„Éê„Éº„ÅÆ„Çπ„Éû„Éõ„Åã„ÇâË©¶ÂêàË®òÈå≤„ÅåÊ∂à„Åà„Åæ„Åô\n' +
        '‚Ä¢ Âæ©ÂÖÉ„Åß„Åç„Åæ„Åõ„Çì!\n\n' +
        '„ÄêÊÆã„Çã„ÇÇ„ÅÆ„Äë\n' +
        '‚Ä¢ ÈÅ∏ÊâãÊÉÖÂ†±\n' +
        '‚Ä¢ „ÉÅ„Éº„É†Ë®≠ÂÆö\n\n' +
        'Á∂ö„Åë„Çã„Å´„ÅØ„ÄÅÁÆ°ÁêÜËÄÖ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:';
    
    const inputPassword = prompt(message);
    
    if (inputPassword === null) {
        return;
    }
    
    if (!inputPassword || inputPassword.trim() === '') {
        alert('‚ùå „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
        return;
    }
    
    const finalConfirm = confirm(
        '‚ö†Ô∏è ÊúÄÁµÇÁ¢∫Ë™ç\n\n' +
        '„ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÄÇ\n' +
        '„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ\n\n' +
        'Êú¨ÂΩì„Å´ÂÆüË°å„Åó„Åæ„Åô„Åã?'
    );
    
    if (finalConfirm) {
        resetTeamData(inputPassword);
    }
}

        function resetTeamData(adminPassword) {  // ‚Üê „Éë„É©„É°„Éº„ÇøËøΩÂä†
    personalGames = [];
    teamGames = [];
    saveData();
    
    if (teamData) {
        clearServerGameData(adminPassword);  // ‚Üê „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÊ∏°„Åô
    }
    
    displayGames();
    displayRankings();
    updateCharts();
    if (typeof displayTeamGamesHistory === 'function') {
        displayTeamGamesHistory();
    }
    
    alert('‚úÖ „ÉÅ„Éº„É†ÂÖ®‰Ωì„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü!\n\nÂÖ®„É°„É≥„Éê„Éº„Å´ÂΩ±Èüø„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ\nÂêÑ„É°„É≥„Éê„Éº„ÅØ„Äå‰ªä„Åô„ÅêÂêåÊúü„Äç„ÅßÁ©∫„ÅÆ„Éá„Éº„Çø„ÅåÂèñÂæó„Åï„Çå„Åæ„Åô„ÄÇ');
}

async function clearServerGameData(adminPassword) {  // ‚Üê „Éë„É©„É°„Éº„ÇøËøΩÂä†
    try {
        showSyncIndicator('syncing', '„Çµ„Éº„Éê„Éº„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇíÂâäÈô§‰∏≠...');
        
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain',
            },
            body: JSON.stringify({
                action: 'clearGames',
                teamCode: teamData.code,
                adminPassword: adminPassword  // ‚Üê „Éë„Çπ„ÉØ„Éº„Éâ„ÇíÈÄÅ‰ø°
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showSyncIndicator('success', '„Çµ„Éº„Éê„Éº„ÅÆË©¶Âêà„Éá„Éº„Çø„ÇÇÂâäÈô§ÂÆå‰∫Ü');
        } else {
            showSyncIndicator('error', result.error || '„Çµ„Éº„Éê„ÉºÂâäÈô§Â§±Êïó');
            alert('‚ùå ' + (result.error || '„Çµ„Éº„Éê„ÉºÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü'));
        }
    } catch (error) {
        console.error('„Çµ„Éº„Éê„ÉºÂâäÈô§„Ç®„É©„Éº:', error);
        showSyncIndicator('error', '„Çµ„Éº„Éê„ÉºÂâäÈô§Â§±Êïó');
        alert('‚ùå „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
    }
}

        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
        function openShotPositionModal(callback) {
            shotChartCallback = callback;
            currentShotPosition = null;
            
            const modal = document.getElementById('shotPositionModal');
            const canvas = document.getElementById('shotCourtCanvas');
            const container = document.getElementById('shotCourtContainer');
            
            // „Ç≥„Éº„ÉàÂõ≥„ÇíÊèèÁîª
            drawCourt(canvas);
            
            // „Çø„ÉÉ„Éó„Ç§„Éô„É≥„Éà„ÇíË®≠ÂÆö
            container.onclick = function(e) {
                const rect = canvas.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * canvas.width;
                const y = ((e.clientY - rect.top) / rect.height) * canvas.height;
                
                // Ë®òÈå≤„Åï„Çå„Åü‰ΩçÁΩÆ„Çí‰øùÂ≠ò
                currentShotPosition = { x: x, y: y };
                
                // ‰∏ÄÊôÇÁöÑ„Å™„Éû„Éº„Ç´„Éº„ÇíË°®Á§∫
                drawCourt(canvas);
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Ëá™ÂãïÁöÑ„Å´„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Å¶Ë®òÈå≤
                setTimeout(function() {
                    confirmShotPosition();
                }, 300);
            };
            
            modal.classList.add('active');
        }
        
        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
        function closeShotPositionModal() {
            const modal = document.getElementById('shotPositionModal');
            modal.classList.remove('active');
            currentShotPosition = null;
            shotChartCallback = null;
        }
        
        // „Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÇíÁ¢∫ÂÆö
        function confirmShotPosition() {
            if (currentShotPosition && shotChartCallback) {
                const canvas = document.getElementById('shotCourtCanvas');
                const zone = getZoneFromPosition(
                    currentShotPosition.x,
                    currentShotPosition.y,
                    canvas.width,
                    canvas.height
                );
                
                shotChartCallback({
                    x: currentShotPosition.x,
                    y: currentShotPosition.y,
                    zone: zone
                });
            }
            closeShotPositionModal();
        }
        
        // ‰ΩçÁΩÆË®òÈå≤„Çí„Çπ„Ç≠„ÉÉ„Éó
        function skipShotPosition() {
            if (shotChartCallback) {
                shotChartCallback(null);
            }
            closeShotPositionModal();
        }

        // „ÄêÈñ¢Êï∞1„ÄëÁ∑¥Áøí„É°„Éã„É•„Éº„Éú„Çø„É≥„ÇíÊäº„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
        function togglePracticeMenu(button) {
            button.classList.toggle('selected');
        }
        
        // „ÄêÈñ¢Êï∞2„ÄëË™øÂ≠ê„Éú„Çø„É≥„ÇíÊäº„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
        function selectMood(button) {
            document.querySelectorAll('.mood-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            button.classList.add('selected');
        }
        
        // „ÄêÈñ¢Êï∞3„ÄëÁ∑¥ÁøíË®òÈå≤„Çí‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞
        // üíæ Á∑¥ÁøíË®òÈå≤„Çí‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞
        function savePracticeRecord() {
            // 1. ÂÖ•Âäõ„Åï„Çå„ÅüÊÉÖÂ†±„ÇíÂèñÂæó„Åô„Çã
            const date = document.getElementById('practiceDate').value;
            const note = document.getElementById('practiceNote').value;
            const duration = document.getElementById('practiceDuration').value;
            
            // 2. ÈÅ∏„Å∞„Çå„ÅüÁ∑¥Áøí„É°„Éã„É•„Éº„ÇíÂèñÂæó„Åô„Çã
            const selectedMenus = [];
            document.querySelectorAll('.practice-menu-btn.selected').forEach(function(btn) {
                selectedMenus.push(btn.getAttribute('data-menu'));
            });
            
            // 3. ÈÅ∏„Å∞„Çå„ÅüË™øÂ≠ê„ÇíÂèñÂæó„Åô„Çã
            let selectedMood = null;
            const moodBtn = document.querySelector('.mood-btn.selected');
            if (moodBtn) {
                selectedMood = moodBtn.getAttribute('data-mood');
            }
            
            // 4. „Ç®„É©„Éº„ÉÅ„Çß„ÉÉ„ÇØ
            if (!myPlayerId) {
                alert('ÂÖà„Å´Ë®≠ÂÆö„Çø„Éñ„ÅßÈÅ∏Êâã„ÇíÁôªÈå≤„ÉªÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ!');
                return;
            }
            if (!date) {
                alert('Êó•‰ªò„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ!');
                return;
            }
            
            if (selectedMenus.length === 0) {
                alert('Á∑¥Áøí„É°„Éã„É•„Éº„Çí1„Å§‰ª•‰∏äÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ!');
                return;
            }
            
            if (!selectedMood) {
                alert('‰ªäÊó•„ÅÆË™øÂ≠ê„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ!');
                return;
            }
            
            // 5. Á∑¥ÁøíË®òÈå≤„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Çí‰ΩúÊàê
            const practice = {
                id: 'practice_' + Date.now(),  // „É¶„Éã„Éº„ÇØ„Å™ID
                date: date,
                playerId: myPlayerId,
                menus: selectedMenus,
                mood: selectedMood,
                note: note,
                duration: duration ? parseInt(duration) : 0,
                xp: 10,  // Âü∫Êú¨XP
                timestamp: new Date().toISOString()
            };
            
            // 6. „Å≤„Å®„Åì„Å®Êó•Ë®ò„ÇíÊõ∏„ÅÑ„Åü„Çâ„Éú„Éº„Éä„ÇπXP
            if (note.trim().length > 0) {
                practice.xp += 20;
            }
            
            // 7. Á∑¥ÁøíË®òÈå≤ÈÖçÂàó„Å´ËøΩÂä†
            practiceRecords.push(practice);
            
            // ‚≠ê‚≠ê‚≠ê „Åì„Åì„Åã„Çâ‰øÆÊ≠£ ‚≠ê‚≠ê‚≠ê
            // 8. „Çπ„Éà„É™„Éº„ÇØ„ÇíË®àÁÆó
            const currentStreak = calculateStreak(date);
            const streakBonus = getStreakBonus(currentStreak);
            practice.xp += streakBonus;
            
            // 9. „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç£„Éº„É´„ÇíÊõ¥Êñ∞
            userProfile.totalXP += practice.xp;
            userProfile.lastPracticeDate = date;
            
            // 10. „Éá„Éº„Çø„Çí‰øùÂ≠ò
            saveData();
            
            // 11. ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏(„Çπ„Éà„É™„Éº„ÇØÊÉÖÂ†±„ÇÇË°®Á§∫)
            let message = '‚úÖ Á∑¥ÁøíË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!\n';
            message += 'Áç≤ÂæóXP: +' + practice.xp + 'XP\n';
            message += 'üî• ÈÄ£Á∂öË®òÈå≤: ' + currentStreak + 'Êó•';
            if (streakBonus > 0) {
                message += '\nüéâ „Çπ„Éà„É™„Éº„ÇØ„Éú„Éº„Éä„Çπ: +' + streakBonus + 'XP!';
            }
            alert(message);
            // ‚≠ê‚≠ê‚≠ê „Åì„Åì„Åæ„Åß‰øÆÊ≠£ ‚≠ê‚≠ê‚≠ê
            
            // 12. ÂÖ•Âäõ„Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('practiceNote').value = '';
            document.getElementById('practiceDuration').value = '';
            document.querySelectorAll('.practice-menu-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            document.querySelectorAll('.mood-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            
            // 13. Â±•Ê≠¥„ÇíÂÜçË°®Á§∫
            displayPracticeHistory();

            // 14. ÂÄã‰∫∫„Éá„Éº„Çø„Çø„Éñ„ÅÆË°®Á§∫„ÇÇÊõ¥Êñ∞
            updateStreakDisplay();      // „Çπ„Éà„É™„Éº„ÇØË°®Á§∫„ÇíÊõ¥Êñ∞
            displayPracticeCalendar();  // „Ç´„É¨„É≥„ÉÄ„Éº„ÇíÊõ¥Êñ∞
        }
        
        // „ÄêÈñ¢Êï∞4„ÄëÁ∑¥ÁøíÂ±•Ê≠¥„ÇíË°®Á§∫„Åô„ÇãÈñ¢Êï∞
        function displayPracticeHistory() {
            const listEl = document.getElementById('practiceHistoryList');
            
            // ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÈÅ∏Êâã„ÅÆÁ∑¥ÁøíË®òÈå≤„Å†„Åë„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            // Ê≥®ÊÑè: ÈÅ∏ÊâãID„Åå‰∏ÄËá¥„Åô„ÇãË®òÈå≤„ÅÆ„Åø„ÇíË°®Á§∫(Âè§„ÅÑË®òÈå≤„ÅØË°®Á§∫„Åï„Çå„Å™„ÅÑ)
            const myPractices = myPlayerId 
                ? practiceRecords.filter(function(p) {
                    return p.playerId === myPlayerId;
                  })
                : [];
            
            if (myPractices.length === 0) {
                listEl.innerHTML = '<p style="color: #999; text-align: center;">„Åæ„Å†Á∑¥ÁøíË®òÈå≤„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }
            
            // ÊúÄÊñ∞„ÅÆË®òÈå≤„Åå‰∏ä„Å´Êù•„Çã„Çà„ÅÜ„Å´„ÇΩ„Éº„Éà
            const sorted = myPractices.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            });
            
            // ÊúÄÊñ∞5‰ª∂„Å†„ÅëË°®Á§∫
            const recent = sorted.slice(0, 5);
            
            let html = '';
            recent.forEach(function(practice) {
                // Êó•‰ªò„ÇíË¶ã„ÇÑ„Åô„ÅèÂ§âÊèõ
                const dateObj = new Date(practice.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {
                    month: 'long',
                    day: 'numeric'
                });
                
                // Á∑¥Áøí„É°„Éã„É•„Éº„ÇíÊó•Êú¨Ë™û„Å´Â§âÊèõ
                const menuNames = {
                    'shoot': '„Ç∑„É•„Éº„Éà',
                    'dribble': '„Éâ„É™„Éñ„É´',
                    'pass': '„Éë„Çπ',
                    'defense': '„Éá„Ç£„Éï„Çß„É≥„Çπ',
                    'fitness': '‰ΩìÂäõ',
                    'other': '„Åù„ÅÆ‰ªñ'
                };
                
                // Ë™øÂ≠ê„ÇíÁµµÊñáÂ≠ó„Å´Â§âÊèõ
                const moodEmojis = {
                    'good': 'üòä ËâØ„Åã„Å£„Åü',
                    'normal': 'üòê ÊôÆÈÄö',
                    'bad': 'üò¢ „Ç§„Éû„Ç§„ÉÅ'
                };
                
                html += '<div class="practice-history-item">';
                html += '<div class="practice-history-date">üìÖ ' + dateStr + '</div>';
                
                // Á∑¥Áøí„É°„Éã„É•„ÉºË°®Á§∫
                html += '<div class="practice-history-menus">';
                practice.menus.forEach(function(menu) {
                    html += '<span class="practice-menu-tag">' + menuNames[menu] + '</span>';
                });
                html += '</div>';
                
                // Ë™øÂ≠êË°®Á§∫
                html += '<div class="practice-history-mood">' + moodEmojis[practice.mood] + '</div>';
                
                // „É°„É¢„Åå„ÅÇ„Çå„Å∞Ë°®Á§∫
                if (practice.note) {
                    html += '<div class="practice-history-note">üí¨ ' + practice.note + '</div>';
                }
                
                // XPË°®Á§∫
                html += '<div style="color: #667eea; font-weight: bold; margin-top: 5px;">+' + practice.xp + 'XP</div>';
                
                html += '</div>';
            });
            
            listEl.innerHTML = html;
        }
            

        // „ÄêÈñ¢Êï∞5„Äë„Çπ„Éà„É™„Éº„ÇØ„ÇíË®àÁÆó„Åô„ÇãÈñ¢Êï∞
        function calculateStreak(practiceDate) {
            const today = new Date(practiceDate);
            today.setHours(0, 0, 0, 0);
            
            if (!userProfile.lastPracticeDate) {
                // Âàù„ÇÅ„Å¶„ÅÆÁ∑¥ÁøíË®òÈå≤
                userProfile.currentStreak = 1;
                userProfile.longestStreak = 1;
                return 1;
            }
            
            const lastDate = new Date(userProfile.lastPracticeDate);
            lastDate.setHours(0, 0, 0, 0);
            
            // Êó•Êï∞„ÅÆÂ∑Æ„ÇíË®àÁÆó(„Éü„É™Áßí‚ÜíÊó•Êï∞)
            const daysDiff = Math.floor((today - lastDate) / (1000 * 60 * 60 * 24));
            
            if (daysDiff === 0) {
                // ‰ªäÊó•Êó¢„Å´Ë®òÈå≤Ê∏à„Åø(„Çπ„Éà„É™„Éº„ÇØ„ÅØÂ§â„Çè„Çâ„Å™„ÅÑ)
                return userProfile.currentStreak;
            } else if (daysDiff === 1) {
                // ÈÄ£Á∂öË®òÈå≤Á∂ôÁ∂ö!
                userProfile.currentStreak++;
                // ÊúÄÈï∑Ë®òÈå≤„ÇíÊõ¥Êñ∞
                if (userProfile.currentStreak > userProfile.longestStreak) {
                    userProfile.longestStreak = userProfile.currentStreak;
                }
                return userProfile.currentStreak;
            } else {
                // ÈÄîÂàá„Çå„Åü...
                userProfile.currentStreak = 1;
                return 1;
            }
        }
        
        // „ÄêÈñ¢Êï∞6„Äë„Çπ„Éà„É™„Éº„ÇØ„Éú„Éº„Éä„ÇπXP„ÇíË®àÁÆó
        function getStreakBonus(streak) {
            if (streak >= 30) return 200;
            if (streak >= 14) return 100;
            if (streak >= 7) return 50;
            return 0;
        }

        // ==================== Week 7-8: XP„Éª„É¨„Éô„É´„Ç∑„Çπ„ÉÜ„É† ËøΩÂä†ÈñãÂßã ====================
        
        /**
         * Ë©¶ÂêàË®òÈå≤„Åã„ÇâXP„ÇíË®àÁÆó„Åô„ÇãÈñ¢Êï∞
         * @param {Object} gameData - Ë©¶Âêà„Éá„Éº„Çø
         * @returns {Object} - XPÊÉÖÂ†± {total: ÂêàË®àXP, breakdown: ÂÜÖË®≥}
         */
        function calculateGameXP(gameData) {
            // Âü∫Êú¨XP(Ë©¶Âêà„Å´Âá∫Â†¥„Åó„Åü„ÇâÂøÖ„Åö„ÇÇ„Çâ„Åà„Çã)
            let xp = 50;
            
            // ÂÜÖË®≥„ÇíË®òÈå≤(Âæå„ÅßÂàÜÊûê„Å´‰Ωø„Åà„Çã)
            const breakdown = {
                base: 50,
                bonuses: []
            };
            
            // „Éú„Éº„Éä„ÇπXP: ÂæóÁÇπ
            if (gameData.totalPoints >= 15) {
                xp += 30;
                breakdown.bonuses.push({name: 'È´òÂæóÁÇπ(15ÁÇπ‰ª•‰∏ä)', xp: 30});
            } else if (gameData.totalPoints >= 10) {
                xp += 20;
                breakdown.bonuses.push({name: '‰∫åÊ°ÅÂæóÁÇπ(10ÁÇπ‰ª•‰∏ä)', xp: 20});
            }
            
            // „Éú„Éº„Éä„ÇπXP: 2P„Ç∑„É•„Éº„ÉàÊàêÂäüÁéá
            if (gameData.twoPointsAttempted >= 5) {
                if (gameData.twoPointPercentage >= 60) {
                    xp += 15;
                    breakdown.bonuses.push({name: '2PÈ´òÊàêÂäüÁéá(60%‰ª•‰∏ä)', xp: 15});
                } else if (gameData.twoPointPercentage >= 50) {
                    xp += 10;
                    breakdown.bonuses.push({name: '2PËâØÊàêÂäüÁéá(50%‰ª•‰∏ä)', xp: 10});
                }
            }
            
            // „Éú„Éº„Éä„ÇπXP: 3P„Ç∑„É•„Éº„ÉàÊàêÂäüÁéá
            if (gameData.threePointsAttempted >= 3) {
                if (gameData.threePointPercentage >= 40) {
                    xp += 15;
                    breakdown.bonuses.push({name: '3PÈ´òÊàêÂäüÁéá(40%‰ª•‰∏ä)', xp: 15});
                } else if (gameData.threePointPercentage >= 33) {
                    xp += 10;
                    breakdown.bonuses.push({name: '3PËâØÊàêÂäüÁéá(33%‰ª•‰∏ä)', xp: 10});
                }
            }
            
            // „Éú„Éº„Éä„ÇπXP: „É™„Éê„Ç¶„É≥„Éâ
            const totalRebounds = gameData.offensiveRebounds + gameData.defensiveRebounds;
            if (totalRebounds >= 8) {
                xp += 15;
                breakdown.bonuses.push({name: '„É™„Éê„Ç¶„É≥„ÉâÁéã(8Êú¨‰ª•‰∏ä)', xp: 15});
            } else if (totalRebounds >= 5) {
                xp += 10;
                breakdown.bonuses.push({name: '„É™„Éê„Ç¶„É≥„ÉâË≤¢ÁåÆ(5Êú¨‰ª•‰∏ä)', xp: 10});
            }
            
            // „Éú„Éº„Éä„ÇπXP: „Ç¢„Ç∑„Çπ„Éà
            if (gameData.assists >= 5) {
                xp += 15;
                breakdown.bonuses.push({name: '„Ç¢„Ç∑„Çπ„ÉàÁéã(5Êú¨‰ª•‰∏ä)', xp: 15});
            } else if (gameData.assists >= 3) {
                xp += 10;
                breakdown.bonuses.push({name: '„Ç¢„Ç∑„Çπ„ÉàË≤¢ÁåÆ(3Êú¨‰ª•‰∏ä)', xp: 10});
            }
            
            // „Éú„Éº„Éä„ÇπXP: „Çπ„ÉÜ„Ç£„Éº„É´
            if (gameData.steals >= 4) {
                xp += 15;
                breakdown.bonuses.push({name: '„Çπ„ÉÜ„Ç£„Éº„É´Áéã(4Êú¨‰ª•‰∏ä)', xp: 15});
            } else if (gameData.steals >= 2) {
                xp += 10;
                breakdown.bonuses.push({name: '„Çπ„ÉÜ„Ç£„Éº„É´Ë≤¢ÁåÆ(2Êú¨‰ª•‰∏ä)', xp: 10});
            }
            
            // „Éú„Éº„Éä„ÇπXP: „Éñ„É≠„ÉÉ„ÇØ
            if (gameData.blocks >= 3) {
                xp += 15;
                breakdown.bonuses.push({name: '„Éñ„É≠„ÉÉ„ÇØÁéã(3Êú¨‰ª•‰∏ä)', xp: 15});
            } else if (gameData.blocks >= 1) {
                xp += 10;
                breakdown.bonuses.push({name: '„Éñ„É≠„ÉÉ„ÇØË≤¢ÁåÆ(1Êú¨‰ª•‰∏ä)', xp: 10});
            }
            
            return {
                total: xp,
                breakdown: breakdown
            };
        }
        
        /**
         * „É¨„Éô„É´„Å´ÂøÖË¶Å„Å™Á¥ØË®àXP„ÇíË®àÁÆó
         * @param {number} level - ÁõÆÊ®ô„É¨„Éô„É´
         * @returns {number} - ÂøÖË¶Å„Å™Á¥ØË®àXP
         */
        function getXPForLevel(level) {
            if (level === 1) return 0;
            
            let totalXP = 0;
            for (let i = 1; i < level; i++) {
                totalXP += 50 + (i * 50);
            }
            return totalXP;
        }
        
        /**
         * „É¨„Éô„É´„Ç¢„ÉÉ„Éó„Çí„ÉÅ„Çß„ÉÉ„ÇØ„Åó„Å¶ÂÆüË°å
         */
        function checkLevelUp() {
            const currentLevel = userProfile.level;
            const nextLevelXP = getXPForLevel(currentLevel + 1);
            
            if (userProfile.totalXP >= nextLevelXP) {
                userProfile.level++;
                saveData();
                showLevelUpAnimation(userProfile.level);
                
                setTimeout(function() {
                    checkLevelUp();
                }, 1000);
            }
        }
        
        /**
         * „É¨„Éô„É´„Ç¢„ÉÉ„Éó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë°®Á§∫
         * @param {number} newLevel - Êñ∞„Åó„ÅÑ„É¨„Éô„É´
         */
        function showLevelUpAnimation(newLevel) {
            const nextLevelXP = getXPForLevel(newLevel + 1);
            const xpToNext = nextLevelXP - userProfile.totalXP;
            
            alert('üéâ‚ú® „É¨„Éô„É´„Ç¢„ÉÉ„Éó! ‚ú®üéâ\n\n' +
                  '‚≠ê „É¨„Éô„É´ ' + newLevel + ' „Å´„Å™„Çä„Åæ„Åó„Åü!\n\n' +
                  'Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß „ÅÇ„Å® ' + xpToNext + 'XP\n' +
                  'È†ëÂºµ„Å£„Å¶Á∑¥Áøí„ÉªË©¶Âêà„ÇíÁ∂ö„Åë„Çà„ÅÜ!');
        }
        
        /**
         * XPÁç≤Âæó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë°®Á§∫
         * @param {Object} xpData - XPÊÉÖÂ†±
         */
        function showXPAnimation(xpData) {
            let message = '‚≠ê XP GET! ‚≠ê\n\n';
            message += '+' + xpData.total + 'XP Áç≤Âæó!\n\n';
            
            if (xpData.breakdown.bonuses.length > 0) {
                message += '„Äê„Éú„Éº„Éä„Çπ„Äë\n';
                xpData.breakdown.bonuses.forEach(function(bonus) {
                    message += '‚úì ' + bonus.name + ': +' + bonus.xp + 'XP\n';
                });
                message += '\n';
            }
            
            message += 'ÂêàË®àXP: ' + userProfile.totalXP + '\n';
            message += 'ÁèæÂú®: „É¨„Éô„É´ ' + userProfile.level;
            
            const nextLevelXP = getXPForLevel(userProfile.level + 1);
            const xpToNext = nextLevelXP - userProfile.totalXP;
            message += '\nÊ¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß: „ÅÇ„Å® ' + xpToNext + 'XP';
            
            alert(message);
        }
        
        /**
         * Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„ÅÆÈÄ≤Êçó„Éë„Éº„Çª„É≥„Éà„ÇíË®àÁÆó
         * @returns {number} - ÈÄ≤Êçó„Éë„Éº„Çª„É≥„Éà(0-100)
         */
        function getProgressToNextLevel() {
            const currentLevel = userProfile.level;
            const currentXP = userProfile.totalXP;
            const nextLevelXP = getXPForLevel(currentLevel + 1);
            const prevLevelXP = getXPForLevel(currentLevel);
            
            const xpInThisLevel = nextLevelXP - prevLevelXP;
            const xpEarned = currentXP - prevLevelXP;
            
            const progress = Math.min(100, Math.max(0, Math.floor((xpEarned / xpInThisLevel) * 100)));
            
            return progress;
        }
        
        /**
         * Ê¨°„ÅÆ„É¨„Éô„É´„Åæ„Åß„Å´ÂøÖË¶Å„Å™XP„ÇíË®àÁÆó
         * @returns {number} - ÂøÖË¶ÅXP
         */
        function getXPToNextLevel() {
            const currentLevel = userProfile.level;
            const currentXP = userProfile.totalXP;
            const nextLevelXP = getXPForLevel(currentLevel + 1);
            
            return Math.max(0, nextLevelXP - currentXP);
        }
        
        // ==================== Week 7-8: XP„Éª„É¨„Éô„É´„Ç∑„Çπ„ÉÜ„É† ËøΩÂä†ÁµÇ‰∫Ü ====================

        // ==================== Week 7-8: Ë©¶ÂêàË®òÈå≤‰øùÂ≠òÊôÇ„ÅÆXP‰ªò‰∏é ËøΩÂä†ÈñãÂßã ====================
        
        /**
         * ÂÄã‰∫∫„É¢„Éº„Éâ„ÅßË©¶ÂêàË®òÈå≤„Çí‰øùÂ≠ò„Åô„ÇãÈñ¢Êï∞(Êñ∞Ë¶è‰ΩúÊàê)
         */
        function savePersonalGameRecord() {
            // ÂÖ•ÂäõÂÄ§„ÅÆÂèñÂæó
            const date = document.getElementById('gameDate').value;
            const opponent = document.getElementById('opponent').value;
            const playTime = parseInt(document.getElementById('playTime').value) || 0;
            
            // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
            if (!date) {
                alert('Ë©¶ÂêàÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!opponent) {
                alert('ÂØæÊà¶Áõ∏Êâã„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (!myPlayerId) {
                alert('ÂÖà„Å´ÈÅ∏Êâã„ÇíÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ(Ë®≠ÂÆö„Çø„Éñ)');
                return;
            }
            
            // Áµ±Ë®à„Éá„Éº„Çø„ÅÆÂèñÂæó
            const twoPointsMade = parseInt(document.getElementById('twoPointsMade').textContent);
            const twoPointsAttempted = parseInt(document.getElementById('twoPointsAttempted').textContent);
            const threePointsMade = parseInt(document.getElementById('threePointsMade').textContent);
            const threePointsAttempted = parseInt(document.getElementById('threePointsAttempted').textContent);
            const freeThrowsMade = parseInt(document.getElementById('freeThrowsMade').textContent);
            const freeThrowsAttempted = parseInt(document.getElementById('freeThrowsAttempted').textContent);
            const offensiveRebounds = parseInt(document.getElementById('offensiveRebounds').textContent);
            const defensiveRebounds = parseInt(document.getElementById('defensiveRebounds').textContent);
            const assists = parseInt(document.getElementById('assists').textContent);
            const steals = parseInt(document.getElementById('steals').textContent);
            const blocks = parseInt(document.getElementById('blocks').textContent);
            const turnovers = parseInt(document.getElementById('turnovers').textContent);
            const fouls = parseInt(document.getElementById('fouls').textContent);
            
            // Ë®àÁÆó
            const totalPoints = (twoPointsMade * 2) + (threePointsMade * 3) + freeThrowsMade;
            const twoPointPercentage = twoPointsAttempted > 0 ? ((twoPointsMade / twoPointsAttempted) * 100).toFixed(1) : 0;
            const threePointPercentage = threePointsAttempted > 0 ? ((threePointsMade / threePointsAttempted) * 100).toFixed(1) : 0;
            const freeThrowPercentage = freeThrowsAttempted > 0 ? ((freeThrowsMade / freeThrowsAttempted) * 100).toFixed(1) : 0;
            
            // Ë©¶Âêà„Éá„Éº„Çø„Çí‰ΩúÊàê
            const gameData = {
                id: 'game_' + Date.now(),
                date: date,
                opponent: opponent,
                playerId: myPlayerId,
                playTime: playTime,
                twoPointsMade: twoPointsMade,
                twoPointsAttempted: twoPointsAttempted,
                threePointsMade: threePointsMade,
                threePointsAttempted: threePointsAttempted,
                freeThrowsMade: freeThrowsMade,
                freeThrowsAttempted: freeThrowsAttempted,
                offensiveRebounds: offensiveRebounds,
                defensiveRebounds: defensiveRebounds,
                assists: assists,
                steals: steals,
                blocks: blocks,
                turnovers: turnovers,
                fouls: fouls,
                totalPoints: totalPoints,
                totalRebounds: offensiveRebounds + defensiveRebounds,
                twoPointPercentage: parseFloat(twoPointPercentage),
                threePointPercentage: parseFloat(threePointPercentage),
                freeThrowPercentage: parseFloat(freeThrowPercentage),
                recordedBy: myPlayerId,
                recordMethod: 'personal',
                timestamp: new Date().toISOString()
            };
            
            // XP„ÇíË®àÁÆó
            const xpData = calculateGameXP(gameData);
            
            // XP„Çí„Ç≤„Éº„É†„Éá„Éº„Çø„Å´Ë®òÈå≤
            gameData.xpEarned = xpData.total;
            gameData.xpBreakdown = xpData.breakdown;
            
            // „É¶„Éº„Ç∂„Éº„Éó„É≠„Éï„Ç°„Ç§„É´„ÅÆXP„ÇíÂ¢ó„ÇÑ„Åô
            userProfile.totalXP += xpData.total;
            
            // „Éá„Éº„Çø„Çí‰øùÂ≠ò
            personalGames.unshift(gameData);
            saveData();
            
            // XPÁç≤Âæó„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Ë°®Á§∫
            showXPAnimation(xpData);
            
            // „É¨„Éô„É´„Ç¢„ÉÉ„Éó„ÉÅ„Çß„ÉÉ„ÇØ
            checkLevelUp();
            
            // ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏
            alert('‚úÖ Ë©¶ÂêàË®òÈå≤„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!');
            
            // „Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà
            resetInputForm();
            
            // Â±•Ê≠¥„Çø„Éñ„Å´Âàá„ÇäÊõø„Åà
            switchTab('list');
        }
        
        /**
         * ÂÖ•Âäõ„Éï„Ç©„Éº„É†„Çí„É™„Çª„ÉÉ„Éà„Åô„ÇãÈñ¢Êï∞
         */
        function resetInputForm() {
            document.getElementById('gameDate').valueAsDate = new Date();
            document.getElementById('opponent').value = '';
            document.getElementById('playTime').value = '0';
            
            // ÂÖ®„Å¶„ÅÆÁµ±Ë®à„Çí„É™„Çª„ÉÉ„Éà
            const statIds = [
                'twoPointsMade', 'twoPointsAttempted',
                'threePointsMade', 'threePointsAttempted',
                'freeThrowsMade', 'freeThrowsAttempted',
                'offensiveRebounds', 'defensiveRebounds',
                'assists', 'steals', 'blocks', 'turnovers', 'fouls'
            ];
            
            statIds.forEach(function(id) {
                document.getElementById(id).textContent = '0';
            });
        }
        
        // ==================== Week 7-8: Ë©¶ÂêàË®òÈå≤‰øùÂ≠òÊôÇ„ÅÆXP‰ªò‰∏é ËøΩÂä†ÁµÇ‰∫Ü ====================
        
        // „ÄêÈñ¢Êï∞7„Äë„Çπ„Éà„É™„Éº„ÇØË°®Á§∫„ÇíÊõ¥Êñ∞„Åô„ÇãÈñ¢Êï∞
        function updateStreakDisplay() {
            document.getElementById('currentStreakDisplay').textContent = userProfile.currentStreak;
            document.getElementById('longestStreakDisplay').textContent = userProfile.longestStreak;
            document.getElementById('totalXPDisplay').textContent = userProfile.totalXP;
        }

        // „ÄêÈñ¢Êï∞8„ÄëÈÅéÂéª7Êó•Èñì„ÅÆ„Ç´„É¨„É≥„ÉÄ„Éº„ÇíË°®Á§∫
        function displayPracticeCalendar() {
            const calendarEl = document.getElementById('practiceCalendar');
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            let html = '';
            
            // ÈÅéÂéª7Êó•Èñì„Çí„É´„Éº„Éó
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                // „Åù„ÅÆÊó•„Å´Á∑¥ÁøíË®òÈå≤„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const hasPractice = practiceRecords.some(function(p) {
                        // ÈÅ∏Êäû‰∏≠„ÅÆÈÅ∏Êâã„ÅÆÁ∑¥ÁøíË®òÈå≤„ÅÆ„Åø„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                    const isMyRecord = !p.playerId || p.playerId === myPlayerId;
                    return p.date === dateStr && isMyRecord;
                });

                // ÊõúÊó•
                const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
                const dayName = dayNames[date.getDay()];
                
                // ‰ªäÊó•„Åã„Å©„ÅÜ„Åã
                const isToday = i === 0;
                
                html += '<div style="text-align: center; flex: 1;">';
                html += '<div style="font-size: 0.8em; color: #999;">' + dayName + '</div>';
                
                if (hasPractice) {
                    html += '<div style="font-size: 2em;">üî•</div>';
                } else if (isToday) {
                    html += '<div style="font-size: 2em;">üìç</div>';
                } else {
                    html += '<div style="font-size: 2em; opacity: 0.2;">‚¨ú</div>';
                }
                
                html += '<div style="font-size: 0.7em; color: #666;">' + (date.getMonth() + 1) + '/' + date.getDate() + '</div>';
                html += '</div>';
            }
            
            calendarEl.innerHTML = html;
        }
        
        loadData();
        migrateData();
        updateDisplay();
        displayGames();
        displayPlayers();
        updateMyPlayerSelect();
        updatePlayerBanners();
        console.log('‚òÖ‚òÖ‚òÖ „Åì„Çå„Åã„Çâ displayTeamStatus „ÇíÂëº„Å≥„Åæ„Åô ‚òÖ‚òÖ‚òÖ');
        console.log('‚òÖ‚òÖ‚òÖ teamData:', teamData);
        displayTeamStatus();
        loadTeamData();
        checkAndShowDraftGame();
        displayTeamList();

        const lastMode = localStorage.getItem('lastMode');
        if (lastMode) {
            switchMode(lastMode);
        } else {
            switchMode('personal');  // „Éá„Éï„Ç©„É´„Éà„ÅØÂÄã‰∫∫„É¢„Éº„Éâ
        }
        
        // ========== ÈÅ∏ÊâãÈÅ∏Êäû„ÉÄ„Ç§„Ç¢„É≠„Ç∞„ÅÆHTML‰ΩúÊàê ==========
        function createPlayerSelectDialog() {
            const dialogHTML = `
                <div id="playerSelectModal" class="modal-overlay" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>üèÄ ÈÅ∏Êâã„ÇíÈÅ∏Êäû</h2>
                            <button class="modal-close" onclick="closePlayerSelectDialog()">√ó</button>
                        </div>
                        <div class="modal-body">
                            <p style="margin-bottom: 15px; color: #666;">ÂÄã‰∫∫„É¢„Éº„Éâ„ÅßË°®Á§∫„Åô„ÇãÈÅ∏Êâã„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
                            <select id="playerSelectDropdown" class="player-select-dropdown">
                                <option value="">ÈÅ∏Êâã„ÇíÈÅ∏Êäû...</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn cancel-btn" onclick="closePlayerSelectDialog()">„Ç≠„É£„É≥„Çª„É´</button>
                            <button class="modal-btn confirm-btn" onclick="confirmPlayerSelection()">ÈÅ∏Êäû</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }
        
        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„ÉÄ„Ç§„Ç¢„É≠„Ç∞„Çí‰ΩúÊàê
        createPlayerSelectDialog();

        // üìù Á∑¥Áøí„É°„Éã„É•„Éº„Éú„Çø„É≥„ÇíÊäº„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
        function togglePracticeMenu(button) {
            // „Éú„Çø„É≥„Å´„Äåselected„Äç„Å®„ÅÑ„ÅÜ„ÇØ„É©„Çπ„Åå„ÅÇ„Çå„Å∞Ê∂à„Åô„ÄÅ„Å™„Åë„Çå„Å∞ËøΩÂä†„Åô„Çã
            button.classList.toggle('selected');
        }
        
        // üòä Ë™øÂ≠ê„Éú„Çø„É≥„ÇíÊäº„Åó„Åü„Å®„Åç„ÅÆÂá¶ÁêÜ
        function selectMood(button) {
            // ‰ªñ„ÅÆË™øÂ≠ê„Éú„Çø„É≥„ÅÆÈÅ∏Êäû„ÇíÂÖ®ÈÉ®Ëß£Èô§„Åô„Çã
            document.querySelectorAll('.mood-btn').forEach(function(btn) {
                btn.classList.remove('selected');
            });
            
            // Êäº„Åó„Åü„Éú„Çø„É≥„Å†„Åë„ÇíÈÅ∏ÊäûÁä∂ÊÖã„Å´„Åô„Çã
            button.classList.add('selected');
        }
        
                
        
    </script>
    <!-- ========== „Åì„Åì„Åã„ÇâËøΩÂä† ========== -->
    
    <!-- „Ç∑„É•„Éº„Éà‰ΩçÁΩÆË®òÈå≤„É¢„Éº„ÉÄ„É´ -->
    <div id="shotPositionModal" class="shot-chart-modal">
        <div class="shot-chart-content">
            <h2 style="text-align: center; color: #667eea;">üéØ „Å©„Åì„Åã„ÇâÊâì„Å£„ÅüÔºü</h2>
            <p style="text-align: center; color: #666; margin-bottom: 10px;">
                „Ç≥„Éº„Éà„Çí„Çø„ÉÉ„Éó„Åó„Å¶„Ç∑„É•„Éº„Éà‰ΩçÁΩÆ„ÇíË®òÈå≤
            </p>
            
            <div class="court-container" id="shotCourtContainer">
                <canvas id="shotCourtCanvas" class="court-canvas" width="300" height="400"></canvas>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modal-btn cancel-btn" style="flex: 1;" onclick="closeShotPositionModal()">
                    „Ç≠„É£„É≥„Çª„É´
                </button>
                <button class="modal-btn confirm-btn" style="flex: 1;" onclick="skipShotPosition()">
                    ‰ΩçÁΩÆ„ÇíË®òÈå≤„Åõ„Åö„Çπ„Ç≠„ÉÉ„Éó
                </button>
            </div>
        </div>
    </div>

    </body>
</html>
    
