<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ€ ãƒã‚¹ã‚±è¨˜éŒ²</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            z-index: 1000;
            display: none;
        }

        .sync-indicator.syncing {
            display: block;
            color: #667eea;
        }

        .sync-indicator.success {
            display: block;
            color: #2ecc71;
        }

        .sync-indicator.error {
            display: block;
            color: #ff4757;
        }

        .mode-switch {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid white;
            border-radius: 12px;
            background: rgba(255,255,255,0.2);
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-btn.active {
            background: white;
            color: #667eea;
        }

        .mode-btn.active.team-mode {
            color: #f39c12;
        }

        .mode-btn.active.team-mode {
            color: #f39c12;
        }

        /* å€‹äººãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã®å…¨ä½“èƒŒæ™¯ */
        body.personal-mode {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®æ™‚ã®å…¨ä½“èƒŒæ™¯ */
        body.team-mode {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }
        
        .tab-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab {
            flex: 1;
            min-width: 80px;
            padding: 15px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85em;
        }

        .tab.active {
            background: white;
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .stepper {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .stepper button {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 10px;
            background: #667eea;
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .stepper button:active {
            transform: scale(0.95);
        }

        .stepper .value {
            flex: 1;
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .stats-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 12px;
            color: white;
            text-align: center;
        }

        .stats-display h3 {
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stats-display .percentage {
            font-size: 1.8em;
            font-weight: bold;
        }

        .stats-display .fraction {
            font-size: 0.9em;
            opacity: 0.85;
            margin-top: 5px;
            font-weight: normal;
        }

        .save-btn, .primary-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .save-btn:active, .primary-btn:active {
            transform: scale(0.98);
        }

        .save-btn:disabled, .primary-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .game-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            position: relative;
        }

        .game-date {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .game-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .stat-box {
            text-align: center;
            padding: 8px;
            background: #f7f7f7;
            border-radius: 8px;
        }

        .stat-box .label {
            font-size: 0.7em;
            color: #666;
            margin-bottom: 4px;
        }

        .stat-box .value {
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-box .fraction {
            font-size: 0.75em;
            color: #999;
            margin-top: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .empty-state .icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        input[type="date"], input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
        }

        .saved-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: bold;
            z-index: 1000;
        }

        .saved-indicator.show {
            opacity: 1;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.1em;
            font-weight: bold;
            margin: 25px 0 15px 0;
            color: #333;
            border-left: 4px solid #667eea;
            padding-left: 10px;
        }

        .section-title:first-of-type {
            margin-top: 0;
        }

        .player-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .player-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .player-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .player-btn .number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .player-btn .name {
            font-size: 0.85em;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .action-btn.success {
            background: #2ecc71;
            color: white;
        }

        .action-btn.miss {
            background: #e0e0e0;
            color: #666;
        }

        .action-btn.other {
            background: #667eea;
            color: white;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .play-history {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: #f7f7f7;
            border-radius: 10px;
            padding: 10px;
        }

        .play-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .play-item:last-child {
            margin-bottom: 0;
        }

        .undo-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            background: #ff4757;
            color: white;
            font-size: 0.85em;
            cursor: pointer;
        }

        .period-selector {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .period-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-weight: bold;
            color: #666;
        }

        .period-btn.selected {
            background: #ffc107;
            color: white;
            border-color: #ffc107;
        }

        .team-code-display {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .team-code-display .code {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        .player-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-info .number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .my-data-badge {
            background: #2ecc71;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }

        .top-record {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .top-record .trophy {
            font-size: 3em;
            margin-bottom: 10px;
        }

        .top-record .value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .close-modal {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            width: 100%;
            margin-top: 15px;
            font-size: 16px;
            cursor: pointer;
        }
        .ranking-medal {
            font-size: 2em;
            display: inline-block;
            width: 50px;
            text-align: center;
        }

        .ranking-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-info .rank {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-right: 10px;
        }

        .ranking-info .player-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .ranking-info .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
            margin-left: 10px;
        }

        .game-history-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            color: white;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .game-history-item:hover {
            transform: translateY(-2px);
        }

        .game-history-item .game-date {
            font-size: 1em;
            color: #333;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .game-history-item .game-opponent {
            font-size: 1.3em;
            font-weight: bold;
        }

        .game-detail {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 10px;
            margin-bottom: 15px;
        }

        .game-detail.active {
            display: block;
        }

        .ranking-section {
            margin-bottom: 30px;
        }

        .ranking-section h3 {
            font-size: 1.2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid #667eea;
        }

        .top3-container {
            margin-bottom: 15px;
        }

        .all-rankings {
            display: none;
            margin-top: 10px;
        }

        .all-rankings.active {
            display: block;
        }

        .toggle-rankings {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: white;
            color: #667eea;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .toggle-rankings:hover {
            background: #667eea;
            color: white;
        }

        .toggle-rankings.active {
            background: #667eea;
            color: white;
        }

        /* ã‚¹ã‚³ã‚¢å…¥åŠ›æ¬„ */
        .score-input-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        .score-input-box {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .score-input-box label {
            font-size: 0.9em;
            font-weight: bold;
            color: #666;
            margin-bottom: 5px;
        }

        .score-input-box input {
            width: 80px;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            color: #667eea;
        }

        .score-vs {
            font-size: 1.5em;
            font-weight: bold;
            color: #999;
        }

        /* è©¦åˆçµæœè¡¨ç¤º */
        .game-result {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }

        .game-result.loss {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .game-result .result-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .game-result .result-score {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        .game-result .result-outcome {
            font-size: 1.3em;
            font-weight: bold;
        }

        .quarter-scores {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .quarter-score-item {
            background: white;
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }

        .quarter-score-item .quarter-label {
            font-size: 0.85em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .quarter-score-item .quarter-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
        }

        .quarter-score-item .quarter-diff {
            font-size: 0.9em;
            margin-top: 3px;
        }

        .quarter-diff.positive {
            color: #2ecc71;
        }

        .quarter-diff.negative {
            color: #e74c3c;
        }

        /* è©¦åˆç·¨é›†æ©Ÿèƒ½ */
        .edit-game-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            margin: 15px 0;
            width: 100%;
            font-size: 1em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .edit-game-btn:hover {
            background: #e67e22;
        }

        .edit-modal-content {
            max-height: 80vh;
            overflow-y: auto;
        }

        .edit-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .edit-section:last-child {
            border-bottom: none;
        }

        .edit-section h3 {
            color: #667eea;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .player-stat-edit {
            background: #f7f7f7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .player-stat-edit .player-header {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .stat-edit-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .stat-edit-item {
            display: flex;
            flex-direction: column;
        }

        .stat-edit-item label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 3px;
        }

        .stat-edit-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .save-edit-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 1.1em;
            margin-top: 15px;
        }

        .save-edit-btn:hover {
            background: #27ae60;
        }

        .delete-game-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            font-size: 0.95em;
            margin-top: 10px;
        }

        .delete-game-btn:hover {
            background: #c0392b;
        }

        /* ãƒœã‚¿ãƒ³ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes button-press {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
            100% { transform: scale(1); }
        }

        .action-btn.pressed {
            animation: button-press 0.3s ease;
        }

        /* ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€šçŸ¥ */
        .feedback-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.2em;
            font-weight: bold;
            z-index: 10000;
            animation: fade-in-out 1s ease;
            pointer-events: none;
        }

        @keyframes fade-in-out {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .feedback-notification.success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .feedback-notification.miss {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .feedback-notification.other {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        /* ç¾åœ¨é¸æŠä¸­ã®é¸æ‰‹è¡¨ç¤º */
        .current-player-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .current-player-banner .player-icon {
            font-size: 1.5em;
        }

        .current-player-banner .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .current-player-banner .player-label {
            font-size: 0.8em;
            opacity: 0.9;
        }

        .current-player-banner .player-name {
            font-size: 1.2em;
        }
         /* ========== é¸æ‰‹é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« ========== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 25px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .modal-header h2 {
            font-size: 1.3em;
            color: #333;
            margin: 0;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            padding: 0;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .modal-close:hover {
            background: #f0f0f0;
            color: #333;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .player-select-dropdown {
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 12px;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .player-select-dropdown:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .player-select-dropdown option {
            padding: 10px;
            font-size: 1em;
        }
        
        .modal-footer {
            display: flex;
            gap: 10px;
            padding: 20px 25px;
            border-top: 2px solid #f0f0f0;
        }
        
        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .cancel-btn {
            background: #f0f0f0;
            color: #666;
        }
        
        .cancel-btn:hover {
            background: #e0e0e0;
        }
        
        .confirm-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .confirm-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .confirm-btn:active {
            transform: translateY(0);
        }
        /* ========== ãƒãƒ¼ãƒ åè¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« ========== */
        .team-names {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 5px;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .our-team-name {
            color: white;
            font-weight: 600;
            margin-right: 20px;
        }
        
        .vs-label {
            color: white;
            font-size: 0.75em;
            font-weight: normal;
            opacity: 0.8;
            min-width: 30px;
            text-align: center;
            padding: 0 15px;
        }
        
        .opp-team-name {
            color: white;
            font-weight: 600;
            margin-left: 20px;
        }
        /* ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .shot-chart-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .shot-chart-modal.active {
            display: flex;
        }
        
        .shot-chart-content {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }
        
        .court-container {
            position: relative;
            width: 300px;
            height: 400px;
            margin: 20px auto;
            background: #f5f5f5;
            border: 3px solid #667eea;
            border-radius: 10px;
            cursor: crosshair;
        }
        
        .court-canvas {
            width: 100%;
            height: 100%;
        }
        
        .shot-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }
        
        .shot-marker.made {
            background: #2ecc71;
            border: 2px solid #27ae60;
        }
        
        .shot-marker.missed {
            background: #e74c3c;
            border: 2px solid #c0392b;
        }
        
        .zone-stats {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .zone-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
        }
        
        .zone-name {
            font-weight: bold;
            color: #667eea;
        }
        
        .zone-percentage {
            color: #2ecc71;
            font-weight: bold;
        }
        
        .shot-chart-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: transform 0.2s;
        }
        
        .shot-chart-button:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <div class="sync-indicator" id="syncIndicator">åŒæœŸä¸­...</div>
    
    <div class="container">
        <div class="header">
            <h1>ğŸ€ ãƒã‚¹ã‚±è¨˜éŒ²</h1>
            <p>æˆé•·ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†</p>
        </div>

        <div class="mode-switch">
           <button class="mode-btn active" onclick="switchMode('personal')">ğŸ‘¤ å€‹äºº</button>
           <button class="mode-btn" onclick="switchMode('team')">âš¡ ãƒãƒ¼ãƒ </button>
           <button class="mode-btn" onclick="switchMode('settings')">âš™ï¸ è¨­å®š</button>
        </div>

        <div id="personalMode">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTab('input')">ğŸ“ è¨˜éŒ²</button>
                <button class="tab" onclick="switchTab('list')">ğŸ“Š å±¥æ­´</button>
                <button class="tab" onclick="switchTab('ranking')">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
                <button class="tab" onclick="switchTab('graph')">ğŸ“ˆ ã‚°ãƒ©ãƒ•</button>
            </div>

            <div id="inputTab" class="tab-content active">
                <div id="inputPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">ğŸ‘¤</span>
                    <div class="player-info">
                        <span class="player-label">ç¾åœ¨è¡¨ç¤ºä¸­</span>
                        <span class="player-name" id="inputPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">æ–°ã—ã„è©¦åˆã‚’è¨˜éŒ²</h2>
                    
                    <div class="input-group">
                        <label>è©¦åˆæ—¥</label>
                        <input type="date" id="gameDate">
                    </div>

                    <div class="input-group">
                        <label>å¯¾æˆ¦ç›¸æ‰‹</label>
                        <input type="text" id="opponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                    </div>

                    <div class="input-group">
                        <label>ãƒ—ãƒ¬ã‚¤æ™‚é–“(åˆ†)</label>
                        <input type="number" id="playTime" value="0" min="0" max="200">
                    </div>

                    <div class="section-title">ğŸ€ ã‚·ãƒ¥ãƒ¼ãƒˆ</div>
                    
                    <div class="input-group">
                        <label>2ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsMade', -1)">âˆ’</button>
                            <div class="value" id="twoPointsMade">0</div>
                            <button onclick="changeValue('twoPointsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>2ãƒã‚¤ãƒ³ãƒˆè©¦æŠ•</label>
                        <div class="stepper">
                            <button onclick="changeValue('twoPointsAttempted', -1)">âˆ’</button>
                            <div class="value" id="twoPointsAttempted">0</div>
                            <button onclick="changeValue('twoPointsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsMade', -1)">âˆ’</button>
                            <div class="value" id="threePointsMade">0</div>
                            <button onclick="changeValue('threePointsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>3ãƒã‚¤ãƒ³ãƒˆè©¦æŠ•</label>
                        <div class="stepper">
                            <button onclick="changeValue('threePointsAttempted', -1)">âˆ’</button>
                            <div class="value" id="threePointsAttempted">0</div>
                            <button onclick="changeValue('threePointsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼æˆåŠŸ</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsMade', -1)">âˆ’</button>
                            <div class="value" id="freeThrowsMade">0</div>
                            <button onclick="changeValue('freeThrowsMade', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼è©¦æŠ•</label>
                        <div class="stepper">
                            <button onclick="changeValue('freeThrowsAttempted', -1)">âˆ’</button>
                            <div class="value" id="freeThrowsAttempted">0</div>
                            <button onclick="changeValue('freeThrowsAttempted', 1)">+</button>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stats-display">
                            <h3>2PæˆåŠŸç‡</h3>
                            <div class="percentage" id="twoPointPercentage">0%</div>
                            <div class="fraction" id="twoPointFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>3PæˆåŠŸç‡</h3>
                            <div class="percentage" id="threePointPercentage">0%</div>
                            <div class="fraction" id="threePointFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>FTæˆåŠŸç‡</h3>
                            <div class="percentage" id="freeThrowPercentage">0%</div>
                            <div class="fraction" id="freeThrowFraction">(0/0)</div>
                        </div>
                        <div class="stats-display">
                            <h3>ç·å¾—ç‚¹</h3>
                            <div class="percentage" id="totalPoints">0</div>
                        </div>
                    </div>

                    <div class="section-title">ğŸ¯ ãƒªãƒã‚¦ãƒ³ãƒ‰</div>

                    <div class="input-group">
                        <label>ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</label>
                        <div class="stepper">
                            <button onclick="changeValue('offensiveRebounds', -1)">âˆ’</button>
                            <div class="value" id="offensiveRebounds">0</div>
                            <button onclick="changeValue('offensiveRebounds', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</label>
                        <div class="stepper">
                            <button onclick="changeValue('defensiveRebounds', -1)">âˆ’</button>
                            <div class="value" id="defensiveRebounds">0</div>
                            <button onclick="changeValue('defensiveRebounds', 1)">+</button>
                        </div>
                    </div>

                    <div class="section-title">ğŸ“Š ãã®ä»–ã®çµ±è¨ˆ</div>

                    <div class="input-group">
                        <label>ã‚¢ã‚·ã‚¹ãƒˆ</label>
                        <div class="stepper">
                            <button onclick="changeValue('assists', -1)">âˆ’</button>
                            <div class="value" id="assists">0</div>
                            <button onclick="changeValue('assists', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</label>
                        <div class="stepper">
                            <button onclick="changeValue('steals', -1)">âˆ’</button>
                            <div class="value" id="steals">0</div>
                            <button onclick="changeValue('steals', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ–ãƒ­ãƒƒã‚¯</label>
                        <div class="stepper">
                            <button onclick="changeValue('blocks', -1)">âˆ’</button>
                            <div class="value" id="blocks">0</div>
                            <button onclick="changeValue('blocks', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</label>
                        <div class="stepper">
                            <button onclick="changeValue('turnovers', -1)">âˆ’</button>
                            <div class="value" id="turnovers">0</div>
                            <button onclick="changeValue('turnovers', 1)">+</button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label>ãƒ•ã‚¡ã‚¦ãƒ«</label>
                        <div class="stepper">
                            <button onclick="changeValue('fouls', -1)">âˆ’</button>
                            <div class="value" id="fouls">0</div>
                            <button onclick="changeValue('fouls', 1)">+</button>
                        </div>
                    </div>

                    <button class="save-btn" id="saveGameBtn" onclick="savePersonalGame()">è¨˜éŒ²ã‚’ä¿å­˜</button>
                </div>
            </div>

            <div id="listTab" class="tab-content">
                <div id="listPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">ğŸ‘¤</span>
                    <div class="player-info">
                        <span class="player-label">ç¾åœ¨è¡¨ç¤ºä¸­</span>
                        <span class="player-name" id="listPlayerName"></span>
                    </div>
                </div>
                <div id="gameList"></div>
            </div>

            <div id="rankingTab" class="tab-content">
                <div id="rankingPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">ğŸ‘¤</span>
                    <div class="player-info">
                        <span class="player-label">ç¾åœ¨è¡¨ç¤ºä¸­</span>
                        <span class="player-name" id="rankingPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ† ãƒ™ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹</h2>
                    <p style="color: #666; margin-bottom: 15px; font-size: 0.9em;">
                        é¸æŠã—ãŸé¸æ‰‹ã®è‡ªå·±ãƒ™ã‚¹ãƒˆè¨˜éŒ²ã§ã™
                    </p>
                    <div id="topPoints"></div>
                </div>
            </div>

            <div id="graphTab" class="tab-content">
                <div id="graphPlayerBanner" class="current-player-banner" style="display: none;">
                    <span class="player-icon">ğŸ‘¤</span>
                    <div class="player-info">
                        <span class="player-label">ç¾åœ¨è¡¨ç¤ºä¸­</span>
                        <span class="player-name" id="graphPlayerName"></span>
                    </div>
                </div>
                <div class="card">
                    <h2 style="margin-bottom: 20px;">ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ã®æ¨ç§»</h2>
                    <div class="chart-container">
                        <canvas id="shootingChart"></canvas>
                    </div>
                </div>
            </div>

            
        </div>
        <div id="settingsMode" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ”— ãƒãƒ¼ãƒ é€£æº</h2>
                    <div id="teamStatus"></div>
                    
                    <button class="primary-btn" style="margin-bottom: 10px;" onclick="showCreateTeamModal()">
                        ğŸ†• æ–°ã—ã„ãƒãƒ¼ãƒ ã‚’ä½œæˆ
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="showJoinTeamModal()">
                        ğŸ‘‹ ãƒãƒ¼ãƒ ã«å‚åŠ 
                    </button>
                    
                    <div style="margin-top: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 0.9em; color: #1976d2;">
                        ğŸ’¡ <strong>ãƒãƒ¼ãƒ æ©Ÿèƒ½:</strong> è¨˜éŒ²ä¿‚1äººãŒå…¨é¸æ‰‹ã‚’è¨˜éŒ²â†’å…¨å“¡ã®ã‚¹ãƒãƒ›ã«è‡ªå‹•åŒæœŸ
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ‘¤ å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºè¨­å®š</h2>
                    <div class="input-group">
                        <label>å€‹äººãƒ¢ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹é¸æ‰‹</label>
                        <select id="myPlayerSelect" onchange="changeMyPlayer()">
                            <option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                        </select>
                    </div>
                    <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                        é¸æŠã—ãŸé¸æ‰‹ã®å€‹äººæˆç¸¾ãŒå±¥æ­´ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ã‚°ãƒ©ãƒ•ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </p>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ‘¥ é¸æ‰‹ç™»éŒ²</h2>
                    <div class="input-group">
                        <label>èƒŒç•ªå·</label>
                        <input type="number" id="playerNumber" placeholder="ä¾‹: 7" min="0" max="99">
                    </div>
                    <div class="input-group">
                        <label>åå‰</label>
                        <input type="text" id="playerName" placeholder="ä¾‹: å±±ç”° èŠ±å­">
                    </div>
                    <button class="primary-btn" style="margin-top: 15px;" onclick="addPlayer()">é¸æ‰‹ã‚’è¿½åŠ </button>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ç™»éŒ²æ¸ˆã¿é¸æ‰‹</h2>
                    <div id="playerList"></div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px;">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
                    <button class="primary-btn" style="background: #2ecc71; margin-bottom: 10px;" onclick="exportData()">
                        ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                    </button>
                    
                    <button class="primary-btn" style="background: #3498db;" onclick="document.getElementById('importFile').click()">
                        ğŸ“‚ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‹ã‚‰å¾©å…ƒ
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
             <button class="primary-btn" style="background: #3498db; margin-top: 10px;" onclick="confirmClearLocalData()">
    ğŸ—‘ï¸ ã“ã®ã‚¹ãƒãƒ›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
</button>

<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="confirmResetTeamData()">
    âš ï¸ ãƒãƒ¼ãƒ å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ
</button>
                    
                </div>
            </div>
        <div id="teamMode" style="display: none;">
            <div class="tab-bar">
                <button class="tab active" onclick="switchTeamTab('record')">âš¡ è¨˜éŒ²</button>
                <button class="tab" onclick="switchTeamTab('history')">ğŸ“Š å±¥æ­´</button>
                <button class="tab" onclick="switchTeamTab('ranking')">ğŸ“ˆ ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
            </div>

            <div id="teamRecordTab">
            <div class="card">
                <h2 style="margin-bottom: 20px;">âš¡ è©¦åˆè¨˜éŒ²</h2>
                
                <div class="input-group">
                    <label>è©¦åˆæ—¥</label>
                    <input type="date" id="teamGameDate">
                </div>

                <div class="input-group">
                    <label>å¯¾æˆ¦ç›¸æ‰‹</label>
                    <input type="text" id="teamOpponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                </div>

                <button class="primary-btn" onclick="startTeamGame()">è©¦åˆé–‹å§‹</button>
            </div>

            <div id="teamRecording" style="display: none;">
                <div class="card">
                    <h2 style="margin-bottom: 15px;">ãƒ”ãƒªã‚ªãƒ‰ã‚’é¸æŠ</h2>
                    <div class="period-selector">
                        <div class="period-btn selected" onclick="selectPeriod(1)" id="period1">1Q</div>
                        <div class="period-btn" onclick="selectPeriod(2)" id="period2">2Q</div>
                        <div class="period-btn" onclick="selectPeriod(3)" id="period3">3Q</div>
                        <div class="period-btn" onclick="selectPeriod(4)" id="period4">4Q</div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h3 style="font-size: 1em; color: #666; margin-bottom: 10px;">ã“ã®ã‚¯ã‚©ãƒ¼ã‚¿ãƒ¼ã®å¾—ç‚¹</h3>
                        <div class="score-input-container">
                            <div class="score-input-box">
                                <label>è‡ªãƒãƒ¼ãƒ </label>
                                <input type="number" id="ourScoreInput" min="0" max="99" value="0" onchange="updateQuarterScore(currentPeriod, 'our')">
                            </div>
                            <div class="score-vs">-</div>
                            <div class="score-input-box">
                                <label>ç›¸æ‰‹</label>
                                <input type="number" id="oppScoreInput" min="0" max="99" value="0" onchange="updateQuarterScore(currentPeriod, 'opp')">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">é¸æ‰‹ã‚’é¸æŠ</h2>
                    <div id="playerSelector" class="player-grid"></div>
                </div>

                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">ãƒ—ãƒ¬ã‚¤ã‚’è¨˜éŒ²</h2>
                        <button class="primary-btn" style="background: #3498db; padding: 8px 16px; font-size: 0.9em;" onclick="openGlossary()">
                            â“ ç”¨èªè§£èª¬
                        </button>
                    </div>
                    <div class="action-buttons">
                        <button class="action-btn success" onclick="recordPlay('2p-made')">2PæˆåŠŸ</button>
                        <button class="action-btn miss" onclick="recordPlay('2p-miss')">2På¤±æ•—</button>
                        <button class="action-btn success" onclick="recordPlay('3p-made')">3PæˆåŠŸ</button>
                        <button class="action-btn miss" onclick="recordPlay('3p-miss')">3På¤±æ•—</button>
                        <button class="action-btn success" onclick="recordPlay('ft-made')">FTæˆåŠŸ</button>
                        <button class="action-btn miss" onclick="recordPlay('ft-miss')">FTå¤±æ•—</button>
                        <button class="action-btn other" onclick="recordPlay('oreb')">ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</button>
                        <button class="action-btn other" onclick="recordPlay('dreb')">ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰</button>
                        <button class="action-btn other" onclick="recordPlay('ast')">ã‚¢ã‚·ã‚¹ãƒˆ</button>
                        <button class="action-btn other" onclick="recordPlay('stl')">ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</button>
                        <button class="action-btn other" onclick="recordPlay('blk')">ãƒ–ãƒ­ãƒƒã‚¯</button>
                        <button class="action-btn other" onclick="recordPlay('to')">ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</button>
                        <button class="action-btn other" onclick="recordPlay('foul')">ãƒ•ã‚¡ã‚¦ãƒ«</button>
                    </div>

                    <div class="play-history" id="playHistory">
                        <div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px;">è©¦åˆçµ±è¨ˆ</h2>
                    <div id="teamStats"></div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                        <button class="primary-btn" style="background: #3498db;" onclick="saveDraftTeamGame()">
                            ğŸ’¾ é€”ä¸­ä¿å­˜
                        </button>
                        <button class="save-btn" onclick="saveTeamGame()">
                            âœ… è©¦åˆçµ‚äº†ãƒ»ä¿å­˜
                        </button>
                    </div>
                </div>
            </div>
     </div>
     <div id="teamHistoryTab" style="display: none;">
         <div id="teamGamesList"></div>
     </div>
     <div id="teamRankingTab" style="display: none;">
         <div id="teamRankingsDisplay"></div>
     </div>
        </div>
    </div>

    <div id="createTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ†• ãƒãƒ¼ãƒ ã‚’ä½œæˆ</h2>
            <div class="input-group">
                <label>ãƒãƒ¼ãƒ å</label>
                <input type="text" id="newTeamName" placeholder="ä¾‹: ã•ãã‚‰ãƒã‚¹ã‚±éƒ¨">
            </div>
            <button class="primary-btn" onclick="createTeam()">ä½œæˆ</button>
            <button class="close-modal" onclick="closeModal('createTeamModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>

    <div id="joinTeamModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">ğŸ‘‹ ãƒãƒ¼ãƒ ã«å‚åŠ </h2>
            <div class="input-group">
                <label>ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰</label>
                <input type="text" id="joinTeamCode" placeholder="6æ¡ã®ã‚³ãƒ¼ãƒ‰" maxlength="6">
            </div>
            <button class="primary-btn" onclick="joinTeam()">å‚åŠ </button>
            <button class="close-modal" onclick="closeModal('joinTeamModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
  <div id="glossaryModal" class="modal">
        <div class="modal-content" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
            <h2 class="modal-title">ğŸ“š ãƒã‚¹ã‚±ç”¨èªè§£èª¬</h2>
            
            <div style="text-align: left;">
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #2ecc71; margin-top: 0;">âœ… æˆåŠŸãƒ—ãƒ¬ã‚¤</h3>
                    
                    <p style="margin: 10px 0;"><strong>2PæˆåŠŸ(ãƒ„ãƒ¼ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ)</strong><br>
                    2ç‚¹ã‚·ãƒ¥ãƒ¼ãƒˆãŒå…¥ã£ãŸã¨ãã€‚ã‚´ãƒ¼ãƒ«ã«è¿‘ã„å ´æ‰€ã‹ã‚‰ã®ã‚·ãƒ¥ãƒ¼ãƒˆã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>3PæˆåŠŸ(ã‚¹ãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆæˆåŠŸ)</strong><br>
                    3ç‚¹ã‚·ãƒ¥ãƒ¼ãƒˆãŒå…¥ã£ãŸã¨ãã€‚3ç‚¹ãƒ©ã‚¤ãƒ³ã®å¤–å´ã‹ã‚‰ã®ã‚·ãƒ¥ãƒ¼ãƒˆã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>FTæˆåŠŸ(ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼æˆåŠŸ)</strong><br>
                    ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼(1ç‚¹)ãŒå…¥ã£ãŸã¨ãã€‚ãƒ•ã‚¡ã‚¦ãƒ«ã•ã‚ŒãŸå¾Œã®ç„¡å¦¨å®³ã‚·ãƒ¥ãƒ¼ãƒˆã€‚</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #95a5a6; margin-top: 0;">âŒ å¤±æ•—ãƒ—ãƒ¬ã‚¤</h3>
                    
                    <p style="margin: 10px 0;"><strong>2På¤±æ•—</strong><br>
                    2ç‚¹ã‚·ãƒ¥ãƒ¼ãƒˆãŒå¤–ã‚ŒãŸã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>3På¤±æ•—</strong><br>
                    3ç‚¹ã‚·ãƒ¥ãƒ¼ãƒˆãŒå¤–ã‚ŒãŸã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>FTå¤±æ•—</strong><br>
                    ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼ãŒå¤–ã‚ŒãŸã¨ãã€‚</p>
                </div>

                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #3498db; margin-top: 0;">ğŸ“Š ãã®ä»–ã®è¨˜éŒ²</h3>
                    
                    <p style="margin: 10px 0;"><strong>ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰(æ”»æ’ƒãƒªãƒã‚¦ãƒ³ãƒ‰)</strong><br>
                    å‘³æ–¹ã®ã‚·ãƒ¥ãƒ¼ãƒˆãŒå¤–ã‚ŒãŸå¾Œã€è‡ªåˆ†ã®ãƒãƒ¼ãƒ ãŒå†ã³ãƒœãƒ¼ãƒ«ã‚’å–ã£ãŸã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰(å®ˆå‚™ãƒªãƒã‚¦ãƒ³ãƒ‰)</strong><br>
                    ç›¸æ‰‹ã®ã‚·ãƒ¥ãƒ¼ãƒˆãŒå¤–ã‚ŒãŸå¾Œã€ãƒœãƒ¼ãƒ«ã‚’å–ã£ãŸã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>ã‚¢ã‚·ã‚¹ãƒˆ</strong><br>
                    ãƒ‘ã‚¹ã‚’å‡ºã—ã¦ã€ãã®ãƒ‘ã‚¹ã‚’å—ã‘ãŸå‘³æ–¹ãŒã‚·ãƒ¥ãƒ¼ãƒˆã‚’æ±ºã‚ãŸã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</strong><br>
                    ç›¸æ‰‹ã‹ã‚‰ãƒœãƒ¼ãƒ«ã‚’å¥ªã£ãŸã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>ãƒ–ãƒ­ãƒƒã‚¯</strong><br>
                    ç›¸æ‰‹ã®ã‚·ãƒ¥ãƒ¼ãƒˆã‚’æ‰‹ã§é˜²ã„ã ã¨ãã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼</strong><br>
                    ãƒœãƒ¼ãƒ«ã‚’å¤±ã£ãŸã¨ãã€‚ãƒ‘ã‚¹ãƒŸã‚¹ã€ãƒ‰ãƒªãƒ–ãƒ«ãƒŸã‚¹ã€ç›¸æ‰‹ã«å¥ªã‚ã‚ŒãŸã¨ããªã©ã€‚</p>
                    
                    <p style="margin: 10px 0;"><strong>ãƒ•ã‚¡ã‚¦ãƒ«</strong><br>
                    åå‰‡ã‚’ã—ãŸã¨ãã€‚ç›¸æ‰‹ã‚’æŠ¼ã™ã€å©ãã€ä¸æ­£ãªãƒ–ãƒ­ãƒƒã‚¯ãªã©ã€‚</p>
                </div>

                <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <h3 style="color: #f39c12; margin-top: 0;">ğŸ’¡ è¨˜éŒ²ã®ã‚³ãƒ„</h3>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>è¿·ã£ãŸã‚‰è¨˜éŒ²ã—ãªã„ã‚ˆã‚Šã€è¨˜éŒ²ã—ãŸæ–¹ãŒã„ã„</li>
                        <li>é–“é•ãˆãŸã‚‰ã€Œãƒ—ãƒ¬ã‚¤å±¥æ­´ã€ã‹ã‚‰å‰Šé™¤ã§ãã‚‹</li>
                        <li>ã‚·ãƒ¥ãƒ¼ãƒˆã¯ã€ŒæˆåŠŸã€ã¾ãŸã¯ã€Œå¤±æ•—ã€ã®ä¸¡æ–¹ã‚’å¿…ãšè¨˜éŒ²</li>
                        <li>ãƒªãƒã‚¦ãƒ³ãƒ‰ã¯èª°ãŒå–ã£ãŸã‹ãŒé‡è¦</li>
                    </ul>
                </div>
            </div>
            
            <button class="primary-btn" onclick="closeModal('glossaryModal')">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <!-- è©¦åˆç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="editGameModal" class="modal">
        <div class="modal-content edit-modal-content">
            <h2 class="modal-title">ğŸ”’ è©¦åˆè¨˜éŒ²ã‚’ç·¨é›†</h2>
            
            <div class="edit-section">
                <h3>ğŸ“… è©¦åˆæƒ…å ±</h3>
                <div class="input-group">
                    <label>è©¦åˆæ—¥</label>
                    <input type="date" id="editGameDate">
                </div>
                <div class="input-group">
                    <label>å¯¾æˆ¦ç›¸æ‰‹</label>
                    <input type="text" id="editOpponent" placeholder="ç›¸æ‰‹ãƒãƒ¼ãƒ å">
                </div>
            </div>

            <div class="edit-section">
                <h3>ğŸ€ è©¦åˆã‚¹ã‚³ã‚¢</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                    <div class="input-group">
                        <label>Q1 è‡ªãƒãƒ¼ãƒ </label>
                        <input type="number" id="editOurQ1" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q1 ç›¸æ‰‹</label>
                        <input type="number" id="editOppQ1" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q2 è‡ªãƒãƒ¼ãƒ </label>
                        <input type="number" id="editOurQ2" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q2 ç›¸æ‰‹</label>
                        <input type="number" id="editOppQ2" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q3 è‡ªãƒãƒ¼ãƒ </label>
                        <input type="number" id="editOurQ3" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q3 ç›¸æ‰‹</label>
                        <input type="number" id="editOppQ3" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q4 è‡ªãƒãƒ¼ãƒ </label>
                        <input type="number" id="editOurQ4" min="0" max="99" value="0">
                    </div>
                    <div class="input-group">
                        <label>Q4 ç›¸æ‰‹</label>
                        <input type="number" id="editOppQ4" min="0" max="99" value="0">
                    </div>
                </div>
            </div>

            <div class="edit-section" id="editPlayersSection">
                <h3>ğŸ‘¥ é¸æ‰‹çµ±è¨ˆ</h3>
                <div id="editPlayersList"></div>
            </div>

            <button class="save-edit-btn" onclick="saveGameEdit()">âœ… å¤‰æ›´ã‚’ä¿å­˜</button>
            <button class="delete-game-btn" onclick="deleteGame()">ğŸ—‘ï¸ ã“ã®è©¦åˆã‚’å‰Šé™¤</button>
            <button class="close-modal" onclick="closeModal('editGameModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
    
    <div class="saved-indicator" id="savedIndicator">âœ“ ä¿å­˜ã—ã¾ã—ãŸ</div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwbPUgd-QAVhwBmhyBwiCtS1GDvZks0imrC78ZsJu5dV-d-Zt6reEW0oi1Lkc_MbW_agQ/exec';
        
        let currentMode = 'personal';
        // ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆé–¢é€£ã®å¤‰æ•°
        let currentShotPosition = null;
        let shotChartCallback = null;
        
        // ã‚³ãƒ¼ãƒˆå›³ã‚’æç”»ã™ã‚‹é–¢æ•°
        function drawCourt(canvas) {
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            // èƒŒæ™¯ã‚’ç™½ã«
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // ã‚³ãƒ¼ãƒˆã®ç·šï¼ˆé»’ï¼‰
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            
            // å¤–æ 
            ctx.strokeRect(10, 10, width - 20, height - 20);
            
            // ãƒ•ãƒªãƒ¼ã‚¹ãƒ­ãƒ¼ãƒ©ã‚¤ãƒ³ï¼ˆå°å½¢ï¼‰
            ctx.beginPath();
            ctx.moveTo(width * 0.2, 10);
            ctx.lineTo(width * 0.3, height * 0.25);
            ctx.lineTo(width * 0.7, height * 0.25);
            ctx.lineTo(width * 0.8, 10);
            ctx.closePath();
            ctx.stroke();
            
            // 3ãƒã‚¤ãƒ³ãƒˆãƒ©ã‚¤ãƒ³ï¼ˆåŠå††ï¼‰
            ctx.beginPath();
            ctx.arc(width / 2, 10, width * 0.45, 0, Math.PI);
            ctx.stroke();
            
            // ã‚´ãƒ¼ãƒ«ï¼ˆåŠå††ï¼‰
            ctx.beginPath();
            ctx.arc(width / 2, 10, 15, 0, Math.PI * 2);
            ctx.fillStyle = '#e74c3c';
            ctx.fill();
            
            // ã‚»ãƒ³ã‚¿ãƒ¼ãƒ©ã‚¤ãƒ³ï¼ˆç‚¹ç·šï¼‰
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(10, height / 2);
            ctx.lineTo(width - 10, height / 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ã‚¨ãƒªã‚¢åã‚’è¡¨ç¤º
            ctx.fillStyle = '#999';
            ctx.font = '12px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText('ã‚´ãƒ¼ãƒ«ä¸‹', width / 2, 80);
            ctx.fillText('å·¦ã‚¦ã‚£ãƒ³ã‚°', width * 0.25, height * 0.35);
            ctx.fillText('å³ã‚¦ã‚£ãƒ³ã‚°', width * 0.75, height * 0.35);
            ctx.fillText('ãƒˆãƒƒãƒ—', width / 2, height * 0.6);
        }
        
        // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ãŒã©ã®ã‚¨ãƒªã‚¢ã«å±ã™ã‚‹ã‹åˆ¤å®šã™ã‚‹é–¢æ•°
        function getZoneFromPosition(x, y, width, height) {
            const centerX = width / 2;
            const distanceFromCenter = Math.abs(x - centerX);
            
            // Yåº§æ¨™ã§åˆ¤å®š
            if (y < height * 0.2) {
                return 'paint'; // ã‚´ãƒ¼ãƒ«ä¸‹
            } else if (y < height * 0.4) {
                if (distanceFromCenter < width * 0.2) {
                    return 'mid_range'; // ãƒŸãƒ‰ãƒ«ãƒ¬ãƒ³ã‚¸
                } else {
                    return x < centerX ? 'left_wing' : 'right_wing'; // å·¦å³ã‚¦ã‚£ãƒ³ã‚°
                }
            } else if (y < height * 0.65) {
                return 'top'; // ãƒˆãƒƒãƒ—
            } else {
                return 'backcourt'; // ãƒãƒƒã‚¯ã‚³ãƒ¼ãƒˆ
            }
        }
        
        // ã‚¨ãƒªã‚¢åã‚’æ—¥æœ¬èªã«å¤‰æ›
        function getZoneNameJP(zone) {
            const names = {
                'paint': 'ã‚´ãƒ¼ãƒ«ä¸‹',
                'left_wing': 'å·¦ã‚¦ã‚£ãƒ³ã‚°',
                'right_wing': 'å³ã‚¦ã‚£ãƒ³ã‚°',
                'mid_range': 'ãƒŸãƒ‰ãƒ«ãƒ¬ãƒ³ã‚¸',
                'top': 'ãƒˆãƒƒãƒ—',
                'backcourt': 'ãƒãƒƒã‚¯ã‚³ãƒ¼ãƒˆ'
            };
            return names[zone] || zone;
        }
        let personalGames = [];
        let teamGames = [];
        let players = [];
        let myPlayerId = null;
        let teamData = null;
        let charts = {};
        
        let stats = {
            twoPointsMade: 0, twoPointsAttempted: 0,
            threePointsMade: 0, threePointsAttempted: 0,
            freeThrowsMade: 0, freeThrowsAttempted: 0,
            offensiveRebounds: 0, defensiveRebounds: 0,
            assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
        };

        let currentTeamGame = null;
        let draftTeamGame = null;
        let selectedPlayer = null;
        let currentPeriod = 1;

        function showSyncIndicator(status, message) {
            const indicator = document.getElementById('syncIndicator');
            indicator.className = 'sync-indicator ' + status;
            indicator.textContent = message;
            
            if (status === 'success' || status === 'error') {
                setTimeout(function() {
                    indicator.className = 'sync-indicator';
                }, 3000);
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('basketballData');
                if (saved) {
                    const data = JSON.parse(saved);
                    personalGames = data.personalGames || [];
                    teamGames = data.teamGames || [];
                    players = data.players || [];
                    myPlayerId = data.myPlayerId || null;
                    teamData = data.teamData || null;
                    draftTeamGame = data.draftTeamGame || null;
                    // â–¼â–¼â–¼ ã“ã“ã‹ã‚‰è¿½åŠ  â–¼â–¼â–¼
                    // myPlayerIdãŒå­˜åœ¨ã—ãªã„é¸æ‰‹ã‚’æŒ‡ã—ã¦ã„ã‚‹å ´åˆã€ä¿®æ­£ã™ã‚‹
                    if (myPlayerId && players.length > 0) {
                        const playerExists = players.find(function(p) {
                            return p.id === myPlayerId;
                        });
                
                        if (!playerExists) {
                            console.warn('é¸æŠä¸­ã®é¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æœ€åˆã®é¸æ‰‹ã‚’è‡ªå‹•é¸æŠã—ã¾ã™ã€‚');
                            myPlayerId = players[0].id;
                            saveData();
                        }
                    }
                    // â–²â–²â–² ã“ã“ã¾ã§è¿½åŠ  â–²â–²â–²
                }
            } catch (e) {
                console.error('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        function saveData() {
            const data = {
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData,
                draftTeamGame: draftTeamGame
            };
            localStorage.setItem('basketballData', JSON.stringify(data));
            showSavedIndicator();
        }

        function showSavedIndicator() {
            const indicator = document.getElementById('savedIndicator');
            indicator.classList.add('show');
            setTimeout(function() {
                indicator.classList.remove('show');
            }, 2000);
        }

        
        function startTeamGame() {
            // é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯è­¦å‘Š
            if (draftTeamGame) {
                if (!confirm('âš ï¸ æœªå®Œäº†ã®è©¦åˆè¨˜éŒ²ãŒã‚ã‚Šã¾ã™\n\næ–°ã—ã„è©¦åˆã‚’é–‹å§‹ã™ã‚‹ã¨ã€é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚\nç¶šã‘ã¾ã™ã‹?')) {
                    return;
                }
            }
            
            if (players.length === 0) { 
                alert('å…ˆã«é¸æ‰‹ã‚’ç™»éŒ²ã—ã¦ãã ã•ã„(è¨­å®šã‚¿ãƒ–)'); 
                return; 
            }

            const date = document.getElementById('teamGameDate').value;
            if (!date) { 
                alert('è©¦åˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„'); 
                return; 
            }

            currentTeamGame = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('teamOpponent').value.trim(),
                plays: [],
                playerStats: {},
                scores: {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                }
            };

            players.forEach(function(p) {
                currentTeamGame.playerStats[p.id] = {
                    twoPointsMade: 0, twoPointsAttempted: 0,
                    threePointsMade: 0, threePointsAttempted: 0,
                    freeThrowsMade: 0, freeThrowsAttempted: 0,
                    offensiveRebounds: 0, defensiveRebounds: 0,
                    assists: 0, steals: 0, blocks: 0, turnovers: 0, fouls: 0
                };
            });

            currentPeriod = 1;
            selectPeriod(1);
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
        }

        function displayPlayerSelector() {
            const sel = document.getElementById('playerSelector');
            sel.innerHTML = players.map(function(p) {
                const isSelected = selectedPlayer === p.id;
                return '<div class="player-btn' + (isSelected ? ' selected' : '') + '" onclick="selectPlayer(\'' + p.id + '\')">' +
                    '<div class="number">#' + p.number + '</div>' +
                    '<div class="name">' + p.name + '</div>' +
                    '</div>';
            }).join('');
        }

        function selectPlayer(id) {
            selectedPlayer = id;
            displayPlayerSelector();
        }

        function selectPeriod(period) {
            currentPeriod = period;
            
            // ãƒ”ãƒªã‚ªãƒ‰ãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’æ›´æ–°
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById('period' + i);
                if (i === period) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            }
            
            // ã‚¹ã‚³ã‚¢å…¥åŠ›æ¬„ã®å€¤ã‚’æ›´æ–°(IDã¯å›ºå®š)
            const ourScoreInput = document.querySelector('.score-input-container input[id^="ourScore"]');
            const oppScoreInput = document.querySelector('.score-input-container input[id^="oppScore"]');
            
            if (ourScoreInput && oppScoreInput) {
                // onchangeã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®šã—ç›´ã—
                ourScoreInput.onchange = function() { updateQuarterScore(period, 'our'); };
                oppScoreInput.onchange = function() { updateQuarterScore(period, 'opp'); };
                
                // ç¾åœ¨ã®ã‚¯ã‚©ãƒ¼ã‚¿ãƒ¼ã®ã‚¹ã‚³ã‚¢ã‚’è¡¨ç¤º
                if (currentTeamGame && currentTeamGame.scores) {
                    ourScoreInput.value = currentTeamGame.scores.our['q' + period] || 0;
                    oppScoreInput.value = currentTeamGame.scores.opp['q' + period] || 0;
                }
            }
        }

        function updateQuarterScore(quarter, team) {
            if (!currentTeamGame) return;
            
            const inputId = team === 'our' ? 'ourScoreInput' : 'oppScoreInput';
            const value = parseInt(document.getElementById(inputId).value) || 0;
            
            currentTeamGame.scores[team]['q' + quarter] = value;
        }

        function getPlayLabel(type) {
            const labels = {
                '2p-made': '2PæˆåŠŸ', '2p-miss': '2På¤±æ•—',
                '3p-made': '3PæˆåŠŸ', '3p-miss': '3På¤±æ•—',
                'ft-made': 'FTæˆåŠŸ', 'ft-miss': 'FTå¤±æ•—',
                'oreb': 'ã‚ªãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰', 'dreb': 'ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹ãƒªãƒã‚¦ãƒ³ãƒ‰',
                'ast': 'ã‚¢ã‚·ã‚¹ãƒˆ', 'stl': 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«', 'blk': 'ãƒ–ãƒ­ãƒƒã‚¯',
                'to': 'ã‚¿ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼', 'foul': 'ãƒ•ã‚¡ã‚¦ãƒ«'
            };
            return labels[type] || type;
        }

        function recordPlay(type) {
            if (!selectedPlayer || !currentPeriod) {
                alert('é¸æ‰‹ã¨ã‚¯ã‚©ãƒ¼ã‚¿ãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!currentTeamGame) {
                alert('è©¦åˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆç³»ã®ãƒ—ãƒ¬ã‚¤ã®å ´åˆã¯ä½ç½®ã‚’è¨˜éŒ²
            const shotTypes = ['2p-made', '2p-miss', '3p-made', '3p-miss'];
            
            if (shotTypes.includes(type)) {
                // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
                openShotPositionModal(function(position) {
                    // ä½ç½®æƒ…å ±ã¨å…±ã«ãƒ—ãƒ¬ã‚¤ã‚’è¨˜éŒ²
                    recordPlayWithPosition(type, position);
                });
            } else {
                // ã‚·ãƒ¥ãƒ¼ãƒˆä»¥å¤–ã¯ãã®ã¾ã¾è¨˜éŒ²
                recordPlayWithPosition(type, null);
            }
        }
        
        // ä½ç½®æƒ…å ±ä»˜ãã§ãƒ—ãƒ¬ã‚¤ã‚’è¨˜éŒ²ã™ã‚‹æ–°ã—ã„é–¢æ•°
        function recordPlayWithPosition(type, position) {
            if (!currentTeamGame) {
                alert('è©¦åˆã‚’é–‹å§‹ã—ã¦ãã ã•ã„');
                return;
            }
            
            const play = {
                playType: type,
                playerId: selectedPlayer,
                period: currentPeriod,  // â† currentQuarterã§ã¯ãªãcurrentPeriod
                timestamp: Date.now()
            };
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®æƒ…å ±ã‚’è¿½åŠ 
            if (position) {
                play.position = position;
            }
            
            currentTeamGame.plays.push(play);  // â† currentPlaysã§ã¯ãªãcurrentTeamGame.playsã«å¤‰æ›´
            updatePlayerStats(selectedPlayer, type);
            displayPlayHistory();
            updateTeamStats();  // â† displayCurrentStatsã§ã¯ãªãupdateTeamStatsã‚’å‘¼ã¶
            
            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤ºã‚’è¿½åŠ 
            const player = players.find(p => p.id === selectedPlayer);
            const playerName = player ? '#' + player.number + ' ' + player.name : '';
            showPlayFeedback(playerName + ' ' + getPlayLabel(type), type);
            
            saveData();
        }

        // ãƒ—ãƒ¬ã‚¤ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦é¸æ‰‹ã®çµ±è¨ˆã‚’æ›´æ–°
        function updatePlayerStats(playerId, playType) {
            if (!currentTeamGame || !currentTeamGame.playerStats[playerId]) {
                return;
            }
            
            const stats = currentTeamGame.playerStats[playerId];
            
            switch(playType) {
                case '2p-made':
                    stats.twoPointsMade++;
                    stats.twoPointsAttempted++;
                    break;
                case '2p-miss':
                    stats.twoPointsAttempted++;
                    break;
                case '3p-made':
                    stats.threePointsMade++;
                    stats.threePointsAttempted++;
                    break;
                case '3p-miss':
                    stats.threePointsAttempted++;
                    break;
                case 'ft-made':
                    stats.freeThrowsMade++;
                    stats.freeThrowsAttempted++;
                    break;
                case 'ft-miss':
                    stats.freeThrowsAttempted++;
                    break;
                case 'oreb':
                    stats.offensiveRebounds++;
                    break;
                case 'dreb':
                    stats.defensiveRebounds++;
                    break;
                case 'ast':
                    stats.assists++;
                    break;
                case 'stl':
                    stats.steals++;
                    break;
                case 'blk':
                    stats.blocks++;
                    break;
                case 'to':
                    stats.turnovers++;
                    break;
                case 'foul':
                    stats.fouls++;
                    break;
            }
        }

        function showPlayFeedback(message, type) {
            // æ—¢å­˜ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒã‚ã‚Œã°å‰Šé™¤
            const existing = document.querySelector('.feedback-notification');
            if (existing) {
                existing.remove();
            }

            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯é€šçŸ¥ã‚’ä½œæˆ
            const feedback = document.createElement('div');
            feedback.className = 'feedback-notification';
            
            // ã‚¿ã‚¤ãƒ—ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            if (type.includes('made')) {
                feedback.classList.add('success');
            } else if (type.includes('miss')) {
                feedback.classList.add('miss');
            } else {
                feedback.classList.add('other');
            }
            
            feedback.textContent = message;
            document.body.appendChild(feedback);

            // 1ç§’å¾Œã«å‰Šé™¤
            setTimeout(function() {
                if (feedback && feedback.parentNode) {
                    feedback.remove();
                }
            }, 1000);

            // ãƒœã‚¿ãƒ³ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(function(btn) {
                if (btn.textContent.toLowerCase().includes(type.split('-')[0])) {
                    btn.classList.add('pressed');
                    setTimeout(function() {
                        btn.classList.remove('pressed');
                    }, 300);
                }
            });
        }

        function deletePlay(timestamp) {
            const playIndex = currentTeamGame.plays.findIndex(function(p) {
                return p.timestamp === timestamp;
            });
            if (playIndex === -1) return;
            
            const play = currentTeamGame.plays[playIndex];
            const st = currentTeamGame.playerStats[play.playerId];
            
            if (play.playType === '2p-made') { st.twoPointsMade--; st.twoPointsAttempted--; }
            else if (play.playType === '2p-miss') { st.twoPointsAttempted--; }
            else if (play.playType === '3p-made') { st.threePointsMade--; st.threePointsAttempted--; }
            else if (play.playType === '3p-miss') { st.threePointsAttempted--; }
            else if (play.playType === 'ft-made') { st.freeThrowsMade--; st.freeThrowsAttempted--; }
            else if (play.playType === 'ft-miss') { st.freeThrowsAttempted--; }
            else if (play.playType === 'oreb') { st.offensiveRebounds--; }
            else if (play.playType === 'dreb') { st.defensiveRebounds--; }
            else if (play.playType === 'ast') { st.assists--; }
            else if (play.playType === 'stl') { st.steals--; }
            else if (play.playType === 'blk') { st.blocks--; }
            else if (play.playType === 'to') { st.turnovers--; }
            else if (play.playType === 'foul') { st.fouls--; }
            
            currentTeamGame.plays.splice(playIndex, 1);
            
            updateTeamStats();
            displayPlayHistory();
        }

        function displayPlayHistory() {
    const histEl = document.getElementById('playHistory');
    
    // ========== è¿½åŠ :å­˜åœ¨ãƒã‚§ãƒƒã‚¯ ==========
    if (!currentTeamGame || !currentTeamGame.plays) {
        histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>';
        return;
    }
    // ========================================
    
    if (currentTeamGame.plays.length === 0) {
        histEl.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.9em;">ãƒ—ãƒ¬ã‚¤å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>';
        return;
    }
    
    const recentPlays = currentTeamGame.plays.slice().reverse().slice(0, 10);
    histEl.innerHTML = '<div style="margin-bottom: 10px; font-size: 0.9em; color: #666; font-weight: bold;">æœ€æ–°ã®ãƒ—ãƒ¬ã‚¤(æœ€å¤§10ä»¶) - ã‚¿ãƒƒãƒ—ã§å‰Šé™¤</div>' +
        recentPlays.map(function(play) {
            const p = players.find(function(pl) {
                return pl.id === play.playerId;
            });
            return '<div class="play-item">' +
                '<div>' +
                '<strong>' + play.period + 'Q | #' + p.number + ' ' + p.name + '</strong>' +
                '<div style="font-size: 0.85em; color: #666; margin-top: 2px;">' + getPlayLabel(play.playType) + '</div>' +
                '</div>' +
                '<button class="undo-btn" onclick="deletePlay(' + play.timestamp + ')">å‰Šé™¤</button>' +
                '</div>';
        }).join('');
}

        function updateTeamStats() {
            const el = document.getElementById('teamStats');
            let html = '';

            players.forEach(function(p) {
                const st = currentTeamGame.playerStats[p.id];
                const pts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;
                const reb = st.offensiveRebounds + st.defensiveRebounds;

                html += '<div style="padding: 10px; background: #f7f7f7; border-radius: 8px; margin-bottom: 10px;">' +
                    '<div style="font-weight: bold; margin-bottom: 5px;">#' + p.number + ' ' + p.name + '</div>' +
                    '<div style="font-size: 0.9em; color: #666;">' +
                    pts + 'ç‚¹ | ' + reb + 'ãƒªãƒã‚¦ãƒ³ãƒ‰ | ' + st.assists + 'ã‚¢ã‚·ã‚¹ãƒˆ | ' + st.steals + 'ã‚¹ãƒ†ã‚£ãƒ¼ãƒ« | ' + st.blocks + 'ãƒ–ãƒ­ãƒƒã‚¯' +
                    '</div>' +
                    '</div>';
            });

            el.innerHTML = html;
        }

        function saveTeamGame() {
            if (!currentTeamGame) return;

            teamGames.unshift(currentTeamGame);

            players.forEach(function(player) {
                if (currentTeamGame.playerStats[player.id]) {
                    const st = currentTeamGame.playerStats[player.id];
                    const totalReb = st.offensiveRebounds + st.defensiveRebounds;
                    const totalPts = (st.twoPointsMade * 2) + (st.threePointsMade * 3) + st.freeThrowsMade;

                    const personalGame = {
                        id: Date.now() + Math.random(),
                        date: currentTeamGame.date,
                        opponent: currentTeamGame.opponent,
                        playTime: 0,
                        playerId: player.id,
                        twoPointsMade: st.twoPointsMade,
                        twoPointsAttempted: st.twoPointsAttempted,
                        threePointsMade: st.threePointsMade,
                        threePointsAttempted: st.threePointsAttempted,
                        freeThrowsMade: st.freeThrowsMade,
                        freeThrowsAttempted: st.freeThrowsAttempted,
                        offensiveRebounds: st.offensiveRebounds,
                        defensiveRebounds: st.defensiveRebounds,
                        assists: st.assists,
                        steals: st.steals,
                        blocks: st.blocks,
                        turnovers: st.turnovers,
                        fouls: st.fouls,
                        totalRebounds: totalReb,
                        twoPointPercentage: st.twoPointsAttempted > 0 ? ((st.twoPointsMade / st.twoPointsAttempted) * 100).toFixed(1) : '0',
                        threePointPercentage: st.threePointsAttempted > 0 ? ((st.threePointsMade / st.threePointsAttempted) * 100).toFixed(1) : '0',
                        freeThrowPercentage: st.freeThrowsAttempted > 0 ? ((st.freeThrowsMade / st.freeThrowsAttempted) * 100).toFixed(1) : '0',
                        totalPoints: totalPts,
                        source: 'team',
                        teamGameId: currentTeamGame.id
                    };

                    personalGames.unshift(personalGame);
                }
            });

            saveData();
            
            if (teamData) {
                syncGamesOnly();
            }

            // é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤(è©¦åˆå®Œäº†ã—ãŸã®ã§ä¸è¦)
            clearDraftTeamGame();
            
            // è­¦å‘Šãƒœãƒƒã‚¯ã‚¹ã‚‚å‰Šé™¤
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            currentTeamGame = null;
            selectedPlayer = null;
            currentPeriod = 1;
            document.getElementById('teamRecording').style.display = 'none';
            document.getElementById('teamGameDate').valueAsDate = new Date();
            document.getElementById('teamOpponent').value = '';
            
            alert('âœ… è©¦åˆè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ!\n\nå…¨é¸æ‰‹ã®ãƒ‡ãƒ¼ã‚¿ãŒå€‹äººãƒ¢ãƒ¼ãƒ‰ã«åæ˜ ã•ã‚Œã¾ã™ã€‚');
        }

        // ========== é€”ä¸­ä¿å­˜æ©Ÿèƒ½ ==========
        function saveDraftTeamGame() {
            if (!currentTeamGame) {
                alert('âŒ è¨˜éŒ²ä¸­ã®è©¦åˆãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // ç¾åœ¨ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’é€”ä¸­ä¿å­˜ç”¨ã«ä¿å­˜
            draftTeamGame = {
                id: currentTeamGame.id,
                date: currentTeamGame.date,
                opponent: currentTeamGame.opponent,
                plays: currentTeamGame.plays.slice(), // ã‚³ãƒ”ãƒ¼ã‚’ä½œæˆ
                playerStats: JSON.parse(JSON.stringify(currentTeamGame.playerStats)), // æ·±ã„ã‚³ãƒ”ãƒ¼
                scores: JSON.parse(JSON.stringify(currentTeamGame.scores)), // ã‚¹ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿ã‚‚ä¿å­˜
                currentPeriod: currentPeriod, // ç¾åœ¨ã®ãƒ”ãƒªã‚ªãƒ‰ã‚‚ä¿å­˜
                savedAt: new Date().toISOString() // ä¿å­˜æ—¥æ™‚
            };
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveData();
            
            alert('âœ… é€”ä¸­ä¿å­˜ã—ã¾ã—ãŸ!\n\nè¨˜éŒ²ã‚’ç¶šã‘ã‚‹ã‹ã€å¾Œã‹ã‚‰ã€Œç¶šãã‹ã‚‰è¨˜éŒ²ã€ã§å†é–‹ã§ãã¾ã™ã€‚');
        }

        // ========== ç¶šãã‹ã‚‰è¨˜éŒ²(å†é–‹)æ©Ÿèƒ½ ==========
        function resumeDraftGame() {
            if (!draftTeamGame) {
                alert('âŒ é€”ä¸­ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const dateStr = new Date(draftTeamGame.date).toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            if (!confirm('ğŸ“‹ æœªå®Œäº†ã®è©¦åˆè¨˜éŒ²ãŒã‚ã‚Šã¾ã™\n\n' +
                        'æ—¥ä»˜: ' + dateStr + '\n' +
                        'å¯¾æˆ¦ç›¸æ‰‹: ' + (draftTeamGame.opponent || 'æœªè¨­å®š') + '\n' +
                        'ä¿å­˜æ—¥æ™‚: ' + new Date(draftTeamGame.savedAt).toLocaleString('ja-JP') + '\n\n' +
                        'ç¶šãã‹ã‚‰è¨˜éŒ²ã—ã¾ã™ã‹?')) {
                return;
            }
            
            // ä¿å­˜ã•ã‚Œã¦ã„ãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
            currentTeamGame = {
                id: draftTeamGame.id,
                date: draftTeamGame.date,
                opponent: draftTeamGame.opponent,
                plays: draftTeamGame.plays.slice(),
                playerStats: JSON.parse(JSON.stringify(draftTeamGame.playerStats)),
                scores: draftTeamGame.scores ? JSON.parse(JSON.stringify(draftTeamGame.scores)) : {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                }
            };
            
            // ãƒ”ãƒªã‚ªãƒ‰ã‚‚å¾©å…ƒ
            currentPeriod = draftTeamGame.currentPeriod || 1;
            selectPeriod(currentPeriod);
            
            // æ—¥ä»˜ã¨å¯¾æˆ¦ç›¸æ‰‹ã‚’ç”»é¢ã«è¡¨ç¤º
            document.getElementById('teamGameDate').value = draftTeamGame.date;
            document.getElementById('teamOpponent').value = draftTeamGame.opponent || '';
            
            // è¨˜éŒ²ç”»é¢ã‚’è¡¨ç¤º
            document.getElementById('teamRecording').style.display = 'block';
            displayPlayerSelector();
            updateTeamStats();
            displayPlayHistory();
            
            alert('âœ… è©¦åˆè¨˜éŒ²ã‚’å†é–‹ã—ã¾ã—ãŸ!\n\nå‰å›ã®ç¶šãã‹ã‚‰è¨˜éŒ²ã§ãã¾ã™ã€‚');
        }

        // ========== é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã®å‰Šé™¤(è©¦åˆå®Œäº†æ™‚)==========
        function clearDraftTeamGame() {
            draftTeamGame = null;
            saveData();
        }

        // ========== èµ·å‹•æ™‚ã«é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ ==========
        function checkAndShowDraftGame() {
            // é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„
            if (!draftTeamGame) {
                return;
            }
            
            // ãƒãƒ¼ãƒ è¨˜éŒ²ã‚¿ãƒ–ã®ä¸€ç•ªä¸Šã«ã€Œç¶šãã‹ã‚‰è¨˜éŒ²ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            const teamRecordTab = document.getElementById('teamRecordTab');
            
            // æ—¢ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãªã‚‰ä½•ã‚‚ã—ãªã„
            if (document.getElementById('draftGameAlert')) {
                return;
            }
            
            // æ—¥ä»˜ã‚’è¦‹ã‚„ã™ãæ•´å½¢
            const dateStr = new Date(draftTeamGame.date).toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // ã‚¢ãƒ©ãƒ¼ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ä½œæˆ
            const alertBox = document.createElement('div');
            alertBox.id = 'draftGameAlert';
            alertBox.className = 'card';
            alertBox.style.background = 'linear-gradient(135deg, #ffd93d 0%, #ffb03a 100%)';
            alertBox.style.color = '#333';
            alertBox.style.marginBottom = '20px';
            alertBox.innerHTML = 
                '<div style="display: flex; align-items: center; margin-bottom: 15px;">' +
                '<span style="font-size: 2em; margin-right: 10px;">âš ï¸</span>' +
                '<h2 style="margin: 0;">æœªå®Œäº†ã®è©¦åˆè¨˜éŒ²ãŒã‚ã‚Šã¾ã™</h2>' +
                '</div>' +
                '<div style="background: rgba(255,255,255,0.9); padding: 15px; border-radius: 10px; margin-bottom: 15px;">' +
                '<div style="margin-bottom: 8px;"><strong>ğŸ“… è©¦åˆæ—¥:</strong> ' + dateStr + '</div>' +
                '<div style="margin-bottom: 8px;"><strong>ğŸ€ å¯¾æˆ¦ç›¸æ‰‹:</strong> ' + (draftTeamGame.opponent || 'æœªè¨­å®š') + '</div>' +
                '<div><strong>ğŸ’¾ ä¿å­˜æ—¥æ™‚:</strong> ' + new Date(draftTeamGame.savedAt).toLocaleString('ja-JP') + '</div>' +
                '</div>' +
                '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">' +
                '<button class="primary-btn" style="background: #2ecc71;" onclick="resumeDraftGame()">â–¶ï¸ ç¶šãã‹ã‚‰è¨˜éŒ²</button>' +
                '<button class="primary-btn" style="background: #e74c3c;" onclick="deleteDraftGame()">ğŸ—‘ï¸ å‰Šé™¤ã—ã¦æ–°è¦ä½œæˆ</button>' +
                '</div>';
            
            // ã‚¿ãƒ–ã®æœ€åˆã«æŒ¿å…¥
            teamRecordTab.insertBefore(alertBox, teamRecordTab.firstChild);
        }

        // ========== é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦æ–°è¦ä½œæˆ ==========
        function deleteDraftGame() {
            if (!confirm('âš ï¸ é€”ä¸­ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™\n\nå‰Šé™¤ã™ã‚‹ã¨å¾©å…ƒã§ãã¾ã›ã‚“ã€‚\næœ¬å½“ã«ã‚ˆã‚ã—ã„ã§ã™ã‹?')) {
                return;
            }
            
            clearDraftTeamGame();
            
            // è­¦å‘Šãƒœãƒƒã‚¯ã‚¹ã‚’å‰Šé™¤
            const alertBox = document.getElementById('draftGameAlert');
            if (alertBox) {
                alertBox.remove();
            }
            
            alert('âœ… é€”ä¸­ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ\n\næ–°ã—ã„è©¦åˆã‚’è¨˜éŒ²ã§ãã¾ã™ã€‚');
        }

        

        function switchTeamTab(tab) {
            // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
            const tabs = document.querySelectorAll('#teamMode .tab');
            tabs.forEach(function(t) {
                t.classList.remove('active');
            });
            
            if (tab === 'record') {
                tabs[0].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'block';
                document.getElementById('teamHistoryTab').style.display = 'none';
                document.getElementById('teamRankingTab').style.display = 'none';
                checkAndShowDraftGame();
            } else if (tab === 'history') {
                tabs[1].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'none';
                document.getElementById('teamHistoryTab').style.display = 'block';
                document.getElementById('teamRankingTab').style.display = 'none';
                displayTeamGamesHistory();
            } else if (tab === 'ranking') {
                tabs[2].classList.add('active');
                document.getElementById('teamRecordTab').style.display = 'none';
                document.getElementById('teamHistoryTab').style.display = 'none';
                document.getElementById('teamRankingTab').style.display = 'block';
                displayTeamRankings();
            }
        }

        function displayTeamGamesHistory() {
            const listEl = document.getElementById('teamGamesList');
            
            if (teamGames.length === 0) {
                listEl.innerHTML = '<div class="empty-state"><div class="icon">ğŸ€</div><h3>ã¾ã è©¦åˆè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>è©¦åˆè¨˜éŒ²ã‚¿ãƒ–ã§è¨˜éŒ²ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†!</p></div>';
                return;
            }
            
            let html = '<div class="card"><h2 style="margin-bottom: 20px;">ğŸ“Š è©¦åˆå±¥æ­´</h2></div>';
            
            // ========== æœ€æ–°ã®è©¦åˆãŒä¸Šã«æ¥ã‚‹ã‚ˆã†ã«ã‚½ãƒ¼ãƒˆ ==========
            const sortedGames = teamGames.slice().sort(function(a, b) {
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                return dateB - dateA; // æ–°ã—ã„é †(é™é †)
            });
            // ====================================================
            
            sortedGames.forEach(function(game, index) {
                // å…ƒã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—(ç·¨é›†ãƒ»å‰Šé™¤ç”¨)
                const originalIndex = teamGames.indexOf(game);
                const dateObj = new Date(game.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                // ã‚¹ã‚³ã‚¢æƒ…å ±ã‚’è¨ˆç®—
                let scoreHtml = '';
                if (game.scores) {
                    const ourTotal = (game.scores.our.q1 || 0) + (game.scores.our.q2 || 0) + (game.scores.our.q3 || 0) + (game.scores.our.q4 || 0);
                    const oppTotal = (game.scores.opp.q1 || 0) + (game.scores.opp.q2 || 0) + (game.scores.opp.q3 || 0) + (game.scores.opp.q4 || 0);
                    const isWin = ourTotal > oppTotal;
                    const outcome = ourTotal === oppTotal ? 'å¼•ãåˆ†ã‘' : (isWin ? 'å‹åˆ©' : 'æ•—åŒ—');
                    
                    scoreHtml = '<div style="font-size: 1.5em; font-weight: bold; margin-top: 5px;">' +
                        ourTotal + ' - ' + oppTotal + ' (' + outcome + ')' +
                        '</div>';
                }
                
                html += '<div class="game-history-item" onclick="toggleGameDetail(' + originalIndex + ')">' +
                    '<div class="game-date">' + dateStr + '</div>' +
                    '<div class="game-opponent">vs ' + (game.opponent || 'å¯¾æˆ¦ç›¸æ‰‹ãªã—') + '</div>' +
                    scoreHtml +
                    '</div>' +
                    '<div class="game-detail" id="gameDetail' + originalIndex + '">' +
                    generateScoreDetail(game) +
                    '<button class="edit-game-btn" onclick="event.stopPropagation(); openEditGameModal(' + originalIndex + ')">ğŸ“ è©¦åˆè¨˜éŒ²ã‚’ç·¨é›†(ç®¡ç†è€…ã®ã¿)</button>' +
                    generateGameRankings(game) +
                    '</div>';
            });
            
            listEl.innerHTML = html;
        }

        function toggleGameDetail(index) {
            const detail = document.getElementById('gameDetail' + index);
            detail.classList.toggle('active');
        }

        function generateScoreDetail(game) {
            if (!game.scores) return '';
            
            const ourTotal = (game.scores.our.q1 || 0) + (game.scores.our.q2 || 0) + (game.scores.our.q3 || 0) + (game.scores.our.q4 || 0);
            const oppTotal = (game.scores.opp.q1 || 0) + (game.scores.opp.q2 || 0) + (game.scores.opp.q3 || 0) + (game.scores.opp.q4 || 0);
            const isWin = ourTotal > oppTotal;
            const outcome = ourTotal === oppTotal ? 'å¼•ãåˆ†ã‘' : (isWin ? 'å‹åˆ©' : 'æ•—åŒ—');
            
            // ãƒãƒ¼ãƒ åã‚’å–å¾—
            const ourTeamName = teamData ? teamData.name : 'è‡ªãƒãƒ¼ãƒ ';
            const oppTeamName = game.opponent || 'å¯¾æˆ¦ç›¸æ‰‹';
            
            let html = '<div class="game-result' + (isWin ? '' : ' loss') + '">';
            html += '<div class="result-label">è©¦åˆçµæœ</div>';
            html += '<div class="result-score">' + ourTotal + ' - ' + oppTotal + '</div>';
            
            // ========== ãƒãƒ¼ãƒ åã‚’è¿½åŠ  ==========
            html += '<div class="team-names">';
            html += '<span class="our-team-name">' + ourTeamName + '</span>';
            html += '<span class="vs-label">VS</span>';
            html += '<span class="opp-team-name">' + oppTeamName + '</span>';
            html += '</div>';
            // ===================================
            
            html += '<div class="result-outcome">' + outcome + '</div>';
            html += '</div>';
            
            html += '<div class="quarter-scores">';
            for (let i = 1; i <= 4; i++) {
                const ourScore = game.scores.our['q' + i] || 0;
                const oppScore = game.scores.opp['q' + i] || 0;
                const diff = ourScore - oppScore;
                const diffClass = diff > 0 ? 'positive' : (diff < 0 ? 'negative' : '');
                const diffText = diff > 0 ? '+' + diff : diff;
                
                html += '<div class="quarter-score-item">';
                html += '<div class="quarter-label">Q' + i + '</div>';
                html += '<div class="quarter-value">' + ourScore + ' - ' + oppScore + '</div>';
                html += '<div class="quarter-diff ' + diffClass + '">(' + diffText + ')</div>';
                html += '</div>';
            }
            html += '</div>';
            
            return html;
        }

        function generateGameRankings(game) {
            let html = '';
            
            // å¾—ç‚¹ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += generateRankingSection(game, 'points', 'ğŸ† å¾—ç‚¹ç‹', function(stats) {
                return (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            }, 'ç‚¹');
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += generateRankingSection(game, 'fieldGoalPct', 'ğŸ¯ ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡', function(stats) {
                const made = stats.twoPointsMade + stats.threePointsMade;
                const attempted = stats.twoPointsAttempted + stats.threePointsAttempted;
                return attempted > 0 ? ((made / attempted) * 100).toFixed(1) : 0;
            }, '%', true);
            
            // ãƒªãƒã‚¦ãƒ³ãƒ‰ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += generateRankingSection(game, 'rebounds', 'ğŸ“¦ ãƒªãƒã‚¦ãƒ³ãƒ‰ç‹', function(stats) {
                return stats.offensiveRebounds + stats.defensiveRebounds;
            }, 'æœ¬');
            
            // ã‚¢ã‚·ã‚¹ãƒˆãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += generateRankingSection(game, 'assists', 'ğŸ¤ ã‚¢ã‚·ã‚¹ãƒˆç‹', function(stats) {
                return stats.assists;
            }, 'å›');
            
            // ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += generateRankingSection(game, 'steals', 'ğŸ›¡ï¸ ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«ç‹', function(stats) {
                return stats.steals;
            }, 'å›');
            
            return html;
        }
        

        function generateRankingSection(game, key, title, calcFunc, unit, isPercentage) {
            // é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’é…åˆ—ã«å¤‰æ›ã—ã¦å€¤ã‚’è¨ˆç®—
            const playerData = [];
            Object.keys(game.playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (player) {
                    const stats = game.playerStats[playerId];
                    const value = calcFunc(stats);
                    
                    // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ã®å ´åˆã€è©¦æŠ•æ•°ãŒ0ã®é¸æ‰‹ã¯é™¤å¤–
                    if (isPercentage) {
                        const attempted = stats.twoPointsAttempted + stats.threePointsAttempted;
                        if (attempted > 0) {
                            playerData.push({
                                player: player,
                                value: parseFloat(value),
                                displayValue: value
                            });
                        }
                    } else {
                        playerData.push({
                            player: player,
                            value: parseFloat(value),
                            displayValue: value
                        });
                    }
                }
            });
            
            // å€¤ã§ã‚½ãƒ¼ãƒˆ(é™é †)
            playerData.sort(function(a, b) { return b.value - a.value; });
            
            if (playerData.length === 0) {
                return '';
            }
            
            let html = '<div class="ranking-section">';
            html += '<h3>' + title + '</h3>';
            
            // TOP3ã‚’è¡¨ç¤º
            html += '<div class="top3-container">';
            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            for (let i = 0; i < Math.min(3, playerData.length); i++) {
                const data = playerData[i];
                html += '<div class="ranking-card">' +
                    '<span class="ranking-medal">' + medals[i] + '</span>' +
                    '<div class="ranking-info">' +
                    '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                    '<span class="stat-value">' + data.displayValue + unit + '</span>' +
                    '</div>' +
                    '</div>';
            }
            html += '</div>';
            
            // å…¨é¸æ‰‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°(æŠ˜ã‚ŠãŸãŸã¿)
            if (playerData.length > 3) {
                html += '<button class="toggle-rankings" onclick="toggleAllRankings(\'' + key + game.id + '\')">' +
                    'â–¼ å…¨' + playerData.length + 'åã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º' +
                    '</button>';
                
                html += '<div class="all-rankings" id="allRankings' + key + game.id + '">';
                playerData.forEach(function(data, index) {
                    html += '<div class="ranking-card">' +
                        '<div class="ranking-info">' +
                        '<span class="rank">' + (index + 1) + 'ä½</span>' +
                        '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                        '<span class="stat-value">' + data.displayValue + unit + '</span>' +
                        '</div>' +
                        '</div>';
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }

        function toggleAllRankings(id) {
            const el = document.getElementById('allRankings' + id);
            const btn = event.target;
            
            if (el.classList.contains('active')) {
                el.classList.remove('active');
                btn.classList.remove('active');
                btn.textContent = btn.textContent.replace('â–² é–‰ã˜ã‚‹', 'â–¼ å…¨' + btn.textContent.match(/\d+/)[0] + 'åã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º');
            } else {
                el.classList.add('active');
                btn.classList.add('active');
                btn.textContent = 'â–² é–‰ã˜ã‚‹';
            }
        }
        

        // ========== ãƒãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºé–¢æ•° ==========
        function displayTeamRankings() {
            const container = document.getElementById('teamRankingsDisplay');
            
            if (teamGames.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ†</div><h3>ã¾ã è©¦åˆè¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>è©¦åˆè¨˜éŒ²ã‚¿ãƒ–ã§è¨˜éŒ²ã‚’é–‹å§‹ã—ã¾ã—ã‚‡ã†ï¼</p></div>';
                return;
            }
            
            let html = '';
            
            // ç›´è¿‘3è©¦åˆã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += '<div class="card">';
            html += '<h2 style="margin-bottom: 20px;">ğŸ“Š ç›´è¿‘3è©¦åˆã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
            html += '<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">æœ€æ–°3è©¦åˆã®åˆè¨ˆå€¤ãƒ»å¹³å‡å€¤ã§ç®—å‡º</p>';
            html += calculateRecentGamesRankings();
            html += '</div>';
            
            // å…¨è©¦åˆã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°
            html += '<div class="card">';
            html += '<h2 style="margin-bottom: 20px;">ğŸ† å…¨è©¦åˆé€šç®—ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>';
            html += '<p style="color: #666; margin-bottom: 20px; font-size: 0.9em;">å…¨' + teamGames.length + 'è©¦åˆã®å¹³å‡å€¤ãƒ»åˆè¨ˆå€¤ã§ç®—å‡º</p>';
            html += calculateAllGamesRankings();
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        function calculateRecentGamesRankings() {
            // æœ€æ–°3è©¦åˆã‚’å–å¾—
            const recentGames = teamGames.slice().sort(function(a, b) {
                return new Date(b.date) - new Date(a.date);
            }).slice(0, 3);
            
            if (recentGames.length === 0) return '';
            
            // å„é¸æ‰‹ã®çµ±è¨ˆã‚’é›†è¨ˆ
            const playerStats = {};
            
            recentGames.forEach(function(game) {
                Object.keys(game.playerStats).forEach(function(playerId) {
                    const stats = game.playerStats[playerId];
                    
                    if (!playerStats[playerId]) {
                        playerStats[playerId] = {
                            gamesPlayed: 0,
                            totalPoints: 0,
                            totalRebounds: 0,
                            totalAssists: 0,
                            totalFGMade: 0,
                            totalFGAttempted: 0
                        };
                    }
                    
                    playerStats[playerId].gamesPlayed++;
                    playerStats[playerId].totalPoints += (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                    playerStats[playerId].totalRebounds += stats.offensiveRebounds + stats.defensiveRebounds;
                    playerStats[playerId].totalAssists += stats.assists;
                    playerStats[playerId].totalFGMade += stats.twoPointsMade + stats.threePointsMade;
                    playerStats[playerId].totalFGAttempted += stats.twoPointsAttempted + stats.threePointsAttempted;
                });
            });
            
            let html = '';
            
            // å¾—ç‚¹ç‹ï¼ˆåˆè¨ˆï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ† å¾—ç‚¹ç‹ï¼ˆåˆè¨ˆï¼‰',
                function(stats) { return stats.totalPoints; },
                'ç‚¹',
                false,
                'recentPoints'
            );
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ï¼ˆå¹³å‡ï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ¯ ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ï¼ˆå¹³å‡ï¼‰',
                function(stats) { 
                    return stats.totalFGAttempted > 0 ? (stats.totalFGMade / stats.totalFGAttempted * 100).toFixed(1) : 0;
                },
                '%',
                true,
                'recentFG'
            );
            
            // ãƒªãƒã‚¦ãƒ³ãƒ‰ç‹ï¼ˆåˆè¨ˆï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ“¦ ãƒªãƒã‚¦ãƒ³ãƒ‰ç‹ï¼ˆåˆè¨ˆï¼‰',
                function(stats) { return stats.totalRebounds; },
                'æœ¬',
                false,
                'recentReb'
            );
            
            // ã‚¢ã‚·ã‚¹ãƒˆç‹ï¼ˆåˆè¨ˆï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ¤ ã‚¢ã‚·ã‚¹ãƒˆç‹ï¼ˆåˆè¨ˆï¼‰',
                function(stats) { return stats.totalAssists; },
                'å›',
                false,
                'recentAst'
            );
            
            return html;
        }
        
        function calculateAllGamesRankings() {
            if (teamGames.length === 0) return '';
            
            // å„é¸æ‰‹ã®çµ±è¨ˆã‚’é›†è¨ˆ
            const playerStats = {};
            
            teamGames.forEach(function(game) {
                Object.keys(game.playerStats).forEach(function(playerId) {
                    const stats = game.playerStats[playerId];
                    
                    if (!playerStats[playerId]) {
                        playerStats[playerId] = {
                            gamesPlayed: 0,
                            totalPoints: 0,
                            totalRebounds: 0,
                            totalAssists: 0,
                            totalFGMade: 0,
                            totalFGAttempted: 0
                        };
                    }
                    
                    playerStats[playerId].gamesPlayed++;
                    playerStats[playerId].totalPoints += (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                    playerStats[playerId].totalRebounds += stats.offensiveRebounds + stats.defensiveRebounds;
                    playerStats[playerId].totalAssists += stats.assists;
                    playerStats[playerId].totalFGMade += stats.twoPointsMade + stats.threePointsMade;
                    playerStats[playerId].totalFGAttempted += stats.twoPointsAttempted + stats.threePointsAttempted;
                });
            });
            
            let html = '';
            
            // å¾—ç‚¹ç‹ï¼ˆå¹³å‡ + åˆè¨ˆï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ† å¾—ç‚¹ç‹',
                function(stats) { 
                    const avg = (stats.totalPoints / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'ç‚¹ï¼ˆåˆè¨ˆ' + stats.totalPoints + 'ç‚¹ï¼‰' };
                },
                '',
                false,
                'allPoints',
                true
            );
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ï¼ˆå¹³å‡ï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ¯ ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡',
                function(stats) { 
                    return stats.totalFGAttempted > 0 ? (stats.totalFGMade / stats.totalFGAttempted * 100).toFixed(1) : 0;
                },
                '%',
                true,
                'allFG'
            );
            
            // ãƒªãƒã‚¦ãƒ³ãƒ‰ç‹ï¼ˆå¹³å‡ + åˆè¨ˆï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ“¦ ãƒªãƒã‚¦ãƒ³ãƒ‰ç‹',
                function(stats) { 
                    const avg = (stats.totalRebounds / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'æœ¬ï¼ˆåˆè¨ˆ' + stats.totalRebounds + 'æœ¬ï¼‰' };
                },
                '',
                false,
                'allReb',
                true
            );
            
            // ã‚¢ã‚·ã‚¹ãƒˆç‹ï¼ˆå¹³å‡ + åˆè¨ˆï¼‰
            html += generateTeamRankingSection(
                playerStats,
                'ğŸ¤ ã‚¢ã‚·ã‚¹ãƒˆç‹',
                function(stats) { 
                    const avg = (stats.totalAssists / stats.gamesPlayed).toFixed(1);
                    return { value: parseFloat(avg), display: avg + 'å›ï¼ˆåˆè¨ˆ' + stats.totalAssists + 'å›ï¼‰' };
                },
                '',
                false,
                'allAst',
                true
            );
            
            return html;
        }
        
        function generateTeamRankingSection(playerStats, title, calcFunc, unit, isPercentage, key, useCustomDisplay) {
            const playerData = [];
            
            Object.keys(playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (!player) return;
                
                const stats = playerStats[playerId];
                const result = calcFunc(stats);
                
                let value, displayValue;
                if (useCustomDisplay && typeof result === 'object') {
                    value = result.value;
                    displayValue = result.display;
                } else {
                    value = parseFloat(result);
                    displayValue = result + unit;
                }
                
                // ã‚·ãƒ¥ãƒ¼ãƒˆæˆåŠŸç‡ã®å ´åˆã€è©¦æŠ•æ•°ãŒ0ã®é¸æ‰‹ã¯é™¤å¤–
                if (isPercentage && stats.totalFGAttempted === 0) {
                    return;
                }
                
                // å€¤ãŒ0ä»¥ä¸Šã®å ´åˆã®ã¿è¿½åŠ 
                if (value > 0 || !isPercentage) {
                    playerData.push({
                        player: player,
                        value: value,
                        displayValue: displayValue
                    });
                }
            });
            
            // å€¤ã§ã‚½ãƒ¼ãƒˆï¼ˆé™é †ï¼‰
            playerData.sort(function(a, b) { return b.value - a.value; });
            
            if (playerData.length === 0) {
                return '';
            }
            
            let html = '<div class="ranking-section">';
            html += '<h3>' + title + '</h3>';
            
            // TOP3ã‚’è¡¨ç¤º
            html += '<div class="top3-container">';
            const medals = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
            for (let i = 0; i < Math.min(3, playerData.length); i++) {
                const data = playerData[i];
                html += '<div class="ranking-card">' +
                    '<span class="ranking-medal">' + medals[i] + '</span>' +
                    '<div class="ranking-info">' +
                    '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                    '<span class="stat-value">' + data.displayValue + '</span>' +
                    '</div>' +
                    '</div>';
            }
            html += '</div>';
            
            // å…¨é¸æ‰‹ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰
            if (playerData.length > 3) {
                html += '<button class="toggle-rankings" onclick="toggleAllRankings(\'' + key + '\')">' +
                    'â–¼ å…¨' + playerData.length + 'åã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º' +
                    '</button>';
                
                html += '<div class="all-rankings" id="allRankings' + key + '">';
                playerData.forEach(function(data, index) {
                    html += '<div class="ranking-card">' +
                        '<div class="ranking-info">' +
                        '<span class="rank">' + (index + 1) + 'ä½</span>' +
                        '<span class="player-name">#' + data.player.number + ' ' + data.player.name + '</span>' +
                        '<span class="stat-value">' + data.displayValue + '</span>' +
                        '</div>' +
                        '</div>';
                });
                html += '</div>';
            }
            
            html += '</div>';
            
            return html;
        }
        
        function showCreateTeamModal() {
            document.getElementById('createTeamModal').classList.add('active');
        }

        let currentEditingGameIndex = null;

        function openEditGameModal(gameIndex) {
            // ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ãªã„å ´åˆ
            if (!teamData) {
                alert('âŒ ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“');
                return;
            }
            
            // ãƒ‡ãƒãƒƒã‚°:ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå–å¾—ã§ãã¦ã„ã‚‹ã‹ç¢ºèª
            console.log('teamData:', teamData);
            console.log('ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:', teamData.adminPassword);
            
            // ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆ
            if (!teamData.adminPassword) {
                alert('âš ï¸ ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œãƒãƒ¼ãƒ æƒ…å ±ã€ã‚·ãƒ¼ãƒˆB4ã‚»ãƒ«ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚\nãã®å¾Œã€ã€Œä»Šã™ãåŒæœŸã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ç¢ºèª
            const password = prompt('ğŸ”’ ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\n\nâ€»ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œãƒãƒ¼ãƒ æƒ…å ±ã€ã‚·ãƒ¼ãƒˆB4ã‚»ãƒ«ã§ç¢ºèªã§ãã¾ã™');
            
            if (!password) {
                return;
            }
            
            // ç©ºç™½ãƒã‚§ãƒƒã‚¯
            if (password.trim() === '') {
                alert('âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œè¨¼
            const correctPassword = teamData.adminPassword || '';
            
            if (password !== correctPassword) {
                alert('âŒ ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œãƒãƒ¼ãƒ æƒ…å ±ã€ã‚·ãƒ¼ãƒˆB4ã‚»ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼æˆåŠŸ
            currentEditingGameIndex = gameIndex;
            const game = teamGames[gameIndex];
            
            // è©¦åˆæƒ…å ±ã‚’å…¥åŠ›æ¬„ã«è¨­å®š
            document.getElementById('editGameDate').value = game.date;
            document.getElementById('editOpponent').value = game.opponent || '';
            
            // ã‚¹ã‚³ã‚¢ã‚’å…¥åŠ›æ¬„ã«è¨­å®š
            if (game.scores) {
                document.getElementById('editOurQ1').value = game.scores.our.q1 || 0;
                document.getElementById('editOppQ1').value = game.scores.opp.q1 || 0;
                document.getElementById('editOurQ2').value = game.scores.our.q2 || 0;
                document.getElementById('editOppQ2').value = game.scores.opp.q2 || 0;
                document.getElementById('editOurQ3').value = game.scores.our.q3 || 0;
                document.getElementById('editOppQ3').value = game.scores.opp.q3 || 0;
                document.getElementById('editOurQ4').value = game.scores.our.q4 || 0;
                document.getElementById('editOppQ4').value = game.scores.opp.q4 || 0;
            }
            
            // é¸æ‰‹çµ±è¨ˆã‚’è¡¨ç¤º
            displayEditPlayerStats(game);
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
            document.getElementById('editGameModal').classList.add('active');
        }

        function displayEditPlayerStats(game) {
            const container = document.getElementById('editPlayersList');
            let html = '';
            
            Object.keys(game.playerStats).forEach(function(playerId) {
                const player = players.find(function(p) { return p.id === playerId; });
                if (!player) return;
                
                const stats = game.playerStats[playerId];
                
                html += '<div class="player-stat-edit">';
                html += '<div class="player-header">#' + player.number + ' ' + player.name + '</div>';
                html += '<div class="stat-edit-grid">';
                
                html += '<div class="stat-edit-item"><label>2PæˆåŠŸ</label><input type="number" min="0" id="edit_' + playerId + '_2pm" value="' + stats.twoPointsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>2Pè©¦æŠ•</label><input type="number" min="0" id="edit_' + playerId + '_2pa" value="' + stats.twoPointsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>3PæˆåŠŸ</label><input type="number" min="0" id="edit_' + playerId + '_3pm" value="' + stats.threePointsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>3Pè©¦æŠ•</label><input type="number" min="0" id="edit_' + playerId + '_3pa" value="' + stats.threePointsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>FTæˆåŠŸ</label><input type="number" min="0" id="edit_' + playerId + '_ftm" value="' + stats.freeThrowsMade + '"></div>';
                html += '<div class="stat-edit-item"><label>FTè©¦æŠ•</label><input type="number" min="0" id="edit_' + playerId + '_fta" value="' + stats.freeThrowsAttempted + '"></div>';
                html += '<div class="stat-edit-item"><label>ã‚ªãƒ•ã‚§ãƒ³ã‚¹RB</label><input type="number" min="0" id="edit_' + playerId + '_oreb" value="' + stats.offensiveRebounds + '"></div>';
                html += '<div class="stat-edit-item"><label>ãƒ‡ã‚£ãƒ•ã‚§ãƒ³ã‚¹RB</label><input type="number" min="0" id="edit_' + playerId + '_dreb" value="' + stats.defensiveRebounds + '"></div>';
                html += '<div class="stat-edit-item"><label>ã‚¢ã‚·ã‚¹ãƒˆ</label><input type="number" min="0" id="edit_' + playerId + '_ast" value="' + stats.assists + '"></div>';
                html += '<div class="stat-edit-item"><label>ã‚¹ãƒ†ã‚£ãƒ¼ãƒ«</label><input type="number" min="0" id="edit_' + playerId + '_stl" value="' + stats.steals + '"></div>';
                html += '<div class="stat-edit-item"><label>ãƒ–ãƒ­ãƒƒã‚¯</label><input type="number" min="0" id="edit_' + playerId + '_blk" value="' + stats.blocks + '"></div>';
                html += '<div class="stat-edit-item"><label>TO</label><input type="number" min="0" id="edit_' + playerId + '_to" value="' + stats.turnovers + '"></div>';
                html += '<div class="stat-edit-item"><label>ãƒ•ã‚¡ã‚¦ãƒ«</label><input type="number" min="0" id="edit_' + playerId + '_foul" value="' + stats.fouls + '"></div>';
                
                html += '</div></div>';
            });
            
            container.innerHTML = html;
        }

        function saveGameEdit() {
            if (currentEditingGameIndex === null) return;
            
            const game = teamGames[currentEditingGameIndex];
            
            // è©¦åˆæƒ…å ±ã‚’æ›´æ–°
            game.date = document.getElementById('editGameDate').value;
            game.opponent = document.getElementById('editOpponent').value;
            
            // ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°
            if (!game.scores) {
                game.scores = {
                    our: { q1: 0, q2: 0, q3: 0, q4: 0 },
                    opp: { q1: 0, q2: 0, q3: 0, q4: 0 }
                };
            }
            
            game.scores.our.q1 = parseInt(document.getElementById('editOurQ1').value) || 0;
            game.scores.opp.q1 = parseInt(document.getElementById('editOppQ1').value) || 0;
            game.scores.our.q2 = parseInt(document.getElementById('editOurQ2').value) || 0;
            game.scores.opp.q2 = parseInt(document.getElementById('editOppQ2').value) || 0;
            game.scores.our.q3 = parseInt(document.getElementById('editOurQ3').value) || 0;
            game.scores.opp.q3 = parseInt(document.getElementById('editOppQ3').value) || 0;
            game.scores.our.q4 = parseInt(document.getElementById('editOurQ4').value) || 0;
            game.scores.opp.q4 = parseInt(document.getElementById('editOppQ4').value) || 0;
            
            // å„é¸æ‰‹ã®çµ±è¨ˆã‚’æ›´æ–°
            Object.keys(game.playerStats).forEach(function(playerId) {
                const stats = game.playerStats[playerId];
                
                stats.twoPointsMade = parseInt(document.getElementById('edit_' + playerId + '_2pm').value) || 0;
                stats.twoPointsAttempted = parseInt(document.getElementById('edit_' + playerId + '_2pa').value) || 0;
                stats.threePointsMade = parseInt(document.getElementById('edit_' + playerId + '_3pm').value) || 0;
                stats.threePointsAttempted = parseInt(document.getElementById('edit_' + playerId + '_3pa').value) || 0;
                stats.freeThrowsMade = parseInt(document.getElementById('edit_' + playerId + '_ftm').value) || 0;
                stats.freeThrowsAttempted = parseInt(document.getElementById('edit_' + playerId + '_fta').value) || 0;
                stats.offensiveRebounds = parseInt(document.getElementById('edit_' + playerId + '_oreb').value) || 0;
                stats.defensiveRebounds = parseInt(document.getElementById('edit_' + playerId + '_dreb').value) || 0;
                stats.assists = parseInt(document.getElementById('edit_' + playerId + '_ast').value) || 0;
                stats.steals = parseInt(document.getElementById('edit_' + playerId + '_stl').value) || 0;
                stats.blocks = parseInt(document.getElementById('edit_' + playerId + '_blk').value) || 0;
                stats.turnovers = parseInt(document.getElementById('edit_' + playerId + '_to').value) || 0;
                stats.fouls = parseInt(document.getElementById('edit_' + playerId + '_foul').value) || 0;
            });
            
            // å€‹äººãƒ‡ãƒ¼ã‚¿ã‚‚æ›´æ–°
            updatePersonalGamesFromTeamGame(game);
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            saveData();
            
            // åŒæœŸ
            if (teamData) {
                syncGamesOnly();
            }
            
            // è¡¨ç¤ºã‚’æ›´æ–°
            displayTeamGamesHistory();
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            closeModal('editGameModal');
            
            alert('âœ… è©¦åˆè¨˜éŒ²ã‚’æ›´æ–°ã—ã¾ã—ãŸ!');
        }

        function updatePersonalGamesFromTeamGame(teamGame) {
    // ã“ã®è©¦åˆã«é–¢é€£ã™ã‚‹å€‹äººãƒ‡ãƒ¼ã‚¿ã‚’å…¨ã¦å‰Šé™¤(è©¦åˆIDã§ç¢ºå®Ÿã«å‰Šé™¤)
    personalGames = personalGames.filter(function(g) {
        return !(g.source === 'team' && g.teamGameId === teamGame.id);
    });
    
    // æ–°ã—ã„å€‹äººãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ
    Object.keys(teamGame.playerStats).forEach(function(playerId) {
        const stats = teamGame.playerStats[playerId];
        const totalReb = stats.offensiveRebounds + stats.defensiveRebounds;
        const totalPts = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
        
        const personalGame = {
            id: Date.now() + Math.random(),
            date: teamGame.date,
            opponent: teamGame.opponent,
            playTime: 0,
            playerId: playerId,
            twoPointsMade: stats.twoPointsMade,
            twoPointsAttempted: stats.twoPointsAttempted,
            threePointsMade: stats.threePointsMade,
            threePointsAttempted: stats.threePointsAttempted,
            freeThrowsMade: stats.freeThrowsMade,
            freeThrowsAttempted: stats.freeThrowsAttempted,
            offensiveRebounds: stats.offensiveRebounds,
            defensiveRebounds: stats.defensiveRebounds,
            assists: stats.assists,
            steals: stats.steals,
            blocks: stats.blocks,
            turnovers: stats.turnovers,
            fouls: stats.fouls,
            totalRebounds: totalReb,
            twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
            threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
            freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
            totalPoints: totalPts,
            source: 'team',
            fromTeam: true,
            teamGameId: teamGame.id  // â† â˜…ã“ã“ãŒé‡è¦!ãƒãƒ¼ãƒ ã‚²ãƒ¼ãƒ IDã‚’ä¿å­˜
        };
        
        personalGames.unshift(personalGame);
    });
    
    // å±¥æ­´ã‚„ã‚°ãƒ©ãƒ•ã‚’æ›´æ–°
    displayGames();
    displayRankings();
    updateCharts();
}
        async function deleteGame() {
    if (currentEditingGameIndex === null) return;
    
    const game = teamGames[currentEditingGameIndex];
    const dateStr = new Date(game.date).toLocaleDateString('ja-JP');
    
    if (!confirm('âš ï¸ æœ¬å½“ã«ã“ã®è©¦åˆã‚’å‰Šé™¤ã—ã¾ã™ã‹?\n\n' + dateStr + ' vs ' + game.opponent + '\n\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“!')) {
        return;
    }
    
    // ãƒ­ãƒ¼ã‚«ãƒ«ã®ãƒãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤
    teamGames.splice(currentEditingGameIndex, 1);
    
    // å€‹äººãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ã‚‚å‰Šé™¤(è©¦åˆIDã§ç¢ºå®Ÿã«å‰Šé™¤)
personalGames = personalGames.filter(function(g) {
    return !(g.source === 'team' && g.teamGameId === game.id);
});
    
    saveData();
    
    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚‚å‰Šé™¤
    if (teamData && teamData.adminPassword) {
        try {
            showSyncIndicator('syncing', 'ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å‰Šé™¤ä¸­...');
            
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: JSON.stringify({
                    action: 'deleteGame',
                    teamCode: teamData.code,
                    gameId: game.id,
                    adminPassword: teamData.adminPassword
                })
            });
            
            const result = await response.json();
            
            if (result.success) {
                showSyncIndicator('success', 'å‰Šé™¤å®Œäº†!');
            } else {
                showSyncIndicator('error', result.error || 'å‰Šé™¤å¤±æ•—');
                alert('âš ï¸ ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ:' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'));
            }
        } catch (error) {
            console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
            showSyncIndicator('error', 'å‰Šé™¤å¤±æ•—');
            alert('âš ï¸ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:' + error.message);
        }
    }
    
    // ç”»é¢ã‚’æ›´æ–°
    displayGames();
    displayRankings();
    updateCharts();
    if (typeof displayTeamGamesHistory === 'function') {
        displayTeamGamesHistory();
    }
    
    closeModal('editGameModal');
    currentEditingGameIndex = null;
}

        
        function showJoinTeamModal() {
            document.getElementById('joinTeamModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openGlossary() {
            document.getElementById('glossaryModal').classList.add('active');
        }
        
        function generateTeamCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 6; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        async function createTeam() {
            const teamName = document.getElementById('newTeamName').value.trim();
            if (!teamName) {
                alert('ãƒãƒ¼ãƒ åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showSyncIndicator('syncing', 'ãƒãƒ¼ãƒ ã‚’ä½œæˆä¸­...');
            
            const teamCode = generateTeamCode();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'createTeam',
                        teamName: teamName,
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teamData = {
                        name: teamName,
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        createdAt: new Date().toISOString()
                    };
                    saveData();
                    closeModal('createTeamModal');
                    displayTeamStatus();
                    showSyncIndicator('success', 'ãƒãƒ¼ãƒ ä½œæˆå®Œäº†!');
                    
                    alert('âœ… ãƒãƒ¼ãƒ ã€Œ' + teamName + 'ã€ã‚’ä½œæˆã—ã¾ã—ãŸ!\n\nãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰: ' + teamCode + '\n\nã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å‹é”ã«å…±æœ‰ã—ã¦ãã ã•ã„ã€‚\n\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ: ' + result.spreadsheetUrl);
                } else {
                    throw new Error(result.error || 'ãƒãƒ¼ãƒ ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message + '\n\nã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
            }
        }

        async function joinTeam() {
            const teamCode = document.getElementById('joinTeamCode').value.trim().toUpperCase();
            if (!teamCode || teamCode.length !== 6) {
                alert('æ­£ã—ã„6æ¡ã®ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            showSyncIndicator('syncing', 'ãƒãƒ¼ãƒ ã«å‚åŠ ä¸­...');
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'text/plain',
                    },
                    body: JSON.stringify({
                        action: 'joinTeam',
                        teamCode: teamCode
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    teamData = {
                        name: result.teamData ? result.teamData.name : 'ãƒãƒ¼ãƒ ',
                        code: teamCode,
                        spreadsheetId: result.spreadsheetId,
                        joinedAt: new Date().toISOString()
                    };
                    
                    saveData();
                    closeModal('joinTeamModal');
                    
                    // ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    await loadTeamData();
                    
                    // è¡¨ç¤ºã‚’æ›´æ–°
                    displayTeamStatus();
                    displayPlayers();
                    updateMyPlayerSelect();
                    
                    showSyncIndicator('success', 'ãƒãƒ¼ãƒ å‚åŠ å®Œäº†!');
                    alert('âœ… ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¾ã—ãŸ!\n\nãƒãƒ¼ãƒ å: ' + teamData.name + '\nãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰: ' + teamCode + '\n\né¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸã€‚\nè¨­å®šã‚¿ãƒ–ã®ã€Œå€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºè¨­å®šã€ã§é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                } else {
                    throw new Error(result.error || 'ãƒãƒ¼ãƒ å‚åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                showSyncIndicator('error', 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
                alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        async function syncWithServer(options = { pushPlayers: false, pushGames: true }) {
    if (!teamData) return;

    showSyncIndicator('syncing', 'åŒæœŸä¸­...');

    try {
        const payload = {
            action: 'syncData',
            teamCode: teamData.code
        };

        // æ–°è¦è¿½åŠ ã—ãŸé¸æ‰‹ã ã‘é€ã‚‹(å¾Œè¿°ã® addPlayer ã§ _localNew ã‚’ä»˜ã‘ã‚‹)
        if (options.pushPlayers) {
            const newPlayers = players.filter(p => p && p._localNew === true);
            if (newPlayers.length > 0) payload.players = newPlayers;
        }

        if (options.pushGames) {
            payload.games = teamGames;
        }

        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'text/plain' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        if (!result.success) throw new Error(result.error || 'syncData failed');

        // é€ä¿¡ã«æˆåŠŸã—ãŸ"æ–°è¦é¸æ‰‹"ã¯ãƒ•ãƒ©ã‚°ã‚’å¤–ã—ã¦ãŠã
        if (options.pushPlayers) {
            players.forEach(p => { if (p._localNew) p._localNew = false; });
        }

        showSyncIndicator('success', 'é€ä¿¡å®Œäº†');
    } catch (e) {
        console.error(e);
        showSyncIndicator('error', 'åŒæœŸå¤±æ•—:' + e.message);
    }
}

// â–¼â–¼â–¼ è¿½åŠ :è©¦åˆã ã‘ã‚’é€ã‚‹åŒæœŸ(é¸æ‰‹ã¯é€ã‚‰ãªã„) â–¼â–¼â–¼
async function syncGamesOnly() {
  if (!teamData) return;

  showSyncIndicator('syncing', 'åŒæœŸä¸­...');

  try {
    const payload = {
      action: 'syncData',
      teamCode: teamData.code,
      // â† é¸æ‰‹ã¯é€ã‚‰ãªã„
      games: teamGames       // â† è©¦åˆã ã‘é€ã‚‹
    };

    const response = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'text/plain' },
      body: JSON.stringify(payload)
    });

    const result = await response.json();
    if (!result.success) throw new Error(result.error || 'syncData failed');

    showSyncIndicator('success', 'é€ä¿¡å®Œäº†');
  } catch (e) {
    console.error(e);
    showSyncIndicator('error', 'åŒæœŸå¤±æ•—:' + e.message);
  }
}
// â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–²
        
        
        // â–¼â–¼â–¼ ã“ã“ã‹ã‚‰è¿½åŠ :é€å—ä¿¡ã¾ã¨ã‚ã¦è¡Œã† â–¼â–¼â–¼
async function syncAll() {
  if (!teamData) { alert('ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“'); return; }
  showSyncIndicator('syncing', 'åŒæœŸä¸­â€¦');

  try {
    // 1) ã¾ãšã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—(å—ä¿¡å„ªå…ˆ)
    await loadTeamData();

    // 2) ç”»é¢ã‚’æœ€æ–°åŒ–
    displayPlayers();
    updateMyPlayerSelect();
    displayGames();
    displayRankings();
    updateCharts();

    showSyncIndicator('success', 'åŒæœŸå®Œäº†!');
  } catch (e) {
    console.error(e);
    showSyncIndicator('error', 'åŒæœŸå¤±æ•—:' + e.message);
  }
}
// â–²â–²â–² è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–²


        async function loadTeamData() {
    if (!teamData) return;
    
    showSyncIndicator('syncing', 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...');
    
    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain',
            },
            body: JSON.stringify({
                action: 'getData',
                teamCode: teamData.code
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            let addedCount = 0;
            
            // ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’teamDataã«ä¿å­˜
if (result.teamData && result.teamData.adminPassword) {
    teamData.adminPassword = result.teamData.adminPassword;
    saveData();  // ã™ãã«ä¿å­˜
}
            
            // é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—(ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã§å®Œå…¨ã«ä¸Šæ›¸ã)
if (result.players) {
    // ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿¡é ¼ã—ã¦å®Œå…¨ã«ç½®ãæ›ãˆã‚‹
    players = result.players.map(function(serverPlayer) {
        serverPlayer._localNew = false;
        return serverPlayer;
    });
    addedCount = players.length;
}
            
            // è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦personalGamesã«å¤‰æ›
            if (result.games) {
                // ã‚µãƒ¼ãƒãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã§å®Œå…¨ã«ä¸Šæ›¸ãã™ã‚‹
                teamGames = [];
                personalGames = personalGames.filter(function(g) {
                    return g.source !== 'team';
                });
                
                result.games.forEach(function(game) {
                    teamGames.push(game);
                    
                    // å„é¸æ‰‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’personalGamesã«è¿½åŠ 
                    Object.keys(game.playerStats).forEach(function(playerId) {
                        const stats = game.playerStats[playerId];
                        const totalReb = stats.offensiveRebounds + stats.defensiveRebounds;
                        const totalPts = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
                        
                        const personalGame = {
                            id: Date.now() + Math.random(),
                            date: game.date,
                            opponent: game.opponent,
                            playTime: 0,
                            playerId: playerId,
                            twoPointsMade: stats.twoPointsMade,
                            twoPointsAttempted: stats.twoPointsAttempted,
                            threePointsMade: stats.threePointsMade,
                            threePointsAttempted: stats.threePointsAttempted,
                            freeThrowsMade: stats.freeThrowsMade,
                            freeThrowsAttempted: stats.freeThrowsAttempted,
                            offensiveRebounds: stats.offensiveRebounds,
                            defensiveRebounds: stats.defensiveRebounds,
                            assists: stats.assists,
                            steals: stats.steals,
                            blocks: stats.blocks,
                            turnovers: stats.turnovers,
                            fouls: stats.fouls,
                            totalRebounds: totalReb,
                            twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                            threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                            freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                            totalPoints: totalPts,
                            source: 'team',
                            teamGameId: game.id  // â† ã“ã®è¡Œã‚’è¿½åŠ 
                        };
                        
                        personalGames.unshift(personalGame);
                    });
                });
            }
            
            saveData();
            
            const gameCount = result.games ? result.games.length : 0;
            showSyncIndicator('success', addedCount + 'äººã®é¸æ‰‹ã€' + gameCount + 'è©¦åˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—');
            
            return addedCount;
        } else {
            showSyncIndicator('error', 'ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
        }
    } catch (error) {
        console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        showSyncIndicator('error', 'ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—');
    }
}
        function displayTeamStatus() {
            const statusEl = document.getElementById('teamStatus');

            if (!statusEl) {
                console.error('teamStatusè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }
            
            if (!teamData) {
                statusEl.innerHTML = '<p style="color: #999; text-align: center;">ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“</p>';
                return;
            }

            const teamName = teamData.name || 'ãƒãƒ¼ãƒ åæœªè¨­å®š';
            const teamCode = teamData.code || 'ä¸æ˜';
            
            statusEl.innerHTML = 
                '<div class="team-code-display">' +
                '<div style="font-size: 0.9em; color: #666;">ç¾åœ¨ã®ãƒãƒ¼ãƒ </div>' +
                '<div style="font-size: 1.3em; font-weight: bold; color: #667eea; margin: 10px 0;">' + teamData.name + '</div>' +
                '<div style="font-size: 0.9em; color: #666;">ãƒãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰</div>' +
                '<div class="code">' + teamData.code + '</div>' +
                '<button class="primary-btn" style="background: #2ecc71; margin-top: 15px;" onclick="syncAll()">ä»Šã™ãåŒæœŸ(é€å—ä¿¡)</button>' +
                '<button class="primary-btn" style="background: #e74c3c; margin-top: 10px;" onclick="leaveTeam()">ãƒãƒ¼ãƒ ã‹ã‚‰é€€å‡º</button>' +
                '</div>';
        }

        function leaveTeam() {
            if (confirm('æœ¬å½“ã«ãƒãƒ¼ãƒ ã‹ã‚‰é€€å‡ºã—ã¾ã™ã‹?')) {
                teamData = null;
                saveData();
                displayTeamStatus();
                alert('âœ… ãƒãƒ¼ãƒ ã‹ã‚‰é€€å‡ºã—ã¾ã—ãŸ');
            }
        }

        document.getElementById('gameDate').valueAsDate = new Date();
        document.getElementById('teamGameDate').valueAsDate = new Date();

        function switchMode(mode) {
           currentMode = mode;
            
            // ã™ã¹ã¦ã®ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.mode-btn').forEach(function(btn) {
               btn.classList.remove('active');
               btn.classList.remove('team-mode');
           });
            
            // èƒŒæ™¯è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
           document.body.classList.remove('personal-mode', 'team-mode');
           
            // ã™ã¹ã¦ã®ãƒ¢ãƒ¼ãƒ‰ã‚’éè¡¨ç¤º
            document.getElementById('personalMode').style.display = 'none';
            document.getElementById('teamMode').style.display = 'none';
            document.getElementById('settingsMode').style.display = 'none';
            
            // é¸æŠã•ã‚ŒãŸãƒ¢ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
           if (mode === 'personal') {
                document.querySelector('.mode-btn:nth-child(1)').classList.add('active');
                document.getElementById('personalMode').style.display = 'block';
                document.body.classList.add('personal-mode');
                displayGames();
            } else if (mode === 'team') {
                const teamBtn = document.querySelector('.mode-btn:nth-child(2)');
                teamBtn.classList.add('active');
                teamBtn.classList.add('team-mode');
                document.getElementById('teamMode').style.display = 'block';
                document.body.classList.add('team-mode');
            } else if (mode === 'settings') {
                document.querySelector('.mode-btn:nth-child(3)').classList.add('active');
                document.getElementById('settingsMode').style.display = 'block';
           }
        }
        
        function switchTab(tab) {
            document.querySelectorAll('#personalMode .tab').forEach(function(t) {
                t.classList.remove('active');
            });
            document.querySelectorAll('#personalMode .tab-content').forEach(function(c) {
                c.classList.remove('active');
            });
            
            const tabs = ['input', 'list', 'ranking', 'graph', 'settings'];
            const index = tabs.indexOf(tab);
            document.querySelector('#personalMode .tab:nth-child(' + (index + 1) + ')').classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'graph') updateCharts();
            if (tab === 'settings') { 
                displayPlayers(); 
                updateMyPlayerSelect();
                displayTeamStatus();
            }
            if (tab === 'ranking') displayRankings();
            if (tab === 'list') displayGames();
        }

        function changeValue(key, delta) {
            stats[key] = Math.max(0, stats[key] + delta);
            
            if (key === 'twoPointsMade' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsAttempted = stats.twoPointsMade;
            }
            if (key === 'twoPointsAttempted' && stats.twoPointsMade > stats.twoPointsAttempted) {
                stats.twoPointsMade = stats.twoPointsAttempted;
            }
            if (key === 'threePointsMade' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsAttempted = stats.threePointsMade;
            }
            if (key === 'threePointsAttempted' && stats.threePointsMade > stats.threePointsAttempted) {
                stats.threePointsMade = stats.threePointsAttempted;
            }
            if (key === 'freeThrowsMade' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsAttempted = stats.freeThrowsMade;
            }
            if (key === 'freeThrowsAttempted' && stats.freeThrowsMade > stats.freeThrowsAttempted) {
                stats.freeThrowsMade = stats.freeThrowsAttempted;
            }
            
            updateDisplay();
        }

        function updateDisplay() {
            Object.keys(stats).forEach(function(key) {
                const el = document.getElementById(key);
                if (el) el.textContent = stats[key];
            });
            
            const twoP = stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0';
            const threeP = stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0';
            const ft = stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0';
            const totalPoints = (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade;
            
            document.getElementById('twoPointPercentage').textContent = twoP + '%';
            document.getElementById('threePointPercentage').textContent = threeP + '%';
            document.getElementById('freeThrowPercentage').textContent = ft + '%';
            document.getElementById('totalPoints').textContent = totalPoints;
            
            // åˆ†æ•°ã‚’è¡¨ç¤º
            document.getElementById('twoPointFraction').textContent = '(' + stats.twoPointsMade + '/' + stats.twoPointsAttempted + ')';
            document.getElementById('threePointFraction').textContent = '(' + stats.threePointsMade + '/' + stats.threePointsAttempted + ')';
            document.getElementById('freeThrowFraction').textContent = '(' + stats.freeThrowsMade + '/' + stats.freeThrowsAttempted + ')';
        }
        function savePersonalGame() {
            const date = document.getElementById('gameDate').value;
            if (!date) {
                alert('è©¦åˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }

            const saveBtn = document.getElementById('saveGameBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';

            const game = {
                id: Date.now(),
                date: date,
                opponent: document.getElementById('opponent').value.trim(),
                playTime: parseInt(document.getElementById('playTime').value) || 0,
                playerId: myPlayerId,
                twoPointsMade: stats.twoPointsMade,
                twoPointsAttempted: stats.twoPointsAttempted,
                threePointsMade: stats.threePointsMade,
                threePointsAttempted: stats.threePointsAttempted,
                freeThrowsMade: stats.freeThrowsMade,
                freeThrowsAttempted: stats.freeThrowsAttempted,
                offensiveRebounds: stats.offensiveRebounds,
                defensiveRebounds: stats.defensiveRebounds,
                assists: stats.assists,
                steals: stats.steals,
                blocks: stats.blocks,
                turnovers: stats.turnovers,
                fouls: stats.fouls,
                totalRebounds: stats.offensiveRebounds + stats.defensiveRebounds,
                twoPointPercentage: stats.twoPointsAttempted > 0 ? ((stats.twoPointsMade / stats.twoPointsAttempted) * 100).toFixed(1) : '0',
                threePointPercentage: stats.threePointsAttempted > 0 ? ((stats.threePointsMade / stats.threePointsAttempted) * 100).toFixed(1) : '0',
                freeThrowPercentage: stats.freeThrowsAttempted > 0 ? ((stats.freeThrowsMade / stats.freeThrowsAttempted) * 100).toFixed(1) : '0',
                totalPoints: (stats.twoPointsMade * 2) + (stats.threePointsMade * 3) + stats.freeThrowsMade,
                source: 'personal'
            };

            personalGames.unshift(game);
            saveData();
            
            if (teamData) {
                syncGamesOnly();
            }
            
            displayGames();
            resetForm();
            
            saveBtn.disabled = false;
            saveBtn.textContent = 'è¨˜éŒ²ã‚’ä¿å­˜';
            
            alert('âœ… è©¦åˆè¨˜éŒ²ã‚’ä¿å­˜ã—ã¾ã—ãŸ!');
        }

        function resetForm() {
            Object.keys(stats).forEach(function(key) {
                stats[key] = 0;
            });
            document.getElementById('gameDate').valueAsDate = new Date();
            document.getElementById('opponent').value = '';
            document.getElementById('playTime').value = 0;
            updateDisplay();
        }

        function displayGames() {
    updatePlayerBanners();
    const gameList = document.getElementById('gameList');
    
    // myPlayerIdãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯å…¨ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º
    const myGames = myPlayerId 
        ? personalGames.filter(function(g) {
            return !g.playerId || g.playerId === myPlayerId;
          })
        : personalGames;
    
    if (myGames.length === 0) {
        gameList.innerHTML = '<div class="empty-state"><div class="icon">ğŸ€</div><h3>ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3><p>æœ€åˆã®è©¦åˆã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã†!</p></div>';
        return;
    }

            gameList.innerHTML = myGames.map(function(g) {
                const dateObj = new Date(g.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                const sourceLabel = g.source === 'team' ? ' <span style="background: #2ecc71; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em;">è©¦åˆè¨˜éŒ²</span>' : '';
                
                return '<div class="game-item">' +
                    '<div class="game-date">' + dateStr + 
                    (g.opponent ? ' vs ' + g.opponent : '') + 
                    (g.playTime ? ' (' + g.playTime + 'åˆ†)' : '') + 
                    sourceLabel +
                    '</div>' +
                    '<div class="game-stats">' +
                    '<div class="stat-box"><div class="label">ç·å¾—ç‚¹</div><div class="value">' + g.totalPoints + 'ç‚¹</div></div>' +
                    '<div class="stat-box"><div class="label">2Pç‡</div><div class="value">' + g.twoPointPercentage + '%</div><div class="fraction">(' + g.twoPointsMade + '/' + g.twoPointsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">3Pç‡</div><div class="value">' + g.threePointPercentage + '%</div><div class="fraction">(' + g.threePointsMade + '/' + g.threePointsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">FTç‡</div><div class="value">' + g.freeThrowPercentage + '%</div><div class="fraction">(' + g.freeThrowsMade + '/' + g.freeThrowsAttempted + ')</div></div>' +
                    '<div class="stat-box"><div class="label">ãƒªãƒã‚¦ãƒ³ãƒ‰</div><div class="value">' + g.totalRebounds + '</div></div>' +
                    '<div class="stat-box"><div class="label">ã‚¢ã‚·ã‚¹ãƒˆ</div><div class="value">' + g.assists + '</div></div>' +
                    '</div>' +
                    '<button class="shot-chart-button" onclick="showShotChart(' + g.id + ')">ğŸ¯ ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚’è¦‹ã‚‹</button>'
                    '</div>';
            }).join('');
        }

        // ========== ã“ã“ã‹ã‚‰è¿½åŠ  ==========
        
        // ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showShotChart(gameId) {
    // ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ï¼ˆæœ¬ç•ªç’°å¢ƒã§ã¯å‰Šé™¤å¯èƒ½ï¼‰
    console.log('showShotChart called:', {
        gameId: gameId,
        type: typeof gameId,
        fromTeam: personalGames.find(g => g.id === gameId)?.fromTeam
    });
    
    // æ–‡å­—åˆ—ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚‹ã®ã§æ•°å€¤ã«å¤‰æ›
    const numericId = typeof gameId === 'string' ? parseFloat(gameId) : gameId;
    const game = personalGames.find(g => g.id === numericId);
    
    if (!game) {
        alert('è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        console.error('è©¦åˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', {
            searchId: numericId,
            availableIds: personalGames.map(g => g.id)
        });
        return;
    }
    
    // fromTeamãƒã‚§ãƒƒã‚¯
    if (!game.fromTeam) {
        console.warn('fromTeamãŒfalseã¾ãŸã¯undefined:', game);
    }
    
    // ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã§è¨˜éŒ²ã•ã‚ŒãŸè©¦åˆã®å ´åˆ
    if (game.fromTeam && teamGames) {
        const teamGame = teamGames.find(tg => tg.id === game.teamGameId);
        
        if (teamGame && teamGame.plays) {
            // è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¤ã ã‘ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            const myPlays = teamGame.plays.filter(p => p.playerId === game.playerId);
            
            if (myPlays.length === 0) {
                alert('ã“ã®è©¦åˆã«ã¯ãƒ—ãƒ¬ã‚¤è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“');
                console.warn('ãƒ—ãƒ¬ã‚¤ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', {
                    teamGameId: game.teamGameId,
                    playerId: game.playerId,
                    totalPlays: teamGame.plays.length
                });
                return;
            }
            
            showShotChartModal(myPlays, game.opponent, game.date);
        } else {
            alert('ã“ã®è©¦åˆã«ã¯ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“');
        }
    } else {
        alert('ã“ã®è©¦åˆã¯ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã§è¨˜éŒ²ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤ºã§ãã¾ã›ã‚“');
        console.warn('ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã§ã¯ãªã„:', {
            fromTeam: game.fromTeam,
            teamGamesExists: !!teamGames
        });
    }
}
        
       
        // ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        function showShotChartModal(plays, opponent, date) {
            // ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª
            if (!plays || plays.length === 0) {
                alert('ã“ã®è©¦åˆã«ã¯ãƒ—ãƒ¬ã‚¤ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆç³»ã®ãƒ—ãƒ¬ã‚¤ã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆplayTypeã‚’ä½¿ç”¨ï¼‰
            const shotPlays = plays.filter(p => 
                (p.playType === '2p-made' || p.playType === '2p-miss' || 
                 p.playType === '3p-made' || p.playType === '3p-miss') &&
                p.position && p.position.x !== undefined && p.position.y !== undefined
            );
            
            if (shotPlays.length === 0) {
                alert('ã“ã®è©¦åˆã«ã¯ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ã®è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“\n\nãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®ã€Œè¨˜éŒ²ã€ã‚¿ãƒ–ã§ã‚·ãƒ¥ãƒ¼ãƒˆã‚’è¨˜éŒ²ã™ã‚‹éš›ã«ã€ã‚³ãƒ¼ãƒˆä¸Šã®ä½ç½®ã‚’ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨è¨˜éŒ²ã•ã‚Œã¾ã™ã€‚');
                return;
            }
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’ä½œæˆã—ã¦è¡¨ç¤º
            const modal = document.createElement('div');
            modal.className = 'shot-chart-modal active';
            modal.innerHTML = `
                <div class="shot-chart-content">
                    <h2 style="text-align: center; color: #667eea;">ğŸ¯ ã‚·ãƒ¥ãƒ¼ãƒˆãƒãƒ£ãƒ¼ãƒˆ</h2>
                    <p style="text-align: center; color: #666;">
                        ${opponent} vs ${new Date(date).toLocaleDateString('ja-JP')}
                    </p>
                    
                    <div class="court-container" style="cursor: default;">
                        <canvas id="displayShotCanvas" class="court-canvas" width="300" height="400"></canvas>
                    </div>
                    
                    <div class="zone-stats" id="zoneStatsContainer">
                        <h3 style="color: #667eea; margin-bottom: 10px;">ğŸ“Š ã‚¨ãƒªã‚¢åˆ¥æˆåŠŸç‡</h3>
                        <div id="zoneStatsContent"></div>
                    </div>
                    
                    <button class="shot-chart-button" onclick="this.parentElement.parentElement.remove()">
                        é–‰ã˜ã‚‹
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // ã‚³ãƒ¼ãƒˆå›³ã‚’æç”»
            const canvas = document.getElementById('displayShotCanvas');
            drawCourt(canvas);
            
            // ã‚·ãƒ¥ãƒ¼ãƒˆã‚’ãƒ—ãƒ­ãƒƒãƒˆ
            const ctx = canvas.getContext('2d');
            shotPlays.forEach(play => {
                if (play.position) {
                    const isMade = play.playType.includes('made');
                    
                    ctx.fillStyle = isMade ? '#2ecc71' : '#e74c3c';
                    ctx.beginPath();
                    ctx.arc(play.position.x, play.position.y, 6, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
            
            // ã‚¨ãƒªã‚¢åˆ¥çµ±è¨ˆã‚’è¡¨ç¤º
            setTimeout(() => {
                const statsElement = document.getElementById('zoneStatsContent');
                if (statsElement) {
                    displayZoneStats(shotPlays);
                }
            }, 100);
        }
        
        // ã‚¨ãƒªã‚¢åˆ¥çµ±è¨ˆã‚’è¨ˆç®—ã—ã¦è¡¨ç¤º
        function displayZoneStats(shotPlays) {
            const zoneData = {};
            
            shotPlays.forEach(play => {
                if (play.position) {
                    const zone = play.position.zone || getZoneFromPosition(
                        play.position.x, 
                        play.position.y, 
                        300, 
                        400
                    );
                    
                    if (!zoneData[zone]) {
                        zoneData[zone] = { made: 0, total: 0 };
                    }
                    
                    zoneData[zone].total++;
                    if (play.playType.includes('made')) {
                        zoneData[zone].made++;
                    }
                }
            });
            
            // ã‚¨ãƒªã‚¢åˆ¥çµ±è¨ˆã‚’HTMLåŒ–
            let html = '';
            const zones = ['paint', 'left_wing', 'right_wing', 'mid_range', 'top', 'backcourt'];
            
            zones.forEach(zone => {
                if (zoneData[zone]) {
                    const data = zoneData[zone];
                    const percentage = ((data.made / data.total) * 100).toFixed(1);
                    
                    html += `
                        <div class="zone-item">
                            <span class="zone-name">${getZoneNameJP(zone)}</span>
                            <span class="zone-percentage">
                                ${percentage}% (${data.made}/${data.total})
                            </span>
                        </div>
                    `;
                }
            });
            
            document.getElementById('zoneStatsContent').innerHTML = html || '<p style="text-align: center; color: #999;">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        }
        
        // ========== ã“ã“ã¾ã§è¿½åŠ  ==========

        function displayRankings() {
            const myGames = myPlayerId 
    ? personalGames.filter(function(g) {
        return !g.playerId || g.playerId === myPlayerId;
      })
    : personalGames;
            
            if (myGames.length === 0) {
                document.getElementById('topPoints').innerHTML = '<p style="text-align: center; color: #999;">è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            const topPoints = myGames.slice().sort(function(a, b) {
                return b.totalPoints - a.totalPoints;
            }).slice(0, 10);

            if (topPoints.length > 0) {
                const top = topPoints[0];
                const dateObj = new Date(top.date);
                const dateStr = dateObj.toLocaleDateString('ja-JP', {year: 'numeric', month: 'long', day: 'numeric'});
                
                let html = '<div class="top-record">' +
                    '<div class="trophy">ğŸ†</div>' +
                    '<div style="font-size: 1.2em; margin-bottom: 10px;">æœ€é«˜å¾—ç‚¹</div>' +
                    '<div class="value">' + top.totalPoints + 'ç‚¹</div>' +
                    '<div style="font-size: 1.1em; opacity: 0.95;">' + dateStr;
                
                if (top.opponent) {
                    html += '<br>vs ' + top.opponent;
                }
                
                html += '</div></div>';
                
                document.getElementById('topPoints').innerHTML = html;
            }
        }

        function updateCharts() {
            const myGames = myPlayerId 
    ? personalGames.filter(function(g) {
        return !g.playerId || g.playerId === myPlayerId;
      })
    : personalGames;
            
            if (myGames.length === 0) return;

            const sorted = myGames.slice().reverse();
            const labels = sorted.map(function(g) {
                const d = new Date(g.date).toLocaleDateString('ja-JP', {month: 'short', day: 'numeric'});
                return g.opponent ? d + ' vs ' + g.opponent : d;
            });

            if (charts.shooting) charts.shooting.destroy();
            charts.shooting = new Chart(document.getElementById('shootingChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '2PæˆåŠŸç‡',
                        data: sorted.map(function(g) { return parseFloat(g.twoPointPercentage); }),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }, {
                        label: '3PæˆåŠŸç‡',
                        data: sorted.map(function(g) { return parseFloat(g.threePointPercentage); }),
                        borderColor: '#f093fb',
                        backgroundColor: 'rgba(240, 147, 251, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'FTæˆåŠŸç‡',
                        data: sorted.map(function(g) { return parseFloat(g.freeThrowPercentage); }),
                        borderColor: '#4facfe',
                        backgroundColor: 'rgba(79, 172, 254, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom' } },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { callback: function(v) { return v + '%'; } }
                        }
                    }
                }
            });
        }

        function addPlayer() {
            const num = document.getElementById('playerNumber').value;
            const name = document.getElementById('playerName').value.trim();

            if (!num || !name) { 
                alert('èƒŒç•ªå·ã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); 
                return; 
            }
            
            const exists = players.some(function(p) {
                return p.number === num;
            });
            
            if (exists) { 
                alert('ã“ã®èƒŒç•ªå·ã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™'); 
                return; 
            }

            const player = { 
                id: Date.now().toString(), 
                number: num, 
                name: name 
            };
            players.push(player);
            
            if (!myPlayerId) myPlayerId = player.id;
            
            saveData();

if (teamData) {
    // æ–°è¦è¿½åŠ ãƒ•ãƒ©ã‚°ã‚’ã¤ã‘ã‚‹
    // (ã“ã®è¡Œã¯ã€ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆç›´å¾Œã§ã‚‚OK)
    player._localNew = true;

    // é¸æ‰‹ã ã‘é€ä¿¡(è©¦åˆã¯é€ã‚‰ãªã„)
    syncWithServer({ pushPlayers: true, pushGames: false });
}
            
            displayPlayers();
            updateMyPlayerSelect();

            document.getElementById('playerNumber').value = '';
            document.getElementById('playerName').value = '';
            
            alert('âœ… ' + name + ' #' + num + ' ã‚’ç™»éŒ²ã—ã¾ã—ãŸ!');
        }

        function editPlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            const newNumber = prompt('æ–°ã—ã„èƒŒç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„(ç¾åœ¨: #' + player.number + ')', player.number);
            if (newNumber === null) return;
            
            if (!newNumber || newNumber.trim() === '') {
                alert('èƒŒç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const duplicate = players.some(function(p) {
                return p.id !== playerId && p.number === newNumber.trim();
            });
            
            if (duplicate) {
                alert('ã“ã®èƒŒç•ªå·ã¯æ—¢ã«ä»–ã®é¸æ‰‹ãŒä½¿ç”¨ã—ã¦ã„ã¾ã™');
                return;
            }
            
            const newName = prompt('æ–°ã—ã„åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„(ç¾åœ¨: ' + player.name + ')', player.name);
            if (newName === null) return;
            
            if (!newName || newName.trim() === '') {
                alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            player.number = newNumber.trim();
            player.name = newName.trim();
            
            saveData();

// ã‚µãƒ¼ãƒã¸ã¯é€ã‚‰ãªã„(ç·¨é›†/å‰Šé™¤ã¯æ‰‹å‹•ã§ã‚·ãƒ¼ãƒˆã‚’ç›´ã™é‹ç”¨)
/* if (teamData) {
    syncWithServer();
} */
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('âœ… é¸æ‰‹æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã—ãŸ!\n\n#' + player.number + ' ' + player.name);
        }

        function deletePlayer(playerId) {
            const player = players.find(function(p) {
                return p.id === playerId;
            });
            
            if (!player) return;
            
            if (!confirm('ã€Œ#' + player.number + ' ' + player.name + 'ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹?\n\nâš ï¸ ã“ã®é¸æ‰‹ã®è©¦åˆè¨˜éŒ²ã‚‚å…¨ã¦å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
                return;
            }
            
            players = players.filter(function(p) {
                return p.id !== playerId;
            });
            
            personalGames = personalGames.filter(function(g) {
                return g.playerId !== playerId;
            });
            
            teamGames.forEach(function(game) {
                if (game.playerStats && game.playerStats[playerId]) {
                    delete game.playerStats[playerId];
                }
                if (game.plays) {
                    game.plays = game.plays.filter(function(play) {
                        return play.playerId !== playerId;
                    });
                }
            });
            
            if (myPlayerId === playerId) {
                myPlayerId = players.length > 0 ? players[0].id : null;
            }
            
            saveData();
            
            if (teamData) {
                syncWithServer();
            }
            
            displayPlayers();
            updateMyPlayerSelect();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('âœ… é¸æ‰‹ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
        
        function changeMyPlayer() {
            myPlayerId = document.getElementById('myPlayerSelect').value || null;
            saveData();
            displayGames();
            displayRankings();
            updateCharts();
            
            updatePlayerBanners();  // â† è¿½åŠ 
            
            if (myPlayerId) {
                const p = players.find(function(pl) {
                    return pl.id === myPlayerId;
                });
                alert('âœ… å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºã‚’ã€Œ' + p.name + ' #' + p.number + 'ã€ã«è¨­å®šã—ã¾ã—ãŸ\n\nå±¥æ­´ãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»ã‚°ãƒ©ãƒ•ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ!');
            }
        }

        function updatePlayerBanners() {
            // é¸æ‰‹ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (myPlayerId && players.length > 0) {
                const player = players.find(function(p) { return p.id === myPlayerId; });
                const playerText = player ? player.name + ' #' + player.number : 'é¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';

                const banners = [
                    { banner: 'inputPlayerBanner', name: 'inputPlayerName' },
                    { banner: 'listPlayerBanner', name: 'listPlayerName' },
                    { banner: 'rankingPlayerBanner', name: 'rankingPlayerName' },
                    { banner: 'graphPlayerBanner', name: 'graphPlayerName' }
                ];

                banners.forEach(function(b) {
                    const bannerEl = document.getElementById(b.banner);
                    const nameEl = document.getElementById(b.name);
                    
                    if (bannerEl && nameEl) {
                        bannerEl.style.display = 'flex';
                        nameEl.textContent = playerText;
                        
                        // ã‚¯ãƒªãƒƒã‚¯æ©Ÿèƒ½ã‚’è¿½åŠ 
                        bannerEl.style.cursor = 'pointer';
                        bannerEl.style.transition = 'all 0.3s';
                        bannerEl.onclick = showPlayerSelectDialog;
                        
                        // ãƒã‚¦ã‚¹ã‚’ä¹—ã›ãŸã¨ãã®åŠ¹æœ
                        bannerEl.onmouseenter = function() {
                            this.style.transform = 'scale(1.02)';
                            this.style.boxShadow = '0 4px 12px rgba(0,0,0,0.2)';
                        };
                        
                        bannerEl.onmouseleave = function() {
                            this.style.transform = 'scale(1)';
                            this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                        };
                    }
                });
            } else {
                // é¸æ‰‹ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯éè¡¨ç¤º
                ['inputPlayerBanner', 'listPlayerBanner', 'rankingPlayerBanner', 'graphPlayerBanner'].forEach(function(id) {
                    const el = document.getElementById(id);
                    if (el) {
                        el.style.display = 'none';
                    }
                });
            }
        }
        
        // é¸æ‰‹é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showPlayerSelectDialog() {
            if (!players || players.length === 0) {
                alert('é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nå…ˆã«ã€Œé¸æ‰‹ç®¡ç†ã€ã§é¸æ‰‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const modal = document.getElementById('playerSelectModal');
    if (!modal) {
        console.error('ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        createPlayerSelectDialog();
    }
    
    const dropdown = document.getElementById('playerSelectDropdown');
    if (!dropdown) {
        console.error('ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        alert('ã‚¨ãƒ©ãƒ¼: ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„');
        return;
    }
            dropdown.innerHTML = '<option value="">é¸æ‰‹ã‚’é¸æŠ...</option>';
            
            players.forEach(function(p) {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.name + ' #' + p.number;
                
                // ç¾åœ¨é¸æŠä¸­ã®é¸æ‰‹ã«ãƒãƒ¼ã‚¯ã‚’ä»˜ã‘ã‚‹
                if (p.id === myPlayerId) {
                    option.textContent = 'â˜… ' + option.textContent;
                    option.selected = true;
                }
                
                dropdown.appendChild(option);
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
            const modal = document.getElementById('playerSelectModal');
            modal.style.display = 'flex';
        }
        
        // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹é–¢æ•°
        function closePlayerSelectDialog() {
            const modal = document.getElementById('playerSelectModal');
            modal.style.display = 'none';
        }
        
        // é¸æ‰‹é¸æŠã‚’ç¢ºå®šã™ã‚‹é–¢æ•°
        function confirmPlayerSelection() {
            const dropdown = document.getElementById('playerSelectDropdown');
            const selectedPlayerId = dropdown.value;
            
            if (!selectedPlayerId || selectedPlayerId === '') {
                alert('âŒ é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // é¸æŠã—ãŸé¸æ‰‹ã‚’æ¢ã™
            const selectedPlayer = players.find(function(p) {
                return p.id === selectedPlayerId;
            });
            
            if (!selectedPlayer) {
                alert('âŒ é¸æ‰‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
                return;
            }
            
            // é¸æ‰‹ã‚’åˆ‡ã‚Šæ›¿ãˆ
            myPlayerId = selectedPlayer.id;
            saveData();
            
            // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
            closePlayerSelectDialog();
            
            // ç”»é¢ã‚’æ›´æ–°
            updateDisplay();
            updatePlayerBanners();
            displayGames();
            displayRankings();
            updateCharts();
            
            alert('âœ… ' + selectedPlayer.name + ' #' + selectedPlayer.number + ' ã‚’é¸æŠã—ã¾ã—ãŸ!');
        }
        function updateMyPlayerSelect() {
            const sel = document.getElementById('myPlayerSelect');
            sel.innerHTML = '<option value="">é¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
            players.forEach(function(p) {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.name + ' #' + p.number;
                if (p.id === myPlayerId) opt.selected = true;
                sel.appendChild(opt);
            });
        }

        function displayPlayers() {
            const playerList = document.getElementById('playerList');
            
            if (players.length === 0) {
                playerList.innerHTML = '<p style="text-align: center; color: #999;">ã¾ã é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }

            playerList.innerHTML = players.map(function(p) {
                const isMyPlayer = p.id === myPlayerId;
                
                return '<div class="player-item">' +
                    '<div class="player-info">' +
                    '<div>' +
                    '<span class="number">#' + p.number + '</span>' +
                    '<span style="font-weight: bold; margin-left: 10px;">' + p.name + '</span>' +
                    '</div>' +
                    '<div>' +
                    (isMyPlayer ? '<span class="my-data-badge">å€‹äººãƒ¢ãƒ¼ãƒ‰è¡¨ç¤ºä¸­</span>' : '') +
                    '</div>' +
                    '</div>' +
                    '<div style="display: flex; gap: 10px; margin-top: 10px;">' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #3498db;" onclick="editPlayer(\'' + p.id + '\')">ç·¨é›†</button>' +
                    '<button class="primary-btn" style="flex: 1; padding: 10px; font-size: 0.9em; background: #e74c3c;" onclick="deletePlayer(\'' + p.id + '\')">å‰Šé™¤</button>' +
                    '</div>' +
                    '</div>';
            }).join('');
        }

        function exportData() {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                personalGames: personalGames,
                teamGames: teamGames,
                players: players,
                myPlayerId: myPlayerId,
                teamData: teamData
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ãƒã‚¹ã‚±è¨˜éŒ²_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ!');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(ev) {
                try {
                    const data = JSON.parse(ev.target.result);
                    if (confirm('âš ï¸ ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™\n\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹?')) {
                        personalGames = data.personalGames || [];
                        teamGames = data.teamGames || [];
                        players = data.players || [];
                        myPlayerId = data.myPlayerId || null;
                        teamData = data.teamData || null;
                        saveData();
                        displayGames();
                        displayPlayers();
                        alert('âœ… ãƒ‡ãƒ¼ã‚¿ã®å¾©å…ƒãŒå®Œäº†ã—ã¾ã—ãŸ!');
                        location.reload();
                    }
                } catch (err) {
                    alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        }
        // ========== å€‹äººç”¨:ã“ã®ã‚¹ãƒãƒ›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ ==========
        function confirmClearLocalData() {
            const message = 'âš ï¸ ã“ã®ã‚¹ãƒãƒ›ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™\n\n' +
                'ã€ã‚¯ãƒªã‚¢ã•ã‚Œã‚‹ã‚‚ã®ã€‘\n' +
                'â€¢ ã“ã®ã‚¹ãƒãƒ›ã®è©¦åˆè¨˜éŒ²(' + personalGames.length + 'ä»¶)\n\n' +
                'ã€ã‚¯ãƒªã‚¢ã•ã‚Œãªã„ã‚‚ã®ã€‘\n' +
                'â€¢ é¸æ‰‹æƒ…å ±\n' +
                'â€¢ Google Sheetsã®ãƒ‡ãƒ¼ã‚¿(å…¨å“¡å…±æœ‰)\n' +
                'â€¢ ä»–ã®äººã®ã‚¹ãƒãƒ›ã®ãƒ‡ãƒ¼ã‚¿\n\n' +
                'ğŸ’¡ ãƒ’ãƒ³ãƒˆ:ã€Œä»Šã™ãåŒæœŸã€ã§å¾©å…ƒã§ãã¾ã™\n\n' +
                'æœ¬å½“ã«ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹?';
            
            if (confirm(message)) {
                clearLocalData();
            }
        }

        function clearLocalData() {
    personalGames = [];
    teamGames = [];
    players = [];
    myPlayerId = null;

    saveData();

    displayGames();
    displayRankings();
    updateCharts();
    // ...å¿…è¦ãªUIæ›´æ–°
}
        // ========== ç®¡ç†è€…ç”¨:ãƒãƒ¼ãƒ å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆ ==========
        function confirmResetTeamData() {
    if (!teamData) {
        alert('ãƒãƒ¼ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã›ã‚“');
        return;
    }
    
    const message = 'ğŸ” ç®¡ç†è€…ã®ã¿å®Ÿè¡Œå¯èƒ½\n\n' +
        'âš ï¸ ãƒãƒ¼ãƒ å…¨ä½“ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™\n\n' +
        'ã€å½±éŸ¿ã€‘\n' +
        'â€¢ Google Sheetsã®è©¦åˆãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™\n' +
        'â€¢ å…¨ãƒ¡ãƒ³ãƒãƒ¼ã®ã‚¹ãƒãƒ›ã‹ã‚‰è©¦åˆè¨˜éŒ²ãŒæ¶ˆãˆã¾ã™\n' +
        'â€¢ å¾©å…ƒã§ãã¾ã›ã‚“!\n\n' +
        'ã€æ®‹ã‚‹ã‚‚ã®ã€‘\n' +
        'â€¢ é¸æ‰‹æƒ…å ±\n' +
        'â€¢ ãƒãƒ¼ãƒ è¨­å®š\n\n' +
        'ç¶šã‘ã‚‹ã«ã¯ã€ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:';
    
    const inputPassword = prompt(message);
    
    if (inputPassword === null) {
        return;
    }
    
    if (!inputPassword || inputPassword.trim() === '') {
        alert('âŒ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }
    
    const finalConfirm = confirm(
        'âš ï¸ æœ€çµ‚ç¢ºèª\n\n' +
        'ãƒãƒ¼ãƒ å…¨ä½“ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚\n' +
        'ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚\n\n' +
        'æœ¬å½“ã«å®Ÿè¡Œã—ã¾ã™ã‹?'
    );
    
    if (finalConfirm) {
        resetTeamData(inputPassword);
    }
}

        function resetTeamData(adminPassword) {  // â† ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
    personalGames = [];
    teamGames = [];
    saveData();
    
    if (teamData) {
        clearServerGameData(adminPassword);  // â† ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¸¡ã™
    }
    
    displayGames();
    displayRankings();
    updateCharts();
    if (typeof displayTeamGamesHistory === 'function') {
        displayTeamGamesHistory();
    }
    
    alert('âœ… ãƒãƒ¼ãƒ å…¨ä½“ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ!\n\nå…¨ãƒ¡ãƒ³ãƒãƒ¼ã«å½±éŸ¿ãŒã‚ã‚Šã¾ã™ã€‚\nå„ãƒ¡ãƒ³ãƒãƒ¼ã¯ã€Œä»Šã™ãåŒæœŸã€ã§ç©ºã®ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã•ã‚Œã¾ã™ã€‚');
}

async function clearServerGameData(adminPassword) {  // â† ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
    try {
        showSyncIndicator('syncing', 'ã‚µãƒ¼ãƒãƒ¼ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ä¸­...');
        
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'text/plain',
            },
            body: JSON.stringify({
                action: 'clearGames',
                teamCode: teamData.code,
                adminPassword: adminPassword  // â† ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’é€ä¿¡
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            showSyncIndicator('success', 'ã‚µãƒ¼ãƒãƒ¼ã®è©¦åˆãƒ‡ãƒ¼ã‚¿ã‚‚å‰Šé™¤å®Œäº†');
        } else {
            showSyncIndicator('error', result.error || 'ã‚µãƒ¼ãƒãƒ¼å‰Šé™¤å¤±æ•—');
            alert('âŒ ' + (result.error || 'ã‚µãƒ¼ãƒãƒ¼å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }
    } catch (error) {
        console.error('ã‚µãƒ¼ãƒãƒ¼å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        showSyncIndicator('error', 'ã‚µãƒ¼ãƒãƒ¼å‰Šé™¤å¤±æ•—');
        alert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
    }
}

        // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
        function openShotPositionModal(callback) {
            shotChartCallback = callback;
            currentShotPosition = null;
            
            const modal = document.getElementById('shotPositionModal');
            const canvas = document.getElementById('shotCourtCanvas');
            const container = document.getElementById('shotCourtContainer');
            
            // ã‚³ãƒ¼ãƒˆå›³ã‚’æç”»
            drawCourt(canvas);
            
            // ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            container.onclick = function(e) {
                const rect = canvas.getBoundingClientRect();
                const x = ((e.clientX - rect.left) / rect.width) * canvas.width;
                const y = ((e.clientY - rect.top) / rect.height) * canvas.height;
                
                // è¨˜éŒ²ã•ã‚ŒãŸä½ç½®ã‚’ä¿å­˜
                currentShotPosition = { x: x, y: y };
                
                // ä¸€æ™‚çš„ãªãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤º
                drawCourt(canvas);
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(x, y, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // è‡ªå‹•çš„ã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã¦è¨˜éŒ²
                setTimeout(function() {
                    confirmShotPosition();
                }, 300);
            };
            
            modal.classList.add('active');
        }
        
        // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
        function closeShotPositionModal() {
            const modal = document.getElementById('shotPositionModal');
            modal.classList.remove('active');
            currentShotPosition = null;
            shotChartCallback = null;
        }
        
        // ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ã‚’ç¢ºå®š
        function confirmShotPosition() {
            if (currentShotPosition && shotChartCallback) {
                const canvas = document.getElementById('shotCourtCanvas');
                const zone = getZoneFromPosition(
                    currentShotPosition.x,
                    currentShotPosition.y,
                    canvas.width,
                    canvas.height
                );
                
                shotChartCallback({
                    x: currentShotPosition.x,
                    y: currentShotPosition.y,
                    zone: zone
                });
            }
            closeShotPositionModal();
        }
        
        // ä½ç½®è¨˜éŒ²ã‚’ã‚¹ã‚­ãƒƒãƒ—
        function skipShotPosition() {
            if (shotChartCallback) {
                shotChartCallback(null);
            }
            closeShotPositionModal();
        }
        loadData();
        migrateData();
        updateDisplay();
        displayGames();
        displayPlayers();
        updateMyPlayerSelect();
        displayTeamStatus();
        updatePlayerBanners();
        loadTeamData();
        checkAndShowDraftGame();
        
        // ========== é¸æ‰‹é¸æŠãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®HTMLä½œæˆ ==========
        function createPlayerSelectDialog() {
            const dialogHTML = `
                <div id="playerSelectModal" class="modal-overlay" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h2>ğŸ€ é¸æ‰‹ã‚’é¸æŠ</h2>
                            <button class="modal-close" onclick="closePlayerSelectDialog()">Ã—</button>
                        </div>
                        <div class="modal-body">
                            <p style="margin-bottom: 15px; color: #666;">å€‹äººãƒ¢ãƒ¼ãƒ‰ã§è¡¨ç¤ºã™ã‚‹é¸æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„</p>
                            <select id="playerSelectDropdown" class="player-select-dropdown">
                                <option value="">é¸æ‰‹ã‚’é¸æŠ...</option>
                            </select>
                        </div>
                        <div class="modal-footer">
                            <button class="modal-btn cancel-btn" onclick="closePlayerSelectDialog()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            <button class="modal-btn confirm-btn" onclick="confirmPlayerSelection()">é¸æŠ</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', dialogHTML);
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ä½œæˆ
        createPlayerSelectDialog();
    </script>
    <!-- ========== ã“ã“ã‹ã‚‰è¿½åŠ  ========== -->
    
    <!-- ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="shotPositionModal" class="shot-chart-modal">
        <div class="shot-chart-content">
            <h2 style="text-align: center; color: #667eea;">ğŸ¯ ã©ã“ã‹ã‚‰æ‰“ã£ãŸï¼Ÿ</h2>
            <p style="text-align: center; color: #666; margin-bottom: 10px;">
                ã‚³ãƒ¼ãƒˆã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚·ãƒ¥ãƒ¼ãƒˆä½ç½®ã‚’è¨˜éŒ²
            </p>
            
            <div class="court-container" id="shotCourtContainer">
                <canvas id="shotCourtCanvas" class="court-canvas" width="300" height="400"></canvas>
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="modal-btn cancel-btn" style="flex: 1;" onclick="closeShotPositionModal()">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button class="modal-btn confirm-btn" style="flex: 1;" onclick="skipShotPosition()">
                    ä½ç½®ã‚’è¨˜éŒ²ã›ãšã‚¹ã‚­ãƒƒãƒ—
                </button>
            </div>
        </div>
    </div>

    </body>
</html>
    
